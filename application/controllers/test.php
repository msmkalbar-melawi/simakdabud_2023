$sql = "SELECT * from (( select (ROW_NUMBER() OVER (ORDER BY ss.kd_program))no_urut,ss.kd_skpd,(ss.kd_program)kode,rtrim(nm_program)uraian,sum(anggaran)anggaran,sum(spd_lalu)spd_lalu, sum(nilai)nilai from ( SELECT ('')no_urut,b.kd_skpd,rtrim(a.kd_sub_kegiatanxxx)kode,c.nm_kegiatan, isnull(( SELECT SUM(nilai) FROM trdrka WHERE kd_sub_kegiatan = a.kd_sub_kegiatan AND left(kd_skpd,17)=left(b.kd_skpd,17)),0) AS anggaran, isnull(( SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd WHERE c.kd_sub_kegiatan = a.kd_sub_kegiatan AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu, a.nilai,a.kd_program FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join trskpd c on a.kd_sub_kegiatan=c.kd_sub_kegiatan and b.kd_skpd=c.kd_skpd WHERE a.no_spd = '13.07/01.0/000001/1.03.0.00.0.00.02.0000/M/1/2021') ss inner join trskpd b on ss.kode=b.kd_sub_kegiatan and b.kd_skpd=ss.kd_skpd group by no_urut,ss.kd_skpd,ss.kd_program,nm_program ) union all select ('')no_urut,ss.kd_skpd,rtrim(left(b.kd_sub_kegiatan,12))kode, (select rtrim(j.nm_kegiatan) from ms_kegiatan j where j.kd_kegiatan=left(b.kd_sub_kegiatan,12))as uraian, sum(anggaran)anggaran,sum(spd_lalu)spd_lalu,sum(nilai)nilai from ( SELECT ('')no_urut,b.kd_skpd,rtrim(a.kd_sub_kegiatan)kode,c.nm_kegiatan, isnull(( SELECT SUM(nilai) FROM trdrka WHERE kd_sub_kegiatan = a.kd_sub_kegiatan AND left(kd_skpd,17)=left(b.kd_skpd,17)),0) AS anggaran, isnull(( SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd WHERE c.kd_sub_kegiatan = a.kd_sub_kegiatan AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu, a.nilai,a.kd_program FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join trskpd c on a.kd_sub_kegiatan=c.kd_sub_kegiatan and b.kd_skpd=c.kd_skpd WHERE a.no_spd = '13.07/01.0/000001/1.03.0.00.0.00.02.0000/M/1/2021' ) ss inner join ms_sub_kegiatan b on ss.kode=b.kd_sub_kegiatan group by no_urut,ss.kd_skpd,left(b.kd_sub_kegiatan,12) union all ( SELECT ('')no_urut,b.kd_skpd,rtrim(a.kd_sub_kegiatan)kode,c.nm_sub_kegiatan, isnull(( SELECT SUM(nilai) FROM trdrka WHERE kd_sub_kegiatan = a.kd_sub_kegiatan AND left(kd_skpd,17)=left(b.kd_skpd,17)),0) AS anggaran, isnull(( SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd WHERE c.kd_sub_kegiatan = a.kd_sub_kegiatan AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu, a.nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join trskpd c on a.kd_sub_kegiatan=c.kd_sub_kegiatan and b.kd_skpd=c.kd_skpd WHERE a.no_spd = '13.07/01.0/000001/1.03.0.00.0.00.02.0000/M/1/2021') ) zt order by kode"