<?php  if ( ! defined('BASEPATH')) exit('No direct script access allowed');


class Rka extends CI_Controller {

public $ppkd = "1.20.12";
public $ppkd1 = "1.20.12.02";

	function __contruct()
	{	
		parent::__construct();
	}
	
    function rp_minus($nilai){
        if($nilai<0){
            $nilai = $nilai * (-1);
            $nilai = '('.number_format($nilai,"2",",",".").')';    
        }else{
            $nilai = number_format($nilai,"2",",","."); 
        }
        
        return $nilai;
    }  	

    function nvl($val, $replace){
        if( is_null($val) || $val === '' )  
            return $replace;
        else                                
            return $val;
    }	
 
    function persen($nilai,$nilai2){
            if($nilai != 0){
                $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
            }else{
                if($nilai2 == 0){
                    $persen = $this->rp_minus(0);
                }else{
                    $persen = $this->rp_minus(100);
                }
            } 
          return $persen;  
	 }
 
	function get_status($tgl,$skpd){
        $n_status = '';
        $tanggal = $tgl;
        $sql = "select case when '$tanggal'>=tgl_dpa_ubah then 'nilai_ubah' 
                    when '$tanggal'>=tgl_dpa_sempurna then 'nilai_sempurna' 
                    when '$tanggal'<=tgl_dpa 
                    then 'nilai' else 'nilai' end as anggaran from trhrka where kd_skpd ='$skpd' ";
        
        $q_trhrka = $this->db->query($sql);
        $num_rows = $q_trhrka->num_rows();
        
        foreach ($q_trhrka->result() as $r_trhrka){
             $n_status = $r_trhrka->anggaran;                   
        }    
        return $n_status;                         
    }
// SPD BTL
    function spd_btl(){
        $data['page_title']= 'INPUT SPD BTL';
        $this->template->set('title', 'INPUT SPD BTL');   
        $this->template->load('template','anggaran/rka/spd_btl',$data) ; 
    }
    

function load_dspd_btl($jenis='',$skpd='',$awal='',$ahir='',$nospd=''){
        
		/*$stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		if ($stsubah==0){
			$field="b.nilai";		
			$sts="susun";		
		}else{
			$field="b.nilai_ubah";				
			$sts="ubah";		
		}*/
        
        
		$tgl = $this->input->post('tgl');
        $n_status = $this->get_status($tgl,$skpd);
		$spd = str_replace('123456789','/',$nospd);
        
		$field= 'b.'.$n_status;
        //echo '<script type="text/javascript">alert("' . $n_status. '"); </script>';
		$sql = "SELECT a.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program, a.kd_rek5, a.nm_rek5, a.anggaran, 0 as nilai, b.nilai as lalu FROM (
    				select b.kd_kegiatan,f.nm_kegiatan,f.kd_program,c.nm_program,b.kd_rek5,d.nm_rek5,$field as anggaran 
                	FROM trdrka b 
                	join trskpd g on b.kd_kegiatan=g.kd_kegiatan
                	join m_giat f on g.kd_kegiatan1=f.kd_kegiatan 
                	join m_prog c on f.kd_program=c.kd_program 
                	join ms_rek5 d on b.kd_rek5=d.kd_rek5
                	WHERE b.kd_skpd='$skpd' and g.jns_kegiatan ='$jenis') a 
                LEFT JOIN (
    				SELECT kd_kegiatan,kd_rek5,SUM(a.nilai) as nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd 
    				WHERE b.kd_skpd='$skpd' and a.no_spd != '$spd'
    				GROUP BY kd_kegiatan,kd_rek5) b
				ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_rek5 = b.kd_rek5
				ORDER BY a.kd_rek5
				";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte){ 
		$result[] = array(
                        'id'          => $ii,        
                        'no_spd'      => '',
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
						'nilai'       => number_format($resulte['nilai'],"2",".",","),
                        'lalu'        => number_format($resulte['lalu'],"2",".",","),
                        'anggaran'    => number_format($resulte['anggaran'],"2",".",",")
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	
	}
	
	 function load_spd_btl() {
		$kd_skpd = $this->session->userdata('kdskpd'); 
		//$kd_skpd = '1.20.08.10'; 
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $id  = $this->session->userdata('pcUser'); 
        
        $where ="WHERE jns_beban='51' and a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')";
        if ($kriteria <> ''){                               
            $where="where ((upper(a.no_spd) like upper('%$kriteria%') or a.tgl_Spd like '%$kriteria%' or upper(a.nm_skpd) like 
                    upper('%$kriteria%') or upper(a.kd_skpd) like upper('%$kriteria%')) and upper(a.jns_beban)='51' and 
                    a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhspd a $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();
        
        //$sql = "SELECT *,IF(jns_beban='52','Belanja Langsung','Belanja Tidak Langsung') AS nm_beban from trhspd $where order by tgl_Spd,kd_skpd limit $offset,$rows";
		
        $sql = "SELECT TOP $rows  a.*,nama,case when jns_beban='52' then 'Belanja Langsung' else 'Belanja Tidak Langsung' end AS nm_beban from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip  $where and no_spd not in (select top $offset no_spd from trhspd a left join ms_ttd b on a.kd_bkeluar=b.nip
		where a.jns_beban='51' and a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') order by a.no_spd,a.tgl_spd,a.kd_skpd)
		order by no_spd,tgl_Spd,kd_skpd ";
        $query1 = $this->db->query($sql);  
           
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'tgl_spd' => $resulte['tgl_spd'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
						'ketentuan' => $resulte['klain'],
						'nama_bend' => $resulte['nama'],
						'nip' => $resulte['kd_bkeluar'],						
                        'jns_beban' => $resulte['jns_beban'],
                        'nm_beban' => $resulte['nm_beban'],
                        'bulan_awal' => $resulte['bulan_awal'],
                        'bulan_akhir' => $resulte['bulan_akhir'],
                        'total' => $resulte['total'],                                                                      
                        'status' => $resulte['status']                                                                      
                        );
                        $ii++;
        }
        $result["rows"] = $row;           
        echo json_encode($result);
        $query1->free_result();    	   
	}

// END SPD BTL

// SPD BL
    function spd_bl(){
        $data['page_title']= 'INPUT SPD BL';
        $this->template->set('title', 'INPUT SPD BL');   
        $this->template->load('template','anggaran/rka/spd_bl',$data) ; 
    }

	 function load_spd_bl() {
		$kd_skpd = $this->session->userdata('kdskpd'); 
		//$kd_skpd = '1.20.08.10'; 
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $id  = $this->session->userdata('pcUser');  
        $where ="WHERE jns_beban='52' and a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ";
        if ($kriteria <> ''){                               
            $where="where ((upper(a.no_spd) like upper('%$kriteria%') or a.tgl_Spd like '%$kriteria%' or upper(a.nm_skpd) like 
                    upper('%$kriteria%') or upper(a.kd_skpd) like upper('%$kriteria%')) and upper(a.jns_beban)='52' 
                    and a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') ) ";            
        }
        
        $sql = "SELECT count(*) as total from trhspd a $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();
        
        //$sql = "SELECT *,IF(jns_beban='52','Belanja Langsung','Belanja Tidak Langsung') AS nm_beban from trhspd $where order by tgl_Spd,kd_skpd limit $offset,$rows";
		
        $sql = "SELECT TOP $rows  a.*,nama,case when jns_beban='52' then 'Belanja Langsung' else 'Belanja Tidak Langsung' end AS nm_beban from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip  $where  AND no_spd not in (SELECT TOP $offset  no_spd from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip where a.jns_beban='52' and a.kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') order by a.no_spd,a.tgl_Spd,a.kd_skpd) order by no_spd,tgl_Spd,kd_skpd ";
        $query1 = $this->db->query($sql);       
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'tgl_spd' => $resulte['tgl_spd'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
						'ketentuan' => $resulte['klain'],
						'nama_bend' => $resulte['nama'],
						'nip' => $resulte['kd_bkeluar'],						
                        'jns_beban' => $resulte['jns_beban'],
                        'nm_beban' => $resulte['nm_beban'],
                        'bulan_awal' => $resulte['bulan_awal'],
                        'bulan_akhir' => $resulte['bulan_akhir'],
                        'total' => $resulte['total'],                                                                      
                        'status' => $resulte['status']                                                                      
                        );
                        $ii++;
        }
        $result["rows"] = $row;           
        echo json_encode($result);
        $query1->free_result();    	   
	}
	
function load_dspd_bl($jenis='',$skpd='',$awal='',$ahir='',$nospd=''){
        /*
		$stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		if ($stsubah==0){
			$field="b.nilai";		
			$sts="susun";		
		}else{
			$field="b.nilai_ubah";				
			$sts="ubah";		
		}
		*/
		$tgl = $this->input->post('tgl');
		$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="AND (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }

		$sql = "SELECT count(*) as tot FROM trskpd a WHERE a.kd_skpd='$skpd' and a.jns_kegiatan ='52'";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        //echo '<script type="text/javascript">alert("' . $skpd. '"); </script>';
        
        $n_status = $this->get_status($tgl,$skpd);
		$spd = str_replace('123456789','/',$nospd);
		$field= 'b.'.$n_status;
		//$field='b.nilai_sempurna';
		if($n_status=='nilai_sempurna'){
			$n_trdskpd = 'trdskpd_sempurna';
		}else{
			$n_trdskpd = 'trdskpd';
		}
		
		$spd = str_replace('123456789','/',$nospd);
/*
		$sql = "SELECT TOP $rows a.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program, '' as kd_rek5 , '' as nm_rek5, 
				a.total_ubah as anggaran, nilai,lalu FROM(
                    SELECT b.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program, '' as kd_rek5 , '' as nm_rek5, 
    				sum($field) as total_ubah, b.kd_skpd
    				FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                    WHERE b.kd_skpd='$skpd' and a.jns_kegiatan ='52' group by b.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program,b.kd_skpd
                ) a LEFT JOIN (
                    SELECT kd_kegiatan, kd_skpd, SUM(nilai) as nilai FROM trdskpd b WHERE b.bulan>='$awal' AND b.bulan<='$ahir'
				    AND kd_skpd='$skpd' GROUP BY kd_kegiatan, kd_skpd
                )b ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd LEFT JOIN (
                    SELECT kd_kegiatan,SUM(a.nilai) as lalu FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd 
				    WHERE b.kd_skpd='$skpd' and a.no_spd != '$spd'
				    GROUP BY kd_kegiatan
                ) c ON a.kd_kegiatan=c.kd_kegiatan
				WHERE a.kd_kegiatan NOT IN (SELECT TOP $offset kd_kegiatan FROM  trskpd a WHERE a.kd_skpd='$skpd' and a.jns_kegiatan ='51' ORDER BY a.kd_kegiatan)
				ORDER BY a.kd_kegiatan 
				";
*/
		$sql = "SELECT TOP $rows a.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program, '' as kd_rek5 , '' as nm_rek5, 
				a.total_ubah as anggaran, nilai,lalu FROM(
                    SELECT b.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program, '' as kd_rek5 , '' as nm_rek5, 
    				sum($field) as total_ubah, b.kd_skpd
    				FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                    WHERE b.kd_skpd='$skpd' and a.jns_kegiatan ='52' group by b.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program,b.kd_skpd
                ) a LEFT JOIN (
                    SELECT kd_kegiatan, kd_skpd, SUM(nilai) as nilai FROM $n_trdskpd b WHERE b.bulan>='$awal' AND b.bulan<='$ahir'
				    AND kd_skpd='$skpd' GROUP BY kd_kegiatan, kd_skpd
                )b ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd LEFT JOIN (
                    SELECT kd_kegiatan,SUM(a.nilai) as lalu FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd 
				    WHERE b.kd_skpd='$skpd' and a.no_spd != '$spd'
				    GROUP BY kd_kegiatan
                ) c ON a.kd_kegiatan=c.kd_kegiatan
				WHERE a.kd_kegiatan NOT IN (SELECT TOP $offset kd_kegiatan FROM  trskpd a WHERE a.kd_skpd='$skpd' and a.jns_kegiatan ='51' ORDER BY a.kd_kegiatan)
				ORDER BY a.kd_kegiatan 
				";

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id'          => $ii,        
                        'no_spd'      => '',
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
						'nilai'       => number_format($resulte['nilai'],"2",".",","),
                        'lalu'        => number_format($resulte['lalu'],"2",".",","),
                        'anggaran'    => number_format($resulte['anggaran'],"2",".",",")
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        $query1->free_result();   
        echo json_encode($result);
	}

	function load_tot_dspd_bl($jenis='',$skpd='',$awal='',$ahir='',$nospd='',$tgl1=''){
	
        /*
		$stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		if ($stsubah==0){
			$field="b.nilai";		
			$sts="susun";		
		}else{
			$field="b.nilai_ubah";				
			$sts="ubah";		
		}
		*/

        $n_status = $this->get_status($tgl1,$skpd);
		
		$field= 'b.'.$n_status;
		//$field='b.nilai_sempurna';
		if($n_status=='nilai_sempurna'){
			$n_trdskpd = 'trdskpd_sempurna';
		}else{
			$n_trdskpd = 'trdskpd';
		}
		
		$spd = str_replace('123456789','/',$nospd);
		$sql = "SELECT SUM(nilai) as nilai FROM
				(SELECT a.kd_kegiatan, a.nm_kegiatan, a.kd_program, a.nm_program, '' as kd_rek5 , '' as nm_rek5, 
				 kd_skpd
				FROM trskpd a WHERE a.kd_skpd='$skpd' and a.jns_kegiatan ='52') a
				LEFT JOIN
				(SELECT kd_kegiatan, kd_skpd, SUM(nilai) as nilai FROM $n_trdskpd b WHERE b.bulan>='$awal' AND b.bulan<='$ahir'
				AND kd_skpd='$skpd'
				GROUP BY kd_kegiatan, kd_skpd)b
				ON a.kd_kegiatan=b.kd_kegiatan AND a.kd_skpd=b.kd_skpd";
        $query1 = $this->db->query($sql);  
        $ii     = 0;

         foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'nilai' => $resulte['nilai']
                        );
                        $ii++;
        }
		
				
        echo json_encode($result);
    	$query1->free_result();   
	}

	function load_dspd_ag_bl() {            
        $no = $this->input->post('no');
		$jenis = $this->input->post('jenis');
		$skpd = $this->input->post('skpd');
        $tgl = $this->input->post('tgl');
		//$stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
		$rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
		$offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="AND (upper(no_sp2d) like upper('%$kriteria%') or tgl_sp2d like '%$kriteria%' or upper(kd_skpd) like 
                    upper('%$kriteria%') or upper(jns_spp) like upper('%$kriteria%')) ";            
        }

		$sql = "SELECT count(*) as tot from trdspd WHERE no_spd='$no'";
        $query1 = $this->db->query($sql);
        $total = $query1->row();
		
        $n_status = $this->get_status($tgl,$skpd);
		//$spd = str_replace('123456789','/',$nospd);

		if ($jenis=='52'){
		//$field=$n_status;		
        $field='nilai_sempurna';
		$sql = "SELECT TOP $rows a.*,kd_rek5,nm_rek5 ,(SELECT SUM(nilai) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu,
                (select sum($field) from trdrka where kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd) AS anggaran from trdspd a inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' AND b.kd_skpd='$skpd' 
				AND a.kd_kegiatan NOT IN (SELECT TOP $offset kd_kegiatan FROM trdspd where no_spd = '$no' order by kd_kegiatan)order by b.no_spd,a.kd_kegiatan,a.kd_rek5";
		}else {
		//$field="$n_status";		
        $field='nilai_sempurna';
		$sql = "SELECT a.*,kd_rek5,nm_rek5 ,isnull((SELECT SUM(nilai) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd 
				WHERE n.kd_kegiatan=a.kd_kegiatan  and kd_rek5=a.kd_Rek5 and m.no_spd <> '$no'),0) AS lalu,
				(SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd and kd_rek5=a.kd_Rek5 ) AS anggaran from trdspd a
				inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";
		}
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
                        'nilai'       => number_format($resulte['nilai'],"2",".",","),
                        'lalu'        => number_format($resulte['lalu'],"2",".",","),
                        'anggaran'    => number_format($resulte['anggaran'],"2",".",",")                               
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        $query1->free_result();   
        echo json_encode($result);
	}
 
// END SPD BL	
	


 /* 
function rka0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0','');
	} */
/* function rka1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1','rka1','');
	} */
/* function rka21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21','rka21','');
	} */

	/* function rka22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 22','rka22','');
	}
 */
	function rka221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221','');
	}
function rka0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0 PPKD','rka0pkd','');
	}
function rka1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1 PPKD','rka1pkd','');
	}
function rka21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21 PPKD','rka21pkd','');
	}
function rka31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 31 PPKD','rka31','');
	}
function rka32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 32 PPKD','rka32','');
	}
function dpa0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0','dpa0','');
	}
function dppa0()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 0','dppa0','');
	}
function dppa0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 0','dppa0pkd','');
	}
function dpa1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1','dpa1','');
	}
function dppa1()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 1','dppa1','');
	}
function dppa1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 1','dppa1pkd','');
	}
function dpa21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21','dpa21','');
	}
function dppa21()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 21','dppa21','');
	}
function dppa21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 21','dppa21pkd','');
	}
function dpa22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 22','dpa22','');
	}
function dppa22()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 22','dppa22','');
	}
function dpa221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 221','dpa221','');
	}
function dppa221()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221','dppa221','');
	}
function dpa0pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0 PPKD','dpa0pkd','');
	}
function dpa1pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1 PPKD','dpa1pkd','');
	}
function dpa21pkd()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21 PPKD','dpa21pkd','');
	}
function dpa31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 31 PPKD','dpa31','');
	}
function dppa31()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 31 PPKD','dppa31','');
	}
function dpa32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 32 PPKD','dpa32','');
	}
function dppa32()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 32 PPKD','dppa32','');
	}    
function perda_1()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN I','perda_1','');
	}
function pergub_1()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERGUB APBD LAMPIRAN I','pergub_1','');
	}
	
function perda_II()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN II','perda_II','');
	}

function perdaunit_III()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD UNIT LAMPIRAN III','perdaunit_III','');
	}    
	
 function perda_III()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN III','perda_III','');
	}
	
function perda_IV()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN IV','perda_IV','');
	}

function perda_V()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN V','perda_V','');
	}	
	
function ctk_ringkasbelanja()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','Ringkasan Belanja Per Fungsi, Urusan, Organisasi dan Jenis','ctk_ringkasbelanja','');
	}
	
 function perkada_II()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II PENJABARAN APBD PERUNIT','perkada_II','');
	}    
 function perkada_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_ubah','');
	}   
 function perda_1_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN I','perda_1_ubah','');
	}

function perda_III_ubah()
	{	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN III','perdaIII_ubah','');
	}  

function posting_ang()
    {
        $data['page_title']= 'POSTING';
        $this->template->set('title', 'POSTING');   
        $this->template->load('template','anggaran/rka/posting_ang',$data) ; 
    }


/* function pergub_1()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','PERGUB APBD LAMPIRAN I','pergub_1','');
	} */
	
function index($offset=0,$lctabel,$field,$field1,$judul,$list,$lccari)
	{
		$data['page_title'] = "CETAK $judul";
		
		//$total_rows = $this->master_model->get_count($lctabel);
        if(empty($lccari)){
            $total_rows = $this->master_model->get_count($lctabel);
            $lc = "/.$lccari";
        }else{
            $total_rows = $this->master_model->get_count_teang($lctabel,$field,$field1,$lccari);
            $lc = "";
        }
		// pagination        
		$config['base_url']		= site_url("rka/".$list);
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	           
		//$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
         if(empty($lccari)){     
		$data['list'] 		= $this->master_model->getAll($lctabel,$field,$limit, $offset);
        }else {
            $data['list'] 		= $this->master_model->getCari($lctabel,$field,$field1,$limit, $offset,$lccari);
        }
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		$a=$judul;
		$data['sikap'] = 'list';
		$this->template->set('title', 'CETAK ');
		$this->template->load('template', "anggaran/rka/".$list, $data);
	}
    
   
    
    function  tanggal_format_indonesia($tgl){
        $tanggal  =  substr($tgl,8,2);
        $bulan  = $this-> getBulan(substr($tgl,5,2));
        $tahun  =  substr($tgl,0,4);
        return  $tanggal.' '.$bulan.' '.$tahun;

    }
 
    function  getBulan($bln){
        switch  ($bln){
        case  1:
        return  "Januari";
        break;
        case  2:
        return  "Februari";
        break;
        case  3:
        return  "Maret";
        break;
        case  4:
        return  "Maret";
        break;
        case  5:
        return  "Mei";
        break;
        case  6:
        return  "Juni";
        break;
        case  7:
        return  "Juli";
        break;
        case  8:
        return  "Agustus";
        break;
        case  9:
        return  "September";
        break;
        case  10:
        return  "Oktober";
        break;
        case  11:
        return  "November";
        break;
        case  12:
        return  "Desember";
        break;
    }
    }
    function right($value, $count){
    return substr($value, ($count*-1));
    }

    function left($string, $count){
    return substr($string, 0, $count);
    }

    function  dotrek($rek){
				$nrek=strlen($rek);
				switch ($nrek) {
                case 1:
				$rek = $this->left($rek,1);								
       			 break;
    			case 2:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1);								
       			 break;
    			case 3:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1);								
       			 break;
    			case 5:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2);								
        		break;
    			case 7:
					$rek = $this->left($rek,1).'.'.substr($rek,1,1).'.'.substr($rek,2,1).'.'.substr($rek,3,2).'.'.substr($rek,5,2);								
        		break;
    			default:
				$rek = "";	
				}
				return $rek;
    }
	

	
    
    function preview_rka0(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td rowspan=\"4\" align=\"center\">
                            <!--<img src=\"".base_url()."/image/prov.jpg\" width=\"90\"height=\"100\" />-->
                        </td>
                         <td width=\"60%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>"; 
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        
        //echo("$cRet");
        $data['prev']= $cRet;
        $this->_mpdf('',$cRet,10,10,10,0);
        //$data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        
        //$this->_mpdf('',$cRet,10,10,10,'0');
        
                
    }
/*	
     function preview_dpa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '2.2' AS NO ,'Belanja langsung' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)<>'00' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,'.',',');
                    $triw2= number_format($triw->triw2,2,'.',',');
					$triw3= number_format($triw->triw3,2,'.',',');
					$triw4= number_format($triw->triw4,2,'.',',');
					$total= number_format($triw->jumlah,2,'.',',');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
*/    
    function preview_dppa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPPA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Satuan Kerja Perangkat daerah </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" rowspan=\"2\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"46%\" align=\"center\" rowspan=\"2\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"2\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\" colspan=\"2\"><b>Bertambah (berkurang)</b></td></tr>
                        <tr align=\"center\">	
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>sebelum Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>setelah Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>(Rp)</b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\"><b>%</b></td>
		                 </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"46%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            </tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $uraian=$row->nm_rek;
                    $nilai= number_format($row->nilai,"2",",",".");
                    $nilai_u= number_format($row->nilai_u,"2",",",".");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $totp=number_format($rowp->totp,"2",",",".");
                    $totp1=$rowp->totp;
                    $totp_u=number_format($rowp->totp_u,"2",",",".");
                    $totp1_u=$rowp->totp_u;
                    $n_p = $totp1_u - $totp1;
                    if ($n_p < 0){
                    	$x1="("; $n_p=$n_p*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $p_selisih = number_format($n_p,"2",",",".");
                    $per1   = ($n_p!=0)?($n_p / $totp1 ) * 100:0; 
                    $persenp= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$p_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenp</td>
                                     </tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $rek=$row1->rek;
                    $uraian=$row1->nm_rek;
                    $nilai= number_format($row1->nilai,"2",",",".");
                    $nilai_u= number_format($row1->nilai_u,"2",",",".");
                    $n=$row1->nilai;
                    $n_u=$row1->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $totb=number_format($rowb->totb,"2",",",".");
                    $totb1=$rowb->totb;
                    $totb_u=number_format($rowb->totb_u,"2",",",".");
                    $totb1_u=$rowb->totb_u;
                    $n_b = $totb1_u - $totb1;
                    if ($n_b < 0){
                    	$x1="("; $n_b=$n_b*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $b_selisih = number_format($n_b,"2",",",".");
                    $per1   = ($n_b!=0)?($n_b / $totb1 ) * 100:0; 
                    $persenb= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$b_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenb</td>
                                     </tr>";
                 } 
                  
                  $suplus=$totb1-$totp1; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');
                 $suplus_u=$totb1_u-$totp1_u; 
                  if ($suplus_u < 0){
                	$x1="(";
                	$suplus_u=$suplus_u*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp_u=number_format($suplus_u,2,'.',',');
                 $n_surp = $suplus_u - $suplus;
                    if ($n_surp < 0){
                    	$x1="("; $n_surp=$n_surp*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $surp_selisih = number_format($n_surp,"2",",",".");
                    $per1   = ($n_surp!=0)?($n_surp / $suplus ) * 100:0; 
                    $persurp= number_format($per1,"2",",",".");   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_u$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$x1$persurp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td></tr>";
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '2.2' AS NO ,'Belanja langsung' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)<>'00' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,'.',',');
                    $triw2= number_format($triw->triw2,2,'.',',');
					$triw3= number_format($triw->triw3,2,'.',',');
					$triw4= number_format($triw->triw4,2,'.',',');
					$total= number_format($triw->jumlah,2,'.',',');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_dppa0pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPPA - PPKD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Dokumen Pelaksanaan Perubahan Anggaran Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\" rowspan=\"2\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"46%\" align=\"center\" rowspan=\"2\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"2\"><b>JUMLAH(Rp.)</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\" colspan=\"2\"><b>Bertambah (berkurang)</b></td></tr>
                        <tr align=\"center\">	
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>sebelum Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>setelah Perubahan </b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"13%\"><b>(Rp)</b></td>
				            <td bgcolor=\"#CCCCCC\" align=\"center\" width=\"5%\"><b>%</b></td>
		                 </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"46%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"13%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            </tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $uraian=$row->nm_rek;
                    $nilai= number_format($row->nilai,"2",",",".");
                    $nilai_u= number_format($row->nilai_u,"2",",",".");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $totp=number_format($rowp->totp,"2",",",".");
                    $totp1=$rowp->totp;
                    $totp_u=number_format($rowp->totp_u,"2",",",".");
                    $totp1_u=$rowp->totp_u;
                    $n_p = $totp1_u - $totp1;
                    if ($n_p < 0){
                    	$x1="("; $n_p=$n_p*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $p_selisih = number_format($n_p,"2",",",".");
                    $per1   = ($n_p!=0)?($n_p / $totp1 ) * 100:0; 
                    $persenp= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$p_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenp</td>
                                     </tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $rek=$row1->rek;
                    $uraian=$row1->nm_rek;
                    $nilai= number_format($row1->nilai,"2",",",".");
                    $nilai_u= number_format($row1->nilai_u,"2",",",".");
                    $n=$row1->nilai;
                    $n_u=$row1->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE (LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518')) and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $totb=number_format($rowb->totb,"2",",",".");
                    $totb1=$rowb->totb;
                    $totb_u=number_format($rowb->totb_u,"2",",",".");
                    $totb1_u=$rowb->totb_u;
                    $n_b = $totb1_u - $totb1;
                    if ($n_b < 0){
                    	$x1="("; $n_b=$n_b*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $b_selisih = number_format($n_b,"2",",",".");
                    $per1   = ($n_b!=0)?($n_b / $totb1 ) * 100:0; 
                    $persenb= number_format($per1,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$totb_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$b_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persenb</td>
                                     </tr>";
                 } 
                  
                  $suplus=$totb1-$totp1; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');
                 $suplus_u=$totb1_u-$totp1_u; 
                  if ($suplus_u < 0){
                	$x1="(";
                	$suplus_u=$suplus_u*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp_u=number_format($suplus_u,2,',','.');
                 $n_surp = $suplus_u - $suplus;
                    if ($n_surp < 0){
                    	$x1="("; $n_surp=$n_surp*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $surp_selisih = number_format($n_surp,"2",",",".");
                    $per1   = ($n_surp!=0)?($n_surp / $suplus ) * 100:0; 
                    $persurp= number_format($per1,"2",",",".");   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_u$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$x1$surp_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$x1$persurp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                </tr>";
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $rek=$row2->rek;
                    $uraian=$row2->nm_rek;
                    $nilai= number_format($row2->nilai,"2",",",".");
                    $nilai_u= number_format($row2->nilai_u,"2",",",".");
                    $n=$row2->nilai;
                    $n_u=$row2->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",",",".");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$rek</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$nilai_u</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$n_selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td></tr>";
                }
                
                $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                    $pm_u=$rowpm->totpm_u;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                    $pk_u=$rowpk->totpk_u;
                   
                 }
                    
                  $pmnetto=$pm-$pk;
                  $pmnett=number_format($pmnetto,2,',','.');
                  $pmnetto_u=$pm_u-$pk_u;
                  $pmnett_u=number_format($pmnetto_u,2,',','.');
                  $netto= $pmnetto_u - $pmnetto;
                  if ($netto < 0){
                	$a1="(";
                	$netto=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nettoo=number_format($netto,2,',','.');
                    $pers   = ($netto!=0)?($netto / $pmnetto ) * 100:0; 
                    $p= number_format($per1,"2",".",","); 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\">Jumlah Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pmnett</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pmnett_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$a1$nettoo$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$p</td>
                                     </tr>";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"46%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     </tr>";
                  
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"25%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"71%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"14%\" style=\"text-align: center;\">I </td>
                                <td width=\"14%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                    UNION
                    SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                    WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'
                    UNION
                    SELECT '3.1' AS NO ,'Pembiayaan Masuk' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)='00.03' AND kd_skpd='$id'
                    UNION
                    SELECT '3.2' AS NO ,'Pembiayaan Keluar' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS                    jumlah FROM trskpd
                    WHERE RIGHT (kd_program,2)='00.04' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,',','.');
                    $triw2= number_format($triw->triw2,2,',','.');
					$triw3= number_format($triw->triw3,2,',','.');
					$triw4= number_format($triw->triw4,2,',','.');
					$total= number_format($triw->jumlah,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"4%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"23%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    function preview_rka0pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">Ringkasan Anggaran Pendapatan dan Belanja PPKD</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 }
                 
                 $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                    
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                 
                 $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $coba9=$row2->rek;
                    $coba10=$row2->nm_rek;
                    $coba11= number_format($row2->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                    $pk=$rowpk->totpk;
                }
                    
                  $pmnetto=$pm-$pk; 
                  if ($pmnetto < 0){
                	$a1="(";
                	$pmnetto=$pmnetto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                    $netto=number_format($pmnetto,2,'.',',');  
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$netto$b1</td></tr>";
                   
                    $silpa_jln = ($cob1-$cob)+($pm-$pk); 
                    
                    if ($silpa_jln < 0){
                    	$x1="(";
                    	$silpa_jln=$silpa_jln*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";
                    }
                    
                    $silpa_jl  = number_format($silpa_jln,2,'.',',');
                    $cRet     .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan ( SILPA )</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$silpa_jl$y1</td></tr>";
                    
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa0pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - PPKD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)in('42','43','44') and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE left(kd_rek5,2)in('42','43','44') and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(b.kd_rek5,3)IN('512','513','514','515','516','517','518') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)IN('512','513','514','515','516','517','518') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' 
                        GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(b.kd_rek5,1)='6' AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                        ORDER BY kd_rek";
                 
                 $query2 = $this->db->query($sql3);
                 foreach ($query2->result() as $row2)
                {
                    $coba9=$row2->rek;
                    $coba10=$row2->nm_rek;
                    $coba11= number_format($row2->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                    $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                  
                    $pm=$rowpm->totpm;
                   
                 }
                 $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                    $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   
                    $pk=$rowpk->totpk;
                   
                 }
                    
                  $pmnetto=$pm-$pk; 
                  if ($pmnetto < 0){
                	$a1="(";
                	$pmnetto=$pmnetto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $netto=number_format($pmnetto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$netto$b1</td></tr>";
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";                                  
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr>
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" >Rencana Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah per Triwulan                        </td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" >NO. </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" >Uraian </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" >Triwulan</td>
                            </tr>";
                    
                    $cRet .="<tr >
                                <td width=\"15%\" style=\"text-align: center;\">I </td>
                                <td width=\"15%\" style=\"text-align: center;\">II</td>
                                <td width=\"14%\" style=\"text-align: center;\">III</td>
                                <td width=\"14%\" style=\"text-align: center;\">IV</td>
                                <td width=\"15%\" style=\"text-align: center;\">JUMLAH </td>
                            </tr>";
                            
                    $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'
                              UNION
                              SELECT '2.1' AS NO ,'Belanja Tidak langsung' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5) ='00.02' AND kd_skpd='$id'
                              UNION
                              SELECT '3.1' AS NO ,'Penerimaan Pembiayaan' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'
                              UNION
                              SELECT '3.2' AS NO ,'Penerimaan Pembiayaan' AS uraian,SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 ,SUM(total) AS jumlah FROM trskpd
                              WHERE RIGHT (kd_kegiatan,5)='00.04' AND kd_skpd='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    foreach ($qtriwl->result() as $triw)
                    {
                    $no=$triw->NO;
                    $uraian=$triw->uraian;
                    $triw1= number_format($triw->triw1,2,',','.');
                    $triw2= number_format($triw->triw2,2,',','.');
					$triw3= number_format($triw->triw3,2,',','.');
					$triw4= number_format($triw->triw4,2,',','.');
					$total= number_format($triw->jumlah,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"2%\" align=\"left\">$no</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$total</td></tr>";
                    }
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
                
    }
    
    
    function preview_rka1(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }

//ctk_dpa0
	function ctk_dpa0(){
        $data['page_title']= 'Cetak DPA 0';
        $this->template->set('title', 'Cetak DPA 0');   
        $this->template->load('template','anggaran/rka/ctk_dpa0',$data) ; 
    }

function load_ttd_set_ppkd() {
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%')) and (kode='PPKD' or kode='SETDA') and bidang='1' ";   

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
    
     function preview_coverdpa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);

        $sqlorg="SELECT kd_org,nm_org FROM ms_organisasi WHERE kd_org='$id'";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }
                
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; margin-top: 200px;\" width=\"80%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\"><strong>$kab</strong></td>
                    </tr>
					<tr>
                        <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\"><strong>$nm_org</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                    </tbody>
                </table>";

        $cRet .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                    <tr>
                        <td width=\"20%\" align=\"center\" style=\"font-weight: bold;\">Kode</td> 
                        <td width=\"60%\" align=\"center\" style=\"font-weight: bold;\">Nama Formulir</td>
                    </tr>
                    </thead>
                    <tbody align=\"left\">
                    <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD</strong></td> 
                        <td width=\"60%\" >Ringkasan Dokumen Pelaksanaan Anggaran Satuan Kerja Perangkat Daerah</td>                    
                    </tr>
                    <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD 1</strong></td> 
                        <td width=\"60%\" >Rincian Dokumen Pelaksanaan Anggaran Pendapatan Satuan Kerja Perangkat Daerah </td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD 2.1</strong></td> 
                        <td width=\"60%\" >Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Satuan Kerja Perangkat Daerah </td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD 2.2</strong></td> 
                        <td width=\"60%\" >Rekapitulasi Belanja Langsung menurut Program dan Kegiatan Satuan Kerja Perangkat Daerah</td>                    
                    </tr>
                     <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD 2.2.1</strong></td> 
                        <td width=\"60%\" >Rincian Dokumen Pelaksanaan Anggaran Belanja Langsung Program dan Per Kegiatan Satuan Kerja Perangkat Daerah </td>                    
                    </tr> 
                     <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD 3.1</strong></td> 
                        <td width=\"60%\" >Rincian Penerimaan Pembiayaan Daerah</td>                    
                    </tr>                                        
                      <tr>
                        <td width=\"20%\" ><strong>DPA - SKPD 3.2</strong></td> 
                        <td width=\"60%\" >Rincian Pengeluaran Pembiayaan Daerah</td>                    
                    </tr>                                                                                                   
                    </tbody>
                </table>";
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','',50);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
     function preview_dpa0(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $rinci = $this->uri->segment(5);
        
        
        $ttd2= $_REQUEST['ttd2'];
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }


       if ($ttd2<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"65%\" align=\"center\"><strong>RINGKASAN DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD<br></strong></td>
                    </tr>

                    <tr>
                         <td  style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
                  
       if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Unit Organisasi</stong></td>
                        <td><strong>: $kd_org - $nm_org</stong></td>
                    </tr>
                </table>";
        }ELSE{
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"22%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"3%\"><strong>: </stong></td>
                        <td width=\"80%\"><strong> $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"22%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"3%\"><strong>: </stong></td>
                        <td width=\"80%\"><strong> $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Unit Organisasi </stong></td>
                        <td ><strong>: </stong></td>
                        <td><strong> $kd_org - $nm_org</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Sub Unit Organisasi </stong></td>
                        <td><strong >: </stong></td>
                        <td><strong> $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                </table>";            
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                            
                         <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"10%\" align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"70%\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" width=\"20%\" align=\"center\"><strong>3</strong></td></tr>
                     </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                         </tr>
                     </tfoot>   
                        ";


                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ";
                 if ($rinci == 1){
                    $sql2 = "union all
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek 
                            ,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,a.kelompok, a.nm_rek5 ";
                 }else{
                    $sql2 = "";
                 }
                 $sql3 = "ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=rtrim($row->rek);
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                    
                    if(strlen($coba1)>3){                                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1 </td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba1</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba3</strong></td></tr>";                        
                    }
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and $a$skpd$b='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                    
                    if ($cob1!=0){                   
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$coba4</strong></td></tr>";
  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                    } 
                 }     

                 
         
         
                $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ";
                 if($rinci==1){
                    $sql2=" UNION ALL 
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                            SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                            ";
                 }else{
                    $sql2="";
                 }
                 $sql3 = " ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql1.$sql2.$sql3);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=rtrim($row1->rek);
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    
                    if(strlen($coba5)>3){
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                    }else{
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                    }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,2)='51' or LEFT(kd_rek5,2)='52') and $a$skpd$b='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Jumlah Belanja</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$coba8</strong></td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" width=\"70%\"><strong>Surplus/Defisit</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$x1$surp$y1</strong></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";

                    if ($id == $this->ppkd || $id == $this->ppkd1){
                        //PENERIMAAN PEMBIAYAAN
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td></tr>";
        
                         $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=rtrim($row1->rek);
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpen = $row1->nilai;
                            }
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                            }
                        }
                    
                        $totpen1=number_format($totpen,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PENERIMAAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totpen1</strong></td></tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";                    

                        //PENGELUARAN PEMBIAYAAN
        
                         $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=rtrim($row1->rek);
                            $coba6=$row1->nm_rek;
                            $coba7= number_format($row1->nilai,"2",",",".");
                            
                            if (strlen($coba5)==1){
                                $totpeng = $row1->nilai;
                            }
                        
                            if(strlen($coba5)>3){
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"70%\">$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                            }else{
                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><strong>$coba5</strong></td>                                     
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"70%\"><strong>$coba6</strong></td>
                                             <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong>$coba7</strong></td></tr>";                                                    
                            }
                        }
                        
                        $jbiaya = $totpen - $totpeng;
                        
                        $jbiaya = $this->rp_minus($jbiaya);
                        
                        $totpeng=number_format($totpeng,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PENGELUARAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totpeng</strong></td></tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"> </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                                                         
                       $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\"><strong>JUMLAH PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$jbiaya</strong></td></tr>";


                    }
                    
  
   
                    
                    $cRet    .= "</table>"; 
                    $cRet .="<table style=\"border-collapse:collapse;font-size:12\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr >
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" ><strong>Rencana Pelaksanaan Anggaran <br> Satuan Kerja Perangkat Daerah per Triwulan</strong></td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" ><strong>NO.</strong> </td>
                                <td width=\"23%\" rowspan=\"2\" style=\"text-align: center;\" ><strong>Uraian</strong> </td>
                                <td colspan=\"5\" width=\"73%\" style=\"text-align: center;\" ><strong>Triwulan</strong></td>
                            </tr>";
                    
                    $cRet .="<tr>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>I </strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>II</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>III</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>IV</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>JUMLAH</strong> </td>
                            </tr>";


                    $cRet .="<tr >
                                <td width=\"4%\" style=\"text-align: center;\"><strong>1</strong> </td>
                                <td width=\"23%\" style=\"text-align: center;\" ><strong>2</strong> </td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>3</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>4</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>5</strong></td>
                                <td width=\"14%\" style=\"text-align: center;\"><strong>6</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>7=3+4+5+6 </strong></td>
                            </tr>";
                                                        
  
                    //Pendapatan
                    $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join (select kd_kegiatan from trdrka a 
								where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.04' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pendapatan</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
                    
                    //BTL
                    $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a
                                join (select kd_kegiatan from trdrka a 
								where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                                        
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Tidak Langsung</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //BL
                    $qtriw = " SELECT  isnull(sum(a.triw1),0) AS triw1,isnull(sum(a.triw2),0) AS triw2,isnull(sum(a.triw3),0) 
                                AS triw3,isnull(sum(a.triw4),0) AS triw4 FROM trskpd a
                                join (select kd_kegiatan from trdrka a 
								where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_program,2)<>'00' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">2.2</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Belanja Langsung</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   
 
 
                    //Penerimaan Pembiayaan 
                    $qtriw = "  SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a join (select kd_kegiatan from trdrka a 
								where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id'";
                    
                    
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                    //Pengeluaran Pembiayaan
                    $qtriw = "  SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4 FROM trskpd a join (select kd_kegiatan from trdrka a 
								where $a a.$skpd$b='$id' group by kd_kegiatan) b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"4%\" align=\"left\">3.2</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"23%\" align=\"left\">Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"14%\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\">$total</td></tr>";                   

                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\" width=\"100%\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
								<br>$jdlnip1
                                <br>$jabatan1
      							<p>&nbsp;</p>
								&nbsp;<br>
                				&nbsp;<br>
                				<br><strong><ins>$nama1</ins></strong>
                				<br>$pangkat1
                                <br>$nip1 
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
//end ctk_dpa0

//ctk_dpa1
	function ctk_dpa1(){
        $data['page_title']= 'Cetak DPA 1';
        $this->template->set('title', 'Cetak DPA 1');   
        $this->template->load('template','anggaran/rka/ctk_dpa1',$data) ; 
    }
    
     function preview_coverdpa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd2= $_REQUEST['ttd2'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"7\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>PENDAPATAN</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"30%\" align=\"right\"><strong>NO DPA SKPD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>01</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>4</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"20%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_org - $nm_org</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
     function preview_dpa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"25%\" align=\"center\" colspan=\"5\"><strong>NOMOR DPA SKPD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA 1 - SKPD<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>01</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"5%\" align=\"center\"><strong>4</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"7\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"7\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran <br>Pendapatan Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                         </tr>
                     </tfoot>   
                        ";
				
 /*                $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,5)='00.04' AND $a a.$skpd$b='$id' 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.04' 
                        AND $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.04' 
                        AND $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,5)='00.04' 
                        AND $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.04' 
                        AND $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.tvolume AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,5)='00.04' ) a ORDER BY a.rek1,a.id";
*/

				$sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,5)='00.04' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.04'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                            0 AS harga,SUM(a.total) AS nilai,'6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,5)='00.04' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                            a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,5)='00.04' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
				                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==' '){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
					}else{
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
					}
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
					
				}


				   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";
        $cRet    .= "</table>";
     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

							 $cRet .=" 
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>";

                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"4\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                                </tr>
                                </table>";                                       
        $cRet    .= "</table>"; 

        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.04' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
//end ctk_dpa1
	
/*    
    function preview_dpa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENDAPATAN
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
*/    
        function preview_dppa1(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan Satuan Kerja Perangkat Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='41' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='41' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='41' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='41' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa1pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka1pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">Rincian Anggaran Pendapatan Ppejabat Pengelola Keuangan Daerah</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                      $no=$no+1;                  
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa1pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - ppkd 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">4</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENDAPATAN
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2) in ('42','43','44') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) in ('42','43','44') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2) in ('42','43','44') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.01' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }

//ctk_dpa21
	function ctk_dpa21(){
        $data['page_title']= 'Cetak DPA 2.1';
        $this->template->set('title', 'Cetak DPA 2.1');   
        $this->template->load('template','anggaran/rka/ctk_dpa21',$data) ; 
    }
    
     function preview_coverdpa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd2= $_REQUEST['ttd2'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }

        
        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
        
        $k2 = substr($kd_org,5,2);                        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"8\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>BELANJA TIDAK LANGSUNG</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"27%\" align=\"right\"><strong>NO DPA SKPD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$k2</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>5</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>1</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"21%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_org - $nm_org</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
     function preview_dpa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);

       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  and kode='PPKD' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  and kode='PA'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);

					}
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SKPD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - <br>SKPD - 2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran <br>Belanja Tidak Langsung Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"6\"></td>
                         </tr>
                     </tfoot>   
                        ";
/*
                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id a";
*/

			IF ($id == $this->ppkd){					
				$sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' 
							UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' and a.total<>0
							) 
                        a ORDER BY a.rek1,a.id";
			}else{
				if($id == $this->ppkd1){
					$sql1="SELECT * FROM(
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
							union all
							
							SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
							0 AS harga,SUM(a.total) AS nilai,'6' AS id 
							FROM trdpo a
							LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
							WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,5)='00.51' and substring(a.no_trdrka,34,3) not in ('514','515')
							GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
						
                            UNION ALL 
                            SELECT 0 header, a.no_urut [no_po],RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' and 
							substring(no_trdrka,34,3) in ('514','515') and a.total<>0
							union all
							SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
							a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
							WHERE LEFT(a.no_trdrka$b='$id' AND 
							SUBSTRING(no_trdrka,28,5)='00.51' and 
							substring(no_trdrka,34,3) not in ('514','515') 
							) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
				}else{
					$sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id";
				}
			}		

                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
				                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
					if ($reke<>''){
                        $volum='';                        
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    }
					
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
					
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
					}else{
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
					}
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
					
				}


				   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";

					$cRet .=" 	<tr>
									<td  width=\"100%\" align=\"left\" colspan=\"6\">
										<table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    &nbsp;<br>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    &nbsp;<br>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>
										</table>
									</td>		
								</tr>";
                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                                </tr>";                                       

        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <tr>
					<td style=\"border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"left\" colspan=\"6\">
					<table  border=\"0\" width=\"100%\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
					</table>
					</td>		
				</tr>                    
                </table>";    

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-21</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//end ctk_dpa21
	

//ctk_dpa22
	function ctk_dpa22(){
        $data['page_title']= 'Cetak DPA 2.2';
        $this->template->set('title', 'Cetak DPA 2.2');   
        $this->template->load('template','anggaran/rka/ctk_dpa22',$data) ; 
    }
    
      function preview_dpa22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip)  ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
 
        $cRet='';

     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td  style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"66%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD <br><h3>2.2</h3></strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td></td>
                    </tr>

                  </table>";        

      
/*        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR<br>DPA - SKPD 2.2  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";

*/

       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td > <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"3\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA LANGSUNG BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        

        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr><td width=\"22%\" colspan=\"2\" align=\"center\"><b>Kode</b></td>  
                            <td width=\"17%\" rowspan=\"2\" align=\"center\" valign=\"middle\"><b>Uraian</b></td>
                            <td width=\"6%\"  rowspan=\"2\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:9px;\"  align=\"center\"><b>Target Kinerja (Kuantitatif)</b></td>
                            <td width=\"3%\"  rowspan=\"2\" style=\"font-size:10px;\"  align=\"center\"><b>Sumber Dana</b></td>
                            <td width=\"36%\" colspan=\"4\" align=\"center\"><b>Triwulan</b></td>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Jumlah</b></td>
                        </tr>
                        <tr>
                            <td width=\"12%\" align=\"center\"><b>Program</b></td>                            
                            <td width=\"10%\" align=\"center\"><b>Kegiatan</b></td>
 		                    <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">I</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">II</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">III</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">IV</td>
                        </tr>    
                        <tr>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">1</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">6</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">7</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">8</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">9</td>
                            <td width=\"9%\" style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">10</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">11=(7+8+9+10)</td>
                         </tr>
                     </thead>
                     <tfoot >
                        <tr>
                            <td width=\"100%\" style=\"border-top: solid 1px black;border-right: none;border-bottom: none;border-left: none;\" colspan=\"11\"></td>                         
                         </tr>
                     </tfoot> 
                   
                        ";

                $sql1="SELECT 
                        	a.kd_program AS prog,
                        	a.kd_program AS prog1,
                        	' ' AS giat,
                        	a.nm_program AS uraian,
                        	' ' AS lokasi,
                        	' ' AS target,
                        	'' [sumber_dana],
                        	(select sum(isnull(triw1,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw1,
                        	(select sum(isnull(triw2,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw2,
                        	(select sum(isnull(triw3,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw3,
                        	(select sum(isnull(triw4,0)) from trskpd b where left(b.kd_kegiatan, 18)=a.kd_program) AS triw4
                        FROM
                        	trdrka x
                        LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
                        AND x.kd_kegiatan = a.kd_kegiatan
                        WHERE
                        	RIGHT (a.kd_program, 2) <> '00'
                        AND $a x.kd_skpd$b = '$id'
                        GROUP BY
                        	a.kd_program,a.nm_program
                        
                        UNION
                        SELECT
                        		a.kd_program AS prog,
                        		' ' AS prog1,
                        		a.kd_kegiatan AS giat,
                        		a.nm_kegiatan AS uraian,
                        		a.lokasi AS lokasi,
                        		a.tk_kel AS target,
                        		isnull(x.sumber,'') [sumber_dana],
                        		isnull(a.triw1,0) [triw1],
                        		isnull(a.triw2,0) [triw2],
                        		isnull(a.triw3,0) [triw3],
                        		isnull(a.triw4,0) [triw4]	
                        	FROM
                        		trdrka x
                        		LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
                        	WHERE
                        		RIGHT(a.kd_program,2)<>'00' AND
                        		$a x.kd_skpd$b='$id'
                        	GROUP BY
                        		a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel,a.triw1,a.triw2,a.triw3,a.triw4,x.sumber 
                        					ORDER BY prog,giat  
						";
  

                $tottriw1 = 0;
                $tottriw2 = 0;
                $tottriw3 = 0;
                $tottriw4 = 0;
                $totnilai = 0; 
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $prog=rtrim($row->prog1);
                    $giat=rtrim($row->giat);
                    $uraian=rtrim($row->uraian);
                    $lokasi=rtrim($row->lokasi);
                    $target=rtrim($row->target);
                    $sumber=rtrim($row->sumber_dana);
                    $triw1=$row->triw1;
                    $triw2=$row->triw2;
                    $triw3=$row->triw3;
                    $triw4=$row->triw4;
                    $nilai = $triw1 + $triw2 + $triw3 + $triw4;
                    
                    if($prog != ''){
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $tottriw1 = $tottriw1 +  $triw1;   
                        $tottriw2 = $tottriw2 +  $triw2;
                        $tottriw3 = $tottriw3 +  $triw3;
                        $tottriw4 = $tottriw4 +  $triw4;
                        $totnilai = $totnilai +  $nilai;
                    }else{
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    $triw1=number_format($triw1,2,',','.');
                    $triw2=number_format($row->triw2,2,',','.');
                    $triw3=number_format($row->triw3,2,',','.');
                    $triw4=number_format($row->triw4,2,',','.');
                    $nilai1 = number_format($nilai,2,',','.');
 
                    

                      $cRet    .= " <tr>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \"  align=\"left\">$prog</td>                                     
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$giat</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$uraian</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$target</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$sumber</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw1</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw2</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw3</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$triw4</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai1</td>
                                    </tr> 
                                    
                                   
                                    ";


/*
                     $cRet    .= " <tr>
                                        <td style=\" $bold \"  align=\"left\">$prog</td>                                     
                                        <td style=\" $bold \" >$giat</td>
                                        <td style=\" $bold \" >$target</td>
                                        <td style=\" $bold \" >A</td>
                                        <td style=\" $bold \" align=\"left\">A</td>
                                        <td style=\" $bold \" align=\"left\">$sumber</td>
                                        <td style=\" $bold \" align=\"right\">$triw1</td>
                                        <td style=\" $bold \" align=\"right\">$triw2</td>
                                        <td style=\" $bold \" align=\"right\">$triw3</td>
                                        <td style=\" $bold \" align=\"right\">$triw4</td>
                                        <td style=\" $bold \" align=\"right\">$nilai1</td>
                                    </tr> 
                                     
                                    ";
*/                                      

 
                }

                $tottriw1 = number_format($tottriw1,2,',','.');   
                $tottriw2 = number_format($tottriw2,2,',','.');
                $tottriw3 = number_format($tottriw3,2,',','.');
                $tottriw4 = number_format($tottriw4,2,',','.');
                $totnilai = number_format($totnilai,2,',','.');

       
                 $cRet    .= " <tr>
                                    <td colspan=\"6\" style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottriw1</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottriw2</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottriw3</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottriw4</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totnilai</td>
                                </tr>
                                 ";
            

 



							 $cRet .="<tr>
                                        <td colspan=\"11\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"50%\" colspan=\"2\">&emsp;</td>
                                                    <td width=\"10%\" >&emsp;</td>
                                                    <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,</td>
                                                </tr>
                                                <tr>
    								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
    								                    <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    &nbsp;<br>
    								                    &nbsp;	
    								                </td>
    								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
    								                    <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><ins>$nama1</ins></b>
                                                        <br>$pangkat1
                    				                    <br>$nip1 
    								                </td>
    								                <td align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
    								                    <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    &nbsp;<br>
    								                    &nbsp;	
    								                </td>
    								                <td align=\"center\">$jdlnip2  
    								                    <br>$jabatan2
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><u>$nama2</u></b>
                                                        <br>$pangkat2
                    				                    <br>$nip2 
    								                </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";

        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-22</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//END ctk_dpa22



//ctk_dpa31
	function ctk_dpa31(){
        $data['page_title']= 'Cetak DPA 3.1';
        $this->template->set('title', 'Cetak DPA 3.1');   
        $this->template->load('template','anggaran/rka/ctk_dpa31',$data) ; 
    }
    
     function preview_coverdpa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd1= $_REQUEST['ttd1'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
        $k2 = substr($kd_org,5,2);                        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"8\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH (DPA PPKD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>PENERIMAAN PEMBIAYAAN</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"27%\" align=\"right\"><strong>NO DPA PPKD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$k2</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>6</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>1</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"21%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_org - $nm_org</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
      function preview_dpa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
               
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2' and kode='PA')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip2 = 'Pengguna Anggaran,';                    
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);


                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }
 
 
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;font-size:12;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA PPKD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - PPKD <br> 3.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>6</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>RINCIAN PENERIMAAN PEMBIAYAAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead >                       
                        <tr><td width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"40%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                        </tr>

                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"50%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">3</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";

                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.61' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            ) 
                        a ORDER BY a.rek1,a.id";

                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
				                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;                    
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">$nila</td></tr>
                                     ";
					}else{
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"10%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"50%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"40%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
					}
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><b>PEMBIAYAAN DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
					
				}


      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong>JUMLAH PENERIMAAN</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong>$totp</strong></td>
                                </tr>
                                <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong>&nbsp;</strong></td>
                                </tr>
                                ";
        $cRet    .= "</table>";

     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

							 $cRet .=" 
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>";

                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"4\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana penerimaan per Triwulan</td>
                                </tr>
                                </table>";                                       
        $cRet    .= "</table>"; 


        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

         $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
       $cRet    .= "</table>";

/*

        $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
 */
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-31</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//end ctk_dpa31

//ctk_dpa32
	function ctk_dpa32(){
        $data['page_title']= 'Cetak DPA 3.2';
        $this->template->set('title', 'Cetak DPA 3.2');   
        $this->template->load('template','anggaran/rka/ctk_dpa32',$data) ; 
    }
    
     function preview_coverdpa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd1= $_REQUEST['ttd1'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
        $k2 = substr($kd_org,5,2);                        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"8\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"8\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH (DPA PPKD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>PENGELUARAN PEMBIAYAAN</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"27%\" align=\"right\"><strong>NO DPA PPKD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$k2</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>6</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>2</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"21%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"8\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_org - $nm_org</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
 
     function preview_dpa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
               
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }


       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2' and kode='PA')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip2 = 'Pengguna Anggaran,';                    
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
					

                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }
 
 
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;font-size:12;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA PPKD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - PPKD <br> 3.2<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>6</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>2</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>RINCIAN PENGELUARAN PEMBIAYAAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
         
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead >                       
                        <tr><td width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"40%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                        </tr>

                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"50%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">3</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";

                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.62' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            ) 
                        a ORDER BY a.rek1,a.id";

                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
				                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;                    
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"right\">$nila</td></tr>
                                     ";
					}else{
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"10%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"50%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;;\" width=\"40%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
					}
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><b>6.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><b>PEMBIAYAAN DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
					
				}


      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong>JUMLAH PENGELUARAN</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong>$totp</strong></td>
                                </tr>
                                <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong>&nbsp;</strong></td>
                                </tr>
                                ";
        $cRet    .= "</table>";

     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

							 $cRet .=" 
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>";

                    $cRet    .=" <tr>
                                    <td style=\"border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"4\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana pengeluaran per Triwulan</td>
                                </tr>
                                </table>";                                       
        $cRet    .= "</table>"; 


        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

         $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
       $cRet    .= "</table>";

                                                          
        $cRet    .= "</table>"; 
/*

        $cRet  .=" <table style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:12\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan II</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>                    
                </table>";    
 */
       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-32</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//end ctk_dpa32


	
/* 
 function preview_dpa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA TIDAK LANGSUNG
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,3)='511' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
*/

    
    function preview_dppa21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Satuan Kerja Perangkat Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,3)='511' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_dppa21pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>PEJABAT PENGELOLA KEUANGAN DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Belanja Tidak Langsung Pengelola Keuangan Daerah </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    function preview_rka21pkd(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:14px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 21  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:14px;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:14px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";
                    $no=$no+1;               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
    
    function preview_dpa21pkd(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA TIDAK LANGSUNG
SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518') AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3) in ('512','513','514','515','516','517','518')
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,3) in ('512','513','514','515','516','517','518') ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3) in ('512','513','514','515','516','517','518') AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.02' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
	
	function preview_rka22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;
                    $pangkat=$rowttd->pangkat;
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip; 
                    $pangkat2=$rowttd2->pangkat;
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR<br>RKA - SKPD 22  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Pemerintahan </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
					<tr>
                        <td width=\"20%\">Organisasi </td>
                        <td width=\"80%\">$kd_org -".$this->rka_model->get_nama($kd_org,'nm_org','ms_organisasi','kd_org')."</td>
                    </tr>
                    <tr>
                        <td>Unit Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"36%\" align=\"center\"><b>Tahun n</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Tahun n+1</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Belanja Pegawai</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Barang & Jasa</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Modal</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT
							a.kd_program AS prog,
							a.kd_program AS prog1,
							' ' AS giat,
							a.nm_program AS uraian,
							' ' AS lokasi,
							' ' AS target,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '521' THEN x.nilai ELSE 0 END) AS bljpeg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '522' THEN x.nilai ELSE 0 END) AS bljbrg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '523' THEN x.nilai ELSE 0 END) AS bljmdl,
							SUM (x.nilai) AS jumlah
						FROM
							trdrka x
						LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
						AND x.kd_kegiatan = a.kd_kegiatan
						WHERE
							RIGHT (a.kd_program, 2) <> '00'
						AND x.kd_skpd = '$id'
						GROUP BY
							a.kd_program,a.nm_program
						UNION
						SELECT
								a.kd_program AS prog,
								' ' AS prog1,
								a.kd_kegiatan AS giat,
								a.nm_kegiatan AS uraian,
								a.lokasi AS lokasi,
								a.tk_kel AS target,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '521' THEN x.nilai ELSE 0 END) AS bljpeg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '522' THEN x.nilai ELSE 0 END) AS bljbrg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '523' THEN x.nilai ELSE 0 END) AS bljmdl,
								SUM(x.nilai) AS jumlah
							FROM
								trdrka x
								LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
							WHERE
								RIGHT(a.kd_program,2)<>'00' AND
								x.kd_skpd='$id'
							GROUP BY
								a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel
						ORDER BY prog,giat
						";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }

						$sql1="SELECT x.kd_skpd ,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan WHERE LEFT(kd_rek5,3)='521' AND  a.kd_skpd='$id') AS bljpeg,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan WHERE LEFT(kd_rek5,3)='522' AND  a.kd_skpd='$id')  AS bljbrg,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan WHERE LEFT(kd_rek5,3)='523' AND  a.kd_skpd='$id') AS bljmdl,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd  AND x.kd_kegiatan=a.kd_kegiatan WHERE x.kd_skpd='$id' and LEFT(kd_rek5,2)='52' ) AS jumlah FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd
						WHERE x.kd_skpd='$id' GROUP BY x.kd_skpd ";


                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                   
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:center;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }
		
				$kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
				if ((($kd_ttd=='01') && ($kd_kepala!='1.20.03'))|| ($id=='1.20.03.00')){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"10\">
								<table border=\"0\"  align=\"right\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>$pangkat 
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"10\">							
								<table border=\"0\"  align=\"right\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>$pangkat2 
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } 
                          
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"10\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"10\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                            </tr>";
				 $cRet    .= "</table>";      
				 
         $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd where kd_skpd='$id' order by no";
                     $sqltapd = $this->db->query($sqltim);
                  if ($sqltapd->num_rows() > 0){
					
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
				  }}
					else{
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\"> &nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>"; 
					}
        
           
                             
                 
        $cRet    .= "</table>";
        $data['prev']= $cRet; 
		$judul ='RKA-22'.$id.'';
      switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,5,'5');
        break;
		case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 0;     
		echo ("<title>RKA 22</title>");
    	echo($cRet);
        break;
        }
        
                
    }
	
	
/*	
    function preview_dpa22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - SKPD 2.2  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rekapitulasi Belanja Langsung Berdasarkan Program dan Kegiatan </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"18%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Sumber Dana</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"32%\" align=\"center\"><b>Triwilan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"9%\" align=\"center\"><b>Jumlah (Rp)</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">I</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">II</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">III</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">IV</td>
                        </tr>    
                     </thead>

                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td></tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM (
SELECT a.kd_program AS prog,a.kd_program AS prog1,' ' AS giat,b.nm_program AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
' ' AS triw1,' ' AS triw2,' ' AS triw3,' ' AS triw4,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LEN(a.kd_program))= a.kd_program) AS jumlah 
FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_prog b ON a.kd_program1=b.kd_program 
WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_program
UNION 
SELECT a.kd_program AS prog,' ' AS prog1,a.kd_kegiatan AS giat,b.nm_kegiatan AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
(SELECT triw1 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan) AS triw1,
(SELECT triw2 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan)  AS triw2,
(SELECT triw3 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan) AS triw3,
(SELECT triw4 AS nilai FROM trskpd WHERE  kd_kegiatan = a.kd_kegiatan) AS triw4,
(SELECT SUM(nilai) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah 
FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan 
WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_kegiatan
)
a ORDER BY a.prog,a.giat";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $sumber=$row->sumber;
                    $triw1=empty($row->triw1) || $row->triw1 == 0 ? '' :number_format($row->triw1,2,',','.');
                    $triw2=empty($row->triw2) || $row->triw2 == 0 ? '' :number_format($row->triw2,2,',','.');
                    $triw3=empty($row->triw3) || $row->triw3 == 0 ? '' :number_format($row->triw3,2,',','.');
                    $triw4=empty($row->triw4) || $row->triw4 == 0 ? '' :number_format($row->triw4,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$sumber</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     </tr>
                                     ";
                }
                
                $query2="SELECT SUM(triw1) AS triw1,SUM(triw2) AS triw2,SUM(triw3) AS triw3,SUM(triw4) AS triw4 FROM trskpd WHERE jns_kegiatan='52' AND kd_skpd='$id'";
                $sqltw=mysql_query("$query2");
                    while($t  =  mysql_fetch_array($sqltw)){
                        $tottw1= empty($t['triw1']) || $t['triw1'] == 0 ? '' : number_format($t['triw1'],2,',','.');
                        $tottw2= empty($t['triw2']) || $t['triw2'] == 0 ? '' : number_format($t['triw2'],2,',','.');
                        $tottw3= empty($t['triw3']) || $t['triw3'] == 0 ? '' : number_format($t['triw3'],2,',','.');
                        $tottw4= empty($t['triw4']) || $t['triw4'] == 0 ? '' : number_format($t['triw4'],2,',','.');
                    
                
                $cRet    .="<tr>
				          		     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                    
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >JUMLAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tottw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
			                  
							  </tr>" ;    
                
                }
                $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"11\">
								<table border=\"0\">
								<tr>
								<td width=\"100%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
           
                             
                 
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
*/    
    function preview_dppa22(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"80%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR DPA - SKPD 2.2  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rekapitulasi Belanja Langsung Berdasarkan Program dan Kegiatan </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Sumber Dana</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Jumlah (Rp)</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">Sebelum Perubahan</td>
                            <td width=\"13%\" bgcolor=\"#CCCCCC\" align=\"center\">Setelah Perubahan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>    
                     </thead>
                    
                   ";
                        
                 $sql1="SELECT * FROM (
                        SELECT a.kd_program AS prog,a.kd_program AS prog1,' ' AS giat,b.nm_program AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LEN(a.kd_program))= a.kd_program) AS jumlah ,
                        (SELECT SUM(nilai_ubah) AS nilai FROM trdrka WHERE  LEFT(kd_kegiatan,LEN(a.kd_program))= a.kd_program) AS jumlah_u 
                        FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_prog b ON a.kd_program1=b.kd_program 
                        WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_program
                        UNION 
                        SELECT a.kd_program AS prog,' ' AS prog1,a.kd_kegiatan AS giat,b.nm_kegiatan AS uraian, ' ' AS lokasi,' 'AS target,' ' AS sumber,
                        (SELECT SUM(nilai) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah ,
                        (SELECT SUM(nilai_ubah) AS nilai FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan ) AS jumlah_u
                        FROM trskpd a LEFT JOIN trdrka c ON c.kd_kegiatan=a.kd_kegiatan INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan 
                        WHERE RIGHT(a.kd_program,2)<>'00' AND a.kd_skpd = '$id' GROUP BY a.kd_kegiatan)
                        a ORDER BY a.prog,a.giat";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $sumber=$row->sumber;                    
                    $nilai=empty($row->jumlah) || $row->jumlah == 0 ? '' :number_format($row->jumlah,2,',','.');
                    $nilai_u=empty($row->jumlah_u) || $row->jumlah_u == 0 ? '' :number_format($row->jumlah_u,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $n=$row->jumlah;
                    $n_u=$row->jumlah_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$sumber</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen1</td>
                                     
                                     </tr>
                                     ";
                }
                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>";
                 }
                
                $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">
								<table border=\"0\">
								<tr>
								<td width=\"100%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
        
           
                             
                 
        $cRet    .= "</table>";
        
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA22.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    
 /*   
    function preview_dpa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 31  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENERIMAAN PEMBIAYAAN  </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) ='61') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
 */ 
  function preview_dppa31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pembiayaan Masuk </strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) ='61' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pembiayaan masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
/*    
    function preview_dpa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 32  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
          <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN PENGELUARAN PEMBIAYAAN  </strong></td>
                    </tr></table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) ='62') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                  $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.04' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
*/    
    function preview_dppa32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA PPKD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - PPKD 3.2  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">6</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"12\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"12\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">                
        <tr>
                	<td width=\"100%\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd
								</td>
							</tr>
						</table>
					</td>
         </tr>
         <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pembiayaan Keluar</strong></td>
                    </tr></table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id,' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id,a.no_po as po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) ='62' ) a ORDER BY a.rek1,a.id,a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_ubah) AS totp_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE RIGHT (kd_kegiatan,5)='00.03' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
    
    
    function daftar_kegiatan($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan/$id");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(4);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
				$data['kode_skpd'] = $id;
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list', $data);
	}
	
//ctk dpa_221	
    function daftar_kegiatan1($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan1/$id");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(4);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		$data['kode_skpd'] = $id;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list_dpa', $data);
	}
 
    function preview_dpa221(){
       $id = $this->uri->segment(3);
       $giat = $this->uri->segment(4);
       $cetak = $this->uri->segment(5);
       $chkpa = $this->uri->segment(6);
       $cell = $this->uri->segment(7); 
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  and kode='PPKD'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
					
				}
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
 
         $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,a.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,rtrim(d.sumber) [sumber] ,a.sasaran_giat,a.ang_lalu,a.waktu_giat FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY f.kd_urusan,
				f.nm_urusan,
				a.kd_skpd,
				e.nm_skpd,
				a.kd_program,
				a.nm_program,
				a.kd_kegiatan,
				c.nm_kegiatan,
				a.tu_capai,
				a.tu_mas,
				a.tu_kel,
				a.tu_has,
				a.tk_capai,
				a.tk_mas,
				a.tk_kel,
				a.tk_has,
				a.lokasi,
				d.sumber,
				a.sasaran_giat,
				a.ang_lalu,a.waktu_giat";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_has  = $roworg->tu_has;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_has  = $roworg->tk_has;
                    $sas_giat = $roworg->sasaran_giat;
                    $ang_lalu = $roworg->ang_lalu;
                    $wak_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;

                    
                }
		$kd_urusan= empty($roworg->kd_urusan) || ($roworg->kd_urusan) == '' ? '' : ($roworg->kd_urusan);
		$nm_urusan= empty($roworg->nm_urusan) || ($roworg->nm_urusan) == '' ? '' : ($roworg->nm_urusan);
		$kd_skpd= empty($roworg->kd_skpd) || ($roworg->kd_skpd) == '' ? '' : ($roworg->kd_skpd);
		$nm_skpd= empty($roworg->nm_skpd) || ($roworg->nm_skpd) == '' ? '' : ($roworg->nm_skpd);
		$kd_prog= empty($roworg->kd_program) || ($roworg->kd_program) == '' ? '' : ($roworg->kd_program);
		$nm_prog= empty($roworg->nm_program) || ($roworg->nm_program) == '' ? '' : ($roworg->nm_program);
		$kd_giat= empty($roworg->kd_kegiatan) || ($roworg->kd_kegiatan) == '' ? '' : ($roworg->kd_kegiatan);
		$nm_giat= empty($roworg->nm_kegiatan) || ($roworg->nm_kegiatan) == '' ? '' : ($roworg->nm_kegiatan);
		$lokasi= empty($roworg->lokasi) || ($roworg->lokasi) == '' ? '' : ($roworg->lokasi);
		$tu_capai= empty($roworg->tu_capai) || ($roworg->tu_capai) == '' ? '' : ($roworg->tu_capai);
		$tu_mas= empty($roworg->tu_mas) || ($roworg->tu_mas) == '' ? '' : ($roworg->tu_mas);
		$tu_kel= empty($roworg->tu_kel) || ($roworg->tu_kel) == '' ? '' : ($roworg->tu_kel);
		$tu_has= empty($roworg->tu_has) || ($roworg->tu_has) == '' ? '' : ($roworg->tu_has);
		$tk_capai= empty($roworg->tk_capai) || ($roworg->tk_capai) == '' ? '' : ($roworg->tk_capai);
		$tk_mas= empty($roworg->tk_mas) || ($roworg->tk_mas) == '' ? '' : ($roworg->tk_mas);
		$tk_kel= empty($roworg->tk_kel) || ($roworg->tk_kel) == '' ? '' : ($roworg->tk_kel);
		$tk_has= empty($roworg->tk_has) || ($roworg->tk_has) == '' ? '' : ($roworg->tk_has);
		$sas_giat= empty($roworg->sasaran_giat) || ($roworg->sasaran_giat) == '' ? '' : ($roworg->sasaran_giat);
		$ang_lalu= empty($roworg->ang_lalu) || ($roworg->ang_lalu) == '' || ($roworg->ang_lalu) == 'Null' ? 0 : ($roworg->ang_lalu);
		$wak_giat= empty($roworg->waktu_giat) || ($roworg->waktu_giat) == '' || ($roworg->waktu_giat) == 'Null' ? '' : ($roworg->waktu_giat);
   		$sumber= empty($roworg->sumber) || ($roworg->sumber) == '' || ($roworg->sumber) == 'Null' ? '' : ($roworg->sumber);
        
        switch($sumber){
            case 'DAU';
                $sumber = 'Dana Alokasi Umum (DAU)';
            break;
            case 'PAD';
                $sumber = 'Pendapatan Asli Daerah (PAD)';
            break;            
            case 'DAK';
                $sumber = 'Dana Alokasi Khusus (DAK)';
            break;            
        }
        
  
       $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",",",".");
                   $totp1 =number_format($rowb->totb*1.1,"2",",",".");
                }        
        $cRet='';

 
        $k2 = substr($id,5,5);
        $k3 = substr($kd_prog,-2,2);
        $k4 = substr($kd_giat,-2,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SKPD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD <br>2.2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k3</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k4</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>2</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"20%\"><strong>&nbsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>&nbsp;Organisasi</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>&nbsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                    </tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Program</td>
						<td width=\"3%\" align=\"center\">:</td>
						<td width=\"77%\" align=\"left\">$kd_prog   - $nm_prog</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Kegiatan</td>
						<td width=\"3%\" align=\"center\">:</td>
						<td width=\"77%\" align=\"left\">$kd_giat   - $nm_giat</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;</td>
						<td width=\"3%\" align=\"center\"></td>
						<td width=\"77%\" align=\"left\"></td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Waktu Pelaksanaan</td>
						<td width=\"3%\" align=\"center\">:</td>
						<td width=\"77%\" align=\"left\">$wak_giat</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Lokasi Kegiatan</td>
						<td width=\"3%\" align=\"center\">:</td>
						<td width=\"77%\" align=\"left\">$lokasi</td></tr>						
						<tr><td width=\"20%\" align=\"left\">&nbsp;Sumber Dana</td>
						<td width=\"3%\" align=\"center\">:</td>
						<td width=\"77%\" align=\"left\">$sumber</td></tr>
                </table>";         
 
        $cRet .= "<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"3\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belanja langsung</td>
                    </tr>";
        $cRet .="<tr>
                 <td width=\"20%\" align=\"center\">Indikator </td>
                 <td width=\"60%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td width=\"20%\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td>$tu_capai</td>
                    <td>$tk_capai</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td>$tu_mas</td>
                    <td>Rp. $totp </td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td>$tu_kel</td>
                    <td>$tk_kel</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td>$tu_has</td>
                    <td>$tk_has</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"3\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"3\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>MENURUT PROGRAM DAN PER KEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";


        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td></tr>
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"14%\" align=\"center\">Tarif / Harga</td>
                        </tr>                            
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"40%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"8%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"20%\" align=\"center\">6 = (3 X 5)</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: solid 1px black; border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"></hr></td>
                         </tr>
                     </tfoot>   
                        ";

                $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
						GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
						 UNION ALL 
						 SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
						 UNION ALL  
						 SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
						 UNION ALL 
						 select * from(
						 SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
						) as r4 where nilai<>0
						 UNION ALL 
						 SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id' and a.nilai<>0  GROUP BY a.kd_rek5,b.nm_rek5
						 UNION ALL 
						 select * from (
						 SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
						0 AS harga,SUM(a.total) AS nilai,'6' AS id 
						FROM trdpo a
						LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
						WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(a.no_trdrka,12,21)='$giat' and a.total<>0
						GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
						) as he where nilai<>0
						UNION ALL
						SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
						a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,12,21)='$giat' AND (header='0' or header is null) and a.total<>0
						) a ORDER BY a.rek1,a.id,a.no_po";
                $totbl = 0;
                $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $nopo = $row->no_po;
                //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :$row->volume;

                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilaibl = empty($row->nilai)  ? 0 : $row->nilai;
                    
                    if(strlen($row->rek1) <= '5' ){
                        $bold = 'font-weight:bold;';
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                    }else{
                        $bold ='';
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    if(strlen($row->rek1) == '1' ){
                        $totbl = $totbl + $nilaibl;
                    }            
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;$bold $lbawah $latas  \" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"8%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"8%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                             
                }

                   $totbl=number_format($totbl,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"><strong>$totbl</strong></td></tr>";

							 $cRet .="
                                        <tr>
                                        <td colspan=\"6\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"50%\" colspan=\"2\">&emsp;
                                                    <td width=\"10%\" >&emsp;
                                                    <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                                </tr>
                                                <tr>
    								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
    								                    <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    &nbsp;<br>
    								                    &nbsp;	
    								                </td>
    								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
    								                    <br>$jabatan1
                                                        <p>&nbsp;</p>
														&nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><ins>$nama1</ins></b>
                                                        <br>$pangkat1
                    				                    <br>$nip1 
    								                </td>
    								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
    								                    <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    &nbsp;<br>
    								                    &nbsp;	
    								                </td>
    								                <td width=\"40%\" align=\"center\">$jdlnip2  
    								                    <br>$jabatan2
                                                        <p>&nbsp;</p>
														&nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><u>$nama2</u></b>
                                                        <br>$pangkat2
                    				                    <br>$nip2 
    								                </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                            
                                    ";

   
        $qtriw = " SELECT distinct isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) 
                                AS triw3,isnull( a.triw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" 
                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                     </tr>

                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;
                            <table border=\"0\" width=\"100%\">
                                <tr>
                                    <td width=\"15%\" align=\"left\">&emsp;Triwulan I</td>
                                    <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                                    <td width=\"10%\" align=\"right\">&emsp;$triw1</td>
                                    <td width=\"65%\" align=\"left\">&emsp;</td>

                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan II</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw2</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan III</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw3</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan IV</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"right\">&emsp;Jumlah</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$total</td>
                                    <td align=\"left\">&emsp;</td>

                                </tr>                           
                            </table>
                        </td>
                     </tr>

                </table>";    

                                                                       

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-2.2.1</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

 
//end ctk_dpa221   
    
   
/*	
    function preview_dpa221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        //echo"$giat";
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,a.nm_program,a.kd_kegiatan,a.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber FROM trskpd a
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    //$tu_capai  = $roworg->$tu_capai;
//                    $tu_mas  = $roworg->$tu_mas;
//                    $tu_kel  = $roworg->$tu_kel;
//                    $tu_has  = $roworg->$tu_has;
//                    $tk_capai  = $roworg->$tk_capai;
//                    $tk_mas  = $roworg->$tk_mas;
//                    $tk_kel  = $roworg->$tk_kel;
//                    $tk_has  = $roworg->$tk_has;
                }
        $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 2.2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">2</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi<br>&nbsp;
								Program<br>&nbsp;
								Kegiatan<br>&nbsp;
								<br>&nbsp;
								Waktu Pelaksanaan<br>&nbsp;
								Lokasi Kegiatan<br>&nbsp;
								Sumber Dana <br>&nbsp;
								
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd<br>
								: $kd_prog   - $nm_prog<br>
								: $kd_giat   - $nm_giat<br>
								: <br>
								: $lokasi<br>
								: <br>
								
								</td>
								
							</tr>
						</table>
					</td>";
        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td width=\"20%\" align=\"center\">Indikator </td>
                 <td width=\"60%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td width=\"20%\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                                          
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
GROUP BY LEFT(a.kd_rek5,1) 
 UNION ALL 
 SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
 UNION ALL  
 SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
 UNION ALL 
 SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
 UNION ALL 
 SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
 UNION ALL 
 SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,12,21)='$giat' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                  
                 
                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"6\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
						  $querytriw = $this->db->query($qtriw);;
                                                  
                foreach ($querytriw->result() as $rowt)
                {
                   
                    $resttriw1=empty($rowt->triw1) || $rowt->triw1 == 0 ? '' :number_format($rowt->triw1,2,',','.');
                    $resttriw2=empty($rowt->triw2) || $rowt->triw2 == 0 ? '' :number_format($rowt->triw2,2,',','.');
                    $resttriw3=empty($rowt->triw3) || $rowt->triw3 == 0 ? '' :number_format($rowt->triw3,2,',','.');
                    $resttriw4=empty($rowt->triw4) || $rowt->triw4 == 0 ? '' :number_format($rowt->triw4,2,',','.');
                    $resttriw5=empty($rowt->jumlah) || $rowt->jumlah == 0 ? '' :number_format($rowt->jumlah,2,',','.');
						 // $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
//						  $resttriw=mysql_fetch_array($sqltriw);
						  //$resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
//						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
//						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
//						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
//						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"3\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"3\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";
        }
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA221.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
*/    
    function daftar_kegiatan2($offset=0)
	{
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(3);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list_dppa', $data);
	}
    
    function preview_dppa221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $org=substr($kd_skpd,5,2);
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,b.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber FROM trskpd a 
                INNER JOIN m_prog b ON a.kd_program1=b.KD_PROGRAM
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY a.kd_skpd";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tk_has  = $roworg->tk_has;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>DOKUMEN PELAKSANAAN ANGGARAN </strong></td>
                         <td width=\"25%\" colspan=\"5\" align=\"center\"><strong>NOMOR DPA SKPD  </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>&nbsp;<br>FORMULIR DPA - SKPD 2.1  </strong></td>
                    </tr>
                    <tr>
                         <td width=\"60%\" align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                         <td width=\"5%\" align=\"center\">$kd_urusan</td>
                         <td width=\"5%\" align=\"center\">$org</td>
                         <td width=\"5%\" align=\"center\">00</td>
                         <td width=\"5%\" align=\"center\">5</td>
                         <td width=\"5%\" align=\"center\">1</td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td width=\"85%\" colspan=\"6\" align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
       $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
							<tr>
								<td width=\"23%\" align=\"left\">&nbsp;
								Urusan Pemerintahan<br>&nbsp;
								Organisasi<br>&nbsp;
								Program<br>&nbsp;
								Kegiatan<br>&nbsp;
								<br>&nbsp;
								Waktu Pelaksanaan<br>&nbsp;
								Lokasi Kegiatan<br>&nbsp;
								Sumber Dana &nbsp;								
								</td>
								<td width=\"77%\" align=\"left\">
								: $kd_urusan - $nm_urusan<br>
								: $kd_skpd   - $nm_skpd<br>
								: $kd_prog   - $nm_prog<br>
								: $kd_giat   - $nm_giat<br>
								: <br>
								: $lokasi<br>
								: <br>
								
								</td>
								
							</tr>
						</table>
					</td>";
        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belaja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td rowspan=\"2\" width=\"18%\" align=\"center\">Indikator </td>
                 <td colspan=\"2\" width=\"44%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td colspan=\"2\" width=\"34%\" align=\"center\">Target Kinerja </td>
                </tr>";
        $cRet .="<tr align=\"center\">
   		           <td align=\"center\" width=\"22%\">Sebelum Perubahan</td>
   		           <td align=\"center\" width=\"22%\">Setelah Perubahan</td>
   		           <td align=\"center\" width=\"19%\">Sebelum Perubahan</td>
                   <td align=\"center\" width=\"19%\">Setelah Perubahan</td>
  		        </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td>Capaian Program </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Masukan </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Keluaran </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td>Hasil </td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                    <td> &nbsp;</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan :</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN PERUBAHAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
         
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"25%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Sebelum Perubahan</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td></tr>
                        <tr>
 		                    <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td colspan=\"3\" width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">Rincian Penghitungan</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                            <td rowspan=\"2\" width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr> 
                        <tr>
 		                    <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">1</td>
                            <td width=\"25%\" bgcolor=\"#CCCCCC\" align=\"center\">2</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">3</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">4</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">5</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">6=3x5</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">7</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">8</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">10=7x9</td>
                            <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">11=10-6</td>
                            <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">12</td>
                        </tr>    
                     </thead>
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
    
                    
                     
                        ";
                            
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,' 'AS volume_u,' 'AS satuan_u,
                        ' 'AS harga_u,SUM(a.nilai_ubah) AS nilai_u,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,a.volume_ubah1 AS volume_u,a.satuan_ubah1 AS satuan_u,
                        a.harga_ubah1 AS harga_u,a.total_ubah AS nilai_u,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,12,21)='$giat' ) a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');                    
                    $nila= number_format($row->nilai,"2",".",",");                    
                    $volum_u=$row->volume_u;
                    $sat_u=$row->satuan_u;
                    $hrg_u= empty($row->harga_u) || $row->harga_u == 0 ? '' :number_format($row->harga_u,2,',','.');                    
                    $nila_u= number_format($row->nilai_u,"2",".",",");
                    $n=$row->nilai;
                    $n_u=$row->nilai_u;
                    $n_s = $n_u - $n;
                    if ($n_s < 0){
                    	$x1="("; $n_s=$n_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $n_selisih = number_format($n_s,"2",".",",");
                    $per1   = ($n_s!=0)?($n_s / $n ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$volum_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"center\">$sat_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$hrg_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nila_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$n_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE kd_kegiatan='$giat'  AND kd_skpd='$id'";
                    $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $totp=number_format($rowp->totp,"2",".",",");
                   $totp_u=number_format($rowp->totp_u,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"25%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$totp_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\">&nbsp;</td></tr>";
                 } 
                 $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\"></td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                            </tr>";
                 $cRet .= "<tr>
                                <td width=\"100%\" colspan=\"12\" align=\"left\">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Rencana Pendapatan per Triwulan</td>
                            </tr>";
                 
               
                             
                  $qtriw = "SELECT '1' AS NO ,'Pendapatan' AS uraian,triw1 AS triw1,triw2 AS triw2,triw3 AS triw3,triw4 AS triw4 ,total AS jumlah FROM trskpd
                          WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
						  //echo "$qtriw";
						  $sqltriw=mysql_query("$qtriw") or die ("query gagal ".mysql_error());
						  $resttriw=mysql_fetch_array($sqltriw);
						  $resttriw1= empty($resttriw[2]) || $resttriw[2] == 0 ? '0' : number_format($resttriw[2],2,',','.');
						  $resttriw2= empty($resttriw[3]) || $resttriw[3] == 0 ? '0' : number_format($resttriw[3],2,',','.');
						  $resttriw3= empty($resttriw[4]) || $resttriw[4] == 0 ? '0' : number_format($resttriw[4],2,',','.');
						  $resttriw4= empty($resttriw[5]) || $resttriw[5] == 0 ? '0' : number_format($resttriw[5],2,',','.');
						  $resttriw5= empty($resttriw[6]) || $resttriw[6] == 0 ? '0' : number_format($resttriw[6],2,',','.');
                $cRet .="<tr>
                				<td width=\"52%\" colspan=\"6\" align=\"left\">
								<table border=\"0\">
								<tr>
								<td width=\"32%\" align=\"left\">&nbsp;<br>
								Triwulan I<br>
								Triwulan II<br>
                				Triwulan III<br>
                				Triwulan IV <br>
								&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Jumlah	
								</td>
								<td width=\"10%\" align=\"right\">&nbsp;<br>
								Rp<br>
								Rp<br>
                				Rp<br>
                				Rp<br>
								Rp	
								</td>
								<td width=\"30%\" align=\"right\">&nbsp;<br>
								$resttriw1<br>
								$resttriw2<br>
                				$resttriw3<br>
                				$resttriw4<br>
								$resttriw5							
								</td></tr></table></td>

    							<td width=\"50%\" colspan=\"6\" align=\"center\">$daerah ,$tanggal 
								<br>
								Mengesahkan,
								<br>
								Pejabat Pengelola Keuangan Daerah
      							<br><br /><br />&nbsp;
                				$nama<br>
                				NIP.$nip
								</td>
         					  </tr>";

        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        switch($cetak) {        
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPPA1.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }
        
                
    }
 /*   
    function preview_rka31(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 31  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN PENERIMAAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='61' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) ='61') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='61' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Penerimaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";
                    $no=$no+1;               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);            
               
    }
    
    function preview_rka32(){
        $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - PPKD 32  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN PENGELUARAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,2)='62' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2) 
                        UNION ALL  
                        SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3) 
                        UNION ALL 
                        SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4) 
                        UNION ALL 
                        SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,' 'AS volume,' 'AS satuan,
                        ' 'AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62'
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5 
                        UNION ALL 
                        SELECT RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2) ='62') a ORDER BY a.rek1,a.id";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,2)='62' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pengeluaran</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                 } 
                 
                 $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>Kepala SKPD,
      							<p>&nbsp;</p>
                				<br>$nama
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";
                    $no=$no+1;               
                    }
        
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
       
    }
    
*/ 
 function preview_perda1dns(){
      
      
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    function tes(){

            $data['page_title'] = "Master Data Kegiatan &raquo; Tambah";
            $lc = "select kd_skpd,nm_skpd from ms_skpd order by kd_skpd";
            $query = $this->db->query($lc);
            $data["skpd"]=$query->result();
            
        
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $this->template->load('template','anggaran/rka/tes',$data);
        
                
    }
    
     function preview_perda1(){
       //$id = $this->uri->segment(3);
      $cetak = $this->uri->segment(3);
      
      $tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sql_trhrka="SELECT status_rancang, tgl_dpa_rancang FROM trhrka where kd_skpd='1.01.01.01'";
         $sql_trhrka=$this->db->query($sql_trhrka);
         foreach ($sql_trhrka->result() as $rowsc)
        {                  
            $tgl_rancang= strtotime($rowsc->tgl_dpa_rancang);
        }
            
        if($tgl>$tgl_rancang){
            $rancang = '';
            $n_trdrka = 'trdrka';
        }else{
            $rancang = 'Rancangan';
            $n_trdrka  =   'trdrka_rancang';
        }
      
      $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
        
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $cRet='';
        
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;text-transform:uppercase;border-bottom: none;border-left: none;\" >$rancang RINGKASAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead >                       
                        <tr><td  width=\"15%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"65%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     
                     
                        <tr><td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;\" width=\"70%\"  align=\"center\">2</td>
                            <td style=\"font-weight:bold;\" width=\"20%\"  align=\"center\">3</td></tr>
					</thead>
					<tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"3\"><i>Lampiran I : Perda Prov.Kalimantan Barat - Ringkasan Penyusunan APBD TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN $n_trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN $n_trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN $n_trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   if (strlen($coba1)>3) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   } else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   }
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM $n_trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
									 
                $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN $n_trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN $n_trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN $n_trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    if (strlen($coba5)>3) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
					} else {
					$cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";

					}
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM $n_trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
				 
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">SURPLUS(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
					                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                    $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN $n_trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN $n_trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN $n_trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",",",".");
                    if (strlen($coba9)>3) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
					} else {
						 $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
					}
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM $n_trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",",",".");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
									 
                $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN $n_trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN $n_trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",",",".");
                   if (strlen($coba13)>3) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
				   } else {
					   $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>"; 
				   }
                }
				                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sqltpk="SELECT SUM(nilai) AS totpk FROM $n_trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",",",".");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $netto=$cob3-$cob4; 
					$netto_ag=$netto*-1;
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 //$nett=number_format($netto_ag,2,',','.');
				 $nett=$this->rp_minus($netto_ag);			
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">PEMBIAYAAN NETTO</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
					 $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";

									 
                     $cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"3\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
							 
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
       // $this->template->load('template','anggaran/rka/perda1',$data);
          

        switch($cetak){   
        case 1;
			$this->_mpdf('',$cRet,10,5,10,'0','','Lampiran 1','',2);
		//echo $cRet;//$this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
				echo ("<title>Perda Lampiran 1</title>");
                echo($cRet);
		//$this->template->load('template','anggaran/rka/perda1',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
                
    }
    
 
 
        /*  function preview_perda1pdf(){
       $id = $this->uri->segment(3);
      
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
        
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $cRet='';
        
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"70%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >RINGKASAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead >                       
                        <tr><td  width=\"15%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"65%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     
                     
                        <tr><td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;\" width=\"70%\"  align=\"center\">2</td>
                            <td style=\"font-weight:bold;\" width=\"20%\"  align=\"center\">3</td></tr>
					</thead>
					<tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"><i>Lampiran I : Perda Prov.Kalimantan Barat - Ringkasan Penyusunan APBD TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
				 
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">SURPLUS(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
					                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
									 
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
				                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">PEMBIAYAAN NETTO</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
					 $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";

									 
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"3\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //echo $cRet;
		
		//$this->template->load('template','anggaran/rka/perda1',$data);
        
                
    } */
    

//ctk_perkadaII_apbd

	function ctk_perkadaII_apbd(){
        $data['page_title']= 'Cetak Lampiran II Penjabaran APBD';
        $this->template->set('title', 'Cetak Lampiran II Penjabaran APBD');   
        $this->template->load('template','anggaran/rka/ctk_perkadaII_apbd',$data) ; 
    }
	
    

     function preview_perkadaII_apbd(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
         $chkrancang = $this->uri->segment(5);  
        
        if ($chkrancang==1){
            $rancang = 'Rancangan';
        }else{
            $rancang = '';
        }
        
        
         $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org FROM ms_skpd a 
                INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
                WHERE left(kd_skpd,7)='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
		          $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        
        $cRet='';
$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran II : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;text-transform:uppercase;border-top: none;border-bottom: none;border-left: none;\" >$rancang PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

   
 		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
                        <td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                        <td  width=\"80%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >: $kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>
 			
            
            		<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                         <td  width=\"80%\" align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >: $kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
                    </tr>
                
                  </table>"; 
				  
				     $fs = 12;   	 
					 $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:$fs px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td width=\"15%\" align=\"center\"><b>PENJELASAN</b></td>
                        </tr>
                        <tr><td width=\"20%\" align=\"center\"><b>1</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>2</b></td>
                            <td width=\"15%\" align=\"center\"><b>3</b></td>
                            <td width=\"15%\" align=\"center\"><b>4</b></td>
                        </tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"4\"><i>
							Lampiran II : PerGub Prov. Kalimantan Barat - Penjabaran Penyusunan APBD TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                      
                        ";

                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                    	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],NM_HUKUM [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;
				$num_sql1 = $query->num_rows();
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    $coba3= number_format($nilai,"2",",",".");
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                    }
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" >$hukum</td></tr>";
                }
                
				if($num_sql1>0){
					$coba4=number_format($totp,"2",",",".");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;text-transform: uppercase;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:11px;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 
				 }
                 $sqltb="select * from (
                        select left(a.kd_skpd,4) [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and LEFT(a.kd_skpd,7)='$id'
                    	group by left(a.kd_skpd,4),LEFT(a.kd_skpd,7),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],ISNULL(nm_hukum,'') [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5                        
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                 $totbl = 0;       
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    $jmlb=number_format($nilai,"2",",",".");
                    
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                    }

                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                 }    
                 
                 $sqlbl = "select b.nm_rek2,isnull(sum(nilai),0) [nilai] from trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where LEFT(a.kd_skpd,7)='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 foreach ($querybl->result() as $rowbl){
                    $nm = $rowbl->nm_rek2;
  
                    $nilai =number_format($rowbl->nilai,"2",",",".");

                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:11px;\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"></td></tr>";
                 }
                 
                 
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],
                            ISNULL(nm_hukum,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;
                    $nilai = number_format($nilai,"2",",",".");
                    
                    if ($rek1=='' ){
                       $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $font = '';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';                        
                    }else{
                        $bold = '';
                        $font = '';                        
                    }
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                }

                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                            </tr>";

                
                    $jumbl=number_format($totbl,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";   

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
          
                     
                if ($id==$this->ppkd){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,'' [hukum] from(
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai_terima], 
                            	(select sum(nilai) from trdrka where right(kd_kegiatan,5)='00.62' and LEFT(a.kd_skpd,7)='1.20.12') [nilai_keluar]
                            	from trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],ISNULL(NM_HUKUM,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;                              
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $coba11= $this->rp_minus($nilai) ;

                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td>
                                        </tr>";
                    }

                    $coba12=number_format($totpm,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH PENERIMAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;\" width=\"15%\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";



                    $sql4="select * from (
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],ISNULL(NM_HUKUM,'') [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        $coba15= $this->rp_minus($nilai) ;

                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                    }
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";

                    $coba16=$this->rp_minus($totpk);                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px; \" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";

            }



/*						
                 $sql1="SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,2) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,2),b.nm_rek2
                        UNION ALL
                        SELECT  rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
						  UNION ALL
                        SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek4
						                      UNION ALL
                        SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek5 b 
                        ON LEFT(a.kd_rek5,7)=b.kd_rek5 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek5
						                                          
                        ) a ORDER BY kd_giat,kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1_rek=$row->kd_rek;
					$coba1_giat=$row->kd_giat;
					$coba1=$coba1_giat.'.'.$this->dotrek($coba1_rek);
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
					if (strlen($coba1_rek)>5) {
				$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 0.5px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";

					} else {
                     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";

					}
                }
				
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka a WHERE LEFT(kd_rek5,1)='4' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENDAPATAN</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA DAERAH</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
				$sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,2)='51' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA TIDAK LANGSUNG</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }  				 
				 
                $sql2="SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='51' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                       UNION ALL
                       SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek4 b 
                       ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='51' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek4
		               UNION ALL
                       SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek5 b 
                       ON LEFT(a.kd_rek5,7)=b.kd_rek5 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='51' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek5
                       ) a ORDER BY kd_giat,kd_rek
 ";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
					
                   // $coba5=$row1->kd_rek;
					$coba5_rek=$row1->kd_rek;
					$coba5_giat=$row1->kd_giat;
					$coba5=$coba5_giat.'.'.$this->dotrek($coba5_rek);
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   if (strlen($coba5_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
				   }else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
				   }
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka a WHERE LEFT(kd_rek5,2)='52' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA LANGSUNG</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
				 
                 $sql2bl="  SELECT * FROM (SELECT rtrim(a.kd_program) AS kd_giat,'' AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,'' AS lokasi FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,isnull(x.lokasi,'')lokasi FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan 
                          left join 
                          (select ('Lokasi : '+lokasi)lokasi,kd_kegiatan,kd_skpd from trskpd where right(rtrim(kd_program),2)>15 ) X ON X.kd_kegiatan=A.KD_KEGIATAN 
                          WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan,x.lokasi
                          UNION ALL 
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,'' AS lokasi FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 
                          WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                          UNION ALL 
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,'' AS lokasi FROM trdrka a INNER JOIN ms_rek4 b 
                          ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                          WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek4
                          UNION ALL 
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,'' AS lokasi FROM trdrka a INNER JOIN ms_rek5 b 
                          ON LEFT(a.kd_rek5,7)=b.kd_rek5 
                          WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek5
						  
                          ) a ORDER BY kd_giat,kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
					
                   // $bl1=$row1bl->kd_rek;
					$bl1_rek=$row1bl->kd_rek;
					$bl1_giat=$row1bl->kd_giat;
					$bl1=$bl1_giat.'.'.$this->dotrek($bl1_rek);
					
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",".",",");
					//$bl4=$row1bl->nm_hukum;
					//$bl4=str_replace('&lt;br&gt;','<br>',$row1bl->nm_hukum);
					       
                 if (strlen($bl1_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">&nbsp;</td></tr>";
				 } else {
					  $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">&nbsp;</td></tr>";
				 }
                }
                 
                $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH BELANJA</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
				  
                    $surplus=$cob1-$cob;
					$jml_surplus=number_format($surplus,"2",".",",");
					if ($surplus<0)
					{
						$surplus=$surplus*(-1);
						$jml_surplus=number_format($surplus,"2",".",",");
						$jml_surplus='('.$jml_surplus.')';
					}
					
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">SURPLUS/(DEFISIT)</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jml_surplus</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                    
                    $sql3=" SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_kegiatan,5)='00.61' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='61' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,5)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='61' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek3 
	                       UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,7)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='61' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek3
                                                     ) a ORDER BY kd_giat,kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
					
					
                    //$coba9=$row3->kd_rek;
					$coba9_rek=$row3->kd_rek;
					$coba9_giat=$row3->kd_giat;
					$coba9=$coba9_giat.'.'.$this->dotrek($coba9_rek);
                   
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
					
                                    if (strlen($coba9_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
									} else {
										 $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
									}
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka a WHERE LEFT(kd_rek5,2)='61' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                    if ($rowpm->totpm != 0){
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENERIMAAN DAERAH</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
					}
                 }     
				 
                $sql4=" SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_kegiatan,5)='00.62' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='62' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,5)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='62' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek3 
	                       UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,7)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='62' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek3
                                                     ) a ORDER BY kd_giat,kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    //$coba13=$row4->kd_rek;
					$coba13_rek=$row4->kd_rek;
					$coba13_giat=$row4->kd_giat;
					$coba13=$coba13_giat.'.'.$this->dotrek($coba13_rek);
					
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   if (strlen($coba13_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
				   } else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
				   }
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka a WHERE LEFT(kd_rek5,2)='62' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   if ($rowpk->totpk != 0){
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
				   }
                 }  
				 
*/					 
					if($id=='2.06.01'){
									 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"4\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"width: 30%; \" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
					}
        $cRet .=       " </table>";

        $data['prev']= $cRet;
        //$this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
		ini_set('memory_limit','5000M');
		set_time_limit(5000);
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
				$jdl = 'Laporan Penjabaran APBD ['.$kd_org.']';
                echo ("<title>$jdl</title>");
                echo($cRet);
       
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
//end ctk_perkadaII_apbd
 
	
	

    function preview_perda1_skpd(){
      $id = $this->uri->segment(3);
      $cetak = $this->uri->segment(4);
      // echo "$cetak";
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA'); 
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perda1_skpd',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perda1_skpd', $data);
        break;
        }
        
                
    }
    
         function preview_perda1_skpdpdf(){
 $id = $this->uri->segment(3);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' and b.kd_skpd='$id'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
                $sql4="SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62'  and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"3\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
								<br>BUPATI/WALIKOTA,
      							<p>&nbsp;</p>
                				<br>JAKA SONJAYA
                				<br>NIP. 30707
								</td></tr></table></td>
                             </tr>";
        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perda1',$data);
        
                
    }
    

    function preview_perdaII(){
        $cjns = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        
		$tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sql_trhrka="SELECT status_rancang, tgl_dpa_rancang FROM trhrka where kd_skpd='1.01.01.01'";
        $sql_trhrka=$this->db->query($sql_trhrka);
        foreach ($sql_trhrka->result() as $rowsc){                  
            $tgl_rancang= strtotime($rowsc->tgl_dpa_rancang);
        }
            
			
        if($tgl>$tgl_rancang){
            $rancang = '';
            $n_trdrka = 'trdrka';
        }else{
            $rancang = 'Rancangan';
            $n_trdrka  =   'trdrka_rancang';
        }


         $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
        $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran II : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform:uppercase;\" >$rancang RINGKASAN APBD MENURUT URUSAN PEMERINTAHAN DAERAH DAN ORGANISASI</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" width=\"38%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td rowspan=\"2\" width=\"13%\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td colspan=\"3\" width=\"39%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                    <td width=\"13%\" align=\"center\"><b>TIDAK LANGSUNG</b></td>
                            <td width=\"13%\" align=\"center\"><b>LANGSUNG</b></td>
                            <td width=\"13%\" align=\"center\"><b>JUMLAH BELANJA</b></td>
                        </tr>    
                        <tr>
                            <td align=\"center\">1</td>
                            <td align=\"center\">2</td>
                            <td align=\"center\">3</td>
                            <td align=\"center\">4</td>
                            <td align=\"center\">5</td>
                            <td align=\"center\">6</td>                                 
                         </tr>
                     </thead>
					  <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"><i>Lampiran II : Perda Prov. Kalimantan Barat - Ringkasan Penyusunan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
        //rumus cetak skpd
    //    if ($cjns=='SKPD')
//        {
//                 $sql1="
//                        SELECT * FROM (
//                        SELECT a.kd_urusan1 [A], a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan ,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl, 
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl, 
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah FROM trdrka b RIGHT JOIN ms_urusan1 a 
//                        ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY a.kd_urusan1 ,a.nm_urusan1 
//                        UNION all 
//                        SELECT a.kd_urusan [A],a.kd_urusan AS kode, a.nm_urusan AS nama,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(c.kd_rek5,1)='4' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS pendapatan ,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan)  WHERE LEFT(c.kd_rek5,2)='51' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS btl, 
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(c.kd_rek5,2)='52' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS bl, 
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(c.kd_rek5,1)='5' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS jumlah FROM trdrka b RIGHT JOIN
//                         ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY a.kd_urusan ,a.nm_urusan 
//                         UNION all						 
//                         SELECT e.kd_urusan+'.'+right(kd_org,5) [A],b.kd_org AS kode, b.nm_org AS nama,
//                         (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,1)='4' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7) AND LEFT(b.kd_urusan,4)=e.kd_urusan) AS pendapatan, 
//                         (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,2)='51' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7) AND LEFT(b.kd_urusan,4)=e.kd_urusan) AS btl, 
//                         (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,2)='52' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7)AND LEFT(b.kd_urusan,4)=e.kd_urusan) AS bl, 
//                         (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,1)='5' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7) AND LEFT(b.kd_urusan,4)=e.kd_urusan)AS jumlah
//                          FROM trdrka a 
//                          RIGHT JOIN ms_organisasi b ON left(rtrim(a.kd_skpd),7)=rtrim(b.kd_org)
//                          join trskpd e on rtrim(LEFT(a.no_trdrka,32))=rtrim(e.kd_gabungan)
//                          GROUP BY e.kd_urusan,b.kd_org,b.nm_org,left(rtrim(a.kd_skpd),7) 
//                          ) a ORDER BY a.A
//
//	  					 ";
//       }
//       // rumus cetak per unit
//       else
//       {         
//                 $sql1="
//                            SELECT * FROM (
//                            SELECT a.kd_urusan1 [A], a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan ,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah FROM trdrka b RIGHT JOIN ms_urusan1 a 
//                            ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY a.kd_urusan1 ,a.nm_urusan1 
//                            UNION all 
//                            SELECT a.kd_urusan [A],a.kd_urusan AS kode, a.nm_urusan AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(c.kd_rek5,1)='4' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS pendapatan ,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan)  WHERE LEFT(c.kd_rek5,2)='51' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS btl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(c.kd_rek5,2)='52' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS bl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(c.kd_rek5,1)='5' AND LEFT(b.kd_urusan,4)=a.kd_urusan) AS jumlah FROM trdrka b RIGHT JOIN
//                            ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY a.kd_urusan ,a.nm_urusan 
//                            UNION all						 
//                            SELECT e.kd_urusan+'.'+right(kd_org,5) [A],b.kd_org AS kode, b.nm_org AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,1)='4' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7) AND LEFT(b.kd_urusan,4)=e.kd_urusan) AS pendapatan, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,2)='51' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7) AND LEFT(b.kd_urusan,4)=e.kd_urusan) AS btl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,2)='52' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7)AND LEFT(b.kd_urusan,4)=e.kd_urusan) AS bl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka c join trskpd b on rtrim(LEFT(c.no_trdrka,32))=rtrim(b.kd_gabungan) WHERE LEFT(kd_rek5,1)='5' AND left(rtrim(c.kd_skpd),7)=left(rtrim(a.kd_skpd),7) AND LEFT(b.kd_urusan,4)=e.kd_urusan)AS jumlah
//                            FROM trdrka a 
//                            RIGHT JOIN ms_organisasi b ON left(rtrim(a.kd_skpd),7)=rtrim(b.kd_org)
//                            join trskpd e on rtrim(LEFT(a.no_trdrka,32))=rtrim(e.kd_gabungan)
//                            GROUP BY e.kd_urusan,b.kd_org,b.nm_org,left(rtrim(a.kd_skpd),7) 
//                            UNION all						 
//                            SELECT e.kd_urusan +'.'+right(b.kd_skpd,8)[A],b.kd_skpd AS kode, b.nm_skpd AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND left(rtrim(kd_skpd),10)=left(rtrim(a.kd_skpd),10)) AS pendapatan, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND left(rtrim(kd_skpd),10)=left(rtrim(a.kd_skpd),10)) AS btl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND left(rtrim(kd_skpd),10)=left(rtrim(a.kd_skpd),10)) AS bl, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND left(rtrim(kd_skpd),10)=left(rtrim(a.kd_skpd),10))AS jumlah 
//                            FROM trdrka a 
//                            RIGHT JOIN ms_skpd b ON left(rtrim(a.kd_skpd),10)=rtrim(b.kd_skpd) 
//                            join trskpd e on rtrim(LEFT(a.no_trdrka,32))=rtrim(e.kd_gabungan)
//                            GROUP BY e.kd_urusan,b.kd_skpd,b.nm_skpd,left(rtrim(a.kd_skpd),10)
//                            ) a ORDER BY a.A
//						 ";
//        }
//

                $sql1 = "SELECT * FROM (
                            SELECT a.kd_urusan1 [A], a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan ,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl, 
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl
                            FROM $n_trdrka b RIGHT JOIN ms_urusan1 a 
                            ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY a.kd_urusan1 ,a.nm_urusan1 
                            UNION all 
                            select distinct b.kd_urusan [A],b.kd_urusan [kode], c.nm_urusan [nama],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_kegiatan,4)=b.kd_urusan) [pendapatan],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_kegiatan,4)=b.kd_urusan) [btl],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_kegiatan,4)=b.kd_urusan) [bl]
                            from $n_trdrka a 
                            join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                            join ms_urusan c on b.kd_urusan=c.kd_urusan
                            UNION all						 
                            select distinct b.kd_urusan+'.'+c.kd_org [A],c.kd_org [kode], c.nm_org [nama],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_kegiatan,4)=b.kd_urusan and LEFT(d.kd_skpd,7)=c.kd_org) [pendapatan],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_kegiatan,4)=b.kd_urusan and LEFT(d.kd_skpd,7)=c.kd_org) [btl],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_kegiatan,4)=b.kd_urusan and LEFT(d.kd_skpd,7)=c.kd_org) [bl]
                            from $n_trdrka a 
                            join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                            join ms_organisasi c on LEFT(a.kd_skpd,7)=c.kd_org ";
                
                if ($cjns=='SKPD'){
                    $sql2 ="";
                    $cekbold = 4;
                }else{ 
                    $sql2 ="    union all
                                select distinct b.kd_urusan+'.'+c.kd_skpd [A],c.kd_skpd [kode], c.nm_skpd [nama],
                                (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_kegiatan,4)=b.kd_urusan and d.kd_skpd=c.kd_skpd) [pendapatan],
                                (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_kegiatan,4)=b.kd_urusan and d.kd_skpd=c.kd_skpd) [btl],
                                (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_kegiatan,4)=b.kd_urusan and d.kd_skpd=c.kd_skpd) [bl]
                                from $n_trdrka a 
                                join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                                join ms_skpd c on a.kd_skpd=c.kd_skpd ";
                    $cekbold = 7;
                    }
                 
                 $sql3 =") a ORDER BY a.A ";                         
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                
                $tjum = 0;
                $tpend = 0;
                $tbtl = 0;
                $tbl = 0;
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend = $row->pendapatan;
                    $btl = $row->btl;
                    $bl = $row->bl;
                    $jumlah = $btl + $bl;
                    $ceknol = $pend + $jumlah;
                    
                    if (strlen($kode)==1){
                        $tpend = $tpend + $pend;
                        $tbtl = $tbtl + $btl;
                        $tbl = $tbl + $bl;
                        $tjum = $tjum + $jumlah;
                    }
                                        
                    $pend=number_format($pend,"2",",",".");
                    $btl= number_format($btl,"2",",",".");
                    $bl= number_format($bl,"2",",",".");
                    $jum= number_format($jumlah,"2",",",".");
                   
                   
				   if (strlen($kode)>$cekbold and $ceknol<>0 ) 
				   {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>
                                     ";
				    } else {
					       if($ceknol<>0){
						      if (strlen($kode)<=4){
                                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><b>&nbsp;</b></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td></tr>
                                         ";
                              }
									 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><b>$kode</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$pend</b></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$btl</b></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$bl</b></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$jum</b></td></tr>
                                     ";
                                }
                        
				    }

                  }

                    $nsurplus = $this->rp_minus(($tpend - ($tbtl+$tbl)));                  
                    $pend=number_format($tpend,"2",",",".");
                    $btl= number_format($tbtl,"2",",",".");
                    $bl= number_format($tbl,"2",",",".");
                    $jum= number_format($tjum,"2",",",".");
                                       
                    $cRet    .= "  <tr><td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" width=\"10%\" align=\"right\">JUMLAH</td>                                     
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:11px;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>";

                    $cRet    .= "  <tr><td style=\"vertical-align:top;font-weight:bold;font-size:11px;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" width=\"10%\" align=\"right\">Surplus / (Defisit)</td>                                     
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:11px;border-top: solid 1px black;border-bottom: none;\" colspan=\"4\" width=\"13%\" align=\"right\">$nsurplus</td></tr>";

                                     
  

				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"font-size:16px;width: 30%;\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";							 

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        //$this->_mpdf('',$cRet,10,10,10,0);
       
	switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        echo ("<title>Perda Lampiran II</title>");
		echo ($cRet);
		break;	
		case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perdaII', $data);
        break;
        }
		
    }
      
 ///end preview perdaII   

 
 //Lampiran Pergub Alokasi dana
 function ctk_perkadaIa()
	{	
	 $data['page_title']= 'Cetak ALOKASI DANA';
     $this->template->set('title', 'Cetak ALOKASI DANA');
	 $this->template->load('template','anggaran/rka/ctk_perkadaIa',$data) ;
	 //$this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN I.1 ALOKASI DANA','ctk_perkadaIa','');
	}
 
  function preview_perkadaIa(){
         $cjns = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
         $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
		if ($cjns == 'HIBAH' ){
		      $jdl = 'Alokasi Hibah';
              $kd_alokasi = '514';
              $ckd_sql1 = ' LEFT(a.kd_Rek5,3)='.$kd_alokasi ;
		}else{
		      $jdl = 'Alokasi Bantuan Sosial';
              $kd_alokasi1 = "''";//'517';
              $kd_alokasi2 = '515';
              $ckd_sql1 = ' LEFT(a.kd_Rek5,3)='.$kd_alokasi1.'or LEFT(a.kd_Rek5,3)='.$kd_alokasi2;
		}		
        
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
        $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					   <td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					       <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                        <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none; text-transform:uppercase;border-left: none;\" >DAFTAR NAMA PENERIMA, ALAMAT DAN BESARAN $jdl YANG DITERIMA</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"10%\" align=\"center\"><b>NO</b></td>                            
                            <td width=\"20%\" align=\"center\"><b>NAMA PENERIMA</b></td>
                            <td width=\"40%\" align=\"center\"><b>ALAMAT PENERIMA</b></td>
                            <td width=\"30%\" align=\"center\"><b>JUMLAH (Rp.)</b></td>
                            </tr>
                        
                        <tr>
                            <td align=\"center\"><strong>1</strong></td>
                            <td align=\"center\"><strong>2</strong></td>
                            <td align=\"center\"><strong>3</strong></td>
                            <td align=\"center\"><strong>4</strong></td>
                                                             
                         </tr>
                     </thead>
                     <tfoot>
                     </tfoot>
                        ";
        
        
        
        $sql1=" select a.* from (
                    select a.kd_rek5 [urut],0 [no_urut],a.kd_rek5 [penerima],a.nm_rek5 [alamat],
                    isnull(sum(nilai),0) [nilai] from trdrka a where $ckd_sql1 group by a.kd_rek5,a.nm_rek5                     
                    union all
                    select a.kd_rek5 [urut],c.no_urut,
                    penerima,alamat,total [nilai] from trdrka a inner join trdalokasi c on a.no_trdrka = c.no_trdrka where 
                    total<>0 and penerima <> '' and $ckd_sql1 
                ) as a order by urut,no_urut";
        
 
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $total = 0;                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->no_urut;
                    $nama=$row->penerima;
                    $alamat = $row->alamat;
                    $nilai = number_format($row->nilai,"2",",",".");
                   $curut = 1;
				   if ($kode<>0) 
				   {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\" align=\"left\">$alamat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\" align=\"right\">$nilai</td></tr>
                                     ";
								$curut = $curut + 1;
				    } else {
				                    $total = $total + $row->nilai;
									  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><b>&nbsp;</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\" align=\"left\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\" align=\"right\"><b> &nbsp;</b></td></tr>
                                     ";

									 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\"><b></b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\" align=\"left\"><b><ins>$alamat</ins></b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\" align=\"right\"><b>$nilai</b></td></tr>
                                     ";
									$curut = 1;
                        
				    }

                  }       
                    $total = number_format($total,"2",",",".");
                   $cRet    .= " <tr>
                                     <td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"3\" width=\"70%\" align=\"right\"><b>TOTAL</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\" align=\"right\"><b>$total</b></td></tr>
                                     ";  
                 $cRet .="</table>";


        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";
				   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style= width=\"70%\" align=\"left\" >&nbsp;
								</td>
								<td style=width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        $cRet .="</table>";            
 
        $cRet .=       " </table>";
        
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        //$this->_mpdf('',$cRet,10,10,10,0);
       
	switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        //$this->template->load('template','anggaran/rka/perdaII',$data);
        echo ("<title>Lampiran I.1</title>");
        echo($cRet);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perdaII', $data);
        break;
        }
		
    }

 //End Lampiran Pergub Alokasi dana
 
 
   /*  function preview_perdaIIpdf(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				
        
		
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"70%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran II : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >RINGKASAN APBD MENURUT URUSAN PEMERINTAHAN DAERAH DAN ORGANISASI</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" width=\"38%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td rowspan=\"2\" width=\"13%\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td colspan=\"3\" width=\"39%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                    <td width=\"13%\" align=\"center\"><b>TIDAK LANGSUNG</b></td>
                            <td width=\"13%\" align=\"center\"><b>LANGSUNG</b></td>
                            <td width=\"13%\" align=\"center\"><b>JUMLAH BELANJA</b></td>
                        </tr>    
                        <tr>
                            <td align=\"center\">1</td>
                            <td align=\"center\">2</td>
                            <td align=\"center\">3</td>
                            <td align=\"center\">4</td>
                            <td align=\"center\">5</td>
                            <td align=\"center\">6</td>                                 
                         </tr>
                     </thead>
					  <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"><i>Lampiran II : Perda Prov. Kalimantan Barat - Ringkasan Penyusunan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
                 $sql1="
						SELECT * FROM (
						SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan ,
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl, 
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl, 
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah FROM trdrka b RIGHT JOIN ms_urusan1 a 
						ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY a.kd_urusan1 ,a.nm_urusan1 
						UNION all 
						SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS pendapatan ,
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl, 
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl, 
						(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah FROM trdrka b RIGHT JOIN
						 ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY a.kd_urusan ,a.nm_urusan 
						 UNION all
						 SELECT b.kd_org AS kode, b.nm_org AS nama,
						 (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=left(rtrim(a.kd_skpd),7)) AS pendapatan, 
						 (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=left(rtrim(a.kd_skpd),7)) AS btl, 
						 (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=left(rtrim(a.kd_skpd),7)) AS bl, 
						 (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=left(rtrim(a.kd_skpd),7))AS jumlah FROM trdrka a 
						 RIGHT JOIN ms_organisasi b ON left(rtrim(a.kd_skpd),7)=rtrim(b.kd_org) GROUP BY b.kd_org,b.nm_org,left(rtrim(a.kd_skpd),7)
						 ) a ORDER BY a.kode
						 ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->pendapatan,"2",".",",");
                    $btl= number_format($row->btl,"2",".",",");
                    $bl= number_format($row->bl,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
				   if (strlen($kode)>4)
				   {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>
                                     ";
				} else {
					
									  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><b>&nbsp;</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b> &nbsp;</b></td></tr>
                                     ";

									 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><b>$kode</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"38%\"><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$pend</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$btl</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$bl</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\"><b>$jum</b></td></tr>
                                     ";
				}
               
        
                  }  

				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"width: 30%;\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
							 
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
       $this->_mpdf('',$cRet,10,10,10,1);
       // echo $cRet;

        //$this->template->load('template','anggaran/rka/perdaII',$data);
        
                
    }
     */
	 
   function preview_perdaIII(){
      $id = $this->uri->segment(3);
		 $cetak = $this->uri->segment(4);         
        $tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sql_trhrka="SELECT status_rancang, tgl_dpa_rancang FROM trhrka where kd_skpd='1.01.01.01'";
        $sql_trhrka=$this->db->query($sql_trhrka);
        foreach ($sql_trhrka->result() as $rowsc){                  
            $tgl_rancang= strtotime($rowsc->tgl_dpa_rancang);
        }
            
        if($tgl>$tgl_rancang){
            $rancang = '';
            $n_trdrka = 'trdrka';
        }else{
            $rancang = 'Rancangan';
            $n_trdrka  =   'trdrka_rancang';
        }

         $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org 
                    FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join 
                    ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
                    WHERE kd_org='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                   // $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				  
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       $id=$kd_org;
        $cRet='';
        
				 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran III : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				   
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform: uppercase;\" >RINCIAN $rancang APBD MENURUT URUSAN PEMERINTAH DAERAH, <br> ORGANISASI, PENDAPATAN, BELANJA DAN PEMBIAYAAN</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";      

				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
    					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:solid 1px black;border-bottom: none;border-left: none;border-right:none; \" >:</td>
                        <td  width=\"78%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >$kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>

					<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:none;border-bottom: none;border-left: none;border-right:none; \" >:</td>
                         <td  width=\"78%\" align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >$kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Unit Organisasi </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:none;border-left: none;border-right:none; \" >:</td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none; \" >$kd_org - $nm_org</td>
                    </tr>
                  </table>"; 
				  
				        
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr><td width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"45%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"30%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"45%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"30%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"15%\" align=\"center\">4</td>
                        </tr> 
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"4\"><i>Lampiran III : Perda Prov. Kalimantan Barat - Rincian  Penyusunan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                       ";
					   
                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from $n_trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                    	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                    		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                    			(select kd_kegiatan,nm_hukum from d_hukum a 
                    			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                    			) Z FOR XML path(''), elements)
                    		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;                                  
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    $coba3= number_format($nilai,"2",",",".");
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                    }
                    
                    if (strlen($rek1)<3){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" >$hukum</td></tr>";
                }
                   $coba4=number_format($totp,"2",",",".");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;text-transform: uppercase;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:11px;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                
                 $sqltb="select * from (
                        select left(a.kd_skpd,4) [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from $n_trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and LEFT(a.kd_skpd,7)='$id'
                    	group by left(a.kd_skpd,4),LEFT(a.kd_skpd,7),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                    		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                    			(select kd_kegiatan,nm_hukum from d_hukum a 
                    			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                    			) Z FOR XML path(''), elements)
                    		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                        
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                 $totbl = 0;       
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    $jmlb=number_format($nilai,"2",",",".");
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                    }

                    
                    if (strlen($rek1)<3){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                 }    
                 
				 
                 $sqlbl = "select b.nm_rek2,isnull(sum(nilai),0) [nilai] from $n_trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where LEFT(a.kd_skpd,7)='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 foreach ($querybl->result() as $rowbl){
                    $nm = $rowbl->nm_rek2;
  
                    $nilai =number_format($rowbl->nilai,"2",",",".");

                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:11px;\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"></td></tr>";
                 }
                 
                 
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],
                            isnull(NM_HUKUM,'') [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3,NM_HUKUM 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;
                    $nilai = number_format($nilai,"2",",",".");
                    
                    if ($rek1=='' || strlen($rek1)==2){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $font = '';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                }

                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                            </tr>";

                
                    $jumbl=number_format($totbl,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
		
        /*		 
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,'' AS nm_hukum FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,'' AS nm_hukum FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          
                          SELECT  SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,nm_hukum FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 left join (
                           
 SELECT KD_KEGIATAN,NM_HUKUM=((SELECT '<br>- ' + nm_hukum FROM (select kd_kegiatan,nm_hukum from d_hukum 
 a inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan ) Z
 FOR XML path(''), elements)) FROM d_hukum C GROUP BY kd_kegiatan) X ON X.kd_kegiatan=A.KD_KEGIATAN
                          WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3,nm_hukum
						  
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",",",".");
					//$bl4=$row1bl->nm_hukum;
					$bl4=str_replace('&lt;br&gt;','<br>',$row1bl->nm_hukum);
					       
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$bl4</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",",",".");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
         */         

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
          
                   
                if ($id==$this->ppkd){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,'' [hukum] from(
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai_terima], 
                            	(select sum(nilai) from $n_trdrka where right(kd_kegiatan,5)='00.62' and LEFT(a.kd_skpd,7)='1.20.12') [nilai_keluar]
                            	from $n_trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                            
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;                              
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $coba11= $this->rp_minus($nilai) ;

                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                        }
                        
                        if (strlen($rek1)<3){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td>
                                        </tr>";
                    }

                    $coba12=number_format($totpm,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH PENERIMAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;\" width=\"15%\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";


						
                    $sql4="select * from (
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum]  from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                            
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        $coba15= $this->rp_minus($nilai) ;

                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                        }
                        
                        if (strlen($rek1)<3){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                    }
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";

                    $coba16=$this->rp_minus($totpk);                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px; \" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";

            }

                 
				if($id =='2.06.01'){
				 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"4\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        
				}else{
					
				}
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $data['kd_org']= $id;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
       
		  switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
       // echo $cRet;
		break;
        case 0;
			echo ("<title>Perda Lampiran III $id</title>");
			echo ($cRet);
			break;	
		case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perdaIII', $data);
        break;
        }
        
                
    }
 
	 
    function preview_perdaIIIpdf(){
      $id = $this->uri->segment(3);
        $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org FROM ms_skpd a 
INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
 WHERE kd_org='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                   // $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				  
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       $id=$kd_org;
        $cRet='';
        
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"70%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran III : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >RINGKASAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";      

				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                         <td  width=\"80%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >: $kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none; \" >: $kd_org - $nm_org</td>
                    </tr>
                  </table>"; 
				  
				        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"4\"><i>Lampiran III : Perda Prov. Kalimantan Barat - Rincian  Penyusunan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->kd_rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka a WHERE LEFT(kd_rek5,1)='4' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->kd_rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka a WHERE LEFT(kd_rek5,2)='52' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",",",".");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
				 
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,'' AS nm_hukum FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,'' AS nm_hukum FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          
                          SELECT  SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,nm_hukum FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 left join (
                           
 SELECT KD_KEGIATAN,NM_HUKUM=((SELECT '<br>- ' + nm_hukum FROM (select kd_kegiatan,nm_hukum from d_hukum 
 a inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan ) Z
 FOR XML path(''), elements)) FROM d_hukum C GROUP BY kd_kegiatan) X ON X.kd_kegiatan=A.KD_KEGIATAN
                          WHERE left(rtrim(a.kd_skpd),7)='1.20.12' and left(a.kd_rek5,2)='52' 
                           GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3,nm_hukum
						  
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",",",".");
					//$bl4=$row1bl->nm_hukum;
					$bl4=str_replace('&lt;br&gt;','<br>',$row1bl->nm_hukum);
					       
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$bl4</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",",",".");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->kd_rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka a WHERE LEFT(kd_rek5,2)='61' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",",",".");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->kd_rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka a WHERE LEFT(kd_rek5,2)='62' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",",",".");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
                 }  
				 
				 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"4\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        
                  
                  //$netto=$cob3-$cob4; 
//                  if ($netto < 0){
//                	$a1="(";
//                	$suplus=$netto*-1;
//                	$b1=")";}
//                  else {
//                	$a1="";
//	                $b1="";}
//                 $nett=number_format($netto,2,',','.');  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Pembiayaan Netto</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
//                    $silpa=($cob1+$cob3)-($cob+$cob4);
//                     if ($silpa < 0){
//                	$c1="(";
//                	$silpa=$silpa*-1;
//                	$d1=")";}
//                    else {
//                	$c1="";
//	                $d1="";}
//                 $silp=number_format($silpa,2,',','.');                  
//                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA');    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perdaIII',$data);
        
                
    }
   

  function preview_perdaIV(){
        $cjns = $this->uri->segment(3);
		$cetak = $this->uri->segment(4);
        $tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sql_trhrka="SELECT status_rancang, tgl_dpa_rancang FROM trhrka where kd_skpd='1.01.01.01'";
        $sql_trhrka=$this->db->query($sql_trhrka);
        foreach ($sql_trhrka->result() as $rowsc){                  
            $tgl_rancang= strtotime($rowsc->tgl_dpa_rancang);
        }
            
        if($tgl>$tgl_rancang){
            $rancang = '';
            $n_trdrka = 'trdrka';
        }else{
            $rancang = 'Rancangan';
            $n_trdrka  =   'trdrka_rancang';
        }
                    

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    //$tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
         $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
		  
        $cRet='';
        
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";   
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform: uppercase;\" >$rancang REKAPITULASI BELANJA MENURUT URUSAN PEMERINTAHAN DAERAH, ORGANISASI</td>
                    </tr>
                   
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">PROGRAM DAN KEGIATAN TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

        
		
		
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"15%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\"  width=\"39%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td colspan=\"4\"  width=\"56%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"14%\" align=\"center\"><b>PEGAWAI</b></td>
                             <td width=\"14%\" align=\"center\"><b>BARANG DAN JASA</b></td>
                            <td width=\"14%\" align=\"center\"><b>MODAL</b></td>
                            <td width=\"14%\" align=\"center\"><b>JUMLAH BELANJA</b></td>
                        </tr>
						<tr><td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">6</td></tr>						
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"><i>Lampiran IV : Perda Prov. Kalimantan Barat - Rekapitulasi Anggaran Belanja Berdasarkan Program dan Kegiatan TA $thn</i></td>

                         </tr>
                     </tfoot>
                    
                      
                        ";
				
//              versi unit sama dengan skpd
//				$csql1 ="select * from(
//                        SELECT a.kd_urusan1 AS urusan, '' [skpd],'' [program], a.nm_urusan1 AS nama,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm FROM trdrka b 
//                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1 
//                        UNION all
//                        SELECT a.kd_urusan AS urusan,'' [skpd],'' [program], a.nm_urusan AS nama,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bpeg
//                        ,(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_kegiatan,4)=a.kd_urusan)AS bbj,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bm FROM 
//                        trdrka b INNER JOIN ms_urusan a ON LEFT(b.kd_kegiatan,4)=a.kd_urusan GROUP BY  LEFT(b.kd_kegiatan,4),a.kd_urusan ,a.nm_urusan
//                        union all
//                        SELECT left(a.kd_kegiatan,4) AS urusan,left(a.kd_skpd,7) [skpd],'' [program], b.nm_org AS nama,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)  ) AS bpeg,
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bbj, 
//                        (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bm FROM trdrka a 
//                        INNER JOIN ms_organisasi b ON left(a.kd_skpd,7)=b.kd_org GROUP BY left(a.kd_kegiatan,4),left(a.kd_skpd,7),b.nm_org 
//                        union all ";
//                if ($cjns=='UNIT')
//				{   
//    				$csql2=" SELECT left(a.kd_kegiatan,4) AS urusan,a.kd_skpd [skpd],'' [program], b.nm_skpd AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)  ) AS bpeg,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bbj, 
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bm FROM trdrka a 
//                            INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY left(a.kd_kegiatan,4),a.kd_skpd,b.nm_skpd
//                            union all
//                            SELECT left(a.kd_kegiatan,4) AS urusan, a.kd_skpd as kd_skpd,right(b.kd_program,2) AS program,b.nm_program AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm
//                            FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
//                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),a.kd_skpd,right(b.kd_program,2),b.nm_program
//                            union all
//                            SELECT left(a.kd_kegiatan,4) AS urusan, a.kd_skpd as kd_skpd,right(a.kd_kegiatan,5) AS program,b.nm_kegiatan AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bpeg,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bbj,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bm
//                            FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
//                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),a.kd_skpd,right(a.kd_kegiatan,5),b.nm_kegiatan
//                            ) as a ORDER BY urusan,skpd,program
//                            ";
//                 }else{
//                    $csql2="SELECT left(a.kd_kegiatan,4) AS urusan, left(a.kd_skpd,7) as kd_skpd,right(b.kd_program,2) AS program,b.nm_program AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm
//                            FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
//                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),left(a.kd_skpd,7),right(b.kd_program,2),b.nm_program
//                            union all
//                            SELECT left(a.kd_kegiatan,4) AS urusan, left(a.kd_skpd,7) as kd_skpd,right(b.kd_kegiatan,5) AS program,b.nm_kegiatan AS nama,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bpeg,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bbj,
//                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bm
//                            FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
//                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),left(a.kd_skpd,7),right(b.kd_kegiatan,5),b.nm_kegiatan
//                            ) as a ORDER BY urusan,skpd,program ";
//
//                 }  
//                 
//	 
                
                if ($cjns=='UNIT')
				{   
    				$csql1="select * from(
                                SELECT a.kd_urusan1 AS urusan,'' [urusan_asli], '' [skpd],'' [program], a.nm_urusan1 AS nama,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm FROM $n_trdrka b 
                                INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1 
                                UNION all
                                SELECT left(b.kd_skpd,4) AS urusan,'' [urusan_asli],'' [skpd],'' [program], a.nm_urusan AS nama,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4)) AS bpeg
                                ,(SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4))AS bbj,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4)) AS bm FROM 
                                $n_trdrka b INNER JOIN ms_urusan a ON left(b.kd_skpd,4)=a.kd_urusan GROUP BY  left(b.kd_skpd,4) ,a.nm_urusan
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan,'' [urusan_asli],left(a.kd_skpd,7) [skpd],'' [program], b.nm_org AS nama,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bpeg,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bbj, 
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bm FROM $n_trdrka a 
                                INNER JOIN ms_organisasi b ON left(a.kd_skpd,7)=b.kd_org GROUP BY left(a.kd_skpd,4),left(a.kd_skpd,7),b.nm_org
                                ---------unit
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan,left(kd_kegiatan,4) [urusan_asli],a.kd_skpd [skpd],'' [program], b.nm_skpd AS nama,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)  ) AS bpeg,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bbj, 
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bm FROM $n_trdrka a 
                                INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY left(a.kd_skpd,4),left(kd_kegiatan,4),a.kd_skpd,a.kd_skpd,b.nm_skpd
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan, b.kd_urusan [urusan_asli],a.kd_skpd as kd_skpd,right(b.kd_program,2) AS program,b.nm_program AS nama,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm
                                FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_skpd,4),a.kd_skpd,b.kd_urusan,a.kd_skpd,right(b.kd_program,2),b.nm_program
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan, b.kd_urusan [urusan_asli], a.kd_skpd as kd_skpd,right(a.kd_kegiatan,5) AS program,b.nm_kegiatan AS nama,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bpeg,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bbj,
                                (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bm
                                FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_skpd,4),b.kd_urusan,a.kd_skpd,right(a.kd_kegiatan,5),b.nm_kegiatan
                            ) as a  ORDER BY urusan,skpd,program 

                            ";
                 }else{
                    $csql1 ="select * from(
                            SELECT a.kd_urusan1 AS urusan, '' [skpd],'' [program], a.nm_urusan1 AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm FROM $n_trdrka b 
                            INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1 
                            UNION all
                            SELECT a.kd_urusan AS urusan,'' [skpd],'' [program], a.nm_urusan AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bpeg
                            ,(SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_kegiatan,4)=a.kd_urusan)AS bbj,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bm FROM 
                            $n_trdrka b INNER JOIN ms_urusan a ON LEFT(b.kd_kegiatan,4)=a.kd_urusan GROUP BY  LEFT(b.kd_kegiatan,4),a.kd_urusan ,a.nm_urusan
                            union all
                            SELECT left(a.kd_kegiatan,4) AS urusan,left(a.kd_skpd,7) [skpd],'' [program], b.nm_org AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)  ) AS bpeg,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bbj, 
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bm FROM $n_trdrka a 
                            INNER JOIN ms_organisasi b ON left(a.kd_skpd,7)=b.kd_org GROUP BY left(a.kd_kegiatan,4),left(a.kd_skpd,7),b.nm_org 
                            union all 
                            SELECT left(a.kd_kegiatan,4) AS urusan, left(a.kd_skpd,7) as kd_skpd,right(b.kd_program,2) AS program,b.nm_program AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm
                            FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),left(a.kd_skpd,7),right(b.kd_program,2),b.nm_program
                            union all
                            SELECT left(a.kd_kegiatan,4) AS urusan, left(a.kd_skpd,7) as kd_skpd,right(b.kd_kegiatan,5) AS program,b.nm_kegiatan AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bpeg,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bbj,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bm
                            FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),left(a.kd_skpd,7),right(b.kd_kegiatan,5),b.nm_kegiatan
                            ) as a ORDER BY urusan,skpd,program ";

                 }  
                $query = $this->db->query($csql1);

                 //$query = $this->skpd_model->getAllc();
                $jum = 0;
                $tbpeg = 0;
                $tbtl = 0;
                $tbl = 0;
                $tjum = 0;                                  
                foreach ($query->result() as $row)
                {
                    
                    $uru = $row->urusan;
                    $sk = $row->skpd;
                    $pro = $row->program;                    
                    $nama=$row->nama;
                    $bpeg = $row->bpeg;
                    $bbj = $row->bbj;
                    $bm = $row->bm;
                    
                    if ($sk == ''){
                        $kode = $uru;
                    }else{
                        if($pro==''){
                            $kode = $sk;
                        }else{
                             if ($cjns=='UNIT'){  
                                $uru1 =  $row->urusan_asli;
                                $kode = $uru1.'.'.$sk.'.'.$pro;
                            }else{
                                $kode = $uru.'.'.$sk.'.'.$pro;
                            }
                        }
                    }
                    
                    $jum = $bpeg + $bbj + $bm;
                   
                    if (strlen($uru)<2){    
                        $tbpeg = $tbpeg + $bpeg;
                        $tbtl = $tbtl + $bbj;
                        $tbl = $tbl + $bm;
                        $tjum = $tjum + $jum;
                    }
                    
                    $pend=number_format($bpeg,"2",",",".");
                    $btl= number_format($bbj,"2",",",".");
                    $bl= number_format($bm,"2",",",".");
                    $jum= number_format($jum,"2",",",".");
                   
                    if(strlen($pro) <= 2 || $pro==''){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11;';  
                    }else{
 
                        $bold = '';
                        $font = 'font-size:12;';
                    }
                    
                    if ($jum != 0){
                    $cRet    .= " <tr><td style=\"vertical-align:top;$bold $font border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$kode</td>                                     
                     <td style=\"vertical-align:top;$bold font-size:12; border-top: solid 1px black;border-bottom: none;\" width=\"39%\">$nama</td>
                     <td style=\"vertical-align:top;$bold $font border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$pend</td>
                     <td style=\"vertical-align:top;$bold $font border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$btl</td>
                     <td style=\"vertical-align:top;$bold $font border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$bl</td>
                     <td style=\"vertical-align:top;$bold $font border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$jum</td></tr>
                             ";
                    }
                }

	                   
                    $tbpeg=number_format($tbpeg,"2",",",".");
                    $tbtl= number_format($tbtl,"2",",",".");
                    $tbl= number_format($tbl,"2",",",".");
                    $tjum= number_format($tjum,"2",",",".");

                     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\" colspan=\"2\">JUMLAH</td>                                     
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$tbpeg</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$tbtl</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$tbl</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$tjum</td></tr>
                                     ";
                
       
                
				  
			  
				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        
		
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        
          switch($cetak){   
        case 1;
		ini_set('memory_limit','5000M');
		set_time_limit(5000);
		 
		$this->_mpdf('',$cRet,10,10,10,0);
		break;
        case 0;
		//$this->template->load('template','anggaran/rka/perdaIV',$data);
		echo ("<title>Perda Lampiran IV $cjns</title>");
		echo ($cRet);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
         echo ($cRet);
        //$this->load->view('anggaran/rka/perdaIV', $data);
        break;
		case 3;
		echo ("<title>RKA 22</title>");
		echo ($cRet);
		break;
        }   
    }


   
   /*  function preview_perdaIVpdf(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    //$tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
         $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
		  
        $cRet='';
        
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"70%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran IV : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >REKAPITULASI BELANJA MENURUT URUSAN PEMERINTAHAN DAERAH, ORGANISASI</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">PROGRAM DAN KEGIATAN TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

        
		
		
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"15%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\"  width=\"39%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td colspan=\"4\"  width=\"56%\" align=\"center\"><b>BELANJA</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"14%\" align=\"center\"><b>PEGAWAI</b></td>
                             <td width=\"14%\" align=\"center\"><b>BARANG DAN JASA</b></td>
                            <td width=\"14%\" align=\"center\"><b>MODAL</b></td>
                            <td width=\"14%\" align=\"center\"><b>JUMLAH BELANJA</b></td>
                        </tr>
						<tr><td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\" align=\"center\">6</td></tr>						
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"><i>Lampiran IV : Perda Prov. Kalimantan Barat - Rekapitulasi Anggaran Belanja Berdasarkan Program dan Kegiatan TA $thn</i></td>

                         </tr>
                     </tfoot>
                    
                      
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522')AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523') AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52') AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah FROM trdrka b 
                        INNER JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_program,c.nm_program,a.kd_skpd
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah
                        FROM trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        LEFT JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_kegiatan,c.nm_kegiatan,a.kd_skpd
                        ) a ORDER BY a.kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend=number_format($row->bpeg,"2",".",",");
                    $btl= number_format($row->bbj,"2",".",",");
                    $bl= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"39%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$jum</td></tr>
                                     ";
                
        
                  }  
				  
				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        $this->_mpdf('',$cRet,10,10,10,0);
		
        //$this->template->load('template','anggaran/rka/perdaIV',$data);
        
                
    }
     */
    function preview_perdaV(){
		$cjns = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sql_trhrka="SELECT status_rancang, tgl_dpa_rancang FROM trhrka where kd_skpd='1.01.01.01'";
        $sql_trhrka=$this->db->query($sql_trhrka);
        foreach ($sql_trhrka->result() as $rowsc){                  
            $tgl_rancang= strtotime($rowsc->tgl_dpa_rancang);
        }
            
        if($tgl>$tgl_rancang){
            $rancang = '';
            $n_trdrka = 'trdrka';
        }else{
            $rancang = 'Rancangan';
            $n_trdrka  =   'trdrka_rancang';
        }
  
        
         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';					
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
          
		
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
        
        $cRet='';
         		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran V : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				   
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"5%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"95%\" align=\"center\" style=\"font-size:16px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform: uppercase;\" >$rancang REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" >TAHUN ANGGARAN $thn</td>
                    </tr>
                  </table>"; 
		
        
        $cRet .= "<table style=\"border-collapse:collapse;font-family:arial;font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"3\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"8%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td colspan=\"2\" width=\"24%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" width=\"36%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>JUMLAH</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"12%\" align=\"center\"><b>PEGAWAI</b></td>
                             <td width=\"12%\" align=\"center\"><b>LAINNYA</b></td>
                             <td width=\"12%\" align=\"center\"><b>PEGAWAI</b></td>
                             <td width=\"12%\" align=\"center\"><b>BARANG DAN JASA</b></td>
                             <td width=\"12%\" align=\"center\"><b>MODAL</b></td>
                        </tr>  

                     
                        <tr><td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">6</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">7</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">8=3+4+5+6+7</td></tr>						
                     </thead>
                     <tfoot>
                        <tr>
							<td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"8\"><i>Lampiran V : Perda Prov. Kalimantan Barat - Rekapitulasi Penyusunan Anggaran Belanja Daerah Untuk Keselarasan dan Keterpaduan Urusan Pemerintahan Daerah TA $thn</i></td>
                         </tr>
                     </tfoot>
                    
                        ";
			
			if ($cjns=='UNIT')
			{
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                       (SELECT SUM(a.nilai) FROM $n_trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='511' AND b.kd_fungsi=c.kd_fungsi) AS bbtl,
                       (SELECT SUM(a.nilai) FROM $n_trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE (LEFT(a.kd_rek5,3)='512' OR LEFT(a.kd_rek5,3)='513'
                        OR LEFT(a.kd_rek5,3)='514' OR LEFT(a.kd_rek5,3)='515' OR LEFT(a.kd_rek5,3)='516' OR LEFT(a.kd_rek5,3)='517' OR LEFT(a.kd_rek5,3)='518') AND b.kd_fungsi=c.kd_fungsi) AS bppkd,
                       (SELECT SUM(a.nilai) FROM $n_trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='521' AND b.kd_fungsi=c.kd_fungsi) AS bpeg,
                       (SELECT SUM(a.nilai) FROM $n_trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='522' AND b.kd_fungsi=c.kd_fungsi) AS bbj, 
                       (SELECT SUM(a.nilai) FROM $n_trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='523' AND b.kd_fungsi=c.kd_fungsi) AS bm,
                       (SELECT SUM(a.nilai) FROM $n_trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah FROM $n_trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,C.kd_fungsi
                       UNION
                       SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                       (SELECT SUM(nilai) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
                       (SELECT SUM(nilai) FROM $n_trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
                       (SELECT SUM(nilai) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                       (SELECT SUM(nilai) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                       (SELECT SUM(nilai) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                       (SELECT SUM(nilai) FROM $n_trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM $n_trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                       ) a ORDER BY kode1,a.kode2,skpd";
            }
			else
			{
                if ($cjns=='FUNGSI'){

                    $sql1="select * from(
                                select kd_fungsi [kode],nm_fungsi [nama],sum(isnull(bbtl,0)) [bbtl],sum(isnull(bppkd,0)) [bppkd],sum(isnull(bpeg,0)) [bpeg],sum(isnull(bbj,0)) [bbj],sum(isnull(bm,0)) [bm] from(
                                    select distinct c.kd_fungsi,c.nm_fungsi,a.no_trdrka,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  bbtl,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,2)='51' and LEFT(kd_rek5,3)<>'511' and d.no_trdrka=a.no_trdrka ) bppkd,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka) bpeg,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) bbj,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) bm
                                    from (
                                			select case
                                			when left(kd_kegiatan,4) = '1.24'
                                				then '1.24.01.01'
                                				else kd_skpd
                                			end as kd_skpd,no_trdrka,kd_kegiatan from $n_trdrka
                                	) as a                                  
                                    join ms_skpd b on a.kd_skpd=b.kd_skpd 
                                    join ms_fungsi c on b.kd_fungsi=c.kd_fungsi
                                ) e group by kd_fungsi,nm_fungsi
                            union all
                                select rtrim(kd_fungsi)+'.'+kd_urusan [kode],nm_urusan [nama],sum(isnull(bbtl,0)) [bbtl],sum(isnull(bppkd,0)) [bppkd],sum(isnull(bpeg,0)) [bpeg],sum(isnull(bbj,0)) [bbj],sum(isnull(bm,0)) [bm] from(
                                    select distinct b.kd_fungsi,c.kd_urusan,c.nm_urusan,a.no_trdrka,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  bbtl,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,2)='51' and LEFT(kd_rek5,3)<>'511' and d.no_trdrka=a.no_trdrka ) bppkd,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka) bpeg,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) bbj,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) bm
                                    from (
                                			select case
                                			when left(kd_kegiatan,4) = '1.24'
                                				then '1.24.01.01'
                                				else kd_skpd
                                			end as kd_skpd,no_trdrka,kd_kegiatan from $n_trdrka
                                	) as a                                  
                                    join ms_skpd b on a.kd_skpd=b.kd_skpd 
                                    join ms_urusan c on c.kd_urusan=LEFT(a.kd_kegiatan,4) 
                                ) e group by kd_fungsi,kd_urusan,nm_urusan 
                            ) z order by kode
                        ";
                }else{
                    $sql1="select * from(
                                select kd_fungsi [kode],nm_fungsi [nama],sum(isnull(bbtl,0)) [bbtl],sum(isnull(bppkd,0)) [bppkd],sum(isnull(bpeg,0)) [bpeg],sum(isnull(bbj,0)) [bbj],sum(isnull(bm,0)) [bm] from(
                                    select distinct c.kd_fungsi,c.nm_fungsi,a.no_trdrka,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  bbtl,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,2)='51' and LEFT(kd_rek5,3)<>'511' and d.no_trdrka=a.no_trdrka ) bppkd,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka) bpeg,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) bbj,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) bm
                                    from $n_trdrka a 
                                    join ms_skpd b on a.kd_skpd=b.kd_skpd 
                                    join ms_fungsi c on b.kd_fungsi=c.kd_fungsi
                                ) e group by kd_fungsi,nm_fungsi
                            union all
                                select rtrim(kd_fungsi)+'.'+kd_urusan [kode],nm_urusan [nama],sum(isnull(bbtl,0)) [bbtl],sum(isnull(bppkd,0)) [bppkd],sum(isnull(bpeg,0)) [bpeg],sum(isnull(bbj,0)) [bbj],sum(isnull(bm,0)) [bm] from(
                                    select distinct b.kd_fungsi,c.kd_urusan,c.nm_urusan,a.no_trdrka,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  bbtl,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,2)='51' and LEFT(kd_rek5,3)<>'511' and d.no_trdrka=a.no_trdrka ) bppkd,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka) bpeg,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) bbj,
                                    (select sum(nilai) from $n_trdrka d where LEFT(kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) bm
                                    from $n_trdrka a 
                                    join ms_skpd b on a.kd_skpd=b.kd_skpd 
                                    join ms_urusan c on c.kd_urusan=LEFT(a.kd_kegiatan,4) 
                                ) e group by kd_fungsi,kd_urusan,nm_urusan 
                            ) z order by kode

                        ";
			     }
            }
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
				
                $tbbtl=0;
                $tbppkd= 0;
                $tbpeg= 0;
                $tbbj= 0;
                $tbm= 0;
                $tjum = 0;	
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $bbtl=$row->bbtl;
                    $bppkd= $row->bppkd;
                    $bpeg= $row->bpeg;
                    $bbj= $row->bbj;
                    $bm= $row->bm;
                    $jumlah = $bbtl + $bppkd + $bpeg + $bbj + $bm;

                    if (strlen($kode)==2){
                        $tbbtl=$tbbtl + $bbtl;
                        $tbppkd= $tbppkd + $bppkd;
                        $tbpeg= $tbpeg + $bpeg;
                        $tbbj= $tbbj + $bbj;
                        $tbm= $tbm + $bm;
                        $tjum = $tjum + $jumlah;	
                        
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11;';

                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none; $bold \" width=\"8%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"20%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">&nbsp;</td></tr>
                                     ";

                    }else{
                        $bold = '';
                        $font = '';
                    }
                    
                    $bbtl=number_format($bbtl,"2",",",".");
                    $bppkd= number_format($bppkd,"2",",",".");
                    $bpeg= number_format($bpeg,"2",",",".");
                    $bbj= number_format($bbj,"2",",",".");
                    $bm= number_format($bm,"2",",",".");
                    $jum= number_format($jumlah,"2",",",".");
                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none; $bold \" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
		
                  }  
				  
//                 $sql1="select sum(bbtl)bbtl,sum(bppkd)bppkd,sum(bpeg)bpeg,sum(bbj)bbj,sum(bm)bm,sum(jumlah)jumlah from
//(  SELECT a.kd_skpd AS kode, a.nm_skpd AS nama,a.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
//                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
//                       (SELECT SUM(nilai) FROM trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
//                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
//                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
//                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
//                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
//                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM ms_skpd a ) z";
//                 
//                 $query = $this->db->query($sql1);
//                 //$query = $this->skpd_model->getAllc();
//					
//                foreach ($query->result() as $row)
//                {
//                    $bbtl=number_format($row->bbtl,"2",",",".");
//                    $bppkd= number_format($row->bppkd,"2",",",".");
//                    $bpeg= number_format($row->bpeg,"2",",",".");
//                    $bbj= number_format($row->bbj,"2",",",".");
//                    $bm= number_format($row->bm,"2",",",".");
//                    $jum= number_format($row->jumlah,"2",",",".");
//					
                    $bbtl=number_format($tbbtl,"2",",",".");
                    $bppkd= number_format($tbppkd,"2",",",".");
                    $bpeg= number_format($tbpeg,"2",",",".");
                    $bbj= number_format($tbbj,"2",",",".");
                    $bm= number_format($tbm,"2",",",".");
                    $jum= number_format($tjum,"2",",",".");
					

                     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"right\" colspan=\"2\">JUMLAH</td>                                     
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"font-weight:bold;font-size:11;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
		
//                  }				  
//				  
				     $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"8\">
								<table width=\"100%\" border=\"0\" align=\"center\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table>
								</td>
                             </tr>";

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        
        //$this->load->view('anggaran/rka/perdaV', $data);
          switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        //$this->template->load('template','anggaran/rka/perdaV',$data);
		echo ("<title>Perda Lampiran V</title>");
		echo ($cRet);        
		break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perdaV', $data);
        break;
        }        
    }

 
	 
   function preview_ringkasbelanja(){
         $cetak = $this->uri->segment(3);
         $ttd1= $_REQUEST['ttd1'];
               
            
	       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    if ($ttd1<>''){
                        $kab     = $rowsc->kab_kota;
                        $daerah  = $rowsc->daerah;
                    }
                    else{
                        $kab     = '';
                        $daerah  = '';                        
                    }
                    $thn     = $rowsc->thn_ang;
                }
				
	   if ($ttd1<>''){			
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    
                    $nipt='Nip.'.$rowttd->nip;
                    $pangkatt=$rowttd->pangkat;
                    $namat= $rowttd->nm;
                    $jabatant  = $rowttd->jab;
                }
        } 
        else{
                    $nipt='';
                    $pangkatt='';
                    $namat= '';
                    $jabatant  = '';            
        }                 
        $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
                    </tr>
                    <tr>
                    </tr>                    
                    <tr>
                    </tr>														
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >RINGKASAN BELANJA PER FUNGSI, URUSAN, ORGANISASI DAN JENIS</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"5%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" width=\"18%\" align=\"center\"><b>URAIAN</b></td>
                            <td colspan=\"8\" width=\"56%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" width=\"21%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"7%\" align=\"center\"><b>PEGAWAI</b></td>
                            <td width=\"7%\" align=\"center\"><b>BUNGA</b></td>
                            <td width=\"7%\" align=\"center\"><b>SUBSIDI</b></td>
                            <td width=\"7%\" align=\"center\"><b>HIBAH</b></td>
                            <td width=\"7%\" align=\"center\"><b>BANTUAN SOSIAL</b></td>
                            <td width=\"7%\" align=\"center\"><b>BAGI HASIL PAJAK</b></td>
                            <td width=\"7%\" align=\"center\"><b>BANTUAN KEUANGAN</b></td>
                            <td width=\"7%\" align=\"center\"><b>TIDAK TERDUGA</b></td>
                            <td width=\"7%\" align=\"center\"><b>PEGAWAI</b></td>
                            <td width=\"7%\" align=\"center\"><b>BARANG & JASA</b></td>
                            <td width=\"7%\" align=\"center\"><b>MODAL</b></td>
                        </tr>                            
                     </thead>
                        ";
        //rumus cetak skpd
                $sql1="select * from(
                        select kd_fungsi [urut],kd_fungsi [kode],nm_fungsi [nama],sum(isnull(spegawaibtl,0)) spegawaibtl,sum(isnull(shibah,0)) shibah,sum(isnull(sbsosial,0)) [sbsosial],
                        sum(isnull(sbhasilpajak,0)) [sbhasilpajak],sum(isnull(sbkeu,0)) [sbkeu],sum(isnull(sterduga,0)) [sterduga],sum(isnull(spegawaibl,0)) [spegawaibl]
                        ,sum(isnull(sls,0)) [sls],sum(isnull(smodal,0)) [smodal]
                         from(
                            select distinct c.kd_fungsi,c.nm_fungsi,a.no_trdrka,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  spegawaibtl,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='514' and d.no_trdrka=a.no_trdrka ) shibah,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='515' and d.no_trdrka=a.no_trdrka) sbsosial,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='516' and d.no_trdrka=a.no_trdrka ) sbhasilpajak,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='517' and d.no_trdrka=a.no_trdrka ) sbkeu,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='518' and d.no_trdrka=a.no_trdrka ) sterduga,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka ) spegawaibl,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) sls,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) smodal
                            from (
                        			select case
                        			when left(kd_kegiatan,4) = '1.24'
                        				then '1.24.01.01'
                        				else kd_skpd
                        			end as kd_skpd,no_trdrka,kd_kegiatan from trdrka
                        	) as a 
                            join ms_skpd b on a.kd_skpd=b.kd_skpd 
                            join ms_fungsi c on b.kd_fungsi=c.kd_fungsi
                        ) e group by kd_fungsi,nm_fungsi
                        union all
                        select rtrim(kd_fungsi)+'.'+kd_urusan [urut],rtrim(kd_fungsi)+'.'+kd_urusan [kode],nm_urusan [nama],sum(isnull(spegawaibtl,0)) spegawaibtl,sum(isnull(shibah,0)) shibah,sum(isnull(sbsosial,0)) [sbsosial],
                        sum(isnull(sbhasilpajak,0)) [sbhasilpajak],sum(isnull(sbkeu,0)) [sbkeu],sum(isnull(sterduga,0)) [sterduga],sum(isnull(spegawaibl,0)) [spegawaibl]
                        ,sum(isnull(sls,0)) [sls],sum(isnull(smodal,0)) [smodal]
                         from(
                            select distinct b.kd_fungsi,c.kd_urusan,c.nm_urusan,a.no_trdrka,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  spegawaibtl,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='514' and d.no_trdrka=a.no_trdrka ) shibah,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='515' and d.no_trdrka=a.no_trdrka) sbsosial,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='516' and d.no_trdrka=a.no_trdrka ) sbhasilpajak,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='517' and d.no_trdrka=a.no_trdrka ) sbkeu,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='518' and d.no_trdrka=a.no_trdrka ) sterduga,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka ) spegawaibl,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) sls,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) smodal
                            from (
                        			select case
                        			when left(kd_kegiatan,4) = '1.24'
                        				then '1.24.01.01'
                        				else kd_skpd
                        			end as kd_skpd,no_trdrka,kd_kegiatan from trdrka
                        	) as a 
                            join ms_skpd b on a.kd_skpd=b.kd_skpd 
                            join ms_urusan c on c.kd_urusan=LEFT(a.kd_kegiatan,4) 
                        ) e group by kd_fungsi,kd_urusan,nm_urusan 
                        union all
                        select rtrim(kd_fungsi)+'.'+kd_urusan+'.'+kd_urusan+'.'+right(kd_org,2) [urut],kd_urusan+'.'+kd_urusan+'.'+right(kd_org,2) 
                        [kode],nm_org [nama],sum(isnull(spegawaibtl,0)) spegawaibtl,sum(isnull(shibah,0)) shibah,sum(isnull(sbsosial,0)) 
                        [sbsosial],sum(isnull(sbhasilpajak,0)) [sbhasilpajak],sum(isnull(sbkeu,0)) [sbkeu],sum(isnull(sterduga,0)) [sterduga],sum(isnull(spegawaibl,0)) [spegawaibl]
                        ,sum(isnull(sls,0)) [sls],sum(isnull(smodal,0)) [smodal]
                         from(
                            select distinct b.kd_fungsi,c.kd_urusan,f.kd_org,f.nm_org,a.no_trdrka,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='511' and d.no_trdrka=a.no_trdrka )  spegawaibtl,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='514' and d.no_trdrka=a.no_trdrka ) shibah,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='515' and d.no_trdrka=a.no_trdrka) sbsosial,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='516' and d.no_trdrka=a.no_trdrka ) sbhasilpajak,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='517' and d.no_trdrka=a.no_trdrka ) sbkeu,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='518' and d.no_trdrka=a.no_trdrka ) sterduga,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='521' and d.no_trdrka=a.no_trdrka ) spegawaibl,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='522' and d.no_trdrka=a.no_trdrka ) sls,
                            (select sum(nilai) from trdrka d where LEFT(d.kd_rek5,3)='523' and d.no_trdrka=a.no_trdrka ) smodal
                            from (
                        			select case
                        			when left(kd_kegiatan,4) = '1.24'
                        				then '1.24.01.01'
                        				else kd_skpd
                        			end as kd_skpd,no_trdrka,kd_kegiatan from trdrka
                        	) as a 
                            join ms_skpd b on a.kd_skpd= b.kd_skpd 
                            join ms_urusan c on c.kd_urusan=LEFT(a.kd_kegiatan,4) 
                        	join ms_organisasi f on left(b.kd_skpd,7)=f.kd_org
                        ) e group by kd_fungsi,kd_urusan,kd_org,nm_org
                        ) z order by urut";
                         
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                
                $tpegawaibtl = 0;
                $tbunga = 0;
                $tsubsidi = 0;
                $thibah = 0;
                $tbsosial = 0;
                $tbhasilpajak = 0;
                $tbkeu = 0;
                $tterduga = 0;
                $tpegawaibl = 0;
                $tls = 0;
                $tmodal = 0;
                                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pegawaibtl=number_format($row->spegawaibtl,"2",",",".");
                    $bunga= number_format(0,"2",",",".");
                    $subsidi= number_format(0,"2",",",".");
                    $hibah= number_format($row->shibah,"2",",",".");
                    $bsosial= number_format($row->sbsosial,"2",",",".");
                    $bhasilpajak= number_format($row->sbhasilpajak,"2",",",".");
                    $bkeu= number_format($row->sbkeu,"2",".",",");             
                    $terduga= number_format($row->sterduga,"2",",",".");
                    $pegawaibl= number_format($row->spegawaibl,"2",",",".");
                    $ls= number_format($row->sls,"2",",",".");
                    $modal= number_format($row->smodal,"2",",",".");
                    
               
				   if (strlen($kode)>4) 

				   {
				                             
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top:solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$pegawaibtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$bunga</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$subsidi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$hibah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$bsosial</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$bhasilpajak</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$bkeu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$terduga</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$pegawaibl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$ls</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\">$modal</td>
                                     ";
				    } else {
					       
                            $tpegawaibtl = $tpegawaibtl + $row->spegawaibtl;
                            $tbunga= 0 ;
                            $tsubsidi= 0 ;
                            $thibah=  $thibah + $row->shibah;
                            $tbsosial= $tbsosial + $row->sbsosial;
                            $tbhasilpajak= $tbhasilpajak + $row->sbhasilpajak;
                            $tbkeu= $tbkeu + $row->sbkeu;             
                            $tterduga= $tterduga + $row->sterduga;
                            $tpegawaibl= $tpegawaibl + $row->spegawaibl;
                            $tls= $tls + $row->sls;
                            $tmodal= $tmodal + $row->smodal;

									  $cRet    .= " <tr>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>&nbsp;</b></td>                                     
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b> &nbsp;</b></td>
                                                    </tr>";

									 $cRet    .= "  <tr>
                                                        <td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>$kode</b></td>                                     
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"18%\"><b>$nama</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$pegawaibtl</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$bunga</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$subsidi</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$hibah</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$bsosial</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$bhasilpajak</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$bkeu</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$terduga</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$pegawaibl</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$ls</b></td>
                                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"7%\" align=\"right\"><b>$modal</b></td>
                                                    </tr>";
				    }

                  }
                  
                  /*$sqljml="select distinct '' [kode],'Jumlah' [nama],(SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='4') AS pendapatan ,
                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='51') AS btl, 
                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,2)='52') AS bl, 
                            (SELECT isnull(SUM(nilai),0) FROM trdrka WHERE LEFT(kd_rek5,1)='5') AS jumlah FROM trdrka b";
                            
                  $sqlp=$this->db->query($sqljml);
                  foreach ($sqlp->result() as $rowp)
                  {
                    $kode='';
                    $nama='Jumlah';
                    $pend=number_format($rowp->pendapatan,"2",".",",");
                    $btl= number_format($rowp->btl,"2",".",",");
                    $bl= number_format($rowp->bl,"2",".",",");
                    $jum= number_format($rowp->jumlah,"2",".",",");
                    $nsurplus = number_format(($rowp->pendapatan - ($rowp->btl+$rowp->bl)),"2",".",",");
                                       
                    $cRet    .= "  <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" width=\"10%\" align=\"left\">$nama</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$jum</td></tr>";

                    $cRet    .= "  <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" width=\"10%\" align=\"left\">Surplus / (Defisit)</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"4\" width=\"13%\" align=\"right\">$nsurplus</td></tr>";

                                     
                    } */
  

                    $vtpegawaibtl=number_format($tpegawaibtl,"2",",",".");
                    $vtbunga= number_format(0,"2",",",".");
                    $vtsubsidi= number_format(0,"2",",",".");
                    $vthibah= number_format($thibah,"2",",",".");
                    $vtbsosial= number_format($tbsosial,"2",",",".");
                    $vtbhasilpajak= number_format($tbhasilpajak,"2",",",".");
                    $vtbkeu= number_format($tbkeu,"2",",",".");             
                    $vtterduga= number_format($tterduga,"2",",",".");
                    $vtpegawaibl= number_format($tpegawaibl,"2",",",".");
                    $vtls= number_format($tls,"2",",",".");
                    $vtmodal= number_format($tmodal,"2",",",".");


                                       
                    $cRet    .= "  <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" width=\"10%\" align=\"left\">Jumlah</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtpegawaibtl</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtbunga</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtsubsidi</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vthibah</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtbsosial</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtbhasilpajak</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtbkeu</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtterduga</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtpegawaibl</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtls</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"13%\" align=\"right\">$vtmodal</td>
                                    </tr>
                                
                                ";

                                     

				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"13\">
								    <table style=\"width: 100%;\" border=\"0\" align=\"center\">
								    <tr>
								        <td style=\"width: 70%;\" align=\"left\" >&nbsp;</td>
								        <td style=\"width: 30%;\" align=\"center\" >$daerah ,$tanggal					
								        <br>$jabatant,
                                        <p>&nbsp;</p>
								        <br>
								        <br>
                				        <br><u><b>$namat</b></u>
								        <br>$pangkatt
                                        <br>$nipt
                                        </td></tr></table></td>
                             </tr>";

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK RINGKASAN BELANJA');        
        //$this->_mpdf('',$cRet,10,10,10,0);
       
	switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,10);
        break;
        case 0;
            echo ("<title>Ringkasan Belanja Per Fungsi, Urusan, Organisasi dan Jenis</title>");
            echo($cRet);
            break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/ctk_ringkasbelanja', $data);
        break;
        }
		
    }
      

 
    function preview_perdaVpdf(){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';					
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
          
		
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
        
        $cRet='';
         $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"80%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran V : </td>
                         <td  width=\"20%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"5%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"95%\" align=\"center\" style=\"font-size:16px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >
						 REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" >TAHUN ANGGARAN $thn</td>
                    </tr>
                  </table>"; 
		
        
        $cRet .= "<table style=\"border-collapse:collapse;font-family:arial;font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"8%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td colspan=\"2\" width=\"24%\" align=\"center\"><b>BELANJA TIDAK LANGSUNG</b></td>
                            <td colspan=\"3\" width=\"36%\" align=\"center\"><b>BELANJA LANGSUNG</b></td>
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>JUMLAH</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"12%\" align=\"center\"><b>PEGAWAI</b></td>
                             <td width=\"12%\" align=\"center\"><b>LAINNYA</b></td>
                             <td width=\"12%\" align=\"center\"><b>PEGAWAI</b></td>
                             <td width=\"12%\" align=\"center\"><b>BARANG DAN JASA</b></td>
                             <td width=\"12%\" align=\"center\"><b>MODAL</b></td>
                        </tr>  

                     
                        <tr><td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">6</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">7</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">8</td></tr>						
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"8\"><i>Lampiran V : Perda Prov. Kalimantan Barat - Ringkasan Penyusunan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn</i></td>
                         </tr>
                     </tfoot>
                    
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='511' AND b.kd_fungsi=c.kd_fungsi) AS bbtl,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE (LEFT(a.kd_rek5,3)='512' OR LEFT(a.kd_rek5,3)='513'
                        OR LEFT(a.kd_rek5,3)='514' OR LEFT(a.kd_rek5,3)='515' OR LEFT(a.kd_rek5,3)='516' OR LEFT(a.kd_rek5,3)='517' OR LEFT(a.kd_rek5,3)='518') AND b.kd_fungsi=c.kd_fungsi) AS bppkd,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='521' AND b.kd_fungsi=c.kd_fungsi) AS bpeg,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='522' AND b.kd_fungsi=c.kd_fungsi) AS bbj, 
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,3)='523' AND b.kd_fungsi=c.kd_fungsi) AS bm,
                       (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,C.kd_fungsi
                       UNION
                       SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd=a.kd_skpd) AS bbtl,
                       (SELECT SUM(nilai) FROM trdrka WHERE (LEFT(kd_rek5,3)='512' OR LEFT(kd_rek5,3)='513' OR LEFT(kd_rek5,3)='514' OR LEFT(kd_rek5,3)='515'
                       OR LEFT(kd_rek5,3)='516' OR LEFT(kd_rek5,3)='517' OR LEFT(kd_rek5,3)='518') AND kd_skpd=a.kd_skpd) AS bppkd,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                       (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah FROM trdrka a 
                       INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                       ) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $bbtl=number_format($row->bbtl,"2",".",",");
                    $bppkd= number_format($row->bppkd,"2",".",",");
                    $bpeg= number_format($row->bpeg,"2",".",",");
                    $bbj= number_format($row->bbj,"2",".",",");
                    $bm= number_format($row->bm,"2",".",",");
                    $jum= number_format($row->jumlah,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bppkd</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bpeg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bbj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jum</td></tr>
                                     ";
		
                  }  
				  
				  
				  
				     $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"8\">
								<table width=\"100%\" border=\"0\" align=\"center\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table>
								</td>
                             </tr>";

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        $this->_mpdf('',$cRet,10,10,10,0);
                echo $cRet;

		//$this->template->load('template','anggaran/rka/perdaV',$data);
        
                
    }
	
	  function preview_pergub1(){
       //$id = $this->uri->segment(3);
      $cetak = $this->uri->segment(3);
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
        
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1' and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $cRet='';
        
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"65%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"25%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >RINGKASAN PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead >                       
                        <tr><td  width=\"15%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"65%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     
                     
                        <tr><td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;\" width=\"70%\"  align=\"center\">2</td>
                            <td style=\"font-weight:bold;\" width=\"20%\"  align=\"center\">3</td></tr>
					</thead>
					<tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\"><i>Lampiran I : PerGub Prov.Kalimantan Barat - Ringkasan Penjabaran Penyusunan APBD TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   if (strlen($coba1)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   } else {
					     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   }			 
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba4</td></tr>";

                 }     
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   if (strlen($coba5)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
				   } else {
					     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
				   }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
				 
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">SURPLUS(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
					                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                    $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   if (strlen($coba9)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
				   } else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
				   }
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
									 
                $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   if (strlen($coba9)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
				   } else {
					                      $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";  
				   }
                }
				                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">PEMBIAYAAN NETTO</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
					 $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";

									 
                     $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"3\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
							 
        $cRet    .= "</table>";
        $data['prev']= $cRet;
		
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
       // $this->template->load('template','anggaran/rka/perda1',$data);
                switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/pergub1',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/pergub1', $data);
        break;
        }
                
    }
	
//ctk perdaunit_III
    function preview_perdaunit_III(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);         
        $tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sql_trhrka="SELECT status_rancang, tgl_dpa_rancang FROM trhrka where kd_skpd='1.01.01.01'";
        $sql_trhrka=$this->db->query($sql_trhrka);
        foreach ($sql_trhrka->result() as $rowsc){                  
            $tgl_rancang= strtotime($rowsc->tgl_dpa_rancang);
        }
            
        if($tgl>$tgl_rancang){
            $rancang = '';
            $n_trdrka = 'trdrka';
        }else{
            $rancang = 'Rancangan';
            $n_trdrka  =   'trdrka_rancang';
        }
            
            
   
         $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org 
                    FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join 
                    ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
                    WHERE kd_org=left('$id',7) and a.kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                   // $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				  
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
        
				 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran III : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform: uppercase;\" >RINCIAN $rancang APBD MENURUT URUSAN PEMERINTAH DAERAH, <br> ORGANISASI, PENDAPATAN, BELANJA DAN PEMBIAYAAN</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";      

				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
    					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:solid 1px black;border-bottom: none;border-left: none;border-right:none; \" >:</td>
                        <td  width=\"78%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >$kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>

					<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:none;border-bottom: none;border-left: none;border-right:none; \" >:</td>
                         <td  width=\"78%\" align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >$kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Unit Organisasi </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:none;border-left: none;border-right:none;border-bottom: none; \" >:</td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >$kd_org - $nm_org</td>
                    </tr>
					<tr>
						<td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Sub Unit Organisasi </td>
                        <td  align=\"left\" valign=\"top\" style=\"border-top:none;border-left: none;border-right:none; \" >:</td>
                        <td  align=\"left\" style=\"border-top: none;border-left: none; \" >$kd_skpd - $nm_skpd</td>
                    </tr>

					</table>"; 
				  
				        
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr><td width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"45%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"30%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
 
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"45%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"30%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" width=\"15%\" align=\"center\">4</td>
                        </tr>
 
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"4\"><i>Lampiran III : Perda Prov. Kalimantan Barat - Rincian  Penyusunan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                        ";
                
				 
                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from $n_trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                    	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                    		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                    			(select kd_kegiatan,nm_hukum from d_hukum a 
                    			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                    			) Z FOR XML path(''), elements)
                    		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                        union all                        
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek4 [kd_rek1],c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek4,c.nm_rek4 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 [kd_rek1],a.nm_rek5 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,a.nm_rek5                       
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                 $query = $this->db->query($sql1);
                 $num_query = $query->num_rows();  
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;                                  
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    $coba3= number_format($nilai,"2",",",".");
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                    }
                    
                    if (strlen($rek1)<3){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" >$hukum</td></tr>";
                }
                
                 
                if($num_query> 0){
                   $coba4=number_format($totp,"2",",",".");

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;text-transform: uppercase;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:11px;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 $sqltb="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from $n_trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and a.kd_skpd='$id'
                    	group by b.kd_urusan,LEFT(a.kd_skpd,7),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                    		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                    			(select kd_kegiatan,nm_hukum from d_hukum a 
                    			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                    			) Z FOR XML path(''), elements)
                    		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                        
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                 $totbl = 0;      
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    $jmlb=number_format($nilai,"2",",",".");
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                    }
                    
                    if (strlen($rek1)<3){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                 }    
                 
                 
                 $sqlbl = "select b.nm_rek2,isnull(sum(nilai),0) [nilai] from $n_trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where kd_skpd='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 if($querybl->num_rows()>0){            
                     foreach ($querybl->result() as $rowbl){
                        $nm = $rowbl->nm_rek2;
                        $nilai =number_format($rowbl->nilai,"2",",",".");
    
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:11px;\" width=\"15%\" align=\"right\">$nilai</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"></td></tr>";
                     }
                 }
                 
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],a.kd_skpd [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],a.kd_skpd [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],a.kd_skpd [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],
                            isnull(NM_HUKUM,'') [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3,NM_HUKUM 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                 
                 $query1 = $this->db->query($sql2);
                 $num_query1 = $query1->num_rows();
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;

                    $nilai= number_format($nilai,"2",",",".");
                    
                    if ($rek1=='' || strlen($rek1)==2){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $font = '';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                }
                if($num_query1>1){
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                            </tr>";

                
                    $jumbl=number_format($totbl,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";

  		        }

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";

        /*		 
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,'' AS nm_hukum FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,'' AS nm_hukum FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          
                          SELECT  SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,nm_hukum FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 left join (
                           
 SELECT KD_KEGIATAN,NM_HUKUM=((SELECT '<br>- ' + nm_hukum FROM (select kd_kegiatan,nm_hukum from d_hukum 
 a inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan ) Z
 FOR XML path(''), elements)) FROM d_hukum C GROUP BY kd_kegiatan) X ON X.kd_kegiatan=A.KD_KEGIATAN
                          WHERE left(rtrim(a.kd_skpd),7)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3,nm_hukum
						  
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1=$row1bl->kd_rek;
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",",",".");
					//$bl4=$row1bl->nm_hukum;
					$bl4=str_replace('&lt;br&gt;','<br>',$row1bl->nm_hukum);
					       
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$bl4</td></tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",",",".");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and left(rtrim(a.kd_skpd),7)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }        
         */         

        
                     
                if ($id==$this->ppkd1){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,'' [hukum] from(
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai_terima], 
                            	(select sum(nilai) from $n_trdrka where right(kd_kegiatan,5)='00.62' and LEFT(a.kd_skpd,7)='1.20.12') [nilai_keluar]
                            	from $n_trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                            
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;                              
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $coba11= $this->rp_minus($nilai) ;

                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                        }
                        
                        if (strlen($rek1)<3){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td>
                                        </tr>";
                    }

                    $coba12=number_format($totpm,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH PENERIMAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;\" width=\"15%\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";



                    $sql4="select * from (
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],isnull(nm_hukum,'') [hukum]  from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                            
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        $coba15= $this->rp_minus($nilai) ;

                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                        }
                        
                        if (strlen($rek1)<3){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                    }
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";

                    $coba16=$this->rp_minus($totpk);                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px; \" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";

            }

                 
				if($id=='2.06.01.05'){ 
				 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"4\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
					}
            
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $data['kd_org']= $id;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
       
		  switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
       // echo $cRet;
		break;
        case 0;
			echo ("<title>Perda Lampiran III $id</title>");
			echo ($cRet);
			break;	
		case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perdaIII', $data);
        break;
        }
        
                
    }
    
	
//end preview perdaunit_III	





    function preview_perkada(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org FROM ms_skpd a 
INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
 WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				  $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        
        $cRet='';
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

   
 		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                         <td  width=\"80%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >: $kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>
                    <tr>
					<td align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                         <td  align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >: $kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
                    </tr>
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Sub Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none; \" >: $nm_skpd</td>
                    </tr>
                  </table>"; 
				  
					 
					 $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"15%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td width=\"15%\" align=\"center\"><b>PENJELASAN</b></td>
                        </tr>
                        <tr><td width=\"20%\" align=\"center\"><b>1</b></td>                            
                            <td width=\"50%\" align=\"center\"><b>2</b></td>
                            <td width=\"15%\" align=\"center\"><b>3</b></td>
                            <td width=\"15%\" align=\"center\"><b>4</b></td>
                        </tr>

                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"4\"><i>
							Lampiran II : PerGub Prov. Kalimantan Barat - Penjabaran Penyusunan APBD TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                      
                        ";

                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                    	group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],NM_HUKUM [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                 $query = $this->db->query($sql1);
                 $num_sql1 = $query->num_rows();
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;                                  
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    $coba3= number_format($nilai,"2",",",".");
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                    }
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" >$hukum</td></tr>";
                }
                   $coba4=number_format($totp,"2",",",".");
                    
                    if($num_sql1 > 0){
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;text-transform: uppercase;\" width=\"50%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:11px;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                    }
                 
                 $sqltb="select * from (
                        select left(a.kd_skpd,4) [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and a.kd_skpd='$id'
                    	group by left(a.kd_skpd,4),a.kd_skpd,c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],ISNULL(nm_hukum,'') [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5                        
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                 $totbl = 0;       
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    $jmlb=number_format($nilai,"2",",",".");
                    
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                    }

                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';
                    }else{
                        $bold = '';
                        $font = '';
                    }

 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                 }    
                 
                 $sqlbl = "select b.nm_rek2,isnull(sum(nilai),0) [nilai] from trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where a.kd_skpd='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 foreach ($querybl->result() as $rowbl){
                    $nm = $rowbl->nm_rek2;
  
                    $nilai =number_format($rowbl->nilai,"2",",",".");

                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:11px;\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\"></td></tr>";
                 }
                 
                 
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(b.kd_kegiatan1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],
                            ISNULL(nm_hukum,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(b.kd_kegiatan1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
                
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;
                    $nilai = number_format($nilai,"2",",",".");
                    
                    if ($rek1=='' ){
                       $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $font = '';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';                        
                    }else{
                        $bold = '';
                        $font = '';                        
                    }
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"20%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font\" width=\"15%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                }

                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                            </tr>";

                
                    $jumbl=number_format($totbl,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";   

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                    
                    $jumsur = $this->rp_minus(($totp-$totbl));

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">SURPLUS/(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px\" width=\"15%\" align=\"right\">$jumsur</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";   

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";

                    
                     
                if ($id==$this->ppkd1){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,'' [hukum] from(
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai_terima], 
                            	(select sum(nilai) from trdrka where right(kd_kegiatan,5)='00.62' and a.kd_skpd='$id') [nilai_keluar]
                            	from trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            	group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],ISNULL(NM_HUKUM,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;                              
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $coba11= $this->rp_minus($nilai) ;

                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td>
                                        </tr>";
                    }

                    $coba12=number_format($totpm,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"50%\">JUMLAH PENERIMAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px;\" width=\"15%\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";



                    $sql4="select * from (
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],ISNULL(NM_HUKUM,'') [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        $coba15= $this->rp_minus($nilai) ;

                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $font = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $font = '';
                        }
                       
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"20%\" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" width=\"50%\">$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" width=\"15%\" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">$hukum</td></tr>";
                    }
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";

                    $coba16=$this->rp_minus($totpk);                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" width=\"50%\">JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:11px; \" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";

            }



/*						
                 $sql1="SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE rtrim(a.kd_skpd)='$id' and left(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,2) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,2),b.nm_rek2
                        UNION ALL
                        SELECT  rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
						  UNION ALL
                        SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek4
						                      UNION ALL
                        SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek5 b 
                        ON LEFT(a.kd_rek5,7)=b.kd_rek5 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,1)='4' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek5
						                                          
                        ) a ORDER BY kd_giat,kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1_rek=$row->kd_rek;
					$coba1_giat=$row->kd_giat;
					$coba1=$coba1_giat.'.'.$this->dotrek($coba1_rek);
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
					if (strlen($coba1_rek)>5) {
				$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 0.5px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";

					} else {
                     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" ></td></tr>";

					}
                }
				
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka a WHERE LEFT(kd_rek5,1)='4' and rtrim(a.kd_skpd)='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENDAPATAN</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and rtrim(a.kd_skpd)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA DAERAH</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
				$sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,2)='51' and rtrim(a.kd_skpd)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA TIDAK LANGSUNG</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }  				 
				 
                $sql2="SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE rtrim(a.kd_skpd)='$id' and left(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='51' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                       UNION ALL
                       SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek4 b 
                       ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='51' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek4
		               UNION ALL
                       SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek5 b 
                       ON LEFT(a.kd_rek5,7)=b.kd_rek5 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='51' GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek5
                       ) a ORDER BY kd_giat,kd_rek
 ";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
					
                   // $coba5=$row1->kd_rek;
					$coba5_rek=$row1->kd_rek;
					$coba5_giat=$row1->kd_giat;
					$coba5=$coba5_giat.'.'.$this->dotrek($coba5_rek);
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   if (strlen($coba5_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
				   }else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba6</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
				   }
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka a WHERE LEFT(kd_rek5,2)='52' and rtrim(a.kd_skpd)='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl=number_format($rowbl->totbl,"2",".",",");
                    $cob=$rowbl->totbl;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">BELANJA LANGSUNG</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jumbl</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td></tr>";
                 }
				 
                 $sql2bl="  SELECT * FROM (SELECT rtrim(a.kd_program) AS kd_giat,'' AS kd_rek,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,'' AS lokasi FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE rtrim(a.kd_skpd)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,isnull(x.lokasi,'')lokasi FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan 
                          left join 
                          (select ('Lokasi : '+lokasi)lokasi,kd_kegiatan,kd_skpd from trskpd where right(rtrim(kd_program),2)>15 ) X ON X.kd_kegiatan=A.KD_KEGIATAN 
                          WHERE rtrim(a.kd_skpd)='$id' and right(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan,x.lokasi
                          UNION ALL 
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,'' AS lokasi FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 
                          WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                          UNION ALL 
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,'' AS lokasi FROM trdrka a INNER JOIN ms_rek4 b 
                          ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                          WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek4
                          UNION ALL 
                          SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,'' AS lokasi FROM trdrka a INNER JOIN ms_rek5 b 
                          ON LEFT(a.kd_rek5,7)=b.kd_rek5 
                          WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='52' 
                           GROUP BY rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek5
						  
                          ) a ORDER BY kd_giat,kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
					
                   // $bl1=$row1bl->kd_rek;
					$bl1_rek=$row1bl->kd_rek;
					$bl1_giat=$row1bl->kd_giat;
					$bl1=$bl1_giat.'.'.$this->dotrek($bl1_rek);
					
                    $bl2=$row1bl->nm_rek;
                    $bl3= number_format($row1bl->nilai,"2",".",",");
					//$bl4=$row1bl->nm_hukum;
					//$bl4=str_replace('&lt;br&gt;','<br>',$row1bl->nm_hukum);
					       
                 if (strlen($bl1_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">&nbsp;</td></tr>";
				 } else {
					  $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$bl2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$bl3</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"left\">&nbsp;</td></tr>";
				 }
                }

                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka a WHERE LEFT(kd_rek5,1)='5' and rtrim(a.kd_skpd)='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH BELANJA</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jmlb</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 }  
                  
				  
                    $surplus=$cob1-$cob;
					$jml_surplus=number_format($surplus,"2",".",",");
					if ($surplus<0)
					{
						$surplus=$surplus*(-1);
						$jml_surplus=number_format($surplus,"2",".",",");
						$jml_surplus='('.$jml_surplus.')';
					}
					
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">SURPLUS/(DEFISIT)</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$jml_surplus</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                    
                    $sql3=" SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_kegiatan,5)='00.61' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='61' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,5)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='61' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek3 
	                       UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,7)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='61' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek3
                                                     ) a ORDER BY kd_giat,kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
					
					
                    //$coba9=$row3->kd_rek;
					$coba9_rek=$row3->kd_rek;
					$coba9_giat=$row3->kd_giat;
					$coba9=$coba9_giat.'.'.$this->dotrek($coba9_rek);
                   
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
					
                                    if (strlen($coba9_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
									} else {
										 $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba10</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
									}
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka a WHERE LEFT(kd_rek5,2)='61' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                    if ($rowpm->totpm != 0){
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENERIMAAN DAERAH</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
					}
                 }     
				 
                $sql4=" SELECT * FROM (SELECT rtrim(a.kd_kegiatan) AS kd_giat,'' AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE left(rtrim(a.kd_skpd),7)='$id' and right(a.kd_kegiatan,5)='00.62' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,3) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='62' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,3),b.nm_rek3
                           UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,5) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,5)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='62' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,5),b.nm_rek3 
	                       UNION ALL
                           SELECT rtrim(a.kd_kegiatan) AS kd_giat,LEFT(a.kd_rek5,7) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,7)=b.kd_rek3 WHERE rtrim(a.kd_skpd)='$id' and left(a.kd_rek5,2)='62' GROUP BY  rtrim(a.kd_kegiatan),LEFT(a.kd_rek5,7),b.nm_rek3
                                                     ) a ORDER BY kd_giat,kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    //$coba13=$row4->kd_rek;
					$coba13_rek=$row4->kd_rek;
					$coba13_giat=$row4->kd_giat;
					$coba13=$coba13_giat.'.'.$this->dotrek($coba13_rek);
					
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   if (strlen($coba13_rek)>5) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
				   } else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">$coba14</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
				   }
                }
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka a WHERE LEFT(kd_rek5,2)='62' and left(rtrim(a.kd_skpd),7)='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   if ($rowpk->totpk != 0){
                    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\">JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;</tr>";
				   }
                 }  
				 
*/					 
					if($id=='2.06.01.05'){
									 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"4\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"width: 30%;\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
					}
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
            $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
            //$this->template->load('template','anggaran/rka/perkadaII',$data);
   			echo ("<title>Pergub Lampiran II Unit $id</title>");
			echo ($cRet);
			break;	        
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
 
	

	function preview_perkada_penjelasan(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org FROM ms_skpd a 
INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
 WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				  $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        
        $cRet='';
$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"70%\" rowspan=\"3\" align=\"right\" Valign=\"top\">Lampiran III : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

   
 		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                         <td  width=\"80%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >: $kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
                    </tr>
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none; \" >: $kd_skpd - $nm_skpd</td>
                    </tr>
                  </table>"; 
				  
        
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"12%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"2\" width=\"27%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td rowspan=\"2\" width=\"12%\" align=\"center\"><b>JUMLAH (Rp.)</b></td>
                            <td colspan=\"5\" width=\"49%\" align=\"center\"><b>PENJELASAN</b></td>                            
                            </tr>
                        <tr>
 		                     <td width=\"17%\" align=\"center\">URAIAN</td>
                             <td width=\"5%\" align=\"center\">VOLUME</td>
                             <td width=\"5%\" align=\"center\">SATUAN</td>
                             <td width=\"10%\" align=\"center\">HARGA</td>
                             <td width=\"12%\" align=\"center\">TOTAL</td>
                        </tr>    
                     </thead>
                      <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"8\"><i>
							Lampiran II : PerGub Prov. Kalimantan Barat - Penjabaran Penyusunan APBD TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td></tr>
                        ";
                        
                 $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $pend=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 } 
                 $sql1="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='4'  ORDER BY kd_rek,nu,po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                                       
                 $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $blj=number_format($rowb->totb,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sqltbtl="SELECT SUM(nilai) AS totbtl FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
                 $sqlbtl=$this->db->query($sqltbtl);
                 foreach ($sqlbtl->result() as $rowbtl)
                {
                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Tidak Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbtl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 } 
                  
                 $sql2="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='51'  ORDER BY kd_rek,nu,po";
                 
                 $query1 = $this->db->query($sql2);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query1->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                 $sqltbl="SELECT SUM(nilai) AS totbl FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                 $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $bljbl=number_format($rowbl->totbl,"2",".",",");
                    //$cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljbl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sql3="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='52'  ORDER BY kd_rek,nu,po";
                 
                 $query2 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query2->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Jumlah Belanja </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                                     
                 $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $bljpm=number_format($rowpm->totpm,"2",".",",");
                   $bljpm1=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 }
                 
                 $sql4="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='61'  ORDER BY kd_rek,nu,po";
                 
                 $query3 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                                     
                
        
                  }
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                  
                  $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $bljpk=number_format($rowpk->totpk,"2",".",",");
                   $bljpk1=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$bljpk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
                  }                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">&nbsp;</tr>";
                 
                 
                 $sql5="SELECT * FROM perkada WHERE kd_skpd='$id' AND jns='62'  ORDER BY kd_rek,nu,po";
                 
                 $query4 = $this->db->query($sql5);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $uraian=$row->uraian;
                    $volume=empty($row->volume) || $row->volume == 0 ? '' :$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  $netto=$bljpm1-$bljpk1;
                   if ($netto < 0){
                	$x1="(";
                	$netto=$netto*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $net=number_format($netto,2,',','.');  
                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"27%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$net$y1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\" align=\"right\"></tr>";
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    
    function preview_perda1_ubah(){
       $id = $this->uri->segment(3);
       $cetak = $this->uri->segment(4);
             
       if ($id <> 'keseluruhan' ) {
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
                
         $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       }
       
       if ($id <> 'keseluruhan') {
           $skpd1 = "and kd_skpd='$id'";
           $skpd2 = " and b.kd_skpd='$id'";
           
       } else {
           $skpd1 = '';
           $skpd2 = '';
            
       }
       
       $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
           
        $jk=$this->rka_model->combo_skpd();
       
        $cRet='';
        
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"55%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN I  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }                 
             
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
        if ($id <> 'keseluruhan') {
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                        <tr>
                            <td width=\"20%\">Urusan Organisasi </td>
                            <td width=\"80%\">: $kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td>Organisasi</td>
                            <td>: $kd_skpd - $nm_skpd</td>
                        </tr>
                    
                    </table>";      
        }
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\" colspan=\"2\" ><b>JUMLAH (Rp.)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>BERTAMBAH</br>(BERKURANG)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\" ><b>%</b></td>   
                        </tr>
                        <tr >
                             <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Penyusunan</b></td>
                             <td bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>Perubahan</b></td>                             
                        </tr>  
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                        
               
                   $sql1="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(a.kd_rek1,1)='4'  $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(a.kd_rek2,1)='4'  $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(a.kd_rek3,1)='4'  $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
               
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1  = $row->rek;
                    $coba2  = $row->nm_rek;
                    $coba3  = number_format($row->nilai,"2",".",",");
                    $coba3u = number_format($row->nilai_u,"2",".",",");
                    $rumus1 = $row->nilai_u - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="(";
                    	$rumus1=$rumus1*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");                                  
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen1</td>
                                 </tr>";
                }
              
                $sqltp="SELECT SUM(nilai) AS totp,Sum(nilai_ubah) as totp_u FROM trdrka WHERE LEFT(kd_rek5,1)='4' $skpd1 ";
                
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4   =   number_format($rowp->totp,"2",".",",");
                   $coba4u  =   number_format($rowp->totp_u,"2",".",",");
                   $rumus2  =   $rowp->totp_u - $rowp->totp;                   
                   if ($rumus2 < 0){
                    	$x1="(";
                    	$rumus2=$rumus2*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total2 = number_format($rumus2,"2",".",",");     
                    $cob1   =$rowp->totp;
                    $cob1u  =$rowp->totp_u;
                    $per2   = ($rumus2!=0)?($rumus2/$rowp->totp) * 100:0; 
                    $persen2= number_format($per2,"2",".",",");
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba4u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen2</td>
                                 </tr>";
                    //$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
//                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                 }
                
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE LEFT(a.kd_rek1,1)='5' $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE LEFT(a.kd_rek2,1)='5' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE LEFT(a.kd_rek3,1)='5' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                                
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5  = $row1->rek;
                    $coba6  = $row1->nm_rek;
                    $coba7  = number_format($row1->nilai,"2",".",",");
                    $coba7u = number_format($row1->nilai_u,"2",".",",");
                    $rumus3 = $row1->nilai_u - $row1->nilai;
                    if ($rumus3 < 0){
                    	$x1="(";
                    	$rumus3=$rumus3*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total3 = number_format($rumus3,"2",".",",");     
                    $per3   = ($rumus3!=0)?($rumus3 /$row1->nilai ) * 100:0; 
                    $persen3= number_format($per3,"2",".",",");
                     $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total3$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen3</td>
                                  </tr>";
                }
                   
                 $sqltb="SELECT SUM(nilai) AS totb,sum(nilai_ubah) as totb_u FROM trdrka WHERE LEFT(kd_rek5,1)='5' $skpd1 ";                                           
                    
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                    $coba8  =   number_format($rowb->totb,"2",".",",");
                    $coba8u =   number_format($rowb->totb_u,"2",".",",");
                    $rumus4 =   $rowb->totb_u - $rowb->totb;
                    if ($rumus4 < 0){
                    	$x1="(";
                    	$rumus4=$rumus4*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total4 = number_format($rumus4,"2",".",",");
                    $cob=$rowb->totb;
                    $cobu=$rowb->totb_u;
                    $per4   = ($rumus4!=0)?($rumus4 /$rowb->totb ) * 100:0; 
                    $persen4= number_format($per4,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba8</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba8u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total4$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen4</td>
                                </tr>";
                 } 
                  
                  $suplus=$cob1-$cob;
                  $suplusu=$cob1u-$cobu; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                 if ($suplusu < 0){
                	$x1="(";
                	$suplusu=$suplusu*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                    
                 $surp  = number_format($suplus,2,',','.');
                 $surpu = number_format($suplusu,2,',','.');
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$surp$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$surpu$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                   
                    $sql3="SELECT a.kd_rek1 AS kd_rek,a.lra AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' $skpd2 GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                            
                    
                    
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9  = $row3->rek;
                    $coba10 = $row3->nm_rek;
                    $coba11 = number_format($row3->nilai,"2",".",",");
                    $coba11u= number_format($row3->nilai_u,"2",".",",");
                    $rumus5 = $row3->nilai_u - $row3->nilai;
                    if ($rumus5 < 0){
                    	$x1="(";
                    	$rumus5=$rumus5*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total5 = number_format($rumus5,"2",".",",");
                    $per5   = ($rumus5!=0)?($rumus5 /$row3->nilai) * 100:0; 
                    $persen5= number_format($per5,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba11u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total5$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen5</td>    
                                 </tr>";
                }
                
                    $sqltpm="SELECT SUM(nilai) AS totpm, SUM(nilai_ubah) as totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' $skpd1 ";
                
                
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12  = number_format($rowpm->totpm,"2",".",",");
                   $coba12u = number_format($rowpm->totpm_u,"2",".",",");
                   $rumus6  = $rowpm->totpm_u - $rowpm->totpm;
                   if ($rumus6 < 0){
                    	$x1="(";
                    	$rumus6=$rumus6*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total6 = number_format($rumus6,"2",".",",");
                   $cob3   =$rowpm->totpm;
                   $cob3u  =$rowpm->totpm_u;
                   $per6   = ($rumus6!=0)?($rumus6 /$rowpm->totpm) * 100:0; 
                   $persen6= number_format($per6,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba12u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total6$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen6</td>
                                </tr>";
                }
                
                $sql4="sELECT a.kd_rek2 AS kd_rek,a.lra AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' $skpd2 GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.lra AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_u FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' $skpd2 GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                    
                
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13  = $row4->rek;
                    $coba14  = $row4->nm_rek;
                    $coba15  = number_format($row4->nilai,"2",".",",");
                    $coba15u = number_format($row4->nilai_u,"2",".",",");
                    $rumus7  = $row4->nilai_u - $row4->nilai;
                    if ($rumus7 < 0){
                    	$x1="(";
                    	$rumus7=$rumus7*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total7 = number_format($rumus7,"2",".",",");
                   $per7   = ($rumus7!=0)?($rumus7 /$row4->nilai) * 100:0; 
                   $persen7= number_format($per7,"2",".",",");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba15u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total7$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen7</td>
                                 </tr>";
                }
             
                    $sqltpk="SELECT SUM(nilai) AS totpk, SUM(nilai) as totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' $skpd1 ";    

                
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16  = number_format($rowpk->totpk,"2",".",",");
                   $coba16u = number_format($rowpk->totpk_u,"2",".",",");
                   $rumus8  = $rowpk->totpk_u - $rowpk->totpk;
                   if ($rumus8 < 0){
                    	$x1="(";
                    	$rumus8=$rumus8*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                   $total8 = number_format($rumus8,"2",".",",");
                   $cob4=$rowpk->totpk;
                   $cob4u=$rowpk->totpk_u;
                   $per8   = ($rumus8!=0)?($rumus8 /$rowpk->totpk) * 100:0; 
                   $persen8= number_format($per8,"2",".",",");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$coba16u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$x1$total8$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$persen8</td>
                                </tr>";
                 }  
                  
                  $netto=$cob3-$cob4;
                  $nettou=$cob3u-$cob4u; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.'); 
                 if ($nettou < 0){
                	$a1="(";
                	$nettou=$nettou*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nettu=number_format($nettou,2,',','.');
                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$a1$nett$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">$a1$nettu$b1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                    $silpa=($cob1+$cob3)-($cob+$cob4);
                    if ($silpa < 0){
                    	$c1="(";
                    	$silpa=$silpa*-1;
                    	$d1=")";}
                    else {
                    	$c1="";
    	                $d1="";}
                    $silp=number_format($silpa,2,',','.');
                    $silpau=($cob1u+$cob3u)-($cobu+$cob4u);
                    if ($silpau < 0){
                    	$c1="(";
                    	$silpau=$silpau*-1;
                    	$d1=")";}
                    else {
                    	$c1="";
    	                $d1="";}
                    $silpu=number_format($silpau,2,',','.');                  
                    $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"40%\">Sisa Lebih Pembiayaan Anggaran Tahun Berkenaan(SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\">$c1$silp$d1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\">$c1$silpu$d1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" width=\"15%\" align=\"right\"></td>
                                  </tr>
                                  ";
                    //$cRet .="<tr>
//                                <td width=\"100%\" align=\"left\" colspan=\"3\">
//								<table border=\"0\">
//								<tr>
//								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
//								<br>&nbsp;
//								&nbsp;<br>
//                				&nbsp;<br>
//                				&nbsp;<br>
//								&nbsp;	
//								</td>
//								<td width=\"30%\" align=\"center\">$daerah ,$tanggal
//								<br>Kepala SKPD,
//      							<p>&nbsp;</p>
//                				<br>$nama
//                				<br>NIP. $nip 
//								</td></tr></table></td>
//                             </tr>";
//        
              
        $cRet         .= "</table>";
        $data['prev']  = $cRet;
        $data['sikap'] = 'preview';
        if ($id <> 'keseluruhan') {
            $judul         = 'Laporan APBD Perubahan lampI - '.$kd_skpd;
        } else {
            $judul         = 'Laporan APBD Perubahan lampI - Keseluruhan';
        }
        
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN I');    
        switch($cetak) {
        case 0;
            $this->template->load('template','anggaran/rka/perda_1_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
                
    }
    
    function preview_perdaII_ubah($cetak=0){
        //$cetak =   $this->uri->segment(3);           
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
                
        $cRet  ='';
         if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"10%\"><strong><h5>LAMPIRAN II  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>RINGKASAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" width=\"100%\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" bgcolor=\"#CCCCCC\" width=\"26%\" align=\"center\" colspan=\"4\"><b>PENDAPATAN</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" bgcolor=\"#CCCCCC\" width=\"54%\" align=\"center\" colspan=\"8\"><b>BELANJA</b></td>
                        </tr>
                        <tr>
 		                    <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">SEBELUM<br>PERUBAHAN</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">SETELAH<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"2\" width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BERTAMBAH</br>(BERKURANG)</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">SEBELUM<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">SETELAH<br>PERUBAHAN</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\"colspan=\"2\" width=\"12%\" bgcolor=\"#CCCCCC\" align=\"center\">BERTAMBAH</br>(BERKURANG)</td>
                        </tr>
                        <tr>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >(RP.)</td>
                             <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" >%</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Tidak Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Jumlah</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Tidak Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Langsung</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >Jumlah</td>
                             <td bgcolor=\"#CCCCCC\" width=\"7%\" align=\"center\" >(RP.)</td>
                             <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\" >%</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" >&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,a.kd_urusan1 AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,a.kd_urusan AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND LEFT(kd_skpd,4)=a.kd_urusan) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND LEFT(kd_skpd,4)=a.kd_urusan) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND LEFT(kd_skpd,4)=a.kd_urusan) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan WHERE LEN(kd_urusan) <> '1' GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT a.kd_skpd AS kode, a.nm_skpd AS nama,a.kd_skpd AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' AND kd_skpd=a.kd_skpd) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51' AND kd_skpd=a.kd_skpd) AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_skpd a ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,a.nm_skpd
                        UNION
                        SELECT '' AS kode, 'JUMLAH' AS nama,'JUMLAH' AS urut,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='4' ) AS nilai,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='4' ) AS nilai_ubah,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='51' ) AS btl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS bl,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='51') AS btl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS bl_ubah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah_ubah FROM trdrka b
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1) a ORDER BY a.urut
                        ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode   =$row->kode;
                    $nama   =$row->nama;
                    $pend   =number_format($row->nilai,"2",".",",");
                    $pendu  =number_format($row->nilai_ubah,"2",".",",");
                    $rumus1  = $row->nilai_ubah - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="(";
                    	$rumus1=$rumus1*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                    
                    $btl    = number_format($row->btl,"2",".",",");
                    $bl     = number_format($row->bl,"2",".",",");
                    $jum    = number_format($row->jumlah,"2",".",",");
                    $btlu   = number_format($row->btl_ubah,"2",".",",");
                    $blu    = number_format($row->bl_ubah,"2",".",",");
                    $jumu   = number_format($row->jumlah_ubah,"2",".",",");
                    $rumus2 = ($row->jumlah_ubah - $row->jumlah);
                    if ($rumus2 < 0){
                    	$x1="(";
                    	$rumus2=$rumus2*-1;
                    	$y1=")";}
                    else {
                    	$x1="";
    	                $y1="";}
                    $total2 = number_format($rumus2,"2",".",",");
                    $per2   = ($rumus2!=0)?($rumus2 / $row->jumlah ) * 100:0; 
                    $persen2= number_format($per2,"2",".",",");    
                    
                     $cRet    .= "<tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\" width=\"5%\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\" width=\"15%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$pendu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"5%\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$btl</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$btlu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$blu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$jumu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"7%\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\" width=\"5%\">$persen2</td>
                                </tr>
                                     ";
                
        
                  }  

        $cRet          .=       " </table>";

        $data['prev']  = $cRet;
        
        $judul = 'Laporan APBD Perubahan Lamp II';
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II'); 
                    
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaII_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                
    }
    
    function preview_perdaIII_ubah(){
      $id    = $this->uri->segment(3);
      $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd where kd_skpd='$id' and kode='PA'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
       
        $cRet='';
         if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"55%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN III:</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }                 
             
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>RINGKASAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">: $kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>: $kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>URAIAN</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" colspan =\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;border-bottom;\" colspan =\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>BERTAMBAH</br>(BERKURANG)</b></td>
                            <td rowspan =\"2\" bgcolor=\"#CCCCCC\" width=\"15%\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Sebelum Perubahan</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>(Rp.)</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"5%\" align=\"center\"><b>%</b></td>
                        </tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"30%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND LEFT(b.kd_rek5,1)='4' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,24) AS kd_rek,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        ) a ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1  = $row->kd_rek;
                    $coba2  = $row->nm_rek;
                    $coba3  = number_format($row->nilai,"2",".",",");
                    $coba3u = number_format($row->nilai_ubah,"2",".",",");
                    $rumus1 = $row->nilai_ubah - $row->nilai;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");  
                    $per1   = ($rumus1!=0)?($rumus1 / $row->nilai ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp, SUM(nilai_ubah) as totp_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                   $coba4u=number_format($rowp->totp_ubah,"2",".",",");
                   $rumus2 = $rowp->totp_ubah - $rowp->totp;
                   if ($rumus2 < 0){
                        $x1="("; $rumus2=$rumus2*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total2 = number_format($rumus2,"2",".",",");  
                   $per2   = ($rumus2!=0)?($rumus2 / $rowp->totp ) * 100:0; 
                   $persen2= number_format($per2,"2",".",",");
                   $cob1=$rowp->totp;
                   $cob1u=$rowp->totp_ubah;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba4u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total2$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                                </tr>";
                 } 
                 
                 $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) as totb_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $jmlb=number_format($rowb->totb,"2",".",",");
                   $jmlbu=number_format($rowb->totb_ubah,"2",".",",");
                   $cob=$rowb->totb;
                   $cobu=$rowb->totb_ubah;
                   $rumus3 = $rowb->totb_ubah - $rowb->totb;
                   if ($rumus3 < 0){
                        $x1="("; $rumus3=$rumus3*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total3 = number_format($rumus3,"2",".",",");  
                   $per3   = ($rumus3!=0)?($rumus3 / $rowb->totb ) * 100:0; 
                   $persen3= number_format($per3,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">BELANJA DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jmlbu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total3$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }    
                $sql2="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND LEFT(b.kd_rek5,2)='51' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5  = $row1->kd_rek;
                    $coba6  = $row1->nm_rek;
                    $coba7  = number_format($row1->nilai,"2",".",",");
                    $coba7u = number_format($row1->nilai_ubah,"2",".",",");
                    $rumus4 = $row1->nilai_ubah - $row1->nilai;
                    if ($rumus4 < 0){
                        $x1="("; $rumus4=$rumus4*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total4 = number_format($rumus4,"2",".",",");  
                   $per4   = ($rumus4!=0)?($rumus4 / $row1->nilai) * 100:0; 
                   $persen4= number_format($per4,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba7u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total4$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>
                                ";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl, SUM(nilai_ubah) as totbl_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl   = number_format($rowbl->totbl,"2",".",",");
                   $jumblu  = number_format($rowbl->totbl_ubah,"2",".",",");
                   $rumus5  = $rowbl->totbl_ubah - $rowbl->totbl;
                   if ($rumus5 < 0){
                        $x1="("; $rumus5=$rumus5*-1; $y1=")";}
                   else {
                        $x1=""; $y1="";}
                   $total5 = number_format($rumus5,"2",".",",");  
                   $per5   = ($rumus5!=0)?($rumus5 / $rowbl->totbl) * 100:0; 
                   $persen5= number_format($per5,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>
                              <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumblu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total5$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen5</td>                                
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }
                 $sql2bl="SELECT * FROM (SELECT a.kd_program AS kd_rek,c.nm_program AS nm_rek,
              			  (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,
             			  (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai_ubah
            			  FROM trskpd a INNER JOIN m_prog c ON 	a.kd_program1=c.kd_program
                          LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2)<>'00' GROUP BY a.kd_program,c.nm_program
                          UNION ALL
                          SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai) AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                          LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2)<>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                          UNION ALL
                          SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai) AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                          ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                          ) a ORDER BY kd_rek";
                 
                 $query1bl = $this->db->query($sql2bl);
                 foreach ($query1bl->result() as $row1bl)
                {
                    $bl1    =$row1bl->kd_rek;
                    $bl2    =$row1bl->nm_rek;
                    $bl3    = number_format($row1bl->nilai,"2",".",",");
                    $bl3u   = number_format($row1bl->nilai_ubah,"2",".",",");
                    $rumus6 = $row1bl->nilai_ubah - $row1bl->nilai;
                    if ($rumus6 < 0){
                        $x1="("; $rumus6=$rumus6*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total6 = number_format($rumus6,"2",".",",");  
                    $per6   = ($rumus6!=0)?($rumus6 / $row1bl->nilai) * 100:0; 
                    $persen6= number_format($per6,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$bl1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bl3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bl3u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total6$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                
                    $sqltbl="SELECT SUM(nilai) AS totbl,Sum(nilai_ubah) as totbl_ubah FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                    $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $jumbl   = number_format($rowbl->totbl,"2",".",",");
                   $jumblu  = number_format($rowbl->totbl_ubah,"2",".",",");
                   $rumus7  = $rowbl->totbl_ubah - $rowbl->totbl;
                   if ($rumus7 < 0){
                        $x1="("; $rumus7=$rumus7*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total7 = number_format($rumus7,"2",".",",");  
                    $per7   = ($rumus7!=0)?($rumus7 / $rowbl->totbl) * 100:0; 
                    $persen7= number_format($per7,"2",".",",");
                   $cob=$rowbl->totbl;
                   $cobu=$rowbl->totbl_ubah;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$jumblu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total7$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen7</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                 }
                 
                 $suplus=$cob1-$cob;
                 $suplusu=$cob1u-$cobu; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                 if ($suplusu < 0){
                	$x1="(";
                	$suplusu=$suplusu*-1;
                	$y1=")";}
                 else {
                	$x1="";
	                $y1="";}
                    
                 $surp  = number_format($suplus,2,',','.');
                 $surpu = number_format($suplusu,2,',','.');               
                  
                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Suprlus/(Defisit)</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$surp$y1</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$surpu$y1</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>
                              <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>";
                
                  
                    
                    $sql3="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                           LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_kegiatan,5)='00.03' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                           UNION ALL
                           SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                           ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                           ) a ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">PEMBIAYAAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9  =$row3->kd_rek;
                    $coba10 =$row3->nm_rek;
                    $coba11 = number_format($row3->nilai,"2",".",",");
                    $coba11u= number_format($row3->nilai_ubah,"2",".",",");
                    $rumus8 = $row3->nilai_ubah - $row3->nilai;
                    if ($rumus8 < 0){
                        $x1="("; $rumus8=$rumus8*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total8 = number_format($rumus8,"2",".",",");  
                    $per8   = ($rumus8!=0)?($rumus8 / $row3->nilai) * 100:0; 
                    $persen8= number_format($per8,"2",".",",");
                    
                     $cRet    .= "<tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba11</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba11u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total8$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen8</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>";
                }
                $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12  = number_format($rowpm->totpm,"2",".",",");
                   $coba12u = number_format($rowpm->totpm_ubah,"2",".",",");
                   $rumus9  = $rowpm->totpm_ubah - $rowpm->totpm;
                   if ($rumus9 < 0){
                        $x1="("; $rumus9=$rumus9*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total9 = number_format($rumus9,"2",".",",");  
                    $per9   = ($rumus9!=0)?($rumus9 / $rowpm->totpm) * 100:0; 
                    $persen9= number_format($per9,"2",".",",");
                    $cob3    = $rowpm->totpm;
                    $cob3u   = $rowpm->totpm_ubah;
                     $cRet    .= " 
                                <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">Jumlah Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba12</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba12u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total9$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen9</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>
                                </tr>
                                <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\"></td>                                     
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">&nbsp;</td>
                                  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\">&nbsp;</td>
                              </tr>";
                 }     
                $sql4="SELECT * FROM (SELECT a.kd_kegiatan AS kd_rek,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah) AS nilai_ubah FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                       LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' and right(a.kd_kegiatan,5)='00.04' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                       UNION ALL
                       SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah) AS nilai_ubah FROM trdrka a INNER JOIN ms_rek3 b 
                       ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id' and left(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                       ) a ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13     = $row4->kd_rek;
                    $coba14     = $row4->nm_rek;
                    $coba15     = number_format($row4->nilai,"2",".",",");
                    $coba15u    = number_format($row4->nilai_ubah,"2",".",",");
                    $rumus10    = $row4->nilai_ubah - $row4->nilai;
                    if ($rumus10 < 0){
                        $x1="("; $rumus10=$rumus10*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total10 = number_format($rumus10,"2",".",",");  
                    $per10   = ($rumus10!=0)?($rumus10 / $row4->nilai) * 100:0; 
                    $persen10= number_format($per10,"2",".",",");
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"30%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba15</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$coba15u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$total10$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"right\">$persen10</td>&nbsp;
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"15%\" align=\"right\"></td>&nbsp;
                                </tr>";
                }
                $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_ubah FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16  = number_format($rowpk->totpk,"2",".",",");
                   $coba16u = number_format($rowpk->totpk_ubah,"2",".",",");
                   $rumus11 = $rowpk->totpk_ubah - $rowpk->totpk;
                   if ($rumus11 < 0){
                        $x1="("; $rumus11=$rumus11*-1; $y1=")";}
                    else {
                        $x1=""; $y1="";}
                    $total11 = number_format($rumus11,"2",".",",");  
                    $per11   = ($rumus11!=0)?($rumus11 / $rowpk->totpk) * 100:0; 
                    $persen11= number_format($per11,"2",".",",");
                    
                   $cob4    =$rowpk->totpk;
                   $cob4u   =$rowpk->totpk_ubah;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"30%\">Jumlah Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$coba16u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"right\">$x1$total11$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$persen11</td>&nbsp;
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"right\"></td>&nbsp;
                                </tr>";
                 }  
                  

              
        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $data['sikap'] = 'preview';
        $judul     = 'Laporan APBD Perubahan Lamp III - '.$kd_skpd;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
        switch($cetak) {
        case 0;
              $this->template->load('template','anggaran/rka/perdaIII_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }       
       
        
                
    }
    
    
    function preview_perdaIV_ubah($cetak=0){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"10%\"><strong><h5>LAMPIRAN IV  :</h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5>PERATURAN DAERAH</strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"10%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"10%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI PERUBAHAN BELANJA MENURUT URUSAN PEMERINTAHAN DAERAH, ORGANISASI, PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"3\" bgcolor=\"#CCCCCC\" width=\"22%\" align=\"center\"><b>URAIAN URUSAN, ORGANISASI, PROGRAM DAN KEGIATAN PEMERINTAH DAERAH</b></td>                            
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>SEBELUM PERUBAHAN</b></td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"49%\" align=\"center\"><b>SETELAH PERUBAHAN</b></td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>BERTAMBAH/(BERKURANG)</b></td>
                        </tr>
                        <tr>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">JENIS BELANJA</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                            <td style=\"border-bottom: solid 1px black;\" colspan=\"3\" width=\"21%\" bgcolor=\"#CCCCCC\" align=\"center\">JENIS BELANJA</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                            <td rowspan=\"2\" width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">(Rp)</td>
                            <td rowspan=\"2\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>
                        <tr>
 		                    <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">PEGAWAI</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">BARANG DAN JASA</td>
                            <td width=\"7%\" bgcolor=\"#CCCCCC\" align=\"center\">MODAL</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"22%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"7%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,1)=a.kd_urusan1)AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,1)=a.kd_urusan1) AS jumlahu,a.kd_urusan1 AS urut FROM trdrka b 
                        RIGHT JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1
                        UNION
                        SELECT a.kd_urusan AS kode, a.nm_urusan AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bpegu
                        ,(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=a.kd_urusan)AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=a.kd_urusan) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND LEFT(kd_skpd,4)=a.kd_urusan)AS jumlahu,a.kd_urusan AS urut FROM trdrka b 
                        RIGHT JOIN ms_urusan a ON LEFT(b.kd_skpd,4)=a.kd_urusan GROUP BY  a.kd_urusan ,a.nm_urusan
                        UNION
                        SELECT b.kd_skpd AS kode, b.nm_skpd AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbj, 
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd) AS bbju, 
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd)AS jumlahu,LEFT(b.kd_skpd,7) AS urut FROM trdrka a 
                        RIGHT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd
                        UNION
                        SELECT b.kd_program AS kode,c.nm_program AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND LEFT(kd_kegiatan,(LEN(b.kd_program)))=b.kd_program ) AS jumlahu,
                        a.kd_skpd AS urut
                        FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        INNER JOIN m_prog c ON b.kd_program1 = c.kd_program WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_program,c.nm_program
                        UNION
                        SELECT b.kd_kegiatan AS kode,c.nm_kegiatan AS nama,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpeg,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' AND kd_skpd=a.kd_skpd AND kd_kegiatan=b.kd_kegiatan ) AS jumlahu,
                        SUBSTRING(b.kd_kegiatan,6,13) AS urut
                        FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                        INNER JOIN m_giat c ON b.kd_kegiatan1 = c.kd_kegiatan WHERE RIGHT(b.kd_program,2) <>'00'GROUP BY  b.kd_kegiatan,c.nm_kegiatan
                        UNION	
                        SELECT DISTINCT '' AS kode, 'JUMLAH' AS nama,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='521') AS bpeg
                        ,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='522' )AS bbj,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,3)='523' ) AS bm,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='521' ) AS bpegu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='522' )AS bbju,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,3)='523' ) AS bmu,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,2)='52' ) AS jumlahu,'JUMLAH' AS urut FROM trdrka) a ORDER BY urut,kode";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode   = $row->kode;
                    $nama   = $row->nama;
                    $pend   = number_format($row->bpeg,"2",".",",");
                    $btl    = number_format($row->bbj,"2",".",",");
                    $bl     = number_format($row->bm,"2",".",",");
                    $jum    = number_format($row->jumlah,"2",".",",");
                    $pendu  = number_format($row->bpegu,"2",".",",");
                    $btlu   = number_format($row->bbju,"2",".",",");
                    $blu    = number_format($row->bmu,"2",".",",");
                    $jumu   = number_format($row->jumlahu,"2",".",",");
                    $rumus1 = $row->jumlahu - $row->jumlah;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");
                    $per1   = ($rumus1!=0)?($rumus1 / $row->jumlah ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");    
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"22%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$pendu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$btlu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$blu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$jumu</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"7%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"right\">$persen1</td>
                                </tr> ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan APBD Perubahan Lamp IV ';
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN IV');        
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaIV_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'L');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }                                              
    }
    
    function preview_perdaV_ubah($cetak=0){
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        if ($cetak <> 0) {
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td rowspan=\"3\" align=\"left\" width=\"60%\"><strong></strong></td>
                         <td rowspan=\"3\" valign =\"top\" align=\"left\" width=\"15%\"><strong><h5>LAMPIRAN IV  </h6></strong></td>
                         <td colspan=\"2\" align=\"left\" width=\"30%\"><strong><h5></strong></h5></td>
                    </tr>
                    <tr> 
                         <td align=\"left\" width=\"15%\"><h5>NOMOR</h5></td><td width=\"20%\" align=\"left\" ><h5>:</h5></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"15%\"><h5>TANGGAL</h5></td><td style=\"border-bottom: solid 1px black;\" align=\"left\" width=\"20%\"><h5>:</h5></td>
                    </tr>
                                         
                   
                  </table>"; 
            }  
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>REKAPITULASI BELANJA DAERAH UNTUK KESELARASAN DAN KETERPADUAN URUSAN PEMERINTAHAN DAERAH DAN FUNGSI DALAM KERANGKA PENGELOLAAN KEUANGAN NEGARA </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"39%\" align=\"center\"><b>URAIAN</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"16%\" align=\"center\"><b>JUMLAH SEBELUM PERUBAHAN</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"16%\" align=\"center\"><b>JUMLAH SETELAH PERUBAHAN</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"19%\" align=\"center\"><b>BERTAMBAH/(BERKURANG)</b></td>
                            </tr>
                        <tr>
 		                     <td width=\"16%\" bgcolor=\"#CCCCCC\" align=\"center\">JUMLAH</td>
                             <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                        </tr>    
                     </thead>
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"39%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"16%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                        </tr>
                        ";
                 $sql1="SELECT * FROM (SELECT b.kd_fungsi AS kode, c.nm_fungsi AS nama,b.kd_fungsi AS kode1,'1' AS kode2,' 'AS skpd,
                        (SELECT SUM(a.nilai) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah,
                        (SELECT SUM(a.nilai_ubah) FROM trdrka a LEFT JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd WHERE LEFT(a.kd_rek5,1)='5' AND b.kd_fungsi=c.kd_fungsi)AS jumlah_u FROM trdrka a  INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd LEFT JOIN ms_fungsi c ON b.kd_fungsi=c.kd_fungsi GROUP BY b.kd_fungsi,c.nm_fungsi,b.kd_fungsi
                        UNION
                        SELECT a.kd_skpd AS kode, b.nm_skpd AS nama,b.kd_fungsi AS kode1,'2' AS kode2,a.kd_skpd AS skpd,
                        (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah,
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' AND kd_skpd=a.kd_skpd)AS jumlah_u FROM trdrka a 
                        INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY a.kd_skpd,b.nm_skpd,b.kd_fungsi
                        UNION	
                        SELECT DISTINCT '' AS kode, 'JUMLAH' AS nama,'99' AS kode1,'3' AS kode2,'' AS skpd,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,1)='5') AS jumlah,                                          
                        (SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_rek5,1)='5' ) AS jumlah_u FROM trdrka) a ORDER BY kode1,a.kode2,skpd";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $jumlah=number_format($row->jumlah,"2",".",",");
                    $jumlah_u= number_format($row->jumlah_u,"2",".",",");
                    $rumus1 = $row->jumlah_u - $row->jumlah;
                    if ($rumus1 < 0){
                    	$x1="("; $rumus1=$rumus1*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $total1 = number_format($rumus1,"2",".",",");
                    $per1   = ($rumus1!=0)?($rumus1 / $row->jumlah ) * 100:0; 
                    $persen1= number_format($per1,"2",".",","); 
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jumlah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$jumlah_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$x1$total1$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"12%\" align=\"right\">$persen1</td>
                                    </tr>
                                     ";
                
        
                  }  

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $judul  = 'Laporan APBD Perubahan Lamp V ';
        $this->template->set('title', 'CETAK PERDA PERUBAHAN LAMPIRAN V');        
        switch($cetak) {
        case 0;
             $this->template->load('template','anggaran/rka/perdaV_ubah',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        } 
                
    }
    
    function preview_perkada_ubah(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
        $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td align=\"center\"><strong>$kab</strong></td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>PENJABARAN PERUBAHAN APBD </strong></td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"20%\">Urusan Organisasi </td>
                        <td width=\"80%\">:$kd_urusan - $nm_urusan</td>
                    </tr>
                    <tr>
                        <td>Organisasi</td>
                        <td>:$kd_skpd - $nm_skpd</td>
                    </tr>
                    
                </table>";  
        
        $cRet .= "<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"17%\" align=\"center\"><b>Uraian</b></td>                            
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td colspan=\"2\" bgcolor=\"#CCCCCC\" width=\"13%\" align=\"center\"><b>Bertambah/ (berkurang)</b></td>
                            <td colspan=\"5\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Penjelasan</b></td>                            
                            </tr>
                        <tr>
 		                     <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Sebelum Perubahan</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Setelah Perubahan</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                             <td width=\"3%\" bgcolor=\"#CCCCCC\" align=\"center\">%</td>
                             <td width=\"18%\" bgcolor=\"#CCCCCC\" align=\"center\">Uraian</td>
                             <td width=\"2%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                             <td width=\"2%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                             <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Harga</td>
                             <td width=\"10%\" bgcolor=\"#CCCCCC\" align=\"center\">Total</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>  
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                                                       
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"3%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                        
                 $sqltp="SELECT SUM(nilai) AS totp,sum(nilai_ubah) as totp_u FROM trdrka WHERE LEFT(kd_rek5,1)='4' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $pend=number_format($rowp->totp,"2",".",",");
                    $pen=$rowp->totp;
                    $pend_u=number_format($rowp->totp_u,"2",".",",");
                    $pen_u=$rowp->totp_u;
                    $pend_s = $rowp->totp_u - $rowp->totp;
                    if ($pend_s < 0){
                    	$x1="("; $pend_s=$pend_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pend_selisih = number_format($pend_s,"2",".",",");
                    $per1   = ($pend_s!=0)?($pend_s / $rowp->totp ) * 100:0; 
                    $persen1= number_format($per1,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pend_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                 $sql1="SELECT * FROM (SELECT SUBSTRING(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTRING(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' AS nilai_u,uraian AS uraian,volume_ubah1 AS volume,satuan_ubah1 AS satuan,harga_ubah1 AS harga,total_ubah AS total, '5' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,1)='4') a ORDER BY kd_rek,nu,po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nu=$row->nilai_u;
                    $n=$row->nilai;
                    $nilaip_s = $nu - $n;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaip_s=$nilaip_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaip_selisih = empty($nilaip_s) || $nilaip_s == 0 ? '' :number_format($nilaip_s,"2",".",",");
                    $perp   = ($nilaip_s!=0)?($nilaip_s / $row->nilai ) * 100:0; 
                    $persenp= empty($perp) || $perp == 0 ? '' :number_format($perp,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaip_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                                       
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none; border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pendapatan Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$pend_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pend_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen1</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                       
                 $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_ubah) AS totb_u FROM trdrka WHERE LEFT(kd_rek5,1)='5' and kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $blj=number_format($rowb->totb,"2",".",",");
                   $blj1=$rowb->totb;
                   $blj_u=number_format($rowb->totb,"2",".",",");
                   $blj_u1=$rowb->totb_u;
                   $blj_s = $rowb->totb_u - $rowb->totb;
                    if ($blj_s < 0){
                    	$x1="("; $blj_s=$blj_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $blj_selisih = number_format($blj_s,"2",".",",");
                    $per1_blj  = ($pend_s!=0)?($blj_s / $rowb->totb ) * 100:0; 
                    $persen_blj= number_format($per1_blj,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$blj_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 }
                 
                 $sqltbtl="SELECT SUM(nilai) AS totbtl,SUM(nilai_ubah) AS totbtl_u FROM trdrka WHERE LEFT(kd_rek5,2)='51' and kd_skpd='$id'";
                 $sqlbtl=$this->db->query($sqltbtl);
                 foreach ($sqlbtl->result() as $rowbtl)
                {
                   $bljbtl=number_format($rowbtl->totbtl,"2",".",",");
                   $bljbtl1=$rowbtl->totbtl;
                   $bljbtl_u=number_format($rowbtl->totbtl_u,"2",".",",");
                   $bljbtl1_u=$rowbtl->totbtl_u;
                   $btl_s = $rowbtl->totbtl_u - $rowbtl->totbtl;
                    if ($btl_s < 0){
                    	$x1="("; $btl_s=$btl_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $btl_selisih = number_format($btl_s,"2",".",",");
                    $per1_btl  = ($pend_s!=0)?($btl_s / $rowbtl->totbtl ) * 100:0; 
                    $persen_btl= number_format($per1_btl,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Tidak Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbtl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbtl_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$btl_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_btl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                  
                 $sql2="SELECT * FROM (SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTRING(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='51'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query1 = $this->db->query($sql2);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query1->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaip_s = $row->nilai_u - $row->nilai;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaip_s=$nilaip_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaip_selisih = empty($nilaip_s) || $nilaip_s == 0 ? '' :number_format($nilaip_s,"2",".",",");
                    $perp   = ($nilaip_s!=0)?($nilaip_s / $row->nilai ) * 100:0; 
                    $persenp= empty($perp) || $perp == 0 ? '' :number_format($perp,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaip_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  
                 $sqltbl="SELECT SUM(nilai) AS totbl,SUM(nilai_ubah) AS totbl_u FROM trdrka WHERE LEFT(kd_rek5,2)='52' and kd_skpd='$id'";
                 $sqlbl=$this->db->query($sqltbl);
                 foreach ($sqlbl->result() as $rowbl)
                {
                   $bljbl=number_format($rowbl->totbl,"2",".",",");
                   $bljbl1=$rowbtl->totbtl;
                   $bljbl_u=number_format($rowbl->totbl_u,"2",".",",");
                   $bljbl1_u=$rowbl->totbl_u;
                   $bl_s = $bljbl1_u - $bljbl1;
                    if ($bl_s < 0){
                    	$x1="("; $bl_s=$bl_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $bl_selisih = empty($bl_s) || $bl_s == 0 ? '' :number_format($bl_s,"2",".",",");
                    $per1_bl  = ($pend_s!=0)?($bl_s / $rowbl->totbl ) * 100:0; 
                    $persen_bl= empty($per1_bl) || $per1_bl == 0 ? '' :number_format($per1_bl,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Langsung</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljbl_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$bl_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_bl</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 } 
                 
                 $sql3="SELECT * FROM (SELECT a.kd_program AS kd_rek, a.kd_program AS kd_rek1,c.nm_program AS nm_rek,(SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai,(SELECT SUM(nilai_ubah) FROM trdrka WHERE LEFT(kd_kegiatan,(LEN(a.kd_program))) = a.kd_program) AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trskpd a INNER JOIN m_prog c ON a.kd_program1=c.kd_program
                        LEFT JOIN trdrka b ON a.kd_program=LEFT(b.kd_kegiatan,(LEN(a.kd_program))) WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_program,c.nm_program 
                        UNION ALL
                        SELECT a.kd_kegiatan AS kd_rek,a.kd_kegiatan AS kd_rek1,c.nm_kegiatan AS nm_rek,SUM(b.nilai)AS nilai,SUM(b.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trskpd a INNER JOIN m_giat c ON a.kd_kegiatan1=c.kd_kegiatan
                        LEFT JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd='$id' AND RIGHT(a.kd_program,2) <>'00' GROUP BY a.kd_kegiatan,c.nm_kegiatan 
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'4' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'5' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'6' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='52' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTRING(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' 'AS nilai_u,uraian AS uraian,volume_ubah1 AS volume,satuan_ubah1 AS satuan,harga_ubah1 AS harga,total_ubah AS total,'7' AS nu,no_po AS po FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='52'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query2 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query2->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaib_s = $row->nilai_u - $row->nilai;
                    if ($nilaip_s < 0){
                    	$x1="("; $nilaib_s=$nilaib_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaib_selisih = empty($nilaib_s) || $nilaib_s == 0 ? '' :number_format($nilaib_s,"2",".",",");
                    $perb   = ($nilaib_s!=0)?($nilaib_s / $row->nilai ) * 100:0; 
                    $persenb= empty($perb) || $perb == 0 ? '' :number_format($perb,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaib_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenb</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                   $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Belanja Daerah</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$blj_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$blj_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_blj</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                 $sqltpm="SELECT SUM(nilai) AS totpm,SUM(nilai_ubah) AS totpm_u FROM trdrka WHERE LEFT(kd_rek5,2)='61' and kd_skpd='$id'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $bljpm=number_format($rowpm->totpm,"2",".",",");
                   $pm=$rowpm->totpm;
                   $bljpm_u=number_format($rowpm->totpm_u,"2",".",",");
                   $pm_u=$rowpm->totpm_u;                   
                    $pm_s = $pm_u - $pm;
                    if ($pm_s < 0){
                    	$x1="("; $pm_s=$pm_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pm_selisih = number_format($pm_s,"2",".",",");
                    $per1_pm  = ($pend_s!=0)?($pm_s / $rowpm->totpm ) * 100:0; 
                    $persen_pm= number_format($per1_pm,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Masuk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpm_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pm_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_pm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 
                 }
                 
                 $sql4="SELECT * FROM (SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTRING(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='61'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query3 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $nilaipm_s = $row->nilai_u - $row->nilai;
                    if ($nilaipm_s < 0){
                    	$x1="("; $nilaipm_s=$nilaipm_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaipm_selisih = empty($nilaipm_s) || $nilaipm_s == 0 ? '' :number_format($nilaipm_s,"2",".",",");
                    $perpm   = ($nilaipm_s!=0)?($nilaipm_s / $row->nilai ) * 100:0; 
                    $persenpm= empty($perpm) || $perpm == 0 ? '' :number_format($perpm,"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaipm_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenpm</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                 
                  
                  $sqltpk="SELECT SUM(nilai) AS totpk,SUM(nilai_ubah) AS totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $bljpk=number_format($rowpk->totpk,"2",".",",");
                   $bljpk1=$rowpk->totpk;
                   $bljpk_u=number_format($rowpk->totpk_u,"2",".",",");
                   $bljpk1_u=$rowpk->totpk_u;                   
                   $pk_s = $bljpk1_u - $bljpk1;
                    if ($pk_s < 0){
                    	$x1="("; $pk_s=$pk_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $pk_selisih = number_format($pk_s,"2",".",",");
                    $per1_pk  = ($pend_s!=0)?($pk_s / $rowpk->totpk ) * 100:0; 
                    $persen_pk= number_format($per1_pk,"2",".",",");
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Keluar</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpk</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$bljpk_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$pk_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persen_pk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
                  }                   
                    
                 
                 
                 $sql5="SELECT * FROM (SELECT SUBSTRING(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_skpd='$id'  AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT SUBSTRING(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,SUM(a.nilai_ubah)AS nilai_u,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE a.kd_skpd='$id' AND LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT SUBSTRING(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,' ' as nilai_u,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po  FROM trdpo
                        WHERE LEFT(no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,2)='62'
                        ) a ORDER BY kd_rek,nu,po";
                 
                 $query4 = $this->db->query($sql5);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row)
                {
                    $kode=$row->kd_rek1;
                    $nama=$row->nm_rek;                    
                    $nilai= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nilai_u= empty($row->nilai_u) || $row->nilai_u == 0 ? '' :number_format($row->nilai_u,2,',','.');
                    $uraian=$row->uraian;
                    $volume=$row->volume;
                    $satuan=$row->satuan; 
                    $harga= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $total= empty($row->total) || $row->total == 0 ? '' :number_format($row->total,2,',','.');
                    $pk=$row->nilai;
                    $pk_u=$row->nilai_u;
                    $nilaipk_s = $pk_u - $pk;
                    if ($nilaipk_s < 0){
                    	$x1="("; $nilaipk_s=$nilaipk_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $nilaipk_selisih = empty($nilaipk_s) || $nilaipk_s == 0 ? '' :number_format($nilaipk_s,"2",",",".");
                    $perpk   = ($nilaipk_s!=0)?($nilaipk_s / $row->nilai ) * 100:0; 
                    $persenpk= empty($perpk) || $perpk == 0 ? '' :number_format($perpk,"2",",",".");
                     
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$nilai_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$nilaipk_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persenpk</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"left\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$volume</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"center\">$satuan</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\">$harga</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\">$total</td></tr>
                                     ";
                
        
                  }
                  $sqltpk="SELECT SUM(nilai) AS totpk,sum(nilai_ubah)as totpk_u FROM trdrka WHERE LEFT(kd_rek5,2)='62' and kd_skpd='$id'";
                  $sqlpk=$this->db->query($sqltpk);
                  foreach ($sqlpk->result() as $rowpklr)
                    {
                       $pk=$rowpklr->totpk;
                       $pk_u=$rowpklr->totpk_u;
                    }
                  $netto=$pm - $pk;
                  $net=number_format($netto,"2",",",".");
                  $netto_u=$pm_u - $pk_u;
                  $net_u=number_format($netto_u,"2",",",".");
                  $netto_s=$netto_u - $netto;
                  if ($netto_s < 0){
                    	$x1="("; $netto_s=$netto_s*-1; $y1=")";}
                    else {
                    	$x1=""; $y1="";}
                    $netto_selisih = number_format($netto_s,"2",",",".");
                    $perpnet   = ($netto_s!=0)?($netto_s / $netto ) * 100:0; 
                    $persennet= number_format($perpnet,"2",",",".");                   
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\">Pembiayaan Netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$net</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$net_u</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"right\">$x1$netto_selisih$y1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"3%\" align=\"right\">$persennet</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"18%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"2%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"right\"></td></tr>";
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
        $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
    
 //   <thead>                       
//                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
//                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
//                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
//                     </thead>
//                     <tfoot>
//                        <tr>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>
//                            <td style=\"border-top: none;\"></td>                           
//                         </tr>
//                     </tfoot>
//    

	
		function _mpdf($judul='',$isi='',$lMargin='',$rMargin='',$font=10,$orientasi='',$hal='',$tab='',$jdlsave='',$tMargin='') {
                

        ini_set("memory_limit","-1");
        $this->load->library('mpdf');
		//$this->mpdf->SetHeader('||Halaman {PAGENO} /{nb}');
        
        
        $this->mpdf->defaultheaderfontsize = 6;	/* in pts */
        $this->mpdf->defaultheaderfontstyle = BI;	/* blank, B, I, or BI */
        $this->mpdf->defaultheaderline = 1; 	/* 1 to include line below header/above footer */

        $this->mpdf->defaultfooterfontsize = 1;	/* in pts */
        $this->mpdf->defaultfooterfontstyle = blank;	/* blank, B, I, or BI */
        $this->mpdf->defaultfooterline = 0; 
		$sa=1;
		$tes=0;
		if ($hal==''){
		$hal1=1;
		} 
		if($hal!==''){
		$hal1=$hal;
		}
		
        if ($tMargin=='' ){
            $tMargin=16;
        }
        
        if($lMargin==''){
            $lMargin=15;
        }

        if($rMargin==''){
            $rMargin=15;
        }
        
        
        $this->mpdf = new mPDF('utf-8', array(215,330),$size,'',$lMargin,$rMargin,$tMargin); //folio
        
        $mpdf->cacheTables = true;
		$mpdf->packTableData=true;
		$mpdf->simpleTables=true;
		$this->mpdf->AddPage($orientasi,'',$hal1,'1','off');
		if (!empty($tab)) $this->mpdf->SetTitle($tab); 
        if ($hal != 'no'){
            $this->mpdf->SetFooter("Halaman {PAGENO}  ");
        }
        if (!empty($judul)) $this->mpdf->writeHTML($judul);
		//$this->mpdf->simpleTables= true;     
        $this->mpdf->writeHTML($isi);         
        //$this->mpdf->Output('');
		$this->mpdf->Output('');
    }
    
     function cari0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0','rka0',$lccr); 
	}
    function caridpa0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 0','dpa0',$lccr); 
	}
    function caridppa0()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 0','dppa0',$lccr); 
	}
     function caridppa0pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 0','dppa0pkd',$lccr); 
	}
    function cari1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1','rka1',$lccr); 
	}
    function caridpa1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 1','dpa1',$lccr); 
	}
    function caridppa1()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 1','dppa1',$lccr); 
	}
    function caridppa1pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 1','dppa1pkd',$lccr); 
	}
    function cari21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21','rka21',$lccr); 
	}
    function caridpa21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 21','dpa21',$lccr); 
	}    
    function caridppa21()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 21','dppa21',$lccr); 
	}
    function caridppa21pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA PPKD 21','dppa21pkd',$lccr); 
	}
    function caridppa22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 22','dppa22',$lccr); 
	}
    function caridppa221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221','dppa221',$lccr); 
	}
    function cari0pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 0 PPKD','rka0pkd',$lccr); 
	}
    function cari1pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 1 PPKD','rka1pkd',$lccr); 
	}
    function cari21pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 21 PPKD','rka21pkd',$lccr); 
	}
    function cari22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 22','rka22',$lccr); 
	}
    function caridpa22()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPA 22','dpa22',$lccr); 
	}
    function cari221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221',$lccr); 
	}
    function caridpa221()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 221','rka221',$lccr); 
	}
    function cari31()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 31 PPKD','rka31',$lccr); 
	}
    function cari31pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 31 PPKD','dppa31',$lccr); 
	}
    function cari32()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','RKA 32 PPKD','rka32',$lccr); 
	}
    function cari32pkd()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 32 PPKD','dppa32',$lccr); 
	}
	
    function cari_perda1()
	{
		$lccr = $this->input->post('nm_org');
        $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN I','perda_1',$lccr); 
	}
	
	 function cari_perda_II()
	{
		$lccr = $this->input->post('nm_org');
        $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN II','perda_II',$lccr); 

	}
	
    function cari_perdaIII()
	{
		$lccr = $this->input->post('nm_org');
        $this->index('0','ms_organisasi','kd_org','nm_org','PERDA APBD LAMPIRAN III','perda_III',$lccr); 

	}	

 function cari_perdaunitIII()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perdaunit_III',$lccr); 
	}
	
    function cari_perkadaII()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_II',$lccr); 
	}
    
    function cari_perkada_ubah()
	{
		$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN II','perkada_ubah',$lccr); 
	}
    
    function cari_perda1_ubah()
	{
	$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN I','perda1_ubah',$lccr); 
	}
    
    function cari_perdaIII_ubah()
	{
	$lccr = $this->input->post('nm_skpd');
        $this->index('0','ms_skpd','kd_skpd','nm_skpd','PERDA APBD PERUBAHAN LAMPIRAN III','perdaIII_ubah',$lccr); 
	}
    


  	function tambah_rka()
	{
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PENYUSUNAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka',$data) ; 
        $query1->free_result();
   }

   
  	function tambah_rka_ubah()
	{
		 $jk=$this->rka_model->combo_skpd();
         $ry=$this->rka_model->combo_giat();
        $cRet='';
        
         $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PERUBAHAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
         $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN PERUBAHAN';
        $this->template->set('title', 'INPUT RKA PERUBAHAN');   
        $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                        'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'nilai_ubah' => $resulte['nilai_ubah']                          
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka_ubah',$data) ; 
   }


   function select_rka($kegiatan='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_sempurna,a.nilai_ubah,a.sumber,a.sumber2,a.sumber3,a.sumber4 from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
                        'nilai_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),                             
                        'sdana' => $resulte['sumber'],
						'sumber' => $resulte['sumber'],
						'sumber2' => $resulte['sumber2'],
						'sumber3' => $resulte['sumber3'],
						'sumber4' => $resulte['sumber4']
                        );
                        $ii++;
        }
           
           echo json_encode($result);
            $query1->free_result();
    }


   function select_rka_ubah($kegiatan='') {

		$sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah,sumber from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai']),
                        'nilai_ubah' => number_format($resulte['nilai_ubah']),                             
                        'sdana' => $resulte['sumber']  
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }

	   
   function select_rincian() {
        $sql = "select uraian,volume1 from trdpo ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'uraian' => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


	function ld_rek($giat='',$rek='') {
        if ($rek==''){
            $dan='';
        }else{
            $dan="and a.kd_rek5='$rek'";
        }
        $sql = " SELECT kd_rek5,nm_rek5 FROM (SELECT kd_rek5,nm_rek5 FROM ms_rek5 WHERE kd_rek5 NOT IN (SELECT kd_rek5 FROM trdrka WHERE kd_kegiatan='$giat'  ) AND
				 (kd_rek5 LIKE '4%' OR kd_rek5 LIKE '5%' OR kd_rek5 LIKE '6%'))a,
				 (SELECT @kd:=b.jns_kegiatan, @pj:=len(b.jns_kegiatan) FROM trskpd a INNER JOIN m_giat b ON 
				 a.kd_kegiatan1=b.kd_kegiatan WHERE a.kd_kegiatan='$giat' )t 
				 WHERE LEFT(a.kd_rek5,@pj)=@kd $dan ORDER BY a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	} 
    
    function ld_harga($rek='') {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ="where kd_rek5='$rek'";
        if ($kriteria <> ''){                               
            $where="where kd_rek5='$rek' and (upper(uraian) like upper('%$kriteria%') or kd_harga like'%$kriteria%')";            
        }
             
        $sql = "SELECT count(*) as tot from ms_harga $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        
        
        $sql = "SELECT * from ms_harga $where order by kd_rek5 limit $offset,$rows";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'kd_harga' => $resulte['kd_harga'],
                        'kd_rek5' => $resulte['kd_rek5'],
                        'uraian' => $resulte['uraian'],
                        'satuan' => $resulte['satuan'],  
                        'harga' => $resulte['harga'],
                        'harga1' => number_format($resulte['harga'])                                                                                  
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);
    	   
	}
     
    function rek($giat='') {
    
        $sql = " SELECT kd_rek5,nm_rek5 FROM ms_rek5 order by kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	   
	function ld_sdana() {
    
           
		$result[] = array('sdana' => 'PAD');
		$result[] = array('sdana' => 'DAK');
		$result[] = array('sdana' => 'DAU');
		$result[] = array('sdana' => 'Bagi Hasil Pajak');
		$result[] = array('sdana' => 'Lain-Lain');
                       
           
        echo json_encode($result);
    	   
	} 


   function tsimpan($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0,$sdana='') {
       
		if (trim($reklama)==''){
			$reklama=$rekbaru;
		}

		$nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
		$nmgiat=$this->rka_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan');
		$nmrek5=$this->rka_model->get_nama($rekbaru,'nm_rek5','ms_rek5','kd_rek5');

		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
		$query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah,sumber,nm_skpd,nm_rek5,nm_kegiatan) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai,'$sdana','$nmskpd','$nmrek5','$nmgiat') ");	
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TK_MAS=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TU_MAS='Dana' where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	

		$this->select_rka($kegiatan);
    }
 
    function tsimpan_ubah($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0,$nilai_ubah=0,$sdana='') {
       
		if (trim($reklama)==''){
			$reklama=$rekbaru;
		}
		$nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
		$nmgiat=$this->rka_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan');
		$nmrek5=$this->rka_model->get_nama($rekbaru,'nm_rek5','ms_rek5','kd_rek5');

		$sdana=str_replace('%20',' ',$sdana);
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
		$query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah,sumber,nm_skpd,nm_rek5,nm_kegiatan) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai_ubah,'$sdana','$nmskpd','$nmrek5','$nmgiat') ");
		$query = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TK_MAS_UBAH=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TU_MAS_UBAH='Dana' where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	

		$this->select_rka_ubah($kegiatan);
    }

    function tsimpan_rinci(){

        $skpd    = $this->input->post('skpd');
        $kegiatan    = $this->input->post('giat');
        $rekening    = $this->input->post('rek');
        $index    = $this->input->post('id');
        $uraian    = $this->input->post('uraian');
        $volume1    = $this->input->post('volum1');
        $satuan1    = $this->input->post('satuan1');
        $harga1    = $this->input->post('harga1');
        $volume2    = $this->input->post('volum2');
        $satuan2    = $this->input->post('satuan2');
        $volume3    = $this->input->post('volum3');
        $satuan3    = $this->input->post('satuan3');
        
		$satuan1 = str_replace("12345678987654321","",$satuan1);
		$satuan1 = str_replace("undefined","",$satuan1);

		$satuan2 = str_replace("12345678987654321","",$satuan2);
		$satuan2 = str_replace("undefined","",$satuan2);

		$satuan3 = str_replace("12345678987654321","",$satuan3);
		$satuan3 = str_replace("undefined","",$satuan3);

		$uraian = str_replace("%20"," ",$uraian);
		$uraian = str_replace("%60"," ",$uraian);

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $vol1=$volume1;
        $vol2=$volume2;
        $vol3=$volume3;
        if($volume1==0){$volume1=1;$vol1='';}
        if($volume2==0){$volume2=1;$vol2='';}
        if($volume3==0){$volume3=1;$vol3='';}
		
		$total	 = $volume1*$volume2*$volume3*$harga1;

		$query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
		$query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3) 
									 values('$index','$norka','$uraian','$vol1','$satuan1',$harga1,$total,'$vol1','$satuan1',$harga1,$total,'$vol2','$satuan2','$vol2','$satuan2','$vol3','$satuan3','$vol3','$satuan3') ");  
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rekening);
	}

  function thapus_rinci_ar_all(){
        $norka = $this->input->post('vnorka');
        $query = $this->db->query("delete from trdpo where no_trdrka='$norka'");
 
        if ( $query > 0 ){
            echo '1' ;
        } else {
            echo '0' ;
        }
    }
	
// tambah rka penyempurnaan
  	function tambah_rka_sempurna(){
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ANGGARAN PENYEMPURNAAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT RKA PENYEMPURNAAN');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => $resulte['nilai'] ,
                        'total' => $resulte['total']                            
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_rka_sempurna',$data) ; 
        $query1->free_result();
   }
 
	function get_realisasi($cskpd=''){

       $query1 = $this->db->query("select total=trans+nsp2d  from(select '1' [no],isnull(sum(b.nilai),0) [trans] from trhtransout a join trdtransout b 
                                    on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd where b.kd_skpd='$cskpd' and b.no_bukti not in 
                                    (select c.no_bukti from trlpj c join trhspp d on c.no_lpj=d.no_lpj and c.kd_skpd=d.kd_skpd
                                    where c.kd_skpd='$cskpd' and (sp2d_batal<>'1' or sp2d_batal is null )) and  a.jns_spp='1' 
                                    ) as f join (
                                    select '1'[no],isnull(sum(c.nilai),0) [nsp2d] from trhspp b 
									join trdspp c on c.no_spp=b.no_spp where (sp2d_batal<>'1' or sp2d_batal is null ) and c.kd_skpd='$cskpd') g on f.no=g.no");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['total'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
		   echo json_encode($result);
           $query1->free_result();	
    }
 	function get_realisasi_keg($cskpd=''){
		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

       $query1 = $this->db->query("select total=trans+nsp2d  from(select '1' [no],isnull(sum(b.nilai),0) [trans] from trhtransout a join trdtransout b 
                                    on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd  where b.kd_skpd='$kdskpd' and b.no_bukti not in 
                                    (select c.no_bukti from trlpj c join trhspp d on c.no_lpj=d.no_lpj and c.kd_skpd=d.kd_skpd
                                      where c.kd_kegiatan='$kegiatan' and (sp2d_batal<>'1' or sp2d_batal is null )) and  a.jns_spp='1' 
                                    and b.kd_kegiatan='$kegiatan') as f join (
                                    select '1'[no],isnull(sum(c.nilai),0) [nsp2d] from trhspp b 
									join trdspp c on c.no_spp=b.no_spp where (sp2d_batal<>'1' or sp2d_batal is null ) and c.kd_skpd='$kdskpd' and c.kd_kegiatan='$kegiatan') g on f.no=g.no");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['total'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
		   echo json_encode($result);
           $query1->free_result();	
    }


	function get_realisasi_rek($cskpd=''){
		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
        $rek5 = $this->input->post('rek5');
        
        $query1 = $this->db->query("select total=trans+nsp2d  from(select '1' [no],isnull(sum(b.nilai),0) [trans] from trhtransout a join trdtransout b 
                                    on a.no_bukti=b.no_bukti and a.kd_skpd=b.kd_skpd  where b.kd_skpd='$kdskpd' and b.no_bukti not in 
                                    (select c.no_bukti from trlpj c join trhspp d on c.no_lpj=d.no_lpj and c.kd_skpd=d.kd_skpd
                                    where c.kd_kegiatan='$kegiatan'and c.kd_rek5='$rek5' and (sp2d_batal<>'1' or sp2d_batal is null )) and  a.jns_spp='1' 
                                    and b.kd_kegiatan='$kegiatan' and b.kd_rek5='$rek5' ) as f join (
                                   select '1'[no],isnull(sum(c.nilai),0) [nsp2d] from trhspp b 
								   join trdspp c on c.no_spp=b.no_spp where (sp2d_batal<>'1' or sp2d_batal is null ) and c.kd_skpd='$kdskpd' and c.kd_kegiatan='$kegiatan' and c.kd_rek5='$rek5' ) g on f.no=g.no");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['total'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
		   echo json_encode($result);
           $query1->free_result();	
    }


 
       function tsimpan_sempurna(){
        
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = rtrim($this->input->post('dana1'));
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
        $id         =  $this->session->userdata('pcNama');        
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
        $query_find = $this->db->query("select * from trdrka where kd_skpd='$kdskpd' and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek'");
        $update = $query_find->num_rows();
        if($update > 0){
            $query_ins = $this->db->query("update trdrka set nilai_sempurna='$nilai',username='$id',last_update=getdate() where kd_skpd='$kdskpd' and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek'
                                           update trdrka set sumber='$sdana1' where kd_skpd='$kdskpd' and kd_kegiatan='$kdkegi'");        
        }else{
            $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,sumber,sumber2,sumber3,sumber4,username,last_update) 
            values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek',0,'$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4','$id',getdate())");        
        }
        
        
        if ( $query_ins > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }


  function cek_kas_sempurna(){
        
        $skpd     = $this->input->post('skpd');
        $kegiatan = $this->input->post('kegiatan');
        
        $result   = array();
        $query    = $this->db->query("select * from trdskpd_sempurna where kd_skpd='$skpd' and kd_kegiatan='$kegiatan'");
        //$query    = $this->db->query("select * from trdskpd where kd_skpd='1.03.01.00' and kd_kegiatan='1.03.1.03.01.00.18.04' ");
        $ii       = 0;
        
        foreach ( $query->result_array() as $row ){
            
            $result[] = array(
                'id'    =>  '$ii',
                'bulan' =>  $row['bulan'],
                'nilai' =>  $row['nilai']
            );
            $ii++;
        }
        echo json_encode($result);
    }
 
    
    	function load_sum_rek_rinci_sempurna(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total_sempurna) as rektotal_rinci from trdpo where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",",")             
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}

    function cek_nopo_sempurna($norka='',$cpo){
        $query_find = $this->db->query("select * from trdpo where no_trdrka='$norka' and no_po='$cpo' and (total<>0)");
        $update = $query_find->num_rows();
        if($update < 1){
            $result = '0';
        }else{
            $result = '1';
        }
        echo json_encode($result);
    }
    
   
  
     function tsimpan_rinci_jk_sempurna(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
        $id         =  $this->session->userdata('pcNama');
		$sql       = "delete from trdpo where  no_trdrka='$norka'";
		$asg       = $this->db->query($sql);
        	
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdpo(no_po,header,kode,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,
                            volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,volume_sempurna1,volume_sempurna2,
                            volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,harga_sempurna1,total_sempurna)"; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
	  


		$query1 = $this->db->query("update trdrka set nilai_sempurna= (select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka),
                                    nilai_ubah=(select sum(total_sempurna) as nl from trdpo where no_trdrka=trdrka.no_trdrka)
                                    ,username='$id',last_update=getdate()  where no_trdrka='$norka' ");  
		$query1 = $this->db->query("update trskpd set total_sempurna= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), 
                                    total_ubah= (select sum(nilai_sempurna) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),
                                    username1='$id',last_update=getdate() where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ");	
		$this->rka_rinci($cskpd,$kegiatan,$rekening);
	
    }

   function thapus_sempurna($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka($kegiatan);
    }

    function simpan_det_keg_sempurna(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        
		$this->db->query(" update trskpd set tu_capai_sempurna='$cp_tu',
                                             tu_capai_ubah='$cp_tu', 
											 tu_mas_sempurna='$m_tu',
                                             tu_mas_ubah='$m_tu',			
											 tu_kel_sempurna='$k_tu',
                                             tu_kel_ubah='$k_tu',			
											 tu_has_sempurna='$h_tu',
                                             tu_has_ubah='$h_tu',
											 tk_capai_sempurna='$cp_ck',
                                             tk_capai_ubah='$cp_ck',
											 tk_mas_sempurna='$m_ck',
                                             tk_mas_ubah='$m_ck',
											 tk_kel_sempurna='$k_ck',
                                             tk_kel_ubah='$k_ck',
											 tk_has_sempurna='$h_ck',
                                             tk_has_ubah='$h_ck',
											 lokasi='$lokasi',
											 sasaran_giat='$sasaran',
											 waktu_giat='$wkeg',
											 kd_pptk='$ttd'
		where kd_skpd='$skpd' and kd_kegiatan='$giat'  "); 
	}
    
// end tambah rka penyempurnaan 

	
	  function tsimpan_rinci_ubah($skpd='',$kegiatan='',$rekening='',$index=0,$uraian='',$volume1=0,$satuan1='',$harga=0,$volume_ubah1=0,$satuan_ubah1='',$harga_ubah=0,$volume2=0,$satuan2='',$volume3=0,$satuan3='',$volume_ubah2=0,$satuan_ubah2='',$volume_ubah3=0,$satuan_ubah3=''){

		$satuan1 = str_replace("12345678987654321","",$satuan1);
		$satuan1 = str_replace("undefined","",$satuan1);

		$satuan2 = str_replace("12345678987654321","",$satuan2);
		$satuan2 = str_replace("undefined","",$satuan2);

		$satuan3 = str_replace("12345678987654321","",$satuan3);
		$satuan3 = str_replace("undefined","",$satuan3);

		$satuan_ubah1 = str_replace("12345678987654321","",$satuan_ubah1);
		$satuan_ubah1 = str_replace("undefined","",$satuan_ubah1);

		$satuan_ubah2 = str_replace("12345678987654321","",$satuan_ubah2);
		$satuan_ubah2 = str_replace("undefined","",$satuan_ubah2);

		$satuan_ubah3 = str_replace("12345678987654321","",$satuan_ubah3);
		$satuan_ubah3 = str_replace("undefined","",$satuan_ubah3);

		$uraian = str_replace("%20"," ",$uraian);
		$uraian = str_replace("%60"," ",$uraian);
		

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
		
        if(($volume1==0)or($volume1=='')) $volume1=1;
        if(($volume2==0)or($volume2=='')) $volume2=1;
        if(($volume3==0)or($volume3=='')) $volume3=1;
		
		$total	 = $volume1*$volume2*$volume3*$harga;
		
		
        if(($volume_ubah1==0)or($volume_ubah1=='')) $volume_ubah1=1;
        if(($volume_ubah2==0)or($volume_ubah2=='')) $volume_ubah2=1;
        if(($volume_ubah3==0)or($volume_ubah3=='')) $volume_ubah3=1;
		
		$total_ubah	 = $volume_ubah1*$volume_ubah2*$volume_ubah3*$harga_ubah;
		
		
		$query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
		$query1 = $this->db->query(" insert into trdpo(no_po,kd_kegiatan,kd_rek5,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume3,satuan3,volume_ubah2,satuan_ubah2,volume_ubah3,satuan_ubah3) 
									 values('$index','$kegiatan','$rekening','$norka','$uraian',$volume1,'$satuan1',$harga,$total,$volume_ubah1,'$satuan_ubah1',$harga_ubah,$total_ubah,$volume2,'$satuan2',$volume3,'$satuan3',$volume_ubah2,'$satuan_ubah2',$volume_ubah3,'$satuan_ubah3') ");  
		$query1 = $this->db->query(" update trdrka set nilai_ubah=(select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci_ubah($skpd,$kegiatan,$rekening);
	}

   function thapus($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka($kegiatan);
    }


	
//alokasi dana	
   function thapus_alokasidana($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdalokasi where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka($kegiatan);
    }
	
	function thapus_alokasi_all(){
        $norka = $this->input->post('vnorka');
        $query = $this->db->query("delete from trdalokasi where no_trdrka='$norka'");
		$query1 = $this->db->query("update trdrka set nilai=0 where no_trdrka='$norka'");
        if ( $query > 0 and $query1 > 0){
            echo '1' ;
        } else {
            echo '0' ;
        }
		
		
    }

	function tsimpan_alokasidanarinci_jk(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
                               
		$sql       = "delete from trdalokasi where  no_trdrka='$norka'";
		$asg       = $this->db->query($sql);
        	
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdalokasi(no_urut,no_trdrka,penerima,alamat,total,cad1,username,lastupdate) "; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
	  
		$query1 = $this->db->query(" update trdrka set nilai= (select isnull(sum(total),0) from trdalokasi where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$this->rka_rinci($skpd,$kegiatan,$rekening);	
    }	

	function alokasidana_rinci($skpd='',$kegiatan='',$rekening='') {
        $norka = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql = "select * from trdalokasi where no_trdrka='$norka' order by no_urut ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                            'id' => $ii,        
                            'no_urut' => $resulte['no_urut'],
                            'penerima' => $resulte['penerima'],
                            'alamat' => $resulte['alamat'],  
                            'cad1' => $resulte['cad1'],
                            'username' => $resulte['username'],
                            'lastupdate' => $resulte['lastupdate'],						
                            'total' => number_format($resulte['total'],"2",".",","),
                            'total_sem' => number_format($resulte['total_sempurna'],"2",".",",") 
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
	
	function rka_rinci_alokasi($skpd='',$kegiatan='',$rekening='') {
        $norka = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql = "select * from trdalokasi where no_trdrka='$norka' order by no_urut";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_urut' => $resulte['no_urut'],  
                        'penerima' => $resulte['penerima'],
						'alamat' => $resulte['alamat'],
						'cad1' => $resulte['cad1'],						
                        'total' => number_format($resulte['total'],"2",".",","),
                        'total_sem' => number_format($resulte['total_sempurna'],"2",".",",")                                 
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


	function load_sum_rek_alokasidana_rinci(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select isnull(sum(total),0) as rektotal_rinci,isnull(sum(total_sempurna),0) as rektotal_rinci_sem from trdalokasi where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),
                        'rektotal_rinci_sem' => number_format($resulte['rektotal_rinci_sem'],"2",".",",")                           
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
	
 	function tambah_alokasidana()
	{
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ALOKASI DANA PENYUSUNAN$jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT KEGIATAN ALOKASI DANA';
        $this->template->set('title', 'INPUT RKA ALOKASI DANA');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",",") ,
                        'total' => number_format($resulte['total'],"2",".",",")                          
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_alokasidana',$data) ; 
        $query1->free_result();
   }

	
//end alokasi dana
//alokasi dana sempurna
 	function tambah_alokasidana_sempurna()
	{
		$jk   = $this->rka_model->combo_skpd();
        $ry   =  $this->rka_model->combo_giat();
        $cRet = '';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\" >
                   <tr >                       
                        <td>INPUT ALOKASI DANA PENYEMPURNAAN $jk</td>
                        <td>$ry</td>
                        </tr>
                  ";
         
        $cRet .="</table>";
        $data['prev']= $cRet;
        $data['page_title']= 'INPUT KEGIATAN ALOKASI DANA';
        $this->template->set('title', 'INPUT RKA ALOKASI DANA');   
         $sql = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai as total from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5";                   
        
        $query1 = $this->db->query($sql);  
        $results = array();
        $i = 1;
        foreach($query1->result_array() as $resulte)
        { 
            $results[] = array(
                       'id' => $i,
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",",") ,
                        'total' => number_format($resulte['total'],"2",".",",")                          
                        );
                        $i++;
        }
        $this->template->load('template','anggaran/rka/tambah_alokasidana_sempurna',$data) ; 
        $query1->free_result();
   }

	function tsimpan_alokasidanarinci_sem_jk(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
                               
		$sql       = "delete from trdalokasi where  no_trdrka='$norka'";
		$asg       = $this->db->query($sql);
        	
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdalokasi(no_urut,no_trdrka,penerima,alamat,total,total_sempurna,cad1,username,lastupdate) "; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
	  
		$query1 = $this->db->query(" update trdrka set nilai_sempurna= (select isnull(sum(total_sempurna),0) from trdalokasi where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$this->rka_rinci($skpd,$kegiatan,$rekening);	
    }


	function get_realisasi_rek_alokasi($cskpd=''){
		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
        $rek5 = $this->input->post('rek5');
        
        $query1 = $this->db->query("select '1'[no],isnull(sum(c.nilai),0) [total] from trhsp2d a join trhspm b on a.no_spm=b.no_spm
                                    join trdspp c on c.no_spp=b.no_spp where c.kd_skpd='$kdskpd' and c.kd_kegiatan='$kegiatan' and c.kd_rek5='$rek5'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                            'id' => $ii,        
                            'nrealisasi' => number_format($resulte['total'],2,'.',',')                                              
                        );
                        $ii++;
        }
       
		   echo json_encode($result);
           $query1->free_result();	
    }
//end alokasi dana sempurna
//Peraturan Gubernur 
//Lamp 1
function ctk_perkadaI(){	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','RINGKASAN PENJABARAN APBD','ctk_perkadaI','');
	}

    function preview_perkadaI(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $tgl= $_REQUEST['tgl_ttd'];
        $tanggal = $this->tanggal_format_indonesia($tgl);
        $ttd2= $_REQUEST['ttd2'];
        $chkrancang = $this->uri->segment(5);
        $uppkd = '1.20.12.02';
        $sppkd = '1.20.12';
        
        if ($chkrancang==1){
            $rancang = 'Rancangan';
        }else{
            $rancang = '';
        }
        
        if ($id!='all'){
            if (strlen($id)==7){
                $a = 'left(';
                $skpd = 'kd_skpd';
                $b = ',7)';
    
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
                
            }else{
                $a = 'left(';;
                $skpd = 'kd_skpd';
                $b = ',10)';
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            }
      
          
                $sqlskpd=$this->db->query($sqldns);
                foreach ($sqlskpd->result() as $rowdns)
                    {
                       
                        $kd_urusan=$rowdns->kd_u;                    
                        $nm_urusan= $rowdns->nm_u;
                        $kd_skpd  = $rowdns->kd_sk;
                        $nm_skpd  = $rowdns->nm_sk;
                    }
        
        }
        
        if ($id!='all'){
            $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
        }else{
            $sqldns="SELECT * from ms_urusan1";
        }
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
      
      if ($ttd2<>''){  
      $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'. $rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       }else{
                     
                    $nip2='' ;
                    
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';       
       } 
       
       if ($nip2='1'){
        $nip2='';
       } 
       
               $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
        
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none; text-transform:uppercase;border-bottom: none;border-left: none;\" >RINGKASAN $rancang PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    

        if ($id != 'all'){         
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td width=\"25%\"><strong>Urusan Pemerintahan</stong></td>
                            <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                        </tr>
                        <tr>
                            <td width=\"25%\"><strong>Bidang Pemerintahan</stong></td>
                            <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                        </tr>
                        <tr>
                            <td><strong>Unit Organisasi</stong></td>
                            <td><strong>$kd_skpd - $nm_skpd</stong></td>
                        </tr>
                    </table>";
        }
        
        $cRet .= "<table style=\"border-collapse:collapse; border-top: solid 1px black;\"  width=\"100%\" align=\"center\" border=\"1\"  cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"1\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Nomor Urut</b></td>                            
                            <td rowspan=\"1\" bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"1\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\">3</td>
                        </tr>
                       
                    	<tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"3\"><i>Lampiran I : PerGub Prov.Kalimantan Barat - Ringkasan $rancang Penyusunan APBD TA $thn</i></td>

                         </tr>
                     </tfoot>   
                       
                        ";

            if ($id != 'all'){
                        $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4'  and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }else{
                       $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                    
                 }
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                
                $totp = 0;                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;   
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   if (strlen($coba1)>3) {
                        
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   } else {
				        if (strlen($coba1)=='1'){
				            $totp = $totp + $row->nilai;
				        }
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   }
                }

                   $coba4=number_format($totp,"2",",",".");
                    $cob1=$totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba4</td></tr>";
                 
                 
                 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
				if ($id != 'all'){					 
                        $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
        					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
        					   UNION ALL 
                               SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                               ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                               UNION ALL 
                               SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                               ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }else{
                     $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
        					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'   GROUP BY a.kd_rek1,a.lra, a.nm_rek1
        					   UNION ALL 
                               SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                               ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5'  GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                               UNION ALL 
                               SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                               ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }
                 
                $totb = 0;
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                    if (strlen($coba5)==1){
                        $totb = $totb + $row1->nilai;
                    }
                    
                    if (strlen($coba5)>3) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
					} else {
					$cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";

					}
                }
                
                   $coba8=number_format($totb,"2",",",".");
                    $cob=$totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
				 
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,"2",",",".");  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">SURPLUS(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
					                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
 
				
                $cob3 = 0;
                $cob4 = 0;
                if ($id == $this->ppkd or $id == $this->ppkd1 or $id == 'all' ){
                    if ($id != 'all'){					 
                        $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,0 AS nilai FROM ms_rek1 a INNER JOIN trdrka b
    							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                                UNION ALL 
                                SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                     }else{
                        $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,0 AS nilai FROM ms_rek1 a INNER JOIN trdrka b
    							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                                UNION ALL 
                                SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                        
                     }
                     $query3 = $this->db->query($sql3);
                     //$query = $this->skpd_model->getAllc();
     
    
                  
                    $totpm = 0;                                  
                    foreach ($query3->result() as $row3)
                    {
                        $coba9=$row3->rek;
                        $coba10=$row3->nm_rek;
                        $coba11= number_format($row3->nilai,"2",",",".");
                        
                        if (strlen($coba9)==3){
                            $totpm = $totpm + $row3->nilai;
                        }
                        
                        if (strlen($coba9)==1){
                            $coba11 = '';    
                        }
                        
                        if (strlen($coba9)>3) {
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
    					} else {
    						 $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                         <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                         <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
    					}
                    }
    
                       $coba12=number_format($totpm,"2",",",".");
                        $cob3=$totpm;
                       
                       if ($id==$uppkd or $id==$sppkd or $id='all') {
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
    					}
                        
       				                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
    
                     if ($id != 'all'){   				 
                         $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                     }else{
                         $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                    
                     }
                     $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    
                    $totpk = 0;
                                                      
                    foreach ($query4->result() as $row4)
                    {
                        $coba13=$row4->rek;
                        $coba14=$row4->nm_rek;
                        $coba15= number_format($row4->nilai,"2",",",".");
                       if (strlen($coba13)==3) {
                            $totpk = $totpk + $row4->nilai;
                            $c =$coba13;
                        }else{$c='';}
                       
                       if (strlen($coba13)>3) {
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
    				   } else {
    					   $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                         <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                         <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>"; 
    				   }
                    }
    									 
                       $coba16=number_format($totpk,"2",",",".");
                        $cob4=$totpk;
                       
                       if($id==$uppkd or $id==$sppkd or $id='all'){
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN $c</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
    				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                      }
                      
                      $netto=$cob3-$cob4; 
    					$netto_ag=$netto*-1;
                      if ($netto < 0){
                    	$a1="(";
                    	$suplus=$netto*-1;
                    	$b1=")";}
                      else {
                    	$a1="";
    	                $b1="";}
                     $nett=number_format($netto_ag,2,",",".");  
                     
    
                     if ($id==$uppkd or $id==$sppkd or $id='all'){      
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">PEMBIAYAAN NETTO </td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";
                    }
                    
              }      
                    
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
    					 $silpa=($cob1+$cob3)-($cob+$cob4);
                         if ($silpa < 0){
                    	$c1="(";
                    	$silpa=$silpa*-1;
                    	$d1=")";}
                        else {
                    	$c1="";
    	                $d1="";}
                     $silp=number_format($silpa,2,",",".");                  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">3.3</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";

                
                
                        $cRet .="
                                    <tr>                                    
                                    <td colspan=\"3\" width=\"100\"  >							
								        <table border=\"0\" align=\"right\" >   
                                            <tr>								
                                                <td width=\"40%\"></td>
								                <td width=\"50%\" align=\"center\">&nbsp;$daerah, $tanggal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								                    <br>$jabatan2,
                                                    <p>&nbsp;</p>
                                                    <br><b>$nama2</b>
                				                    <br>$pangkat2 
                				                    <br>$nip2 
								                </td>
                                                <td width=\"10%\"></td>
                                            </tr>
                                        </table>  
                                    </td>
                             </tr>
                             
 
                             " ;          
  
       
        
            
        $cRet    .= "</table>";
 
 
        $data['prev']= $cRet;    
        switch($cetak) {
            case 0;  
                echo ("<title>RINGKASAN PENJABARAN APBD</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,10,10,'0');
            break;
        }
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }


	
function load_ttd_gub() {
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%')) and kode='PPKD' and nip='1'";   

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
//end LampI
//End PERATURAN Gubernur


    function thapus_ubah($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total_ubah=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka_ubah($kegiatan);
    }

    function thapus_rinci($skpd='',$kegiatan='',$rek,$index=0) {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query  = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' and no_po='$index' ");
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trdrka set nilai_ubah= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rek);
    }
	
    function thapus_rinci_ubah($skpd='',$kegiatan='',$rek,$index=0) {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query  = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' and no_po='$index' ");
		$query1 = $this->db->query(" update trdrka set nilai_ubah= (select sum(total_ubah) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$notrdrka' ");  
		$query1 = $this->db->query(" update trskpd set total_ubah=( select sum(nilai_ubah) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci_ubah($skpd,$kegiatan,$rek);
    }

	function rka_rinci($skpd='',$kegiatan='',$rekening='') {
        
        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql    = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;

        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id'      => $ii,   
                        'header'  => $resulte['header'],  
                        'kode'    => $resulte['kode'],  
                        'no_po'   => $resulte['no_po'],  
                        'uraian'  => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],  
                        'volume2' => $resulte['volume2'],  
                        'volume3' => $resulte['volume3'],  
                        'satuan1' => $resulte['satuan1'],  
                        'satuan2' => $resulte['satuan2'],  
                        'satuan3' => $resulte['satuan3'],
                        'volume'  => $resulte['tvolume'],  
                        'harga1'  => number_format($resulte['harga1'],"2",".",","),  
                        'hargap'  => number_format($resulte['harga1'],"2",".",","),                             
                        'harga2'  => number_format($resulte['harga2'],"2",".",","),                             
                        'harga3'  => number_format($resulte['harga3'],"2",".",","),
                        'totalp'  => number_format($resulte['total'],"2",".",",") ,                            
                        'total'   => number_format($resulte['total'],"2",".",","),
                        'volume_sempurna1' => $resulte['volume_sempurna1'],
                        'tvolume_sempurna' => $resulte['tvolume_sempurna'],                            
                        'satuan_sempurna1' => $resulte['satuan_sempurna1'],
                        'harga_sempurna1'  => number_format($resulte['harga_sempurna1'],"2",".",","),
                        'total_sempurna'  => number_format($resulte['total_sempurna'],"2",".",",")
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }



	
	function rka_rinci_ubah($skpd='',$kegiatan='',$rekening='') {
        $norka = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_po' => $resulte['no_po'],  
                        'uraian' => $resulte['uraian'],  
                        'volume1' => number_format($resulte['volume1']),  
                        'satuan1' => $resulte['satuan1'],  
                        'volume2' => number_format($resulte['volume2']),  
                        'satuan2' => $resulte['satuan2'],  
                        'volume3' => number_format($resulte['volume3']),  
                        'satuan3' => $resulte['satuan3'],  
                        'harga1' => number_format($resulte['harga1']),                             
                        'total' => number_format($resulte['total']),                             
                        'volume_ubah1' => number_format($resulte['volume_ubah1']),  
                        'satuan_ubah1' => $resulte['satuan_ubah1'],  
                        'volume_ubah2' => number_format($resulte['volume_ubah2']),  
                        'satuan_ubah2' => $resulte['satuan_ubah2'],  
                        'volume_ubah3' => number_format($resulte['volume_ubah3']),  
                        'satuan_ubah4' => $resulte['satuan_ubah3'],  
                        'harga_ubah1' => number_format($resulte['harga_ubah1']),                             
                        'total_ubah' => number_format($resulte['total_ubah'])                             
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
	 
	 


	function rka_hukum($skpd='',$kegiatan='',$kd_rek5) {

		$sql = " SELECT *,(SELECT dhukum FROM d_hukum WHERE kd_skpd='$skpd' AND kd_kegiatan='$kegiatan' AND kd_rek5='$kd_rek5' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }


	function rka_hukum_ubah($skpd='',$kegiatan='') {

		$sql = " SELECT *,(SELECT dhukum FROM d_hukum_ubah WHERE kd_skpd='$skpd' AND kd_kegiatan='$kegiatan' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }	


	
	function load_sum_rek(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select sum(nilai) as rektotal,sum(nilai_sempurna) as rektotal_sempurna,sum(nilai_ubah) as rektotal_ubah from trdrka where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_sempurna' => number_format($resulte['rektotal_sempurna'],"2",".",","),
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}

	
    function load_bendahara_p(){

		$kdskpd = $this->input->post('kode');
	
        $query1 = $this->db->query(" select nip,nama from ms_ttd where kd_skpd='$kdskpd' AND kode='BK' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
		
    function load_ppkd(){
	
        $query1 = $this->db->query(" select nip,nama,jabatan,pangkat from ms_ttd where kode='PPKD' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],						
                        'jabatan' => $resulte['jabatan'],
                        'pangkat' => $resulte['pangkat']
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
 
		
    function load_bendahara_ppkd(){
	
        $query1 = $this->db->query(" select nip,nama,jabatan,pangkat from ms_ttd where kode='PPKD' and bidang='1'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip_ppkd' => $resulte['nip'],  
                        'nama_ppkd' => $resulte['nama'],						
                        'jabatan_ppkd' => $resulte['jabatan'],
                        'pangkat_ppkd' => $resulte['pangkat']
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}

	function load_sum_rek_rinci(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total) as rektotal_rinci,sum(total_ubah) as rektotal_rinci_ubah from trdpo where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),  
                        'rektotal_rinci_ubah' => number_format($resulte['rektotal_rinci_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
	

	function load_det_keg(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai'],
                        'm_tu' => $resulte['tu_mas'],
                        'k_tu' => $resulte['tu_kel'],
                        'h_tu' => $resulte['tu_has'],
                        'cp_ck' => $resulte['tk_capai'],
						'm_ck' => $resulte['tk_mas'],
                        'ang_lalu' => number_format(($resulte['ang_lalu']),"2",".",","),
                        'k_ck' => $resulte['tk_kel'],
                        'h_ck' => $resulte['tk_has']						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}

	function load_det_keg_sempurna(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai_sempurna'],
                        'm_tu' => $resulte['tu_mas_sempurna'],
                        'k_tu' => $resulte['tu_kel_sempurna'],
                        'h_tu' => $resulte['tu_has_sempurna'],
                        'cp_ck' => $resulte['tk_capai_sempurna'],
						'm_ck' => $resulte['tk_mas_sempurna'],
                        'ang_lalu' => number_format(($resulte['ang_lalu']),"2",".",","),
                        'k_ck' => $resulte['tk_kel_sempurna'],
                        'h_ck' => $resulte['tk_has_sempurna']						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}

	
	function load_det_keg_ubah(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['SASARAN_GIAT'],  
                        'wkeg' => $resulte['WAKTU_GIAT'],  
                        'ttd' => $resulte['KD_PPTK'],
                        'cp_tu' => $resulte['TU_CAPAI_UBAH'],
                        'm_tu' => $resulte['TU_MAS_UBAH'],
                        'k_tu' => $resulte['TU_KEL_UBAH'],
                        'h_tu' => $resulte['TU_HAS_UBAH'],
                        'cp_ck' => $resulte['TK_CAPAI_UBAH'],
                        'm_ck' => 'Rp. '.number_format($resulte['TK_MAS_UBAH']),
                        'k_ck' => $resulte['TK_KEL_UBAH'],
                        'h_ck' => $resulte['TK_HAS_UBAH']						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}


    function simpan_det_keg(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        
		$this->db->query(" update trskpd set tu_capai='$cp_tu', 
											 tu_mas='$m_tu',			
											 tu_kel='$k_tu',			
											 tu_has='$h_tu',
											 tk_capai='$cp_ck',
											 tk_mas='$m_ck',
											 tk_kel='$k_ck',
											 tk_has='$h_ck',
											 lokasi='$lokasi',
											 sasaran_giat='$sasaran',
											 waktu_giat='$wkeg',
											 kd_pptk='$ttd'
		where kd_skpd='$skpd' and kd_kegiatan='$giat'  "); 
	}

    function simpan_det_keg_ubah(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        
		$this->db->query(" update trskpd set tu_capai_ubah='$cp_tu', 
											 tu_mas_ubah='$m_tu',			
											 tu_kel_ubah='$k_tu',			
											 tu_has_ubah='$h_tu',
											 tk_capai_ubah='$cp_ck',
											 tk_mas_ubah='$m_ck',
											 tk_kel_ubah='$k_ck',
											 tk_has_ubah='$h_ck',
											 lokasi='$lokasi',
											 sasaran_giat='$sasaran',
											 waktu_giat='$wkeg',
											 kd_pptk='$ttd'
		where kd_skpd='$skpd' and kd_kegiatan='$giat'  "); 
	}

   function simpan_dhukum(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $isi=$this->input->post('cisi');      
        $pecah=explode('||',$isi);
		$pj=count($pecah);

		$this->db->query(" delete from d_hukum where kd_skpd='$skpd' and kd_kegiatan='$giat' "); 		
	
		for($i=0;$i<$pj;$i++){
			if (trim($pecah[$i])!=''){
				$this->db->query(" insert into d_hukum(kd_skpd,kd_kegiatan,dhukum) values('$skpd','$giat','".$pecah[$i]."') "); 		
			}
		}
	}
 
 function simpan_dhukum_ubah(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $isi=$this->input->post('cisi');      
        $pecah=explode('||',$isi);
		$pj=count($pecah);

		$this->db->query(" delete from d_hukum_ubah where kd_skpd='$skpd' and kd_kegiatan='$giat' "); 		
	
		for($i=0;$i<$pj;$i++){
			if (trim($pecah[$i])!=''){
				$this->db->query(" insert into d_hukum_ubah(kd_skpd,kd_kegiatan,dhukum) values('$skpd','$giat','".$pecah[$i]."') "); 		
			}
		}

	}
    
   function pgiat($cskpd='') {
        
        $lccr = $this->input->post('q');
        $sql  = " SELECT a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                 where a.kd_skpd='$cskpd' and ( upper(a.kd_kegiatan) like upper('%$lccr%') or upper(a.nm_kegiatan) like upper('%$lccr%') )";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan']
                        );
                        $ii++;
        }
        echo json_encode($result);
    	   
	}
    
//====================================================================================================================
    
    function urusan() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_urusan,nm_urusan FROM ms_urusan where upper(kd_urusan) like upper('%$lccr%') or upper(nm_urusan) like upper('%$lccr%') ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_urusan' => $resulte['kd_urusan'],  
                        'nm_urusan' => $resulte['nm_urusan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}


   function skpd() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}
	
//$id  = $this->session->userdata('pcUser');
   function skpduser() {
        $lccr = $this->input->post('q');
        $id  = $this->session->userdata('pcUser');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where (upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%')) and 
                kd_skpd IN (SELECT kd_skpd FROM user_bud WHERE user_id='$id') order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}



	function org_skpd() {
        $lccr = $this->input->post('q');
        $sql = "select * from ms_organisasi a inner join (select left(rtrim(kd_skpd),7)kd_org from trdrka group by left(rtrim(kd_skpd),7)) b on a.kd_org = b.kd_org
		where upper(a.kd_org) like upper('%$lccr%') or upper(a.nm_org) like upper('%$lccr%') order by a.kd_org ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_org' => $resulte['kd_org'],  
                        'nm_org' => $resulte['nm_org']

                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}
    
    function giat($cskpd='') {
        
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)=left('$cskpd',4) or left(kd_kegiatan,4)='0.00')";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function kegiatan($cskpd='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_kegiatan,nm_kegiatan FROM m_giat where (left(kd_kegiatan,4)= left('$cskpd',4) or left(kd_kegiatan,4)='0.00') and 
        (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%'))";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function cek($giat='',$skpd=''){
        $sql = "SELECT DISTINCT a.kd_kegiatan1,'1' AS ket FROM trskpd a INNER JOIN trdrka b ON a.kd_kegiatan=b.kd_kegiatan WHERE a.kd_skpd = '$skpd' and a.kd_kegiatan1='$giat'";
        $query1 = $this->db->query($sql);  
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan1'],
                        'ket' => $resulte['ket']
                        );
                        $ii++;
        }
		
        echo json_encode($result);
    	$query1->free_result();   
    }
    
    function tambah_giat()
	{
		$wy=$this->rka_model->combo_urus();
        $jk=$this->rka_model->combo_skpd1();         
        $cRet='';
        
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                   <tr>
                        <td>Kode Urusan</td>
                        <td>:</td>
                        <td>$wy</td>
                        </tr>
                  ";
         
         $cRet .="<tr>
                        <td>Kode SKPD</td>
                        <td>:</td>
                        <td>$jk</td>
                        </tr>
                  </table>";
        $data['prev']= $cRet;
        $data['page_title']= 'PILIH KEGIATAN';
        $this->template->set('title', 'DETAIL KEGIATAN');          
        $this->template->load('template','anggaran/rka/pilih_giat',$data) ; 
        //$this->load->view('anggaran/rka/tambah_rka',$data) ;
   }
   
   function select_giat($skpd='') {    
        $sql = "select a.kd_kegiatan as kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan,a.lanjut from trskpd a inner join m_giat b on b.kd_kegiatan=a.kd_kegiatan1 where a.kd_skpd='$skpd' order by a.kd_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,
                        'kd_kegiatan' => $resulte['kd_kegiatan'],                         
                        'nm_kegiatan' => $resulte['nm_kegiatan'],  
                        'jns_kegiatan' => $resulte['jns_kegiatan'],                           
                        'lanjut' => $resulte['lanjut']                           
                        );
                        $ii++;
        }
        echo json_encode($result);
    }
    
    function ld_giat($skpd='',$urusan='') { 
        $lccr   = $this->input->post('q');
		if ($skpd=='0')
		{
			$sql    = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where (left(kd_kegiatan,4)= '$urusan') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%'))  order by kd_kegiatan ";
	}else{
			$sql    = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where (left(kd_kegiatan,10)= left('$skpd',10) or (left(kd_kegiatan,4)='$urusan' or left(kd_kegiatan,4)='0.00') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) ) order by kd_kegiatan ";	
}
	
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'lanjut' => 'Tidak'

                        );
                        $ii++;
        }
        echo json_encode($result);
	}

    
    function ld_giat_ar() { 
        
        $lccr    = $this->input->post('q');
        $skpd1   = $this->input->post('skpd');
        $urusan1 = $this->input->post('urusan');
        $zzz     = $this->input->post('xxx');
        
        if ( $zzz <> ''){
            $where = " and kd_kegiatan not in ($zzz)";
        } else {
            $where = " ";
        }

        $sql    = "SELECT kd_kegiatan,nm_kegiatan,jns_kegiatan FROM m_giat where (left(kd_kegiatan,4)= left('$skpd1',4) or left(kd_kegiatan,4)= $urusan1 or left(kd_kegiatan,4)='0.00') and (upper(kd_kegiatan) like upper('%$lccr%') or upper(nm_kegiatan) like upper('%$lccr%')) $where order by kd_kegiatan ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id'           => $ii,        
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan'],
                        'lanjut'       => 'Tidak'
                        );
                        $ii++;
        }
        echo json_encode($result);
	}

 
 
 	function ld_lanjut() {
		$result[] = array('lanjut' => 'Ya');
		$result[] = array('lanjut' => 'Tidak');                       
        echo json_encode($result);
	}
   
    function ld_jns() {    
        $sql = "SELECT jns_kegiatan FROM m_giat group by jns_kegiatan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'jns_kegiatan' => $resulte['jns_kegiatan']                                               
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}
    
    function psimpan($skpd='',$urusan='',$rekbaru='',$reklama='',$jns='',$lanjut='Tidak') {      	

    $kd=$this->right($rekbaru,5);
    $prog1=$this->left($rekbaru,13);	
    $giat=$urusan.'.'.$skpd.'.'.$kd;
    $prog=$this->left($giat,18); 
    $gabung=$skpd.'.'.$giat;
    $nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
    $nmgiat=$this->rka_model->get_nama($rekbaru,'nm_kegiatan','m_giat','kd_kegiatan');
    $nmprog=$this->rka_model->get_nama($prog1,'nm_program','m_prog','kd_program');
	$query = $this->db->query("delete from trskpd where kd_skpd='$skpd' and kd_kegiatan1='$reklama'");
	$query = $this->db->query("insert into trskpd(kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,kd_kegiatan1,kd_program1,jns_kegiatan,nm_skpd,nm_kegiatan,nm_program,lanjut) 
                                values('$gabung','$giat','$prog','$urusan','$skpd','$rekbaru','$prog1','$jns','$nmskpd','$nmgiat','$nmprog','$lanjut')");	
    $this->select_giat($skpd);
    }

    function psimpan_ar() {      
        
        $vurus   = $this->input->post('urusan');
        $vskpd   = $this->input->post('skpd');
        $kegi    = $this->input->post('kegiatan');
        $jns     = $this->input->post('jns');
        $lanjut  = 'Tidak';
        
        $urusan  = $this->input->post('urusan');
        $skpd    = $this->input->post('skpd');
        $rekbaru = $this->input->post('kegiatan');
        
        $kd      = $this->right($kegi,5);
        $prog1   = $this->left($kegi,13);
        
        $giat    = $vurus.'.'.$vskpd.'.'.$kd;
        $prog    = $this->left($giat,18);
        $gabung  = $vskpd.'.'.$giat;
        
        $nmskpd  = $this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmgiat  = $this->rka_model->get_nama($rekbaru,'nm_kegiatan','m_giat','kd_kegiatan');
        $nmprog  = $this->rka_model->get_nama($prog1,'nm_program','m_prog','kd_program');
    
    	$query1   = $this->db->query("delete from trskpd where kd_skpd='$vskpd' and kd_kegiatan1='$kegi'");
    	$query2   = $this->db->query("insert into trskpd(kd_gabungan,kd_kegiatan,kd_program,kd_urusan,kd_skpd,kd_kegiatan1,kd_program1,jns_kegiatan,nm_skpd,nm_kegiatan,nm_program,lanjut) 
                                    values('$gabung','$giat','$prog','$urusan','$skpd','$rekbaru','$prog1','$jns','$nmskpd','$nmgiat','$nmprog','$lanjut')");	
        
        $msg     = array();
        if ( $query1 > 0 and $query2 > 0 ){
            $msg = array('pesan'=>'1');
            echo json_encode($msg);
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
        }
        //$this->select_giat($skpd);
    }

    
    function ghapus($skpd='',$kegiatan) {
		$query = $this->db->query("delete from trskpd where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and  kd_kegiatan not in(SELECT DISTINCT kd_kegiatan FROM trdrka)");
		$this->select_giat($skpd);
    }

    function anggaran_kas()
	{
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN';
        $this->template->set('title', 'INPUT ANGGARAN KAS');   
        $this->template->load('template','anggaran/rka/anggaran_kas',$data) ; 
   }
       
   function load_trdskpd(){
    
        $kegiatan = $this->input->post('p');
        $sql = "select * from trdskpd where kd_kegiatan='$kegiatan' order by bulan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'bulan' => $resulte['bulan'],
                        'nilai' => $resulte['nilai']                                                                
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
   
   
    function load_trskpd1() {
        $cskpd=$this->uri->segment(3); 
        $jns_beban = '';
        $where = '';
        $spdlalu = ',0 as lalu';            
       
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total_ubah,a.total $spdlalu FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE LEFT(a.kd_kegiatan,4)= LEFT('$cskpd',4) $jns_beban $where AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'lalu'       => $resulte['lalu'],
                        'total'       => $resulte['total'],
                        'total_ubah'  => $resulte['total_ubah']        
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
    

    function load_giat() {
        $cskpd=$this->uri->segment(3); 
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,a.nm_kegiatan,a.kd_program,a.nm_program,(SELECT SUM(nilai)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total,
                (SELECT SUM(nilai_sempurna)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total_sempurna,
                (SELECT SUM(nilai_ubah)  FROM trdrka WHERE kd_kegiatan=a.kd_kegiatan)AS total_ubah FROM trskpd a  
                WHERE kd_skpd= '$cskpd'   AND (UPPER(kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(nm_kegiatan) LIKE UPPER('%$lccr%')) order by a.kd_kegiatan";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'total'       => number_format($resulte['total'],"2",".",","),
                        'total_sempurna'       => number_format($resulte['total_sempurna'],"2",".",","),
                        'total_ubah'  => number_format($resulte['total_ubah'],"2",".",",")   
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
    
    
    
        function load_trskpd() {
        //$cskpd=$this->uri->segment(3);
        $cskpd = $this->input->post('kode');
        $jenis = $this->input->post('jenis');//'52';
        $giat = $this->input->post('giat');
        $no = $this->input->post('no');                        
        if ($jenis !=''){
            $jns_beban = " and a.jns_kegiatan='$jenis' ";
        } else {
            $jns_beban = '';
        }
        if ($giat !=''){                                    
            $where = " and a.kd_kegiatan not in ($giat) ";
        } else {
            $where = '';
        }
        if ($no!=''){
            $spdlalu = ",(SELECT SUM(nilai) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu";
        } else {
            $spdlalu = ',0 as lalu';            
        }
        $lccr='';        
        $lccr = $this->input->post('q');        
        $sql = "SELECT a.kd_kegiatan,b.nm_kegiatan,a.kd_program,(select nm_program from m_prog where kd_program=a.kd_program) as nm_program,a.total $spdlalu FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                WHERE LEFT(a.kd_kegiatan,4)= LEFT('$cskpd',4) $jns_beban $where AND (UPPER(a.kd_kegiatan) LIKE UPPER('%$lccr%') OR UPPER(b.nm_kegiatan) LIKE UPPER('%$lccr%'))";                                              
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan' => $resulte['kd_kegiatan'],  
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program' => $resulte['kd_program'],  
                        'nm_program' => $resulte['nm_program'],
                        'lalu'       => $resulte['lalu'],
                        'total'       => $resulte['total']        
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
    
    
    
    /*
    function simpan_trskpd(){
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
        $asg = $this->db->query($sql);
        if ($asg){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','1','$bln1','$status') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','2','$bln2','$status') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','3','$bln3','$status') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','4','$bln4','$status') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','5','$bln5','$status') ";
                $asg = $this->db->query($sql5);        
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','6','$bln6','$status') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','7','$bln7','$status') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','8','$bln8','$status') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','9','$bln9','$status') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','10','$bln10','$status') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','11','$bln11','$status') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','12','$bln12','$status') ";
                $asg = $this->db->query($sql12);         
                $sql13 = "update trskpd set triw1='$tr1',triw2='$tr2',triw3='$tr3',triw4='$tr4' where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       
        } else {
            echo '0';
            exit();
        }
        echo '1';
    }
    */


    function simpan_trskpd(){
    
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
        $asg = $this->db->query($sql);
        if ($asg){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','1','$bln1','$bln1',0,0,'$status') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','2','$bln2','$bln2',0,0,'$status') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','3','$bln3','$bln3',0,0,'$status') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','4','$bln4','$bln4',0,0,'$status') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','5','$bln5','$bln5',0,0,'$status') ";
                $asg = $this->db->query($sql5);       
                $sql6 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','6','$bln6','$bln6',0,0,'$status') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','7','$bln7','$bln7',0,0,'$status') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','8','$bln8','$bln8',0,0,'$status') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','9','$bln9','$bln9',0,0,'$status') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','10','$bln10','$bln10',0,0,'$status') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','11','$bln11','$bln11',0,0,'$status') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd values('$kdGab','$cgiat','$cskpd','','12','$bln12','$bln12',0,0,'$status') ";
                $asg = $this->db->query($sql12); 
				$ntotal = $tr1+$tr2+$tr3+$tr4;
                $sql13 = "update trskpd set triw1='$tr1',triw2='$tr2',triw3='$tr3',triw4='$tr4',total='$ntotal' where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       

        } else {
            echo '0';
            exit();
        }
        
        echo '1';
    }

	
    function config_anggaran()
    {
        $data['page_title']= 'INPUT KONFIGURASI ANGGARAN';
        $this->template->set('title', 'INPUT KONFIGURASI ANGGARAN');   
        $this->template->load('template','anggaran/rka/config_anggaran',$data) ; 
    }
    
    function spd()
    {
        $data['page_title']= 'INPUT S P D';
        $this->template->set('title', 'INPUT S P D');   
        $this->template->load('template','anggaran/rka/spd',$data) ; 
    }
    
	    function config_spd()
    {
        $data['page_title']= 'INPUT KONFIGURASI S P D';
        $this->template->set('title', 'INPUT KONFIGURASI S P D');   
        $this->template->load('template','anggaran/rka/config_spd',$data) ; 
    }
	
    function load_spd() {
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;        
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(no_spd) like upper('%$kriteria%') or tgl_Spd like '%$kriteria%' or upper(nm_skpd) like 
                    upper('%$kriteria%') or upper(jns_beban) like upper('%$kriteria%')) ";            
        }
        
        $sql = "SELECT count(*) as total from trhspd $where " ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
       	$result["total"] = $total->total; 
        $query1->free_result();
        
        //$sql = "SELECT *,IF(jns_beban='52','Belanja Langsung','Belanja Tidak Langsung') AS nm_beban from trhspd $where order by tgl_Spd,kd_skpd limit $offset,$rows";
		
        $sql = "SELECT TOP $rows  a.*,nama,case when jns_beban='52' then 'Belanja Langsung' else 'Belanja Tidak Langsung' end AS nm_beban from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip  WHERE no_spd not in (SELECT TOP $offset  no_spd from trhspd a left join ms_ttd b 
		on a.kd_bkeluar=b.nip ) order by tgl_Spd,kd_skpd ";
        $query1 = $this->db->query($sql);       
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $row[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'tgl_spd' => $resulte['tgl_spd'],
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
						'ketentuan' => $resulte['klain'],
						'nama_bend' => $resulte['nama'],
						'nip' => $resulte['kd_bkeluar'],						
                        'jns_beban' => $resulte['jns_beban'],
                        'nm_beban' => $resulte['nm_beban'],
                        'bulan_awal' => $resulte['bulan_awal'],
                        'bulan_akhir' => $resulte['bulan_akhir'],
                        'total' => $resulte['total'],                                                                      
                        'status' => $resulte['status']                                                                      
                        );
                        $ii++;
        }
        $result["rows"] = $row;           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    function load_dspd_ar($skpd='') {            
        $no = $this->input->post('no');
		$jenis = $this->input->post('jenis');
		$skpd = $this->input->post('skpd');
		$tgl = $this->input->post('tgl');
		/*
		$stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="nilai";		
			$sts="susun";		
		}else{
			$field="nilai_ubah";				
			$sts="ubah";		
		}*/
		$n_status = $this->get_status($tgl,$skpd);
		$field = $n_status;
		if ($jenis=='52'){
        $sql = "SELECT a.*,kd_rek5,nm_rek5 ,(SELECT SUM(nilai) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu,
                (SELECT SUM(total) FROM trskpd WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd ) AS anggaran from trdspd a inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";
		}else {
        $sql = "SELECT a.*,kd_rek5,nm_rek5 ,isnull((SELECT SUM(nilai) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd 
				WHERE n.kd_kegiatan=a.kd_kegiatan  and kd_rek5=a.kd_Rek5 and m.no_spd <> '$no'),0) AS lalu,
				(SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd and kd_rek5=a.kd_Rek5 ) AS anggaran from trdspd a
				inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";

		}
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
                        'nilai'       => number_format($resulte['nilai'],"2",".",","),
                        'lalu'        => number_format($resulte['lalu'],"2",".",","),
                        'anggaran'    => number_format($resulte['anggaran'],"2",".",",")                               
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}
    
    
    function load_dspd() {            
        $no = $this->input->post('no');
        $sql = "SELECT a.*,(SELECT SUM(nilai) FROM trdspd n INNER JOIN trhspd m ON n.no_spd=m.no_spd WHERE n.kd_kegiatan=a.kd_kegiatan  AND m.no_spd <> '$no') AS lalu,
                (SELECT SUM(total) FROM trskpd WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd ) AS anggaran from trdspd a inner join trhspd b on a.no_spd=b.no_spd where a.no_spd = '$no' order by b.no_spd,a.kd_kegiatan,a.kd_rek5";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'no_spd' => $resulte['no_spd'],
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
						'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
                        'kd_program' => $resulte['kd_program'],
                        'nm_program' => $resulte['nm_program'],
                        'nilai' => $resulte['nilai'],
                        'lalu' => $resulte['lalu'],
                        'anggaran' => $resulte['anggaran']                                        
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();    	   
	}

    
    function spd_lalu(){
        $kegiatan = $this->input->post('cgiat');
        $tgl = $this->input->post('ctgl');     
        //$kegiatan = '1.01.1.01.01.00.01.01';
        //$tgl = '2012-10-29';      
        $sql = "SELECT SUM(nilai) as lalu FROM trdspd a INNER JOIN trhspd b ON a.no_spd=b.no_spd WHERE a.kd_kegiatan='$kegiatan' AND tgl_spd < '$tgl'";
        $query1 = $this->db->query($sql);  
        $row = $query1->row();
        $result[] = array('lalu' => $row->lalu);
        echo json_encode($result);
        $query1->free_result();
    }
    
    function simpan_spd(){
        $tabel  = $this->input->post('tabel');
        $idx    = $this->input->post('cidx');
        $nomor  = $this->input->post('no');
        $nomor2  = $this->input->post('no2');
		$mode_tox= $this->input->post('mode_tox');
        $tgl    = $this->input->post('tgl');
        $skpd   = $this->input->post('skpd');
        $nmskpd = $this->input->post('nmskpd');
        $bend   = $this->input->post('bend');
        $bln1   = $this->input->post('bln1');
        $bln2   = $this->input->post('bln2');
        $ketentuan  = $this->input->post('ketentuan');
        $pengajuan  = $this->input->post('pengajuan');
        $jenis      = $this->input->post('jenis');
        $total      = $this->input->post('total');
        $csql       = $this->input->post('sql');        
        $usernm     = $this->session->userdata('pcNama');    
        $update     = date('Y-m-d H:i:s');    
        $msg = array();                
        // Simpan Header //
        if ($tabel == 'trhspd') {
			if ($mode_tox=='tambah'){
//            $sql = "delete from  $tabel where kd_skpd='$skpd' and no_spd='$nomor'";
//           $asg = $this->db->query($sql);
           //if ($asg){
                $sql = "insert into  $tabel (no_spd,tgl_spd,kd_skpd,nm_skpd,jns_beban,bulan_awal,bulan_akhir,total,klain,kd_bkeluar,username,tglupdate) 
                        values('$nomor','$tgl','$skpd', rtrim('$nmskpd'),'$jenis','$bln1','$bln2','$total', rtrim('$ketentuan'),'$bend','$usernm','$update')";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                } else {
                        $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                }          
            //} else {
           //     $msg = array('pesan'=>'0');
            //    echo json_encode($msg);
             //   exit();
            //}
			} else {
                $sql = "update $tabel set 
					no_spd='$nomor',tgl_spd='$tgl',kd_skpd='$skpd',nm_skpd=rtrim('$nmskpd'),
					jns_beban='$jenis',bulan_awal='$bln1',bulan_akhir='$bln2',total='$total',klain=rtrim('$ketentuan'),kd_bkeluar='$bend',username='$usernm',tglupdate='$update'
					where no_spd='$nomor2' ";
                $asg = $this->db->query($sql);
                if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                } else {
                        $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                }          
 				
			}
			
        } else if ($tabel == 'trdspd') {
            
            // Simpan Detail //                       
                $sql = "delete from  $tabel where no_spd='$nomor2'";
                $asg = $this->db->query($sql);
                if (!($asg)){
                   $msg= array('pesan'=>'0');
                   echo json_encode($msg);
                   exit();
                } else {
                    $sql = "insert into  $tabel(no_spd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,kd_program,nm_program,nilai)";                        
                    $asg = $this->db->query($sql.$csql);
                    if (!($asg)){
                        $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                        exit();
                    }  else {
                        $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }                                                             
        }
        //$asg->free_result();
    }
    
    function hapus_spd(){
        $nomor = $this->input->post('no');
        $msg = array();         
        $sql = "delete from trdspd where no_spd='$nomor'";
        $asg = $this->db->query($sql);
        if ($asg){
            $sql = "delete from trhspd where no_spd='$nomor'";
            $asg = $this->db->query($sql);
            if (!($asg)){
               $msg = array('pesan'=>'0');
               echo json_encode($msg);
               exit();
            } 
        } else {
            $msg = array('pesan'=>'0');
            echo json_encode($msg);
            exit();
        }
          $msg = array('pesan'=>'1');
          echo json_encode($msg);              
    } 
    
    function cetak_lampiran_spd1(){
		
        $print = $this->uri->segment(3);
        $tnp_no = $this->uri->segment(4);
		$cell =  $this->uri->segment(6);
		$nip_ppkd = $this->input->post('nip_ppkd');  
        $nama_ppkd = $this->input->post('nama_ppkd'); 		
        $jabatan_ppkd = $this->input->post('jabatan_ppkd'); 
        $pangkat_ppkd = $this->input->post('pangkat_ppkd'); 	
        $lntahunang = $this->session->userdata('pcThang');       
        $lcnospd = $this->input->post('nomor1');
		$lkd_skpd=$this->rka_model->get_nama($lcnospd,'kd_skpd','trhspd','no_spd');
		$ldtgl_spd=$this->rka_model->get_nama($lcnospd,'tgl_spd','trhspd','no_spd');
		$stsubah=$this->rka_model->get_nama($lkd_skpd,'status_ubah','trhrka','kd_skpd');
		$field = $this->get_status($ldtgl_spd,$lkd_skpd);	
        
		$csql = "SELECT (SELECT no_dpa FROM trhrka WHERE kd_skpd = a.kd_skpd) AS no_dpa,
                (SELECT SUM($field) FROM trdrka WHERE kd_kegiatan IN(SELECT kd_kegiatan FROM trdspd WHERE no_spd=a.no_spd)
                 AND kd_skpd = a.kd_skpd) jm_ang,
                (SELECT SUM(total) FROM trhspd WHERE kd_skpd = a.kd_skpd AND jns_beban=a.jns_beban AND 
                tgl_spd<=a.tgl_spd AND no_spd<>a.no_spd) AS jm_spdlalu,
                a.total AS jm_spdini,a.jns_beban,a.bulan_awal,a.bulan_akhir,kd_skpd
                FROM trhspd a WHERE a.no_spd = '$lcnospd'";
                
        $hasil = $this->db->query($csql);
        $data1 = $hasil->row();
        $periode1 = $this->rka_model->getBulan($data1->bulan_awal);
        $periode2 = $this->rka_model->getBulan($data1->bulan_akhir);
        $jnsspd = $data1->jns_beban;
        $lnsisa = $data1->jm_ang - $data1->jm_spdlalu - $data1->jm_spdini;
        $lkd_skpd =$data1->kd_skpd;
        $ljns_beban =$data1->jns_beban;
		

		
		
		//$field = $this->get_status($ldtgl_spd,$lkd_skpd);
		/*
		if ($stsubah==0){
			$field="nilai";		
		}else{
			$field="nilai_ubah";				
		}
		*/
		if ($ljns_beban=='51')
		{
			$nm_beban="BELANJA TIDAK LANGSUNG";
		} else if ($ljns_beban=='6')
		{
			$nm_beban="PEMBIAYAAN";
		} else
			{
				$nm_beban="BELANJA LANGSUNG ";
			};
			
		$nospd_cetak= $lcnospd;
		$tahun=$this->tukd_model->get_sclient('thn_ang','sclient');
        		
		if ($tnp_no=='1'){
		$con_dpn='903/';
        
			//$tahun=$this->session->userdata('pcThang');
		$con_blk_btl='/BTL/BPKAD-B/'.$tahun;
		$con_blk_bl='/BL/BPKAD-B/'.$tahun;		
	
			($ljns_beban=='51') ?  $nospd_cetak=$con_dpn."&emsp;&emsp;&emsp;".$con_blk_btl:$nospd_cetak=$con_dpn."&emsp;&emsp;&emsp;".$con_blk_bl;
			}	
		
        	
		
        $cRet = '';
   /*     
        if($jnsspd=='51'){            
                
//                    <td colspan=\"5\" style=\"border-top:none;border-right:none;border-left:none;font-size:12px\">
        $cRet .="<table style=\"border-collapse:collapse;font-weight: bold;font-family: arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                 <tr>
                    <td colspan=\"5\" >
                    <h4>>LAMPIRAN SPD NOMOR : $lcnospd<br>
                    $nm_beban<BR>
                    PERIODE BULAN: $periode1 S/D $periode2 <BR>
                    TAHUN ANGGARAN: nnnn $lntahunang
                    <BR>d&nbsp;                                        
                    </td>           
                </tr>
                <tr>
                    <td width=\"20%\" align=\"center\">Nomor DPA-/DPPA-SKPD        
                    </td>
                    <td width=\"20%\" align=\"center\" >Anggaran        
                    </td>
                    <td width=\"20%\" align=\"center\">Akumulasi pada SPD<br>Sebelumnya        
                    </td>
                    <td width=\"20%\" align=\"center\">Jumlah Pada SPD<br>Periode ini        
                    </td>
                    <td width=\"20%\" align=\"center\">Sisa Anggaran
                    </td>
                </tr>";
                $cRet .="
                <tr>
                    <td align=\"center\" style=\"font-size:12px\">$data1->no_dpa        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($data1->jm_ang,"2",".",",")."&nbsp;        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($data1->jm_spdlalu,"2",".",",")."&nbsp;        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($data1->jm_spdini,"2",".",",")."&nbsp;        
                    </td>
                    <td align=\"right\" style=\"font-size:12px\">".number_format($lnsisa,"2",".",",")."&nbsp;
                    </td>
                </tr>";
				
                $cRet .="
                <tr>
                    <td colspan=\"5\" style=\"border-bottom:none;border-right:none;border-left:none;font-size:10px\">
                       <br>Jumlah Dana Belanja Langsung : Rp ".number_format($data1->jm_spdini)."<br><i>(".$this->rka_model->terbilang(ceil($data1->jm_spdini))." rupiah)</i>
                    </td>                             
                 </tr>
                 <tr>
                    <td colspan=\"3\" style=\"border: solid 1px white;font-size:10px\">
                    </td>
                    <td colspan=\"2\" style=\"border: solid 1px white;font-size:10px\" align=\"center\">
                        Ditetapkan di<br>
                        pada tanggal<br>
                        <br>&nbsp;
                        <br>&nbsp;
                        <b>PPKD SELAKU BUD,</b>
                        <br>&nbsp;
                        <br>&nbsp;
                        <br>&nbsp;
                        (nama lengkap)<br>
                        NIP.                                
                    </td>           
                </tr>
            </table>";
        }else{
*/
	/*	 <tr>
                    <td colspan=\"8\" style=\"border-top:none;border-right:none;border-left:none;font-size:10px\">
                    LAMPIRAN SPD NOMOR : $lcnospd<br>
                    BELANJA LANGSUNG<BR>
                    PERIODE BULAN: $periode1 S/D $periode2 <BR>
                    TAHUN ANGGARAN: $lntahunang
                    <BR>&nbsp;                                        
                    </td>           
                </tr>
*/				

//<table style=\"border-collapse:collapse;font-weight:bold;font-family:arial;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">

		$font = 12;
        $font1 = $font-1;
		

        $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-family:Times New Roman; font-size:$font px;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">               
                    <tr>
                        <td width=\"18%\" align=\"left\">LAMPIRAN SPD NOMOR </td>
                    	<td width=\"72%\" align=\"left\">: $nospd_cetak</td>
                    </tr>
                    <tr><td colspan=2 width=\"100%\" align=\"left\">$nm_beban<BR></td></tr>
                    <tr><td align=\"left\"> PERIODE BULAN </td><td align=\"left\">: $periode1 s/d $periode2 $tahun</td></tr>
                    <tr><td align=\"left\">TAHUN ANGGARAN </td><td align=\"left\">: $lntahunang</td></tr>
                </table>";
        $cRet .="
           <table style=\"border-collapse:collapse;font-family:Times New Roman; font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">               
                <tr>
                    <td width=\"3%\" align=\"center\" style=\"font-weight:bold;\">No.<br>Urut        
                    </td>
                    <td width=\"17%\" align=\"center\" style=\"font-weight:bold;\">Nomor DPA-/DPPA-SKPD        
                    </td>
                    <td width=\"28%\" align=\"center\" style=\"font-weight:bold;\">URAIAN      
                    </td>
                    <td width=\"11%\" align=\"center\" style=\"font-weight:bold;\">ANGGARAN(Rp.)       
                    </td>
                    <td width=\"10%\" align=\"center\" style=\"font-weight:bold;\">AKUMULASI PADA SPD SEBELUMNYA (Rp.)    
                    </td>
                    <td width=\"10%\" align=\"center\" style=\"font-weight:bold;\">JUMLAH PADA SPD PERIODE INI (Rp.)
                    </td>
                    <td width=\"10%\" align=\"center\" style=\"font-weight:bold;\">JUMLAH DANA s/d SPD INI (Rp.)
                    </td>
                    <td width=\"11%\" align=\"center\" style=\"font-weight:bold;\">SISA ANGGARAN (Rp.)
                    </td>
                </tr>";
            
			
			 $sql = "select kd_urusan,nm_urusan from ms_urusan where kd_urusan=left(rtrim('$lkd_skpd'),4)";
        $hasil = $this->db->query($sql);
        $tox = $hasil->row();
        $total_spd = $data1->jm_spdlalu + $data1->jm_spdini;
        $kd_urusan = $tox->kd_urusan;
        
			  $cRet .="<tr>
                                    <td>&nbsp;</td>
                                    <td style=\"font-size:$font1 px;font-weight:bold;\"> $kd_urusan       
                                    </td>
                                    <td style=\"font-weight:bold;\"> $tox->nm_urusan       
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_ang,"2",",",".")."&nbsp;           
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdlalu,"2",",",".")."&nbsp;        
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdini,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($total_spd,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($lnsisa,"2",",",".")."&nbsp;
                                    </td>
                                </tr>";    
			
			 $sql = "select kd_skpd,nm_skpd from ms_skpd where kd_skpd='$lkd_skpd'";
        $hasil = $this->db->query($sql);
        $tox = $hasil->row();
        $kd_skpd = $tox->kd_skpd;
        $djns_beban = $this->dotrek($ljns_beban);
			  $cRet .="<tr>
                                    <td>&nbsp;       
                                    </td>
                                    <td style=\"font-size:$font1 px;font-weight:bold;\"> $kd_urusan.$kd_skpd      
                                    </td>
                                    <td style=\"font-weight:bold;\"> $tox->nm_skpd       
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_ang,"2",",",".")."&nbsp;           
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdlalu,"2",",",".")."&nbsp;        
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdini,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($total_spd,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($lnsisa,"2",",",".")."&nbsp;
                                    </td>
                                </tr>";

			  $cRet .="<tr>
                                    <td>&nbsp;       
                                    </td>
                                    <td style=\"font-size:$font1 px;font-weight:bold;\"> $kd_urusan.$kd_skpd.00.00.5  
                                    </td>
                                    <td style=\"font-weight:bold;\"> BELANJA DAERAH   
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_ang,"2",",",".")."&nbsp;           
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdlalu,"2",",",".")."&nbsp;        
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdini,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($total_spd,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($lnsisa,"2",",",".")."&nbsp;
                                    </td>
                                </tr>";   
  $cRet .="<tr>
                                    <td >&nbsp;       
                                    </td>
                                    <td style=\"font-size:$font1 px;font-weight:bold;\"> $kd_urusan.$kd_skpd.00.00.$djns_beban      
                                    </td>
                                    <td style=\"font-weight:bold;\">$nm_beban
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_ang,"2",",",".")."&nbsp;           
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdlalu,"2",",",".")."&nbsp;        
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($data1->jm_spdini,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($total_spd,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-size:$font1 px;font-weight:bold;\">".number_format($lnsisa,"2",",",".")."&nbsp;
                                    </td>
                                </tr>";    								
		if ($ljns_beban=='52'){			
				$sql = "
						select * from ((
						select (ROW_NUMBER() OVER (ORDER BY ss.kd_program))no_urut,rtrim(ss.kd_program)kode,rtrim(nm_program)uraian,sum(anggaran)anggaran,sum(spd_lalu)spd_lalu,sum(nilai)nilai from (SELECT ('')no_urut,rtrim(a.kd_kegiatan)kode,c.nm_kegiatan,
						isnull((SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd),0) AS anggaran,
						isnull((SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd
						WHERE c.kd_kegiatan = a.kd_kegiatan AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd 
						AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu,
						a.nilai,a.kd_program FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join trskpd c on a.kd_kegiatan=c.kd_kegiatan WHERE  a.no_spd = '$lcnospd') ss 
						inner join trskpd b on ss.kode=b.kd_kegiatan group by no_urut,ss.kd_program,nm_program
						) union all
						(
						SELECT ('')no_urut,rtrim(a.kd_kegiatan)kode,c.nm_kegiatan,
						isnull((SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd),0) AS anggaran,
						isnull((SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd
						WHERE c.kd_kegiatan = a.kd_kegiatan AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd 
						AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu,
						a.nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd  inner join trskpd c on a.kd_kegiatan=c.kd_kegiatan
								WHERE  a.no_spd = '$lcnospd')
								) zt order by kode";

		} else{
		
	            $sql = "	
						select no_urut, kode, uraian, anggaran, spd_lalu,nilai,   
                        case when right(kd_kegiatan,5)='00.51'
                            then LEFT(kd_kegiatan,19)+'00'
                            else kd_kegiatan
                        end [kd_kegiatan] 
                        from ((
						select ('')no_urut,rtrim(c.kd_rek3)kode,rtrim(nm_rek3)uraian,
						sum(anggaran)anggaran,sum(spd_lalu)spd_lalu,sum(nilai)nilai,kd_kegiatan from 
						(
						SELECT rtrim(a.kd_rek5)kode,c.nm_rek5,a.kd_kegiatan,
						isnull((SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd and kd_rek5=a.kd_rek5),0) AS anggaran,
						isnull((SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd WHERE c.kd_kegiatan = a.kd_kegiatan and kd_rek5=a.kd_rek5 AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu,
						a.nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join ms_rek5 c on a.kd_rek5=c.kd_rek5
								WHERE  a.no_spd  = '$lcnospd'
						) ss 
						inner join ms_rek3 c on left(ss.kode,3)=c.kd_rek3 group by c.kd_rek3,nm_rek3,ss.kd_kegiatan
						) union all
						(
						select (ROW_NUMBER() OVER (ORDER BY c.kd_rek4))no_urut,rtrim(c.kd_rek4)kode,rtrim(nm_rek4)uraian,
						sum(anggaran)anggaran,sum(spd_lalu)spd_lalu,sum(nilai)nilai,kd_kegiatan from 
						(
						SELECT rtrim(a.kd_rek5)kode,c.nm_rek5,a.kd_kegiatan,
						isnull((SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd and kd_rek5=a.kd_rek5),0) AS anggaran,
						isnull((SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd WHERE c.kd_kegiatan = a.kd_kegiatan and kd_rek5=a.kd_rek5 AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu,
						a.nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join ms_rek5 c on a.kd_rek5=c.kd_rek5
								WHERE  a.no_spd  = '$lcnospd'
						) ss 
						inner join ms_rek4 c on left(ss.kode,5)=c.kd_rek4 group by c.kd_rek4,nm_rek4,ss.kd_kegiatan
						)
						union all
						(
						SELECT ('')no_urut,rtrim(a.kd_rek5)kode,c.nm_rek5,
						isnull((SELECT SUM($field) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND kd_skpd=b.kd_skpd and kd_rek5=a.kd_rek5),0) AS anggaran,
						isnull((SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd WHERE c.kd_kegiatan = a.kd_kegiatan and kd_rek5=a.kd_rek5 AND d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban),0) AS spd_lalu,
						a.nilai,a.kd_kegiatan FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd inner join ms_rek5 c on a.kd_rek5=c.kd_rek5
								WHERE  a.no_spd = '$lcnospd'
								)
								) zt order by kode";
				}
		
		/* "SELECT (SELECT no_dpa FROM trhrka WHERE kd_skpd = b.kd_skpd) AS no_dpa,
                    a.kd_program,a.kd_kegiatan,(SELECT SUM(nilai) FROM trdrka WHERE kd_kegiatan = a.kd_kegiatan AND
                    kd_skpd=b.kd_skpd) AS anggaran,(SELECT SUM(nilai) FROM trdspd c LEFT JOIN trhspd d ON c.no_spd=d.no_spd
                    WHERE c.kd_kegiatan = a.kd_kegiatan AND 
                    d.kd_skpd=b.kd_skpd AND c.no_spd <> a.no_spd AND d.tgl_spd<=b.tgl_spd AND d.jns_beban = b.jns_beban) AS spd_lalu,a.nilai FROM 
                    trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd WHERE 
                    a.no_spd = '$lcnospd'"*/
					
                    $hasil = $this->db->query($sql);
                    $lcno = 0;
                    $lntotal = 0;
					$jtotal_spd = 0;
                    foreach ($hasil->result() as $row)
                    {
                       $lcno = $lcno + 1;
                       //$lntotal = $lntotal + $row->nilai;
                       $lcsisa = $row->anggaran - $row->spd_lalu - $row->nilai;
					   $total_spd=$row->spd_lalu + $row->nilai;
                       //echo $row->no_dpa;
					   if ($row->no_urut=='0') {
						$lcno_urut='';
					   } else {
						   $lcno_urut=$row->no_urut;
					   };
					   $kode=$row->kode;
                       $lenkode = strlen($kode);
                       
                       //copy
                       //copy bl
                       if ($ljns_beban=='52'){
                           if ($lenkode <= 18){
                                $bold = 'font-weight:bold;';
                                $fontr = $font1;
                           }else{
                                $bold = '';
                                $fontr = $font;
                           }
 
							if($lenkode==18){
								$jtotal_spd = $jtotal_spd + $total_spd;
							}
						}
                       
                       if ($ljns_beban=='51'){
                           if ($lenkode <= 5){
                                $bold = 'font-weight:bold;';
                                $fontr = $font1;
                           }else{
                                $bold = '';
                                $fontr = $font;
                           }
							if($lenkode==3){
								$jtotal_spd = $jtotal_spd + $total_spd;
							}

						   $kode=$row->kd_kegiatan.'.'.$this->dotrek($kode);
					   }
                        //copy bl
						
                       $cRet .="<tr>
                                    <td align=\"center\" style=\"$bold font-size:$fontr px\">$lcno_urut    
                                    </td>
                                    <td style=\"$bold font-size:$fontr px\">$kode 
									
                                    </td>
                                    <td style=\"$bold font-size:$fontr px\">$row->uraian       
                                    </td>
                                    <td align=\"right\" style=\"$bold font-size:$fontr px\">".number_format($row->anggaran,"2",",",".")."&nbsp;     
                                    </td>
                                    <td align=\"right\" style=\"$bold font-size:$fontr px\">".number_format($row->spd_lalu,"2",",",".")."&nbsp;    
                                    </td>
                                    <td align=\"right\" style=\"$bold font-size:$fontr px\">".number_format($row->nilai,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"$bold font-size:$fontr px\">".number_format($total_spd,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"$bold font-size:$fontr px\">".number_format($lcsisa,"2",",",".")."&nbsp;
                                    </td>
                                </tr>";    
                        
                    }
                 //perbaiki $total_spd <td align=\"right\" style=\"font-weight:bold;font-size:$font1 px\">".number_format($data1->jm_spdini,"2",".",",")."&nbsp;
				 $cRet .="<tr>
                                    <td align=\"right\" style=\"font-weight:bold;\" colspan=3>JUMLAH &nbsp;&nbsp;&nbsp;       
                                    </td>
                                    <td align=\"right\" style=\"font-weight:bold;font-size:$font1 px\">".number_format($data1->jm_ang,"2",",",".")."&nbsp;           
                                    </td>
                                    <td align=\"right\" style=\"font-weight:bold;font-size:$font1 px\">".number_format($data1->jm_spdlalu,"2",",",".")."&nbsp;        
                                    </td>
                                    <td align=\"right\" style=\"font-weight:bold;font-size:$font1 px\">".number_format($data1->jm_spdini,"2",",",".")."&nbsp;
                                    </td>
                                    <td align=\"right\" style=\"font-weight:bold;font-size:$font1 px\">".number_format($jtotal_spd,"2",",",".")."&nbsp; 
                                    </td>
                                    <td align=\"right\" style=\"font-weight:bold;font-size:$font1 px\">".number_format($lnsisa,"2",",",".")."&nbsp;
                                    </td>
                                </tr>";    		

				$cRet .="</table>";
			/*
            $cRet .=" <table style=\"border-collapse:collapse;font-weight: bold;font-family: arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
           
            <tr>
            <td colspan=\"8\" style=\"border-bottom:none;border-right:none;border-left:none;font-size:10px\">
            <br>Jumlah Dana Belanja Langsung : Rp ".number_format($data1->jm_spdini,"2",".",",")."<br><i>(".$this->rka_model->terbilang($data1->jm_spdini)." rupiah)</i>
            </td>           
            </tr>
            <tr>
                <td colspan=\"5\" style=\"border: solid 1px white;font-size:10px\">
                </td>
                <td colspan=\"3\" style=\"border: solid 1px white;font-size:10px\" align=\"center\">
                    Ditetapkan di<br>
                    pada tanggal<br>
                    <br>&nbsp;
                    <br>&nbsp;
                    <b>PPKD SELAKU BUD,</b>
                    <br>&nbsp;
                    <br>&nbsp;
                    <br>&nbsp;
                    (nama lengkap)<br>
                    NIP.                                
                </td>           
            </tr>	
            </table>
			";*/
// CETAKAN TANDA TANGAN by Tox
			$cRet .=" <table style=\"border-collapse:collapse;font-weight: bold;font-family: arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
		<tr>
                <td width=\"70%\" align=\"right\" colspan=\"2\">&nbsp;
                </td>				
                <td width=\"30%\"  align=\"left\"><br>Ditetapkan di Pontianak</td>
				</td>
			</tr>
		<tr >
                <td width=\"70%\" align=\"right\" colspan=\"2\">&nbsp;
                </td>	
                <td width=\"30%\"  text-indent: 50px; align=\"left\"><u>Pada tanggal :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
				&nbsp;&nbsp;&nbsp;&nbsp;<u></td>
				</td>
			</tr>	
		<tr >
                <td width=\"60%\" align=\"right\">&nbsp;</td>
                <td width=\"40%\"  align=\"center\" colspan=\"2\">KEPALA BADAN PENGELOLAAN KEUANGAN DAN ASSET DAERAH<br>SELAKU BENDAHARA UMUM DAERAH<BR>&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;</td>
				</td>
			</tr>	
		<tr >
                <td align=\"right\">&nbsp;</td>
                <td  align=\"center\" colspan=\"2\"><u>$nama_ppkd</u></td>
				</td>
			</tr>
				<tr >
                <td align=\"right\">&nbsp;</td>
                <td align=\"center\" colspan=\"2\">$pangkat_ppkd</td>
				</td>
			</tr>
		<tr >
                <td  align=\"right\">&nbsp;</td>
                <td align=\"center\" colspan=\"2\">NIP. $nip_ppkd</td>
				</td>
			</tr>			
        </table>";
            //echo $cRet;

        $data['prev']= $cRet;  
        //echo $data['prev'];  
//        $this->rka_model->_mpdf('',$cRet,'10','10',5,'1');
        $hasil->free_result();
		if ($print==1){
            $this->_mpdf('',$cRet,10,10,10,1,'','','',5);
          //$this->rka_model->_mpdf_folio('',$cRet,10,10,10,'0'); 
		} else{
		  echo $cRet;
		}
		
		

		
		
	}
	
    
    function cetak_otor_spd(){
        
        $print = $this->uri->segment(3);
        $tnp_no = $this->uri->segment(4);
        $kop = $this->input->post('kop');
        $tambah = $this->uri->segment(5) == '0' ? '' : $this->uri->segment(5);
        $lcnospd = $this->input->post('nomor1');                
        $nip_ppkd = $this->input->post('nip_ppkd');  
        $nama_ppkd = $this->input->post('nama_ppkd');       
        $jabatan_ppkd = $this->input->post('jabatan_ppkd'); 
        $pangkat_ppkd = $this->input->post('pangkat_ppkd');         
        $csql2 = "select nm_skpd,kd_skpd,tgl_spd,total,bulan_awal,bulan_akhir,jns_beban,kd_bkeluar from trhspd where no_spd = '$lcnospd'  ";
        $hasil1 = $this->db->query($csql2);
        $trh1 = $hasil1->row();
        $ldtgl_spd = $trh1->tgl_spd;
        $jmlspdini = number_format(($trh1->total),2,',','.');//number_format(ceil($trh1->total),2,',','.');;
        $biljmlini = $this->tukd_model->terbilang(($trh1->total));
        $lckdskpd = $trh1->kd_skpd;
        $blnini = $this->rka_model->getBulan($trh1->bulan_awal);
        $blnsd = $this->rka_model->getBulan($trh1->bulan_akhir);
        $lcnmskpd = $trh1->nm_skpd;
                $ljns_beban =$trh1->jns_beban;
        $lcnipbk = $trh1->kd_bkeluar;
        
        if ($lcnipbk<>''){         
            $sqlttd1="SELECT nama as nm FROM ms_ttd WHERE nip='$lcnipbk' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                }
        }
        else{
                    $nama1= '';
        }
 
        
        $nospd_cetak=$lcnospd;
        if ($tnp_no=='1'){
        $con_dpn='903/';
        $tahun=$this->session->userdata('pcThang');
        $con_blk_btl='/BTL/BKAD-B/'.$tahun;
        $con_blk_bl='/BL/BKAD-B/'.$tahun;      

    
            ($ljns_beban=='51' || $ljns_beban=='62') ?  $nospd_cetak=$con_dpn."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$con_blk_btl:$nospd_cetak=$con_dpn."&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;".$con_blk_bl;
            }   
        
        // jumlah anggaran
        $n_status = $this->get_status2($lckdskpd);

        $csql1 = "SELECT SUM($n_status) AS jumlah FROM trdrka WHERE kd_kegiatan IN 
                  (SELECT kd_kegiatan FROM trdspd WHERE no_spd = '$lcnospd')";
           

                  
                  
        $hasil1 = $this->db->query($csql1);
        $trh2 = $hasil1->row();
        $jmldpa = number_format(($trh2->jumlah),2,',','.');//number_format(ceil($trh2->jumlah),2,',','.');
        
        
        //spd lalu
        $sql = "select sum(total) as jm_spd_l from trhspd where no_spd<>'$lcnospd' 
                and tgl_spd<='$ldtgl_spd' and kd_skpd='$lckdskpd' and jns_beban='$ljns_beban'";
        $hasil = $this->db->query($sql);
        $trh = $hasil->row();
        $jmlspdlalu = number_format(($trh->jm_spd_l),2,',','.');//number_format(ceil($trh->jm_spd_l),2,',','.');
        
        
        
        $csql = "SELECT * from sclient";
        $hasil = $this->db->query($csql);
        $trh3 = $hasil->row();
        $jmlsisa = number_format(($trh2->jumlah - $trh->jm_spd_l),2,',','.');;
       // $jmlsisa2 = number_format(($trh2->jumlah - $trh->jm_spd_l - $trh1->total),2,',','.'); //number_format(ceil($trh2->jumlah - $trh->jm_spd_l - $trh1->total),2,',','.');
        //$jmlsisa3 = $trh2->jumlah - $trh->jm_spd_l - $trh1->total;
       // $bilsisa = $this->tukd_model->terbilang($jmlsisa3);
        
        $sql_sisa="SELECT SUM(jumlah-jm_spd_l-total) as sisa
                FROM (select 0 jumlah, 0 jm_spd_l, total total from trhspd where no_spd = '$lcnospd'
                    UNION ALL
                    SELECT SUM($n_status) AS jumlah, 0 jm_spd_l,0 total FROM trdrka WHERE kd_kegiatan IN 
                  (SELECT kd_kegiatan FROM trdspd WHERE no_spd = '$lcnospd')
                  UNION ALL
                    select 0 jumlah, sum(total) as jm_spd_l, 0 total from trhspd where no_spd<>'$lcnospd' 
                and tgl_spd<='$ldtgl_spd' and kd_skpd='$lckdskpd' and jns_beban='$ljns_beban' ) a
                    ";
        $hasilsisa = $this->db->query($sql_sisa);
        $trhsisa = $hasilsisa->row();
          $jmlsisa3 = $trhsisa->sisa;
          $jmlsisa2 = number_format(($trhsisa->sisa),2,',','.');//number_format(ceil($trhsisa->sisa),2,',','.');
        $bilsisa = $this->tukd_model->terbilang($jmlsisa3);

        $csql = "SELECT top 1 * from trkonfig_spd where tgl_konfig_spd<='$ldtgl_spd' order by tgl_konfig_spd desc ";
        $hasil = $this->db->query($csql);
        $trh4 = $hasil->row();
        if($ljns_beban=='51'){
            $njns = 'Belanja Tidak Langsung';
        }else{
          IF($ljns_beban=='62'){
            $njns = 'Pengeluaran Pembiayaan';             
          }else{
            $njns = 'Belanja Langsung';
          }
        }
        
        $xx = 'Bahwa untuk melaksanakan Anggaran '.$njns.' Tahun Anggaran '.$trh3->thn_ang.' berdasarkan Anggaran Kas yang telah
                ditetapkan, perlu disediakan dengan menerbitkan Surat Penyediaan Dana (SPD); ';
            $cRet ="<body style=' background-image: url(".base_url()."/image/spd.bmp) ;background-repeat:no-repeat; background-position: 50% 50%;'>";

        if($kop==5){
            $raimu="BADAN KEUANGAN DAN ASET DAERAH";
        $kepala ="<table width='100%' cellpadding='0px' cellspacing='0' > 
                <tr>
                    <td rowspan='3' width='10%'> <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
                    </td>
                    <td width='90%'><h3><center>PEMERINTAH PROVINSI KALIMANTAN BARAT <br> $raimu <center></h3>
                    </td>

                </tr>
                <tr>
                    <td width='90%'><center>Jalan Ahmad Yani Telepon (0561) 736541 Fax (0561) 738426 <center>
                    </td>
                </tr>
                <tr style='border-bottom:1px'>
                    <td width='90%'><h3><center>PONTIANAK<center></h3>
                    </td>
                </tr> 
                <tr >
                    <td colspan='2'  style='text-align:right; border-bottom: 5px solid black'>Kode Pos 78124
                    </td>
                </tr>                                
        </table>";
    }else{ 
        $kepala="";
        $raimu="BADAN PENGELOLAAN KEUANGAN DAN PENDAPATAN DAERAH";

    }
    $cRet .="$kepala";

//              style=\"font-size:12px\"
//  <table style=\"border-collapse:collapse;font-family: arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

        $cRet .="<br><br>
        
        <table style=\"border-collapse:collapse;font-weight: bold;font-family: Times New Roman; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\">
            <tr>
                <td align=\"center\" style=\"font-size: 11px;\">KEPUTUSAN KEPALA $raimu SELAKU BENDAHARA UMUM DAERAH <br> </td>
            <tr>
            <td align=\"center\">NOMOR : $nospd_cetak  <br></td></tr>
             <tr>
            <td align=\"center\">TENTANG</td></tr>
             <tr>
            <td align=\"center\">SURAT PENYEDIAAN DANA ANGGARAN BELANJA DAERAH TAHUN ANGGARAN $trh3->thn_ang</td></tr>
            <tr>
            <td align=\"center\" style=\"text-transform: uppercase;\">KEPALA $raimu SELAKU BENDAHARA UMUM DAERAH</td></tr>
        </table>";
        
        
        $sql = "EXEC otori_spd '$ldtgl_spd'";
        $hasil = $this->db->query($sql);
        $num_row = $hasil->num_rows();
        $font=10;
        if($num_row>10){
            $font = $font-2;
        }
        $cRet .="<table style=\"border-collapse:collapse;font-family: Times New Roman;; font-size:$font px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                <tr>
                    <td width=\"3%\" align=\"right\" valign=\"top\">&nbsp;</td>
                    <td width=\"13%\" align=\"left\" valign=\"top\" ><strong>Menimbang</strong></td>
                    <td width=\"2%\" align=\"right\" valign=\"top\">:</td>
                    <td width=\"81%\" align=\"justify\" colspan=\"2\" rowspan=\"2\" valign=\"top\" >$xx</td>
                </tr>
                <tr>
                    <td align=\"right\" valign=\"top\">&nbsp;</td>
                    <td align=\"left\" valign=\"top\" >&nbsp;</td>
                    <td align=\"right\" valign=\"top\">&nbsp;</td>
                </tr>

        ";
        
        $kolom1 = '';
        //$sql = "EXEC otori_spd '$ldtgl_spd'";
        //$hasil = $this->db->query($sql);
        foreach ($hasil->result() as $row){
            $cno1 = $row->no1;
            $cket = $row->ket;
            $ctanda = $row->tanda;
            
            if($cno1=='1'){
                $kolom1 = 'Mengingat';
                $kolom2 = ':';
            }else{
                $kolom1 ='';
                $kolom2 = '';
            }
            
            if($ctanda=='F'){
                $ctambah = $lcnmskpd.' Tahun Anggaran '.$trh3->thn_ang.';';
            }else{
                $ctambah = '';
            }
            
            
            $cRet .="<tr>
                        <td align=\"right\" valign=\"top\" > &nbsp;</td>
                        <td align=\"left\" valign=\"top\"><strong>$kolom1</strong></td>
                        <td align=\"right\" valign=\"top\" >$kolom2</td>
                        <td width=\"2%\" align=\"right\" valign=\"top\" >$cno1.</td>
                        <td width=\"79%\" align=\"justify\" >$cket $ctambah</td>
                    </tr>";
        }
        $cRet .="</table>";
        
        $cRet .="        
        <table style=\"border-collapse:collapse;font-family: arial;  font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
        
            <tr>
                <td colspan=\"7\" align=\"center\" valign=\"top\" width=\"100%\"  style=\"font-size:12px\"> 
                    <strong>M E M U T U S K A N :<strong>&nbsp;
                </td>
            </tr>
            <tr>
                 <td width=\"10%\"  style=\"font-size:12px\" align=\"right\">&nbsp;
                </td>
                <td colspan=\"6\" align=\"left\" valign=\"top\" width=\"90%\"  style=\"font-size:12px\">
                    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;$trh4->memutuskan &nbsp;
                </td>
            </tr>
            <tr>
                <td width=\"10%\"  style=\"font-size:12px\" align=\"right\">&nbsp;
                </td>
                <td width=\"3%\"   style=\"font-size:12px\">1.
                </td>
                <td width=\"35%\"  style=\"font-size:12px\">Ditujukan kepada SKPD
                </td>
                <td  width=\"2%\" style=\"font-size:12px\">:
                </td>
                <td  width=\"50%\" colspan=\"3\"   style=\"font-size:12px\">$lckdskpd - $lcnmskpd
                </td>
            </tr>
            <tr>
                <td style=\"font-size:12px\" align=\"right\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">2.
                </td>
                <td style=\"font-size:12px\" valign=\"top\">Bendahara Pengeluaran / Pengeluaran Pembantu 
                </td>
                <td  style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  colspan=\"3\" style=\"font-size:12px\" valign=\"top\">$nama1
                </td>
            </tr>
            <tr>
                <td rowspan=\"2\"  style=\"font-size:12px\" valign=\"top\" align=\"right\">&nbsp;
                </td>
                <td rowspan=\"2\" style=\"font-size:12px\" valign=\"top\">3.
                </td>
                <td rowspan=\"2\" style=\"font-size:12px\" valign=\"top\">Jumlah Penyediaan dana
                </td>
                <td  rowspan=\"2\" style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td width=\"4%\" style=\"font-size:12px\">Rp. <br></td>
                <td width=\"20%\" align=\"right\" style=\"font-size:12px\">  $jmlspdini</td>
                <td width=\"26%\"></td>
            </tr>
            <tr>
                <td  colspan=\"3\" style=\"font-size:12px\"><i>(terbilang: $biljmlini)</i></td>
            </tr>
            <tr>
                <td  style=\"font-size:12px\" align=\"right\">&nbsp;
                </td>
                <td style=\"font-size:12px\">4.
                </td>
                <td style=\"font-size:12px\">Untuk Kebutuhan / Jenis Beban
                </td>
                <td  style=\"font-size:12px\">:
                </td>
                <td  colspan=\"3\"   style=\"font-size:12px\">$tambah Bulan $blnini s.d Bulan $blnsd $trh3->thn_ang / $njns
                </td>
            </tr>
            <tr>
                <td style=\"font-size:12px\" align=\"right\">&nbsp;
                </td>
                <td style=\"font-size:12px\">5.
                </td>
                <td style=\"font-size:12px\"><u><strong>IKHTISAR PENYEDIAAN DANA : </strong></u>
                </td>
                <td  style=\"font-size:12px\">
                </td>
                <td  colspan=\"3\"   style=\"font-size:12px\">
                </td>
            </tr>
            <tr>
                <td style=\"font-size:12px\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">a. Jumlah dana DPA-SKPD/DPPA-SKPD/DPAL
                </td>
                <td style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td style=\"font-size:12px\">Rp. <br></td>
                <td align=\"right\" style=\"font-size:12px\">  $jmldpa</td>
                <td ></td>
                
            </tr>
            <tr>
                <td  style=\"font-size:12px\">&nbsp;
                </td>
                <td  style=\"font-size:12px\" valign=\"top\">&nbsp;
                </td>
                <td  style=\"font-size:12px;\" valign=\"top\">b. Akumulasi SPD sebelumnya
                </td>
                <td  style=\"font-size:12px\" valign=\"top\">:
                </td>
               <td style=\"font-size:12px;border-bottom: solid 1px black;\">Rp. <br></td>
                <td align=\"right\" style=\"font-size:12px;border-bottom: solid 1px black;\">  $jmlspdlalu</td>
                <td ></td>

                </tr>
            <tr>
                <td style=\"font-size:12px\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">c. Sisa dana yang belum di-SPD-kan
                </td>
                <td  style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td style=\"font-size:12px\">Rp. <br></td>
                <td align=\"right\" style=\"font-size:12px\">  $jmlsisa</td>
                <td ></td>
            </tr>
           <tr>
                <td style=\"font-size:12px\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">&nbsp;
                </td>
                <td style=\"font-size:12px\" valign=\"top\">d. Jumlah dana yang di-SPD-kan saat ini
                </td>
                <td style=\"font-size:12px;\" valign=\"top\">:
                </td>
               <td style=\"font-size:12px;border-bottom: solid 1px black;\">Rp. <br></td>
                <td align=\"right\" style=\"font-size:12px;border-bottom: solid 1px black;\">  $jmlspdini</td>
                <td ></td>

            </tr>
            <tr>
                <td rowspan=\"2\"  style=\"font-size:12px\">&nbsp;
                </td>
                <td rowspan=\"2\"  style=\"font-size:12px\" valign=\"top\">&nbsp;
                </td>
                <td rowspan=\"2\"  style=\"font-size:12px\" valign=\"top\">e. Sisa jumlah dana DPA yang belum di-SPD-kan
                </td>
                <td rowspan=\"2\"  style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td style=\"font-size:12px;border-bottom: solid 2px black;\">Rp. <br></td>
                <td align=\"right\" style=\"font-size:12px;border-bottom: solid 2px black;\">  $jmlsisa2 <br>
                </td>
                <td ></td>

            </tr>
            <tr>
                <td  colspan=\"3\" style=\"font-size:12px\"><i>(terbilang: $bilsisa)</i></td>
            </tr>
            <tr> 
                <td style=\"font-size:12px\">&nbsp;
                </td>
                <td style=\"font-size:12px\" align=\"right\" valign=\"top\">6.
                </td>
                <td style=\"font-size:12px\" valign=\"top\">Ketentuan-ketentuan lain
                </td>
                <td style=\"font-size:12px\" valign=\"top\">:
                </td>
                <td  colspan=\"3\" align=\"justify\" style=\"font-size:12px\">Terhadap cara memperoleh, menggunakan dan mempertanggung- jawabkan
uang yang dimaksud tetap berpedoman pada Peraturan Perundang-Undangan
yang berlaku
                </td>
            </tr>           
            </table>";
             // CETAKAN TANDA TANGAN by Tox
            $cRet .="
             <table style=\"border-collapse:collapse;font-weight:none;font-family: arial; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\">
        <tr>
                <td width=\"50%\" align=\"right\" colspan=\"2\">&nbsp;
                </td>               
                <td width=\"50%\"  align=\"left\"><br>Ditetapkan di Pontianak</td>
                </td>
            </tr>
        <tr >
                <td align=\"right\" colspan=\"2\">&nbsp;
                </td>   
                <td  text-indent: 50px; align=\"left\"><u>Pada tanggal :&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                &nbsp;&nbsp;&nbsp;&nbsp;<u></td>
                </td>
            </tr>   
        <tr >
                <td width=\"40%\" align=\"right\">&nbsp;</td>
                <td width=\"60%\"  align=\"center\" colspan=\"2\" style=\"text-transform: uppercase;\">PLT. KEPALA $raimu <br>SELAKU BENDAHARA UMUM DAERAH<BR>&nbsp;<br>&nbsp;<br>&nbsp;</td>
                </td>
            </tr>   
        <tr >
                <td align=\"right\">&nbsp;</td>
                <td  align=\"center\" colspan=\"2\"><u>$nama_ppkd</u></td>
                </td>
            </tr>
                <tr >
                <td align=\"right\">&nbsp;</td>
                <td align=\"center\" colspan=\"2\">$pangkat_ppkd</td>
                </td>
            </tr>
        <tr >
                <td  align=\"right\">&nbsp;</td>
                <td align=\"center\" colspan=\"2\">NIP. $nip_ppkd</td>
                </td>
            </tr>           
        </table>";


        $data['prev']= $cRet;
         
        
        if ($print==1){
            // $this->rka_model->_mpdf_folio('',$cRet,10,10,10,'0');
            $this->_mpdf('',$cRet,10,10,10,'0','no','','',$kop);

        } else{
          echo $cRet;
        }

}

    
///////////////SPD AKHIR
     function ang_kas($skpd='',$cetak='')
    {
        $data['page_title']= 'ANGGARAN KAS';
        $this->template->set('title', 'ANGGARAN KAS');   
        $this->template->load('template','anggaran/rka/cetak_anggaran_kas',$data) ; 
    }

   function anggaran_kas_ubah()
	{
        $data['page_title']= 'INPUT ANGGARAN KAS PERUBAHAN';
        $this->template->set('title', 'INPUT ANGGARAN KAS PERUBAHAN');   
        $this->template->load('template','anggaran/rka/anggaran_kas_ubah',$data) ; 
   }
                   
  function angaran_kas($skpd='',$cetak=0){
        
       $cell = $this->uri->segment(5);
       $ang_t=0;
       $jan_t=0;
       $feb_t=0;
       $mar_t=0;
       $apr_t=0;
       $mei_t=0;
       $jun_t=0;
       $jul_t=0;
       $ags_t=0;
       $sep_t=0;
       $okt_t=0;
       $nov_t=0;
       $des_t=0;
       
       $jtriw1=0;
       $jtriw2=0;
       $jtriw3=0;
       $jtriw4=0;
       
	   
       $id     = $skpd;
            $qrskpd = $this->db->query("select upper(nm_skpd) as cnmskpd from ms_skpd where kd_skpd='$id'");

       $ttd1= $_REQUEST['ttd1'];
       $tgl= $_REQUEST['tgl_ttd'];
       $tanggal = '';//$this->tanggal_format_indonesia($tgl);
       
       foreach( $qrskpd->result() as $qrskpd ){
            $nmskpd = $qrskpd->cnmskpd; 
       }
        
        
       $qrorg = $this->db->query("select kd_org,nm_org from ms_organisasi where left(kd_org,7)=left('$id',7)");
       
       foreach( $qrorg->result() as $qrorg ){
            $kd_org = $qrorg->kd_org;
            $nm_org = $qrorg->nm_org;
             
       }

       
       $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang,daerah FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                    $kota =  $rowsc->daerah;
                }
        

       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {                   
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }
        
        $cRet='<META http-equiv="X-UA-Compatible" content="IE=8"/>';
        $cRet1='';
        $cRet2='';
      
            $cRet .="<table style=\"border-collapse:collapse;font-size:20px;font-weight:bold;\" width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td align=\"center\">$kab</td>
                             
                        </tr>
                         <tr>
                             <td align=\"center\">ANGGARAN KAS PENGELUARAN</td>
                        </tr>
                        
                        <tr>
                             <td align=\"center\">TAHUN ANGGARAN $thn</td>
                        </tr>
    
                        <tr>
                             <td>&nbsp;</td>
                        </tr>
                   </table>";  

        if($id!=0){
            
            $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:12px;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td width=\"10%\" >Organisasi</td>
                             <td width=\"2%\">:</td>
                             <td width=\"88%\">$kd_org - $nm_org</td>
                        </tr>
    
                        <tr>
                             <td>Sub Unit Organisasi</td>
                             <td>:</td>
                             <td>$skpd - $nmskpd</td>
                        </tr>
                        <tr>
                            <td colspan=\"3\">&nbsp;</td>
                        </tr>
                    </table>";  
        }

        $font = 8;
        $font1 = $font-1;
        $cRet .= "<table style=\"border-collapse:collapse; font-size=$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead>                       
                        <tr>
                            <td rowspan=\"2\" width=\"9%\" align=\"center\"><b>Kode</b></td>                            
                            <td rowspan=\"2\" width=\"11%\" align=\"center\"><b>Uraian</b></td>                            
                            <td rowspan=\"2\" width=\"8%\" align=\"center\"><b>Jumlah <br>(Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan I (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan II (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan III (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan IV (Rp.)</b></td>
                            </tr>
                        <tr>
 		                     <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jan</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Feb</td>                             
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mar</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Apr</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mei</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jun</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jul</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Ags</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Sep</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Okt</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Nov</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Des</td>
                        </tr>
                        <tr>
 		                     <td  style=\"font-weight:bold;\" align=\"center\">1</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">2</td>                             
                             <td  style=\"font-weight:bold;\" align=\"center\">3</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">4</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">5</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">6</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">7</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">8</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">9</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">10</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">11</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">12</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">13</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">14</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">15</td>
                        </tr>    
                            
                     </thead>                    
                        <tr><td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>                            
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                        </tr>
                        <tfoot sytle=\"display:table-footer-group;\" border=\"1\">
                            <tr>
                                <td colspan=\"15\"></td> 
                            </tr>                 
                       </tfoot>
  
                        <tbody>
                        ";
                        
                                      
      
                // Pendapatan & Penerimaan Pendapatan
                // 0 = keseluruhan 
                if($id != 0){                             
                     $sql="SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where b.kd_skpd='$id' and (right(b.kd_kegiatan,5)='00.04' or right(b.kd_kegiatan,5)='00.61')
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan ";
                }else{

                     $sql="select kd_skpd = case nm_kegiatan 
                            when 'Pendapatan' then '' 
                            when 'Penerimaan Pembiayaan' then 'PPKD' end,
                            kd_kegiatan = case nm_kegiatan 
                            when 'Pendapatan' then '0.00.0.00.00.00.00.04' 
                            when 'Penerimaan Pembiayaan' then '0.00.0.00.00.00.00.61' end
                            ,nm_kegiatan,isnull(sum(total),0) [total]
                            ,isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],isnull(sum(apr),0) [apr]
                            ,isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags]
                            ,isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] 
                            from(
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=1) AS jan,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=2) AS feb,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=3) AS mar,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=4) AS apr,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=5) AS mei,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=6) AS jun,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=7) AS jul,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=8) AS ags,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=9) AS sep,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=10) AS okt,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=11) AS nov,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=12) AS des  
                            FROM trdrka b where (right(b.kd_kegiatan,5)='00.04' or right(b.kd_kegiatan,5)='00.61' )
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),b.nm_kegiatan,b.kd_kegiatan
                            ) as c group by c.nm_kegiatan
                            union all
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],c.nm_org [nm_kegiatan],isnull(sum(b.nilai),0) [total],
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=1) AS jan,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=2) AS feb,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=3) AS mar,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=4) AS apr,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=5) AS mei,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=6) AS jun,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=7) AS jul,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=8) AS ags,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=9) AS sep,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=10) AS okt,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=11) AS nov,
                                (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=12) AS des  
                            FROM trdrka b 
                            join ms_organisasi c on c.kd_org= LEFT(b.kd_skpd,7)
                            where (right(b.kd_kegiatan,5)='00.04' )
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),c.nm_org 
                            order by kd_skpd";                    
                    
                }
                  $qtpend = $this->db->query($sql);
                  $num_rowpend = $qtpend->num_rows();
                    
                    
                    $ang_t=0;
                    $ang_tpend=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1pend = 0;
                    $jtriw2pend = 0;
                    $jtriw3pend = 0;
                    $jtriw4pend = 0;
                    
                    if ($num_rowpend>0){
                        foreach ($qtpend->result() as $row){
                            $cskpdcek = ($row->kd_skpd);
                            $kode = ($row->kd_kegiatan);
                            $nama=$row->nm_kegiatan;
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
							
                          if($cskpdcek=='' || $cskpdcek=='PPKD'){                            
                                $ang_tpend=$ang_tpend+$ang;
                                $jan_t=$jan_t+$jan;
                                $feb_t=$feb_t+$feb;
                                $mar_t=$mar_t+$mar;
                                $apr_t=$apr_t+$apr;
                                $mei_t=$mei_t+$mei;
                                $jun_t=$jun_t+$jun;
                                $jul_t=$jul_t+$jul;
                                $ags_t=$ags_t+$ags;
                                $sep_t=$sep_t+$sep;
                                $okt_t=$okt_t+$okt;
                                $nov_t=$nov_t+$nov;
                                $des_t=$des_t+$des;

                                $jtriw1pend = $jtriw1pend + ($jan+$feb+$mar);
                                $jtriw2pend = $jtriw2pend + ($apr+$mei+$jun);
                                $jtriw3pend = $jtriw3pend + ($jul+$ags+$sep);
                                $jtriw4pend = $jtriw4pend + ($okt+$nov+$des);
                                
                                $cskpd = '';
                            }else{
                                $cskpd = $cskpdcek;
                            }
                            
                            $ckode = substr($kode,-5);

                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 
                            
                            $cRet    .= "<tr><td style=\"vertical-align:top;font-weight:bold;\" >$cskpd</td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">$nama</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";

                        }      
                    }else{
                        
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pendapatan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                            
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Penerimaan Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                    
                    if($num_rowpend==1){
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Penerimaan Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                
                    $ang_t=number_format($ang_tpend,"2",",",".");
                    $jan_t=number_format($jan_t,"2",",",".");
                    $feb_t=number_format($feb_t,"2",",",".");
                    $mar_t=number_format($mar_t,"2",",",".");
                    $apr_t=number_format($apr_t,"2",",",".");
                    $mei_t=number_format($mei_t,"2",",",".");
                    $jun_t=number_format($jun_t,"2",",",".");
                    $jul_t=number_format($jul_t,"2",",",".");
                    $ags_t=number_format($ags_t,"2",",",".");
                    $sep_t=number_format($sep_t,"2",",",".");
                    $okt_t=number_format($okt_t,"2",",",".");
                    $nov_t=number_format($nov_t,"2",",",".");
                    $des_t=number_format($des_t,"2",",","."); 
                    
                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Jumlah Pendapatan & Pembiayaan Penerimaan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t</td>
                                </tr>";                                                     
                    
                    $jtriw1_t = number_format($jtriw1pend,2,',','.');
                    $jtriw2_t = number_format($jtriw2pend,2,',','.');
                    $jtriw3_t = number_format($jtriw3pend,2,',','.');
                    $jtriw4_t = number_format($jtriw4pend,2,',','.');

                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Jumlah Alokasi Kas yang tersedia untuk pengeluran</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" >$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                                </tr>";                                                     

                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                                                     
                  
                  
                 //Belanja Tidak Langsung
                if($id==0){
                    $sql="select kd_skpd = case nm_kegiatan 
                            when 'Belanja Tidak Langsung' then '' 
                            when 'Pengeluaran Pembiayaan' then 'PPKD' end,
                            kd_kegiatan = case nm_kegiatan 
                            when 'Belanja Tidak Langsung' then '0.00.0.00.00.00.00.51' 
                            when 'Pengeluaran Pembiayaan' then '0.00.0.00.00.00.00.61' end
                            ,nm_kegiatan,isnull(sum(total),0) [total]
                            ,isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],isnull(sum(apr),0) [apr]
                            ,isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags]
                            ,isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] 
                            from(
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=12) AS des  
                            FROM trdrka b where (right(b.kd_kegiatan,5)='00.51' or  right(b.kd_kegiatan,5)='00.62') 
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),b.nm_kegiatan,b.kd_kegiatan
                            )as c group by c.nm_kegiatan                         
                            union all
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],c.nm_org [nm_kegiatan],isnull(sum(b.nilai),0) [total],
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=1) AS jan,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=2) AS feb,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=3) AS mar,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=4) AS apr,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=5) AS mei,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=6) AS jun,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=7) AS jul,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=8) AS ags,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=9) AS sep,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=10) AS okt,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=11) AS nov,
                                                        (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=12) AS des  
                                                    FROM trdrka b 
                                                    join ms_organisasi c on c.kd_org= LEFT(b.kd_skpd,7)
                                                    where (right(b.kd_kegiatan,5)='00.51') 
                                                    GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),c.nm_org 
                            order by kd_skpd";                    
                }else{                    
                    $sql="SELECT '' kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            (SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                        FROM trdrka b where b.kd_skpd='$id' and (right(b.kd_kegiatan,5)='00.51' or  right(b.kd_kegiatan,5)='00.62') 
                        GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan";
                }         
                  $qtbtl = $this->db->query($sql);
                  $num_rowbtl = $qtbtl->num_rows();
                    
                    
                    $ang_tbtl=0;
                    $ang_t=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1btl = 0;
                    $jtriw2btl = 0;
                    $jtriw3btl = 0;
                    $jtriw4btl = 0;
                    
                    
                    if ($num_rowbtl>0){
                        foreach ($qtbtl->result() as $row){
                            $cskpdcek = ltrim($row->kd_skpd);
                            $nama=$row->nm_kegiatan;
                            $kode = ($row->kd_kegiatan);
                            //$ang=$row->total;
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            
                            if($cskpdcek=='' || $cskpdcek=='PPKD'){ 
                                $ang_tbtl=$ang_tbtl+$ang;
                                $jan_t=$jan_t+$jan;
                                $feb_t=$feb_t+$feb;
                                $mar_t=$mar_t+$mar;
                                $apr_t=$apr_t+$apr;
                                $mei_t=$mei_t+$mei;
                                $jun_t=$jun_t+$jun;
                                $jul_t=$jul_t+$jul;
                                $ags_t=$ags_t+$ags;
                                $sep_t=$sep_t+$sep;
                                $okt_t=$okt_t+$okt;
                                $nov_t=$nov_t+$nov;
                                $des_t=$des_t+$des;

                                $jtriw1btl = $jtriw1btl + ($jan+$feb+$mar);
                                $jtriw2btl = $jtriw2btl + ($apr+$mei+$jun);
                                $jtriw3btl = $jtriw3btl + ($jul+$ags+$sep);
                                $jtriw4btl = $jtriw4btl + ($okt+$nov+$des);
                                
                                $cskpd = '';
                            }else{
                                $cskpd = $cskpdcek;
                            }

                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 
                            
                            $cRet    .= "<tr><td style=\"vertical-align:top;font-weight:bold;\">$cskpd</td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">$nama</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";

                        }      
                    }else{
                        
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Belanja Tidak Langsung</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                            
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                    
                    if($num_rowbtl==1){
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                
                    $ang_t=number_format($ang_tbtl,"2",",",".");
                    $jan_t=number_format($jan_t,"2",",",".");
                    $feb_t=number_format($feb_t,"2",",",".");
                    $mar_t=number_format($mar_t,"2",",",".");
                    $apr_t=number_format($apr_t,"2",",",".");
                    $mei_t=number_format($mei_t,"2",",",".");
                    $jun_t=number_format($jun_t,"2",",",".");
                    $jul_t=number_format($jul_t,"2",",",".");
                    $ags_t=number_format($ags_t,"2",",",".");
                    $sep_t=number_format($sep_t,"2",",",".");
                    $okt_t=number_format($okt_t,"2",",",".");
                    $nov_t=number_format($nov_t,"2",",",".");
                    $des_t=number_format($des_t,"2",",","."); 
          
                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Bulan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t</td>
                                </tr>";                                                     
                    
                    $jtriw1_t = number_format($jtriw1btl,2,',','.');
                    $jtriw2_t = number_format($jtriw2btl,2,',','.');
                    $jtriw3_t = number_format($jtriw3btl,2,',','.');
                    $jtriw4_t = number_format($jtriw4btl,2,',','.');

                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Triwulan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                                </tr>";                                                     

                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
                 
                //Sisa Kas BTL
                $ang_t = $this->rp_minus($ang_tpend - $ang_tbtl);
                $jtriw1_t = $this->rp_minus($jtriw1pend - $jtriw1btl);
                $jtriw2_t = $this->rp_minus($jtriw2pend - $jtriw2btl);
                $jtriw3_t = $this->rp_minus($jtriw3pend - $jtriw3btl);
                $jtriw4_t = $this->rp_minus($jtriw4pend - $jtriw4btl);

                $cRet    .= " <tr><td></td> 
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Sisa Kas setelah dikurangi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Triwulan</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                            </tr>";                                                     
              
                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
            
                //BL
                if($id==0){
                    $where1 = '';
                }else{
                    $where1 = "b.kd_skpd='$id' and ";
                }    
                $sql="  select kd_skpd,isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                        isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                        isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                            SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where $where1 SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan
                        ) c group by kd_skpd";
                    $qtbl = $this->db->query($sql);
                    $num_rowbl = $qtbl->num_rows();

                    $ang_tbl=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1bl = 0;
                    $jtriw2bl = 0;
                    $jtriw3bl = 0;
                    $jtriw4bl = 0;

                     
                    if($num_rowbl>0){
                        foreach ($qtbl->result() as $row){
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            $ang_tbl=$ang_tbl+$ang;
        
                            $jan_t=$jan_t+$jan;
                            $feb_t=$feb_t+$feb;
                            $mar_t=$mar_t+$mar;
        
                            $apr_t=$apr_t+$apr;
                            $mei_t=$mei_t+$mei;
                            $jun_t=$jun_t+$jun;
        
                            $jul_t=$jul_t+$jul;
                            $ags_t=$ags_t+$ags;
                            $sep_t=$sep_t+$sep;
        
                            $okt_t=$okt_t+$okt;
                            $nov_t=$nov_t+$nov;
                            $des_t=$des_t+$des;

                            $jtriw1bl = $jtriw1bl + ($jan+$feb+$mar);
                            $jtriw2bl = $jtriw2bl + ($apr+$mei+$jun);
                            $jtriw3bl = $jtriw3bl + ($jul+$ags+$sep);
                            $jtriw4bl = $jtriw4bl + ($okt+$nov+$des);
                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 



                            $cRet    .= "<tr><td></td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Belanja Langsung</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";
                         }                        
                    }else{
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Belanja Langsung</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                        
                    }
               
                 //rincian    
                 if($id==0){
                     $sql1="select * from(
                                select kd_skpd,kd_skpd [kd_kegiatan],nm_skpd [nm_kegiatan],isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c group by kd_skpd,nm_skpd
                            union all
                            select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                            isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                            isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                            union all
                            SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";                 
                 }else{
                     $sql1="select * from(
                                select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where b.kd_skpd='$id' and SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                                ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                                union all
                                SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    	(SELECT isnull(SUM(nilai),0) FROM trdskpd WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where b.kd_skpd='$id' and SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";
                }                 
                $query = $this->db->query($sql1);

                    $ang_t=0;
                    $ang_t2=0;
                    $jan_t2=0;
                    $feb_t2=0;
                    $mar_t2=0;
                    $apr_t2=0;
                    $mei_t2=0;
                    $jun_t2=0;
                    $jul_t2=0;
                    $ags_t2=0;
                    $sep_t2=0;
                    $okt_t2=0;
                    $nov_t2=0;
                    $des_t2=0;
                    $jtriw1_t = 0;
                    $jtriw2_t = 0;
                    $jtriw3_t = 0;
                    $jtriw4_t = 0;

                                                                    
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_kegiatan;
                    $nama=$row->nm_kegiatan;
                    
                    $jan=$row->jan;
                    $feb=$row->feb;
                    $mar=$row->mar;
                    $apr=$row->apr;
                    $mei=$row->mei;
                    $jun=$row->jun;
                    $jul=$row->jul;
                    $ags=$row->ags;
                    $sep=$row->sep;
                    $okt=$row->okt;
                    $nov=$row->nov;
                    $des=$row->des;
                    $ang = number_format($jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des,"2",",",".");
                   
                    if(strlen($kode)<=18){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size: '.$font1.' px;';
                    }else{
                        $bold='';
                        $fontr = 'font-size: '.$font.' px;';
                    }

                    $jan=number_format($jan,"2",",",".");
                    $feb=number_format($feb,"2",",",".");
                    $mar=number_format($mar,"2",",",".");
                    $apr=number_format($apr,"2",",",".");
                    $mei=number_format($mei,"2",",",".");
                    $jun=number_format($jun,"2",",",".");
                    $jul=number_format($jul,"2",",",".");
                    $ags=number_format($ags,"2",",",".");
                    $sep=number_format($sep,"2",",",".");
                    $okt=number_format($okt,"2",",",".");
                    $nov=number_format($nov,"2",",",".");
                    $des=number_format($des,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;$bold $fontr \" >$kode </td>                            
                                        <td style=\"vertical-align:top;$bold $fontr \" >$nama</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ang</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jan</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$feb</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mar</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$apr</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mei</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jun</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jul</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ags</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$sep</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$okt</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$nov</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$des</td>
                                    </tr>
                                     ";
                  }  
                  
                    $ang_t2=number_format($ang_tbl,"2",",",".");
                    $jan_t2=number_format($jan_t,"2",",",".");
                    $feb_t2=number_format($feb_t,"2",",",".");
                    $mar_t2=number_format($mar_t,"2",",",".");
                    $apr_t2=number_format($apr_t,"2",",",".");
                    $mei_t2=number_format($mei_t,"2",",",".");
                    $jun_t2=number_format($jun_t,"2",",",".");
                    $jul_t2=number_format($jul_t,"2",",",".");
                    $ags_t2=number_format($ags_t,"2",",",".");
                    $sep_t2=number_format($sep_t,"2",",",".");
                    $okt_t2=number_format($okt_t,"2",",",".");
                    $nov_t2=number_format($nov_t,"2",",",".");
                    $des_t2=number_format($des_t,"2",",",".");
                                      
                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Langsung Per Bulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t2</td>
                                    </tr>";
                                             
                    $jtriw1_t = number_format($jtriw1bl,2,',','.');
                    $jtriw2_t = number_format($jtriw2bl,2,',','.');
                    $jtriw3_t = number_format($jtriw3bl,2,',','.');
                    $jtriw4_t = number_format($jtriw4bl,2,',','.');

                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Langsung Per Triwulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                    </tr>";  

                  $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
        
                    //sisa kas bl
                    $ang_t = $this->rp_minus($ang_tpend - $ang_tbl);
                    $jtriw1_t = $this->rp_minus($jtriw1pend - $jtriw1bl);
                    $jtriw2_t = $this->rp_minus($jtriw2pend - $jtriw2bl);
                    $jtriw3_t = $this->rp_minus($jtriw3pend - $jtriw3bl);
                    $jtriw4_t = $this->rp_minus($jtriw4pend - $jtriw4bl);
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Sisa Kas setelah dikurangi Belanja Langsung Per Triwulan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  


                    //bl+btl+pengeluaran pembiayaan
                    $ang_t = $this->rp_minus($ang_tbtl + $ang_tbl);
                    $jtriw1_t = $this->rp_minus($jtriw1btl + $jtriw1bl);
                    $jtriw2_t = $this->rp_minus($jtriw2btl + $jtriw2bl);
                    $jtriw3_t = $this->rp_minus($jtriw3btl + $jtriw3bl);
                    $jtriw4_t = $this->rp_minus($jtriw4btl + $jtriw4bl);
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung dan Belanja Langsung serta pembiayaan pengeluaran</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  


                    //bl+btl+pengeluaran pembiayaan
                    $ang_t = $this->rp_minus($ang_tpend - ($ang_tbtl + $ang_tbl));
                    $jtriw1_t = $this->rp_minus($jtriw1pend - ($jtriw1btl + $jtriw1bl));
                    $jtriw2_t = $this->rp_minus($jtriw2pend - ($jtriw2btl + $jtriw2bl));
                    $jtriw3_t = $this->rp_minus($jtriw3pend - ($jtriw3btl + $jtriw3bl));
                    $jtriw4_t = $this->rp_minus($jtriw4pend - ($jtriw4btl + $jtriw4bl));
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Sisa Kas setelah dikurangi Belanja Tidak Langsung dan Belanja Langsung serta pembiayaan pengeluaran</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  

 
 
            $cRet .="<tr>
                        <td colspan=\"15\" width=\"100%\">							
					        <table border=\"0\" width=\"100%\">
					            <tr>								
					                <td width=\"70%\">&nbsp;</td>
					                <td width=\"30%\" align=\"center\">$kota,$tanggal
					                    <br>$jabatan1
                                        <p>&nbsp;</p>
                                        <br>
                                        <br>
    				                    <br><b><u>$nama1</u></b>
    				                    <br>$pangkat1 
    				                    <br>$nip1 
					                </td>
                                </tr>
                            </table>
                        </td>
                 </tr>
                 </tbody>
                 
               ";
        
            
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        if ($id==0){
            $id = 'Keseluruhan'; 
        }
            $judul  = 'Anggaran_Kas_'.$id;//'Anggaran_KAS_'.$id;
        $this->template->set('title', 'CETAK PERDA REALISASI LAMPIRAN V');        
        switch($cetak) {
        case 0;  
                echo ("<title>A</title>");
                echo($cRet);
            break;
        case 1;
      		ini_set('memory_limit','10000M');
            set_time_limit(10000);

             $this->_mpdf('',$cRet,5,3,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;
            ini_set('memory_limit','10000M');
            set_time_limit(10000);
            
            $this->_mpdf('',$cRet,5,3,10,'1','','',$judul);        

/*
        header ("Cache-Control: must-revalidate, post-check=0, pre-check=0");
        header('Content-Type: application/octetstream');
        header("Content-Transfer-Encoding: Binary");
        header("Content-length: ".filesize($data));
        header("Content-disposition: attachment; filename= $judul.pdf");
        readfile("$data");  
        break;
*/
        } 
    }


	
				   
				   
  function total_spd($skpd='',$awal=0,$ahir=12){
        
        $skpd     = $skpd;
        $stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="nilai";		
			$sts="susun";		
		}else{
			$field="nilai";				
			$sts="ubah";		
		}
         $sql = "SELECT SUM($field) as nilai FROM trdskpd  WHERE kd_skpd='$skpd' and bulan>=$awal AND bulan<=$ahir and status='$sts' ";
				
        $query1 = $this->db->query($sql);  
		$test   = $query1->num_rows();
        $ii     = 0;
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'total' => $resulte['nilai']
                        );
                        $ii++;
        }
		
		if ($test===0){
            $result = array(
                        'total' => ''
                        );
                        $ii++;
		}		
        echo json_encode($result);
    	$query1->free_result();   
    }
    
    
    function total_spd_ar($jenis='',$skpd='',$awal=0,$ahir=12){
        
        if ($jenis=='5'){
		  $dan="left(b.jns_kegiatan,1) ='$jenis'";
		}else{
		  $dan="b.jns_kegiatan ='$jenis'";
		}
        
        $skpd     = $skpd;
        $stsubah  = $this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="a.nilai";		
			$sts="susun";		
		}else{
			$field="a.nilai";				
			$sts="ubah";		
		}
        
        $sql = "SELECT SUM($field) as nilai FROM trdskpd a inner join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                WHERE a.kd_skpd='$skpd' and a.bulan>=$awal AND a.bulan<=$ahir and a.status='$sts' and $dan ";
				
        $query1 = $this->db->query($sql);  
		$test   = $query1->num_rows();
        $ii     = 0;
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'total' => $resulte['nilai']
                        );
                        $ii++;
        }
		
		if ($test===0){
            $result = array(
                        'total' => ''
                        );
                        $ii++;
		}		
        echo json_encode($result);
    	$query1->free_result();   
    }
    
    function jumlah_detail_spd(){
        
        $no_spd = $this->input->post('cno_spd');
        $sql    = "SELECT SUM(nilai) as nilai FROM trdspd WHERE no_spd = '$no_spd' ";
				
        $query1 = $this->db->query($sql);  
		$test   = $query1->num_rows();
        $ii     = 0;
        
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'total' => $resulte['nilai']
                        );
                        $ii++;
        }
		
		if ($test===0){
            $result = array(
                        'total' => ''
                        );
                        $ii++;
		}		
        echo json_encode($result);
    	$query1->free_result();   
    }


 
   
   	function load_dspd_all_keg($jenis='',$skpd='',$awal=0,$ahir=12,$nospd=''){

		
        $stsubah=$this->rka_model->get_nama($skpd,'status_ubah','trhrka','kd_skpd');
		
		if ($stsubah==0){
			$field="b.nilai";		
			$sts="susun";		
		}else{
			$field="b.nilai_ubah";				
			$sts="ubah";		
		}

		if ($jenis=='52'){
		  $dan="a.jns_kegiatan ='$jenis'";
		 
			$sql = " SELECT a.*,('')kd_rek5,('')nm_rek5,(SELECT SUM($field) FROM trdskpd b WHERE a.kd_kegiatan=b.kd_kegiatan AND b.bulan>=$awal AND b.bulan<=$ahir and b.status='$sts' ) AS nilai FROM trskpd a WHERE a.kd_skpd='$skpd' and $dan";
		  }else{
		  $dan="a.jns_kegiatan ='$jenis'";
		 
			$sql = " select b.kd_kegiatan,f.nm_kegiatan,f.kd_program,c.nm_program,b.kd_rek5,d.nm_rek5,$field from trdrka b inner join m_giat f
 on b.kd_kegiatan=f.kd_kegiatan inner join m_prog c on 
f.kd_program=c.kd_program inner join ms_rek5 d on b.kd_rek5=d.kd_rek5 where b.kd_kegiatan in 
(select kd_kegiatan FROM trskpd a WHERE a.kd_skpd='$skpd' and $dan) order by b.kd_rek5";
		  }

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 

			if ($stsubah==0){
				$angg="nilai";		
			}else{
				$angg="nilai_ubah";				
			}
			if ($jenis=='52'){
				$n_nilai=$resulte['nilai'];
				if ($stsubah==0){
					$angg="total";		
				}else{
					$angg="total_ubah";				
				}	
			} else {
				$n_nilai=0;
				
			}
			
			$giat=$resulte['kd_kegiatan'];
			$rek=$resulte['kd_rek5'];
			 $q_rek="a.kd_rek5 ='$rek'";
			$s = " SELECT SUM(a.nilai) as nilai FROM trdspd a LEFT JOIN trhspd b ON a.no_spd=b.no_spd WHERE b.kd_skpd='$skpd' AND a.kd_kegiatan='$giat' and $q_rek and a.no_spd<>'$nospd' ";
			$q = $this->db->query($s);  
	        foreach($q->result_array() as $res){
				$lalu=$res['nilai'];
			}


			$result[] = array(
                        'id'          => $ii,        
                        'no_spd'      => '',
                        'kd_kegiatan' => $resulte['kd_kegiatan'],
                        'nm_kegiatan' => $resulte['nm_kegiatan'],
                        'kd_program'  => $resulte['kd_program'],
                        'nm_program'  => $resulte['nm_program'],
                        'kd_rekening' => $resulte['kd_rek5'],
                        'nm_rekening' => $resulte['nm_rek5'],
						'nilai'       => number_format($n_nilai,"2",".",","),
                        'lalu'        => number_format($lalu,"2",".",","),
                        'anggaran'    => number_format($resulte[$angg],"2",".",",")
                        );
                        $ii++;
        }
           
        echo json_encode($result);
        $query1->free_result();	
	}
    
    
    function bulan() {
        for ($count = 1; $count <= 12; $count++)
        {
            $result[]= array(
                     'bln' => $count,
                     'nm_bulan' => $this->tukd_model->getBulan($count)
                     );    
        }
        echo json_encode($result);
	}
    
    
    
     function proses_posting(){

        $skpd = $this->input->post('skpd');
        $this->db->query(" delete from perkada where kd_skpd='$skpd' ");                 

        //Pendapatan
		$sql = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,24) AS kd_rek,SUBSTR(a.no_trdrka,12,24) AS kd_rek1,b.nm_rek2 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '1' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek2 b 
                        ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,24),b.nm_rek2
                        UNION ALL
                        SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '2' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '3' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total, '4' AS nu,' ' AS po,'4' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE  LEFT(a.kd_rek5,1)='4' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian, tvolume AS volume, concat(satuan1,if(LEN(satuan2)=0,'',','),satuan2,if(LEN(satuan3)=0,'',','),satuan3) AS satuan, harga1 AS harga,total AS total, '5' AS nu,no_po AS po,'4' AS jns FROM trdpo
                        WHERE SUBSTRING(no_trdrka,34,1)='4') a  where kd_skpd ='$skpd' ORDER BY kd_rek,nu,po";
        $query1 = $this->db->query($sql);  
        
        foreach($query1->result_array() as $pend){
			  
              $skpd   = $pend['kd_skpd'];
			  $rek    = $pend['kd_rek'];
			  $rek1   = $pend['kd_rek1'];
			  $nm_rek = $pend['nm_rek'];
              $nm_rek = str_replace("'"," ",$nm_rek);
			  $nilai  = $pend['nilai'];
			  $uraian = $pend['uraian'];
			  $volume = $pend['volume'];	
			  $satuan = $pend['satuan'];
			  $harga  = $pend['harga'];
			  $total  = $pend['total'];
			  $nu     = $pend['nu'];
			  $po     = $pend['po'];
              $jns    = $pend['jns'];
			 
			  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
			  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
        		$sql1 = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po,'51' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE  LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po,'51' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
                        UNION ALL
                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po,'51' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
                        ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='51' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
                        UNION ALL
                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,tvolume AS volume, concat(satuan1,if(LEN(satuan2)=0,'',','),satuan2,if(LEN(satuan3)=0,'',','),satuan3) AS satuan, harga1 AS harga,total AS total, '4' AS nu,no_po AS po,'51' AS jns  FROM trdpo
                        WHERE  SUBSTRING(no_trdrka,34,2)='51'
                        )  a  where kd_skpd ='$skpd' ORDER BY kd_rek,nu,po";
                        
        $query2 = $this->db->query($sql1);  
        
        foreach($query2->result_array() as $btl){
			  $skpd=$btl['kd_skpd'];
			  $rek=$btl['kd_rek'];
			  $rek1=$btl['kd_rek1'];
			  $nm_rek=$btl['nm_rek'];
              $nm_rek=str_replace("'"," ",$nm_rek);
			  $nilai=$btl['nilai'];
			  $uraian=$btl['uraian'];
              $uraian=str_replace("'"," ",$uraian);
			  $volume=$btl['volume'];	
			  $satuan=$btl['satuan'];
			  $harga=$btl['harga'];
			  $total=$btl['total'];
			  $nu=$btl['nu'];
			  $po=$btl['po'];
              $jns=$btl['jns'];
			  
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
        $sql2 = " SELECT kd_skpd,CONCAT(kode,'.',kode1) AS kd_rek,(CASE nu WHEN '1' THEN kode WHEN '2' THEN kode  WHEN '7' THEN '' ELSE CONCAT(kode,'.',kode1) END) AS kd_rek1,
            		nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns FROM (
            		SELECT DISTINCT b.kd_program AS kode,'' AS kode1,b.nm_program AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'1' AS nu,'' AS po,b.jns_kegiatan AS jns FROM trdrka a INNER JOIN 
            		trskpd b ON a.kd_kegiatan=b.kd_kegiatan GROUP BY b.kd_program
            		UNION 
            		SELECT  a.kd_kegiatan AS kode,'' AS kode1,a.nm_kegiatan AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,'' AS volume,
            		'' AS satuan,'' AS harga,'' AS total,'2' AS nu,'' AS po,b.jns_kegiatan FROM trdrka a INNER JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan 
            		GROUP BY b.kd_kegiatan
            		UNION 
            		SELECT DISTINCT a.kd_kegiatan AS kode,LEFT(a.kd_rek5,2) AS kode1, nm_rek2 AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'3' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a INNER JOIN
            		ms_rek2 b ON LEFT(kd_rek5,2)=b.kd_rek2 GROUP BY kd_kegiatan,LEFT(a.kd_rek5,2)
            		UNION 
            		SELECT DISTINCT a.kd_kegiatan AS kode,LEFT(a.kd_rek5,3) AS kode1, nm_rek3 AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'4' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a INNER JOIN
            		ms_rek3 b ON LEFT(kd_rek5,3)=b.kd_rek3 GROUP BY kd_kegiatan,LEFT(a.kd_rek5,3)
            		UNION 
            		SELECT DISTINCT a.kd_kegiatan AS kode,LEFT(a.kd_rek5,5) AS kode1, nm_rek4 AS nm_rek,SUM(a.nilai) AS nilai,a.kd_skpd,'' AS uraian,
            		'' AS volume,'' AS satuan,'' AS harga,'' AS total,'5' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a INNER JOIN
            		ms_rek4 b ON LEFT(kd_rek5,5)=b.kd_rek4 GROUP BY kd_kegiatan,LEFT(a.kd_rek5,5)
            		UNION 
            		SELECT  a.kd_kegiatan AS kode,a.kd_rek5 AS kode1, nm_rek5 AS nm_rek,a.nilai AS nilai,a.kd_skpd,'' AS uraian,'' AS volume,
            		'' AS satuan,'' AS harga,'' AS total,'6' AS nu,'' AS po,LEFT(a.kd_rek5,2) AS jns FROM trdrka a 
            		UNION 
            		SELECT SUBSTRING(no_trdrka,12,21) AS kode,SUBSTR(no_trdrka,34,7) AS kode1,' 'AS nm_rek,'' nilai,LEFT(no_trdrka,10) AS kd_skpd,uraian,tvolume AS volume,
            		concat(satuan1,if(LEN(satuan2)=0,'',','),satuan2,if(LEN(satuan3)=0,'',','),satuan3) AS satuan, harga1 AS harga,total,'7' AS nu,no_po AS po,SUBSTR(no_trdrka,34,2) AS jns FROM trdpo 
            		) a where kd_skpd ='$skpd' and jns='52' ORDER BY kd_rek,nu,po";
                        
        $query3 = $this->db->query($sql2);  
        
        foreach($query3->result_array() as $bl){
		
        	  $skpd=$bl['kd_skpd'];
			  $rek=$bl['kd_rek'];
			  $rek1=$bl['kd_rek1'];
			  $nm_rek=$bl['nm_rek'];
              $nm_rek=str_replace("'"," ",$nm_rek);
			  $nilai=$bl['nilai'];
			  $uraian=$bl['uraian'];
              $uraian=str_replace("'"," ",$uraian);
			  $volume=$bl['volume'];	
			  $satuan=$bl['satuan'];
              $satuan=str_replace("'"," ",$satuan);
			  $harga=$bl['harga'];
			  $total=$bl['total'];
			  $nu=$bl['nu'];
			  $po=$bl['po'];
              $jns=$bl['jns'];
			 
				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
		
		}
        
            //        $sql3 = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
            //                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE  LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
            //                        UNION ALL
            //                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
            //                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
            //                        UNION ALL
            //                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
            //                        ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='61' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
            //                        UNION ALL
            //                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po,'61' AS jns  FROM trdpo
            //                        WHERE  SUBSTRING(no_trdrka,34,2)='61'
            //                        ) a $where ORDER BY kd_rek,nu,po";
            //                        
            //        $query4 = $this->db->query($sql3);  
            //        
            //        foreach($query4->result_array() as $pemby1){
            //			  $skpd=$pemby1['kd_skpd'];
            //			  $rek=$pemby1['kd_rek'];
            //			  $rek1=$pemby1['kd_rek1'];
            //			  $nm_rek=$pemby1['nm_rek'];
            //			  $nilai=$pemby1['nilai'];
            //			  $uraian=$pemby1['uraian'];
            //              $uraian=str_replace("'"," ",$uraian);
            //			  $volume=$pemby1['volume'];	
            //			  $satuan=$pemby1['satuan'];
            //			  $harga=$pemby1['harga'];
            //			  $total=$pemby1['total'];
            //			  $nu=$pemby1['nu'];
            //			  $po=$pemby1['po'];
            //              $jns=$pemby1['jns'];
            //			  
            //			 
            //				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
            //				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
            //		
            //		}
                    
            //        $sql4 = " SELECT * FROM (SELECT a.kd_skpd,SUBSTR(a.no_trdrka,12,25) AS kd_rek,SUBSTR(a.no_trdrka,12,25) AS kd_rek1,b.nm_rek3 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'1' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek3 b 
            //                        ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE  LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,25),b.nm_rek3
            //                        UNION ALL
            //                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,27) AS kd_rek,SUBSTR(a.no_trdrka,12,27) AS kd_rek1,b.nm_rek4 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'2' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek4 b 
            //                        ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE  LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,27),b.nm_rek4
            //                        UNION ALL
            //                        SELECT  a.kd_skpd,SUBSTR(a.no_trdrka,12,29) AS kd_rek,SUBSTR(a.no_trdrka,12,29) AS kd_rek1,b.nm_rek5 AS nm_rek,SUM(a.nilai)AS nilai,' ' AS uraian,' 'AS volume,' 'AS satuan,' 'AS harga,' 'AS total,'3' AS nu,' ' AS po,'61' AS jns FROM trdrka a INNER JOIN ms_rek5 b 
            //                        ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,2)='62' GROUP BY SUBSTRING(a.no_trdrka,12,29),b.nm_rek5
            //                        UNION ALL
            //                        SELECT  LEFT(no_trdrka,10) AS kd_skpd,SUBSTR(no_trdrka,12,29) AS kd_rek,' ' AS kd_rek1,' 'AS nm_rek,' 'AS nilai,uraian AS uraian,volume1 AS volume,satuan1 AS satuan,harga1 AS harga,total AS total, '4' AS nu,no_po AS po,'61' AS jns  FROM trdpo
            //                        WHERE  SUBSTRING(no_trdrka,34,2)='62'
            //                        ) a $where ORDER BY kd_rek,nu,po";
            //                        
            //        $query5 = $this->db->query($sql4);  
            //        
            //        foreach($query5->result_array() as $pemby2){
            //			  $skpd=$pemby2['kd_skpd'];
            //			  $rek=$pemby2['kd_rek'];
            //			  $rek1=$pemby2['kd_rek1'];
            //			  $nm_rek=$pemby2['nm_rek'];
            //			  $nilai=$pemby2['nilai'];
            //			  $uraian=$pemby2['uraian'];
            //              $uraian=str_replace("'"," ",$uraian);
            //			  $volume=$pemby2['volume'];	
            //			  $satuan=$pemby2['satuan'];
            //			  $harga=$pemby2['harga'];
            //			  $total=$pemby2['total'];
            //			  $nu=$pemby2['nu'];
            //			  $po=$pemby2['po'];
            //              $jns=$pemby2['jns'];
            //			  
            //			 
            //				  $this->db->query(" insert into perkada(kd_skpd,kd_rek,kd_rek1,nm_rek,nilai,uraian,volume,satuan,harga,total,nu,po,jns) 
            //				  values('$skpd','$rek','$rek1','$nm_rek','$nilai','$uraian','$volume','$satuan','$harga','$total','$nu','$po','$jns') ");			  
            //		
            //		}
        
        /*
        $field ='nilai_ubah';
        $rek ='4';
        $rek1 ='5';
        $rek2 ='6';
        $rek3 ='61';
        $rek4 ='62';
        
        $ang4 = $this->rka_model->get_ang1($field,$rek);
        $ang5 = $this->rka_model->get_ang1($field,$rek1);
        $ang6 =0; //$this->rka_model->get_ang1($field,$rek2);
        $ang71 = $this->rka_model->get_ang2($field,$rek3);
        $ang72 = $this->rka_model->get_ang2($field,$rek4);
        $ang4_71 = $ang4+$ang71;
        $ang5_6_72 = $ang5+$ang6+$ang72;
        $perubahan_sal =$ang4_71-$ang5_6_72;
	
        
        
        $this->db->query("delete from trhju_ppkd where tabel = '9' ");
        $this->db->query("delete from trdju_ppkd where  pos = '9'");
        
        $this->db->query("insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                        values('$no','$tgl','','','','1.20.05.01','','$ang4_71','$ang4_71','9')");
                        
        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
                        values('$no','','','3120101','Estimasi Pendapatan','$ang4','0','D','','0','9') ");
        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
	                       values('$no','','','3120201','Estimasi Penerimaan Pembiayaan','$ang71','0','D','','1','9') ");
        	
        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
						  values('$no','','','3120501','Estimasi Perubahan SAL','0','$perubahan_sal','K','','0','9') ");
        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
						  values('$no','','','3120301','Apropriasi Belanja','0','$ang5','K','','1','9') ");
        $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
						  values('$no','','','3120401','Apropriasi Pengeluaran Pembiayaan','0','$ang72','K','','2','9') ");

	
		*/

        echo '1';	
	
    }    

function pengesahan_dpa()
    {
        $data['page_title']= 'Pengesahan DPA & DPPA';
        $this->template->set('title', 'Pengesahan DPA & DPPA');   
        $this->template->load('template','anggaran/rka/pengesahan_dpa',$data) ; 
    }
function load_pengesahan_dpa(){
        $result = array();
        $row = array();
      	$page = isset($_POST['page']) ? intval($_POST['page']) : 1;
	    $rows = isset($_POST['rows']) ? intval($_POST['rows']) : 10;
	    $offset = ($page-1)*$rows;
        $kriteria = '';
        $kriteria = $this->input->post('cari');
        $where ='';
        if ($kriteria <> ''){                               
            $where="where (upper(kd_skpd) like upper('%$kriteria%') or no_dpa like'%$kriteria%')";            
        }
		
        $sql = "SELECT count(*) as tot from trhrka $where" ;
        $query1 = $this->db->query($sql);
        $total = $query1->row();
        
        $sql = "SELECT * from trhrka $where order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $row[] = array(
                        'id' => $ii,
                        'kd_skpd' => $resulte['kd_skpd'],        
                        'statu' => $resulte['statu'],
						'status_sempurna' => $resulte['status_sempurna'],
                        'status_ubah' => $resulte['status_ubah'],
						'no_dpa' => $resulte['no_dpa'],        
                        'tgl_dpa' => $resulte['tgl_dpa'],
                        'no_dpa_ubah' => $resulte['no_dpa_ubah'],
						'tgl_dpa_ubah' => $resulte['tgl_dpa_ubah'],
						//'status_sempurna' => $resulte['status_sempurna'],
                        'no_dpa_sempurna' => $resulte['no_dpa_sempurna'],
						'tgl_dpa_sempurna' => $resulte['tgl_dpa_sempurna']
                        );
                        $ii++;
        }
           
        $result["total"] = $total->tot;
        $result["rows"] = $row; 
        echo json_encode($result);	   
	}
	
     function simpan_pengesahan(){
        $kdskpd = $this->input->post('kdskpd');
        $sdpa = $this->input->post('stdpa');
        $sdppa = $this->input->post('stdppa');
        $nodpa = $this->input->post('no');
        $tanggal1 = $this->input->post('tgl');
        $nodppa = $this->input->post('no2');
        $tanggal2 = $this->input->post('tgl2');
		$sdpasempurna = $this->input->post('stsempurna');
		$nosempurna = $this->input->post('no3');
        $tanggal3 = $this->input->post('tgl3');
        
        if ($kdskpd == '1.20.05.01'){
                $field ='nilai_ubah';
                $rek ='4';
                $rek1 ='5';
                $rek3 ='61';
                $rek4 ='62';
                
                $ang4 = $this->rka_model->get_ang($field,$rek,$kdskpd);
                $ang5 = $this->rka_model->get_ang($field,$rek1,$kdskpd);
                //$ang6 = $this->rka_model->get_ang($field,$rek2,$kdskpd);
                $ang61 = $this->rka_model->get_ang2($field,$rek3,$kdskpd);
                $ang62 = $this->rka_model->get_ang2($field,$rek4,$kdskpd);
                $ang4_61 = $ang4+$ang61;
                $ang5_62 = $ang5+$ang62;
                $perubahan_sal =$ang4_61-$ang5_62;
        		$sql = "delete from trhrka where kd_skpd = '$kdskpd'";
        		$asg = $this->db->query($sql);
                
                $sql2 = "insert into trhrka(kd_skpd,statu,status_sempurna,status_ubah,no_dpa,tgl_dpa,no_dpa_ubah,tgl_dpa_ubah,no_dpa_sempurna,tgl_dpa_sempurna)
				values('$kdskpd','$sdpa','$sdpasempurna','$sdppa','$nodpa','$tanggal1','$nodppa','$tanggal2','$nosempurna','$tanggal3')";
                $asg = $this->db->query($sql2);
                
                
        		$this->db->query("delete from trhju_ppkd where no_voucher = '$nodpa'");
                $this->db->query("delete from trdju_ppkd where no_voucher = '$nodpa'");
                
                $this->db->query("insert into trhju_ppkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                                values('$nodpa','$tanggal1','','','','$kdskpd','','$ang4_61','$ang4_61','9')");
                                
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
                                values('$nodpa','','','3120101','Estimasi Pendapatan','$ang4','0','D','','0','9') ");
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        	                       values('$nodpa','','','3120201','Estimasi Penerimaan Pembiayaan','$ang61','0','D','','1','9') ");
                	
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120501','Estimasi Perubahan SAL','0','$perubahan_sal','K','','0','9') ");
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120301','Apropriasi Belanja','0','$ang5','K','','1','9') ");
                $this->db->query("insert trdju_ppkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120401','Apropriasi Pengeluaran Pembiayaan','0','$ang62','K','','2','9') ");
                
                
          } else {
                $field ='nilai_ubah';
                $rek ='4';
                $rek1 ='5';
                
                $ang4 = $this->rka_model->get_ang($field,$rek,$kdskpd);
                $ang5 = $this->rka_model->get_ang($field,$rek1,$kdskpd);
                $ang5_4 = $ang4-$ang5;
                $d = $ang4+$ang5_4;
        		$sql = "delete from trhrka where kd_skpd = '$kdskpd'";
        		$asg = $this->db->query($sql);
                
                $sql2 = "insert into trhrka(kd_skpd,statu,status_sempurna,status_ubah,no_dpa,tgl_dpa,no_dpa_ubah,tgl_dpa_ubah,no_dpa_sempurna,tgl_dpa_sempurna)
				values('$kdskpd','$sdpa','$sdpasempurna','$sdppa','$nodpa','$tanggal1','$nodppa','$tanggal2','$nosempurna','$tanggal3')";
                $asg = $this->db->query($sql2);
                
                
        		$this->db->query("delete from trhju_pkd where tabel = '9' and kd_skpd='$kdskpd'");
                $this->db->query("delete from trdju_pkd where no_voucher = '$nodpa' and pos = '9'");
                if ($sdpa=='1'){
                $this->db->query("insert into trhju_pkd(no_voucher,tgl_voucher,ket,username,tgl_update,kd_skpd,nm_skpd,total_d,total_k,tabel) 
                                values('$nodpa','$tanggal1','','','','$kdskpd','','$d','$d','9')");
                $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
                                values('$nodpa','','','3120101','Estimasi Pendapatan','$ang4','0','D','','0','9') ");
                if ($ang5_4<0){
                    $ang5_4=$ang5_4*-1;
                    $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        	                       values('$nodpa','','','3120501','Estimasi Perubahan SAL','$ang5_4','','D','','1','9') ");
                }else{
                $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        	                       values('$nodpa','','','3120501','Estimasi Perubahan SAL','0','$ang5_4','K','','1','9') ");
                }	
                $this->db->query("insert trdju_pkd(no_voucher,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,debet,kredit,rk,jns,urut,pos) 
        						  values('$nodpa','','','3120301','Apropriasi Belanja','0','$ang5','K','','3','9') ");
                }
                
            }
     }
	 
    
     function select_rka_ms($kegiatan='') {

		$sql    = "select a.kd_rek5,b.nm_rek5,a.nilai,a.nilai_ubah,a.sumber,a.sumber2,a.sumber3,a.sumber4 from trdrka a inner join ms_rek5 b on a.kd_rek5=b.kd_rek5 where kd_kegiatan='$kegiatan' order by a.kd_rek5";                   
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5'],  
                        'nilai' => number_format($resulte['nilai'],"2",".",","),
                        'nilai_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),                             
                        'sumber' => $resulte['sumber'],
                        'sumber2' => $resulte['sumber2'],
                        'sumber3' => $resulte['sumber3'],
                        'sumber4' => $resulte['sumber4']                                
                        );
                        $ii++;
        }
           
           echo json_encode($result);
            $query1->free_result();
    }
    

    function ambil_rekening5() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_rek5, nm_rek5 FROM ms_rek5 where left(kd_rek5,1) in ('4','5','6') and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}


    
    function ambil_rekening5_ms() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_rek5, nm_rek5 FROM ms_rek5 where left(kd_rek5,1) in ('4','5','6') and (upper(kd_rek5) like upper('%$lccr%') or upper(nm_rek5) like upper('%$lccr%')) ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	   
	}

    function ambil_sdana_ms(){
        
        $lccr  = $this->input->post('q');
        $query1 = $this->db->query("select kd_sdana, nm_sdana from ms_dana") ;
        $ii     = 0;
        $result = array();
        foreach ($query1->result_array() as $resulte) {
            
            $result[] = array(
                'id'       => '$ii',
                'kd_sdana' => $resulte['kd_sdana'],
                'nm_sdana' => $resulte['nm_sdana']
                );
                $ii++;    
        }
        
        echo json_encode($result) ;
    }
   function ambil_sdana(){
        
        $lccr  = $this->input->post('q');
        $query1 = $this->db->query("select * from ms_dana where upper(kd_sdana) like upper('%$lccr%') or upper(nm_sdana) like upper('%$lccr%') ") ;
        //$query1 = $this->db->query("select kd_sdana, nm_sdana from ms_dana") ;
        
        
        $ii     = 0;
        $result = array();
        foreach ($query1->result_array() as $resulte) {
            
            $result[] = array(
                'id'       => '$ii',
                'kd_sdana' => $resulte['kd_sdana'],
                'nm_sdana' => $resulte['nm_sdana']
                );
                $ii++;    
        }
        
        echo json_encode($result) ;
    }
    

    function config_skpd_ms(){
        $skpd     = $this->session->userdata('kdskpd');
        $sql = "SELECT a.kd_skpd,a.nm_skpd,b.statu,b.status_sempurna,b.status_ubah FROM  ms_skpd a LEFT JOIN trhrka b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
		
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'statu' => $resulte['statu'],
						'status_sempurna' => $resulte['status_sempurna'],
                        'status_ubah' => $resulte['status_ubah']
                        );
                        $ii++;
        }
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }
    
    function cek_kas_ms(){
        
        $skpd     = $this->input->post('skpd');
        $kegiatan = $this->input->post('kegiatan');
        
        $result   = array();
        $query    = $this->db->query("select * from trdskpd where kd_skpd='$skpd' and kd_kegiatan='$kegiatan'");
        //$query    = $this->db->query("select * from trdskpd where kd_skpd='1.03.01.00' and kd_kegiatan='1.03.1.03.01.00.18.04' ");
        $ii       = 0;
        
        foreach ( $query->result_array() as $row ){
            
            $result[] = array(
                'id'    =>  '$ii',
                'bulan' =>  $row['bulan'],
                'nilai' =>  $row['nilai']
            );
            $ii++;
        }
        echo json_encode($result);
    }
    
    function skpd_ms() {
        $lccr = $this->input->post('q');
        $sql = "SELECT kd_skpd,nm_skpd FROM ms_skpd where upper(kd_skpd) like upper('%$lccr%') or upper(nm_skpd) like upper('%$lccr%') order by kd_skpd ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],  
                        'nm_skpd' => $resulte['nm_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	}
    
    function pgiat_ms($cskpd='') {
        
        $lccr = $this->input->post('q');
        $sql  = " SELECT a.kd_kegiatan,b.nm_kegiatan,a.jns_kegiatan FROM trskpd a INNER JOIN m_giat b ON a.kd_kegiatan1=b.kd_kegiatan
                 where a.kd_skpd='$cskpd' and ( upper(a.kd_kegiatan) like upper('%$lccr%') or upper(a.nm_kegiatan) like upper('%$lccr%') )";
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        'kd_kegiatan'  => $resulte['kd_kegiatan'],  
                        'nm_kegiatan'  => $resulte['nm_kegiatan'],
                        'jns_kegiatan' => $resulte['jns_kegiatan']
                        );
                        $ii++;
        }
        echo json_encode($result);
	}
    

    function tsimpan_ms($skpd='',$kegiatan='',$rekbaru='',$reklama='',$nilai=0,$sdana='') {
       
		if (trim($reklama)==''){
			$reklama=$rekbaru;
		}

		$nmskpd=$this->rka_model->get_nama($skpd,'nm_skpd','ms_skpd','kd_skpd');
		$nmgiat=$this->rka_model->get_nama($kegiatan,'nm_kegiatan','trskpd','kd_kegiatan');
		$nmrek5=$this->rka_model->get_nama($rekbaru,'nm_rek5','ms_rek5','kd_rek5');

		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rekbaru;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$reklama' ");
		$query = $this->db->query(" insert into trdrka(no_trdrka,kd_skpd,kd_kegiatan,kd_rek5,nilai,nilai_ubah,sumber,nm_skpd,nm_rek5,nm_kegiatan) values('$notrdrka','$skpd','$kegiatan','$rekbaru',$nilai,$nilai,'$sdana','$nmskpd','$nmrek5','$nmgiat') ");	
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TK_MAS=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ),TU_MAS='Dana' where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	

		$this->select_rka($kegiatan);
    }
    
    function ld_rek_ms($giat='',$rek='') {
        if ($rek==''){
            $dan='';
        }else{
            $dan="and a.kd_rek5='$rek'";
        }
        $sql = " SELECT kd_rek5,nm_rek5 FROM (SELECT kd_rek5,nm_rek5 FROM ms_rek5 WHERE kd_rek5 NOT IN (SELECT kd_rek5 FROM trdrka WHERE kd_kegiatan='$giat'  ) AND
				 (kd_rek5 LIKE '4%' OR kd_rek5 LIKE '5%' OR kd_rek5 LIKE '6%'))a,
				 (SELECT @kd:=b.jns_kegiatan, @pj:=LEN(b.jns_kegiatan) FROM trskpd a INNER JOIN m_giat b ON 
				 a.kd_kegiatan1=b.kd_kegiatan WHERE a.kd_kegiatan='$giat' )t 
				 WHERE LEFT(a.kd_rek5,@pj)=@kd $dan ORDER BY a.kd_rek5 ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_rek5' => $resulte['kd_rek5'],  
                        'nm_rek5' => $resulte['nm_rek5']
                       
                        );
                        $ii++;
        }
           
        echo json_encode($result);
    	    $query1->free_result();
	} 
    
    
    function thapus_ms($skpd='',$kegiatan='',$rek='') {
    	
		$notrdrka=$skpd.'.'.$kegiatan.'.'.$rek;
		$query = $this->db->query(" delete from trdrka where kd_skpd='$skpd' and kd_kegiatan='$kegiatan' and kd_rek5='$rek' ");
		$query = $this->db->query(" delete from trdpo where no_trdrka='$notrdrka' ");
		$query = $this->db->query(" update trskpd set total=( select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan1='$kegiatan' and kd_skpd='$skpd' ");	
		$this->select_rka($kegiatan);
    }
    
    
    function tsimpan_rinci_ms(){

        $skpd    = $this->input->post('skpd');
        $kegiatan    = $this->input->post('giat');
        $rekening    = $this->input->post('rek');
        $index    = $this->input->post('id');
        $uraian    = $this->input->post('uraian');
        $volume1    = $this->input->post('volum1');
        $satuan1    = $this->input->post('satuan1');
        $harga1    = $this->input->post('harga1');
        $volume2    = $this->input->post('volum2');
        $satuan2    = $this->input->post('satuan2');
        $volume3    = $this->input->post('volum3');
        $satuan3    = $this->input->post('satuan3');
        
		$satuan1 = str_replace("12345678987654321","",$satuan1);
		$satuan1 = str_replace("undefined","",$satuan1);

		$satuan2 = str_replace("12345678987654321","",$satuan2);
		$satuan2 = str_replace("undefined","",$satuan2);

		$satuan3 = str_replace("12345678987654321","",$satuan3);
		$satuan3 = str_replace("undefined","",$satuan3);

		$uraian = str_replace("%20"," ",$uraian);
		$uraian = str_replace("%60"," ",$uraian);

		$norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $vol1=$volume1;
        $vol2=$volume2;
        $vol3=$volume3;
        if($volume1==0){$volume1=1;$vol1='';}
        if($volume2==0){$volume2=1;$vol2='';}
        if($volume3==0){$volume3=1;$vol3='';}
		
		$total	 = $volume1*$volume2*$volume3*$harga1;

		$query1 = $this->db->query(" delete from trdpo where no_po='$index' and no_trdrka='$norka' ");  
		$query1 = $this->db->query(" insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3) 
									 values('$index','$norka','$uraian','$vol1','$satuan1',$harga1,$total,'$vol1','$satuan1',$harga1,$total,'$vol2','$satuan2','$vol2','$satuan2','$vol3','$satuan3','$vol3','$satuan3') ");  
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$skpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rekening);
	}
    
    function thapus_rinci_ar_all_ms(){
        $norka = $this->input->post('vnorka');
        $query = $this->db->query("delete from trdpo where no_trdrka='$norka'");
 
        if ( $query > 0 ){
            echo '1' ;
        } else {
            echo '0' ;
        }
    }
    
    function tsimpan_rinci_jk_ms(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
                               
		$sql       = "delete from trdpo where  no_trdrka='$norka'";
		$asg       = $this->db->query($sql);
        	
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdpo(no_po,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah)"; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
	  
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rekening);
	
    }
    
    
    function rka_rinci_ms($skpd='',$kegiatan='',$rekening='') {
        
        $norka  = $skpd.'.'.$kegiatan.'.'.$rekening;
        $sql    = "select * from trdpo where no_trdrka='$norka' order by no_po";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii     = 0;

        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id'      => $ii,        
                        'no_po'   => $resulte['no_po'],  
                        'uraian'  => $resulte['uraian'],  
                        'volume1' => $resulte['volume1'],  
                        'volume2' => $resulte['volume2'],  
                        'volume3' => $resulte['volume3'],  
                        'satuan1' => $resulte['satuan1'],  
                        'satuan2' => $resulte['satuan2'],  
                        'satuan3' => $resulte['satuan3'],
                        'volume'  => $resulte['tvolume'],  
                        'harga1'  => number_format($resulte['harga1'],"2",".",","),  
                        'hargap'  => number_format($resulte['harga1'],"2",".",","),                             
                        'harga2'  => number_format($resulte['harga2'],"2",".",","),                             
                        'harga3'  => number_format($resulte['harga3'],"2",".",","),
                        'totalp'  => number_format($resulte['total'],"2",".",",") ,                            
                        'total'   => number_format($resulte['total'],"2",".",",")                            
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }

    function load_sum_rek_ms(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select sum(nilai) as rektotal,sum(nilai_ubah) as rektotal_ubah from trdrka where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal' => number_format($resulte['rektotal'],"2",".",","),  
                        'rektotal_ubah' => number_format($resulte['rektotal_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
    
    function load_sum_rek_rinci_ms(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query(" select sum(total) as rektotal_rinci,sum(total_ubah) as rektotal_rinci_ubah from trdpo where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rinci' => number_format($resulte['rektotal_rinci'],"2",".",","),  
                        'rektotal_rinci_ubah' => number_format($resulte['rektotal_rinci_ubah'],"2",".",",")  
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}
    
    function tsimpan_ar_ms(){
        
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
        $query_del = $this->db->query("delete from trdrka where kd_skpd='$kdskpd' and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek' ");
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_ubah,sumber,sumber2,sumber3,sumber4) values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4')");        
        
        if ( $query_ins > 0 and $query_del > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }
    
    
    function simpan_det_keg_ms(){
 		
		$skpd=$this->input->post('skpd');
        $giat=$this->input->post('giat');
        $lokasi=$this->input->post('lokasi');      
        $sasaran=$this->input->post('sasaran');      
        $wkeg=$this->input->post('wkeg');      
        $cp_tu=$this->input->post('cp_tu');      
        $cp_ck=$this->input->post('cp_ck');      
        $m_tu=$this->input->post('m_tu');      
        $m_ck=$this->input->post('m_ck');      
        $k_tu=$this->input->post('k_tu');      
        $k_ck=$this->input->post('k_ck');      
        $h_tu=$this->input->post('h_tu');      
        $h_ck=$this->input->post('h_ck');      
        $ttd=$this->input->post('ttd');      
        
		$this->db->query(" update trskpd set tu_capai='$cp_tu', 
											 tu_mas='$m_tu',			
											 tu_kel='$k_tu',			
											 tu_has='$h_tu',
											 tk_capai='$cp_ck',
											 tk_mas='$m_ck',
											 tk_kel='$k_ck',
											 tk_has='$h_ck',
											 lokasi='$lokasi',
											 sasaran_giat='$sasaran',
											 waktu_giat='$wkeg',
											 kd_pptk='$ttd'
		where kd_skpd='$skpd' and kd_kegiatan='$giat'  "); 
	}

    function load_det_keg_ms(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');

        $query1 = $this->db->query(" select * from trskpd where kd_skpd='$kdskpd' and kd_kegiatan='$kegiatan'  ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'lokasi' => $resulte['lokasi'],  
                        'sasaran' => $resulte['sasaran_giat'],  
                        'wkeg' => $resulte['waktu_giat'],  
                        'ttd' => $resulte['kd_pptk'],
                        'cp_tu' => $resulte['tu_capai'],
                        'm_tu' => $resulte['tu_mas'],
                        'k_tu' => $resulte['tu_kel'],
                        'h_tu' => $resulte['tu_has'],
                        'cp_ck' => $resulte['tk_capai'],
                        'm_ck' => 'Rp. '.number_format($resulte['tk_mas']),
                        'k_ck' => $resulte['tk_kel'],
                        'h_ck' => $resulte['tk_has']						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}

	function rka_hukum_ms($skpd='',$kegiatan='') {

		$sql = " SELECT *,(SELECT dhukum FROM d_hukum WHERE kd_skpd='$skpd' AND kd_kegiatan='$kegiatan' AND dhukum=m_hukum.kd_hukum) AS ck FROM m_hukum ";                   
        
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'kd_hukum' => $resulte['kd_hukum'],  
                        'nm_hukum' => $resulte['nm_hukum'],  
                        'ck'   => $resulte['ck']                          
                        );
                        $ii++;
        }
           
           echo json_encode($result);
    }
    
    function simpan_dhukum_ms(){

		$skpd  = $this->input->post('skpd');
        $giat  = $this->input->post('giat');
        $isi   = $this->input->post('cisi');      
        $pecah = explode('||',$isi);
		$pj    = count($pecah);

		$this->db->query(" delete from d_hukum where kd_skpd='$skpd' and kd_kegiatan='$giat' "); 		
	
		for($i=0;$i<$pj;$i++){
			if (trim($pecah[$i])!=''){
				$this->db->query(" insert into d_hukum(kd_skpd,kd_kegiatan,dhukum) values('$skpd','$giat','".$pecah[$i]."') "); 		
			}
		}
	}


//tambahan Fungsi Anguz

function cek_simpan(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');

		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' ");
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
			$msg = array('pesan'=>'1');
			echo json_encode($msg);
		} else{
			$msg = array('pesan'=>'0');
			echo json_encode($msg);
		}
		
	}

	function update_sts_spd()
	{
	$no_spd      = $this->input->post('no');
	$ckd_skpd     = $this->input->post('kd_skpd');
	$csts      = $this->input->post('status_spd');
	$usernm      = $this->session->userdata('pcNama');
	$last_update =  date('d-m-y H:i:s');
					
	   $sql = "update trhspd set status='$csts' where no_spd='$no_spd' and kd_skpd='$ckd_skpd' ";
	   $asg = $this->db->query($sql);
		if ($asg > 0){  	
			echo $csts;
		} else {
            echo '5';
        }
	}
    
  function load_konfig_spd(){

//		$nomor = $this->input->post('nomor');

        $query1 = $this->db->query(" select * from trkonfig_spd order by tgl_konfig_spd ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'no_konfig_spd' => $resulte['no_konfig_spd'],  
                        'tgl_konfig_spd' => $resulte['tgl_konfig_spd'],  
                        'ingat1' => $resulte['ingat1'],  
                        'ingat2' => $resulte['ingat2'],
                        'ingat3' => $resulte['ingat3'],
                        'ingat4' => $resulte['ingat4'],  
                        'ingat5' => $resulte['ingat5'],
                        'ingat6' => $resulte['ingat6'],
                        'memutuskan' => $resulte['memutuskan']						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}
	
	
  function load_konfig_anggaran(){

//		$nomor = $this->input->post('nomor');

        $query1 = $this->db->query(" select * from trkonfig_anggaran order by no_konfig ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        {            
            $result[] = array(
                        'id' => $ii,        
                        'no_konfig' => $resulte['no_konfig'],                            
                        'jenis_anggaran' => $resulte['jenis_anggaran'],  
                        'judul_ag' => $resulte['judul'],
                        'nomor' => $resulte['nomor'],
                        'tanggal' => $resulte['tanggal'],  
                        'lampiran' => $resulte['lampiran']					
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	

	}
	
	function config_skpd(){
        $skpd     = $this->session->userdata('kdskpd');
        $sql = "SELECT a.kd_skpd,a.nm_skpd,b.statu,b.status_ubah FROM  ms_skpd a LEFT JOIN trhrka b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd = '$skpd'";
        $query1 = $this->db->query($sql);  
		
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'statu' => $resulte['statu'],
                        'status_ubah' => $resulte['status_ubah']
                        );
                        $ii++;
        }
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }

   
	function config_skpd2(){
        $skpd     =  $this->input->post('kdskpd');
        $sql = "SELECT a.kd_skpd,a.nm_skpd,b.statu,b.status_ubah FROM  ms_skpd a LEFT JOIN trhrka b ON a.kd_skpd=b.kd_skpd WHERE a.kd_skpd = '$skpd' ";
        $query1 = $this->db->query($sql);  
		
		$test = $query1->num_rows();
		
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result = array(
                        'id' => $ii,        
                        'kd_skpd' => $resulte['kd_skpd'],
                        'nm_skpd' => $resulte['nm_skpd'],
                        'statu' => $resulte['statu'],
                        'status_ubah' => $resulte['status_ubah']
                        );
                        $ii++;
        }
		

		
		
        echo json_encode($result);
    	$query1->free_result();   
    }    
    

	
	
    function tsimpan_ar(){
        
        $kdskpd = $this->input->post('kd_skpd');
        $kdkegi = $this->input->post('kd_kegiatan');
        $kdrek  = $this->input->post('kd_rek5');
        $nilai  = $this->input->post('nilai');
        $sdana1 = $this->input->post('dana1');
        $sdana2 = $this->input->post('dana2');
        $sdana3 = $this->input->post('dana3');
        $sdana4 = $this->input->post('dana4');
                
        $nmskpd = $this->rka_model->get_nama($kdskpd,'nm_skpd','ms_skpd','kd_skpd');
        $nmkegi = $this->rka_model->get_nama($kdkegi,'nm_kegiatan','trskpd','kd_kegiatan');
        $nmrek  = $this->rka_model->get_nama($kdrek,'nm_rek5','ms_rek5','kd_rek5');
        
        $notrdrka  = $kdskpd.'.'.$kdkegi.'.'.$kdrek ;
        $query_del = $this->db->query("delete from trdrka where kd_skpd='$kdskpd' and kd_kegiatan='$kdkegi' and kd_rek5='$kdrek' ");
        $query_ins = $this->db->query("insert into trdrka(no_trdrka,kd_skpd,nm_skpd,kd_kegiatan,nm_kegiatan,kd_rek5,nm_rek5,nilai,nilai_sempurna,nilai_ubah,sumber,sumber2,sumber3,sumber4) values('$notrdrka','$kdskpd','$nmskpd','$kdkegi','$nmkegi','$kdrek','$nmrek','$nilai','$nilai','$nilai','$sdana1','$sdana2','$sdana3','$sdana4')");        
        
        if ( $query_ins > 0 and $query_del > 0 ) {
            echo "1" ;
        } else {
            echo "0" ;
        }
        
    }
    
  function cek_kas(){
        
        $skpd     = $this->input->post('skpd');
        $kegiatan = $this->input->post('kegiatan');
        
        $result   = array();
        $query    = $this->db->query("select * from trdskpd where kd_skpd='$skpd' and kd_kegiatan='$kegiatan'");
        //$query    = $this->db->query("select * from trdskpd where kd_skpd='1.03.01.00' and kd_kegiatan='1.03.1.03.01.00.18.04' ");
        $ii       = 0;
        
        foreach ( $query->result_array() as $row ){
            
            $result[] = array(
                'id'    =>  '$ii',
                'bulan' =>  $row['bulan'],
                'nilai' =>  $row['nilai']
            );
            $ii++;
        }
        echo json_encode($result);
    }
	//---------- Tambahan Agus--------/
	
    
function cek_data(){
	    $nomor    = $this->input->post('no');
	    $tabel   = $this->input->post('tabel');
	    $field    = $this->input->post('field');

		$hasil=$this->db->query(" select count(*) as jumlah FROM $tabel where $field='$nomor' ");
		foreach ($hasil->result_array() as $row){
		$jumlah=$row['jumlah'];	
		}
		if($jumlah>0){
		$msg = array('pesan'=>'1');
        echo json_encode($msg);
		} else{
		$msg = array('pesan'=>'0');
        echo json_encode($msg);
		}
		
	}
	
	
	function perkada_penjabaran()
    {
        $data['page_title']= 'CETAK';
        $this->template->set('title', 'Cetak Penjabaran APBD');   
        $this->template->load('template','anggaran/rka/perkada_penjabaran_apbd',$data) ; 
    }
    
	
	
    function pilih_ttd($dns='') {
        $lccr = $this->input->post('q');
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where kd_skpd ='$dns' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	
    function ttd_gub() {
        $lccr = $this->input->post('q');
        $sql = "SELECT nip,nama,jabatan,kd_skpd FROM ms_ttd where nip='1' ";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],  
                        'jabatan' => $resulte['jabatan'],
                        'kd_skpd' => $resulte['kd_skpd']
                        );
                        $ii++;
        }
           
        echo json_encode($result);
     $query1->free_result();	   
	}
	
	
	 function cetak_pergub_penjabaran_apbd(){
       //$id = $this->uri->segment(3);
		$cetak = $this->uri->segment(3);
 		$lcskpd = $_REQUEST['kd_skpd'];
		// ini jenis cetakkan
         $pilih = $_REQUEST['cpilih'];
         $filter_rek = $_REQUEST['f_rek']; 		 
		 $pj=strlen($filter_rek);
		 if ($pj!=0){
			 
			 $whare1_a=" and LEFT(a.kd_rek1,1)=LEFT(rtrim('$filter_rek'),1)";
            
			 $whare2_a="  and LEFT(a.kd_rek2,$pj)=LEFT(rtrim('$filter_rek'),$pj)";
			 
			 $whare3_a="  and LEFT(a.kd_rek2,$pj)=LEFT(rtrim('$filter_rek'),$pj)";
			 
			 $whare4_a="  and LEFT(a.kd_rek4,$pj)=LEFT(rtrim('$filter_rek'),$pj)";
			 
			 $whare5_a="  and LEFT(a.kd_rek5,$pj)=LEFT(rtrim('$filter_rek'),$pj)";
		 }else{
			  $whare1_a="";
            
			 $whare2_a="";
			 
			 $whare3_a="";
			 
			 $whare4_a="";
			 
			 $whare5_a="";
		 }
		 
             $whare1=" ";
             $whare2=" ";
             $whare3="";
             $whare4="";
             $whare5="";
			 
			 $kd_org  ="";
                    $nm_org  ="";
                    $kd_skpd  ="";
                    $nm_skpd  ="";
		 
		 switch($pilih) {
        case 3;
            $whare1=" and kd_skpd='$lcskpd' and LEFT(a.kd_rek1,1) in('5','4','6') ";
			$whare2=" and kd_skpd='$lcskpd' and LEFT(a.kd_rek2,1) in('5','4','6') ";
			$whare3=" and kd_skpd='$lcskpd' and LEFT(a.kd_rek3,1) in('5','4','6') ";
			$whare4=" and kd_skpd='$lcskpd' and LEFT(a.kd_rek4,1) in('5','4','6') ";
			$whare5=" and kd_skpd='$lcskpd' and LEFT(a.kd_rek5,1) in('5','4','6') ";
			 $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org FROM ms_skpd a 
INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
 WHERE kd_skpd='$lcskpd'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org; 
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;     

					}
        break;
        case 2;        
            $whare1=" and left(kd_skpd,7)='$lcskpd' and LEFT(a.kd_rek1,1) in('5','4','6')";
            $whare2=" and left(kd_skpd,7)='$lcskpd' and LEFT(a.kd_rek2,1) in('5','4','6')";
            $whare3=" and left(kd_skpd,7)='$lcskpd' and LEFT(a.kd_rek3,1) in('5','4','6')";
            $whare4=" and left(kd_skpd,7)='$lcskpd' and LEFT(a.kd_rek4,1) in('5','4','6')";
            $whare5=" and left(kd_skpd,7)='$lcskpd' and LEFT(a.kd_rek5,1) in('5','4','6')";
			
			 $sqldns="SELECT nm_org,kd_org FROM ms_organisasi WHERE kd_org='$lcskpd'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org; 
					}
        break;
        
        } 
		 
	  $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                } 
        
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1' and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        $cRet='';
        
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" ></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >RINGKASAN PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
		if ($pilih == '2'){
			$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
						
							<tr>
							 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Organisasi </td>
								 <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
							</tr>
		</table>"; 
		} else if ($pilih == '3') {
				$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
							
							<tr>
							 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Organisasi </td>
								 <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
							</tr>
							<tr>
							 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Unit Organisasi </td>
								 <td  align=\"left\" style=\"border-top: none;border-left: none; \" >: $kd_skpd - $nm_skpd</td>
							</tr>
		</table>"; 
		}
				  
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead >                       
                        <tr><td  width=\"15%\" align=\"center\"><b>NOMOR URUT</b></td>                            
                            <td width=\"65%\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     
                     
                        <tr><td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;\" width=\"70%\"  align=\"center\">2</td>
                            <td style=\"font-weight:bold;\" width=\"20%\"  align=\"center\">3</td></tr>
					</thead>
					<tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"3\"><i>Lampiran I : PerGub Prov.Kalimantan Barat - Ringkasan Penjabaran Penyusunan APBD TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where nilai <>0 $whare1 $whare1_a GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where nilai <>0 $whare2 $whare2_a GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where nilai <>0 $whare3 $whare3_a GROUP BY a.kd_rek3,a.lra, a.nm_rek3
                        UNION ALL 
                        SELECT a.kd_rek4 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                        ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where nilai <>0 $whare4 $whare4_a GROUP BY a.kd_rek4,a.lra, a.nm_rek4
                        UNION ALL 
                        SELECT a.kd_rek5 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek5 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                        ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where nilai <>0 $whare5 $whare5_a GROUP BY a.kd_rek5,a.lra, a.nm_rek5 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$this->dotrek($row->kd_rek);
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",".",",");
                   if (strlen($row->kd_rek)>5){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   } else {
					     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
				   }			 
                }
              
/* 			  $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,1)='4'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",".",",");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba4</td></tr>";

                 }     
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
					   UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",".",",");
                   if (strlen($coba5)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
				   } else {
					     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
				   }
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,1)='5'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",".",",");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
				 
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">SURPLUS(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>";
                    
					                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                    $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6'  GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                            UNION ALL 
                            SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                            ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                            UNION ALL 
                            SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                            ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query3 = $this->db->query($sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query3->result() as $row3)
                {
                    $coba9=$row3->rek;
                    $coba10=$row3->nm_rek;
                    $coba11= number_format($row3->nilai,"2",".",",");
                   if (strlen($coba9)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
				   } else {
					    $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba9</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba10</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba11</td></tr>";
				   }
                }
                $sqltpm="SELECT SUM(nilai) AS totpm FROM trdrka WHERE LEFT(kd_rek5,2)='61'";
                 $sqlpm=$this->db->query($sqltpm);
                 foreach ($sqlpm->result() as $rowpm)
                {
                   $coba12=number_format($rowpm->totpm,"2",".",",");
                    $cob3=$rowpm->totpm;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba12</td></tr>";
                 }     
									 
                $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query4 = $this->db->query($sql4);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query4->result() as $row4)
                {
                    $coba13=$row4->rek;
                    $coba14=$row4->nm_rek;
                    $coba15= number_format($row4->nilai,"2",".",",");
                   if (strlen($coba9)>3){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";
				   } else {
					                      $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba13</td>                                     
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba14</td>
                                     <td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba15</td></tr>";  
				   }
                }
				                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
									 
                $sqltpk="SELECT SUM(nilai) AS totpk FROM trdrka WHERE LEFT(kd_rek5,2)='62'";
                 $sqlpk=$this->db->query($sqltpk);
                 foreach ($sqlpk->result() as $rowpk)
                {
                   $coba16=number_format($rowpk->totpk,"2",".",",");
                    $cob4=$rowpk->totpk;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$coba16</td></tr>";
                 }  
				                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
                  
                  $netto=$cob3-$cob4; 
                  if ($netto < 0){
                	$a1="(";
                	$suplus=$netto*-1;
                	$b1=")";}
                  else {
                	$a1="";
	                $b1="";}
                 $nett=number_format($netto,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\" align=\"right\">PEMBIAYAAN NETTO</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$a1$nett$b1</td></tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">&nbsp;</td></tr>";
					 $silpa=($cob1+$cob3)-($cob+$cob4);
                     if ($silpa < 0){
                	$c1="(";
                	$silpa=$silpa*-1;
                	$d1=")";}
                    else {
                	$c1="";
	                $d1="";}
                 $silp=number_format($silpa,2,',','.');                  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"70%\">SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" width=\"20%\" align=\"right\">$c1$silp$d1</td></tr>";

									 */ 
                     $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"3\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
							 
        $cRet    .= "</table>";
        $data['prev']= $cRet;
		
       // $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
       // $this->template->load('template','anggaran/rka/perda1',$data);
                switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        echo $cRet;
		//$this->template->load('template','anggaran/rka/pergub1',$data);
        break;
        case 2;        
        /*  header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/pergub1', $data); */
        break;
        }
                
    }
	
	function load_nilai_kua($cskpd=''){
		        
        $query1 = $this->db->query("SELECT a.nilai_kua, (SELECT SUM(nilai) FROM trdrka WHERE LEFT(kd_rek5,2) IN (52) 
		AND kd_skpd = a.kd_skpd) as nilai_ang,(SELECT SUM(nilai_sempurna) FROM trdrka WHERE LEFT(kd_rek5,2) IN (52) 
		AND kd_skpd = a.kd_skpd) [nilai_angg_sempurna] FROM ms_skpd a where a.kd_skpd='$cskpd'");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
            $result[] = array(
                        'id' => $ii,        
                        //'rekspm' => number_format($resulte['rekspm'],2,'.',','),
                        'nilai' => number_format($resulte['nilai_kua'],2,'.',','),                      
                        'kua_terpakai' => number_format($resulte['nilai_ang'],2,'.',','),
                        'kua_terpakai_sempurna' => number_format($resulte['nilai_angg_sempurna'],2,'.',',')                       
                        
                        );
                        $ii++;
        }
       
		   echo json_encode($result);
           $query1->free_result();	
	}


function load_sum_rek_rinci_rka(){

		$kdskpd = $this->input->post('skpd');
		$kegiatan = $this->input->post('keg');
		$rek = $this->input->post('rek');
		$norka=$kdskpd.'.'.$kegiatan.'.'.$rek;

        $query1 = $this->db->query("SELECT nilai, nilai_sempurna, nilai_ubah FROM trdrka where no_trdrka='$norka' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'rektotal_rka' => number_format($resulte['nilai'],"2",".",","),
                        'rektotal_rka_sempurna' => number_format($resulte['nilai_sempurna'],"2",".",","),
                        'rektotal_rka_ubah' => number_format($resulte['nilai_ubah'],"2",".",","),
						
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);
		   
		 }
	

     function tsimpan_rinci_jk(){
        
        $norka     = $this->input->post('no');
        $csql      = $this->input->post('sql');
        $cskpd     = $this->input->post('skpd');
        $kegiatan  = $this->input->post('giat'); 
                               
		$sql       = "delete from trdpo where  no_trdrka='$norka'";
		$asg       = $this->db->query($sql);
        	
				if (!($asg)){
                    $msg = array('pesan'=>'0');
                    echo json_encode($msg);
                    exit();
                }else{            
                    $sql = "insert into trdpo(no_po,header,kode,no_trdrka,uraian,volume1,satuan1,harga1,total,volume_ubah1,satuan_ubah1,harga_ubah1,total_ubah,volume2,satuan2,volume_ubah2,satuan_ubah2,volume3,satuan3,volume_ubah3,satuan_ubah3,tvolume,tvolume_ubah,volume_sempurna1,volume_sempurna2,volume_sempurna3,tvolume_sempurna,satuan_sempurna1,satuan_sempurna2,satuan_sempurna3,harga_sempurna1,total_sempurna)"; 
                    $asg = $this->db->query($sql.$csql);
					if (!($asg)){
                       $msg = array('pesan'=>'0');
                        echo json_encode($msg);
                    }  else {
                       $msg = array('pesan'=>'1');
                        echo json_encode($msg);
                    }
                }
	  
		$query1 = $this->db->query(" update trdrka set nilai= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_sempurna= (select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka),nilai_ubah=(select sum(total) as nl from trdpo where no_trdrka=trdrka.no_trdrka) where no_trdrka='$norka' ");  
		$query1 = $this->db->query(" update trskpd set total= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ),total_sempurna= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ), total_ubah= (select sum(nilai) as jum from trdrka where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ) where kd_kegiatan='$kegiatan' and kd_skpd='$cskpd' ");	
		$this->rka_rinci($skpd,$kegiatan,$rekening);
	
    }

	
function load_ttd_rb() {
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
	
function load_tanda_tangan($skpd='') {
        $kd_skpd = $skpd; 
		$kd_skpd2= $this->left($kd_skpd,7);
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE (left(kd_skpd,7)= '$kd_skpd2' AND kode='PA')  AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%'))";   

		 
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();
    	   
	}
	
	
	function preview_rka221(){
        $id = $this->uri->segment(3);
        $giat = $this->uri->segment(4);
        $cetak = $this->uri->segment(5);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE left(kd_skpd,7)= left('$id',7) AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip; 
                    $pangkat=$rowttd->pangkat;
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE left(kd_skpd,7)= left('$id',7) AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;
                    $pangkat2=$rowttd2->pangkat;
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,a.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,a.sumber,a.sasaran_giat,a.ang_lalu FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY f.kd_urusan,
				f.nm_urusan,
				a.kd_skpd,
				e.nm_skpd,
				a.kd_program,
				a.nm_program,
				a.kd_kegiatan,
				c.nm_kegiatan,
				a.tu_capai,
				a.tu_mas,
				a.tu_kel,
				a.tu_has,
				a.tk_capai,
				a.tk_mas,
				a.tk_kel,
				a.tk_has,
				a.lokasi,
				a.sumber,
				a.sasaran_giat,
				a.ang_lalu";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_has  = $roworg->tu_has;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_has  = $roworg->tk_has;
                    $sas_giat = $roworg->sasaran_giat;
                    $ang_lalu = $roworg->ang_lalu;
                }
		$kd_urusan= empty($roworg->kd_urusan) || ($roworg->kd_urusan) == '' ? '' : ($roworg->kd_urusan);
		$nm_urusan= empty($roworg->nm_urusan) || ($roworg->nm_urusan) == '' ? '' : ($roworg->nm_urusan);
		$kd_skpd= empty($roworg->kd_skpd) || ($roworg->kd_skpd) == '' ? '' : ($roworg->kd_skpd);
		$nm_skpd= empty($roworg->nm_skpd) || ($roworg->nm_skpd) == '' ? '' : ($roworg->nm_skpd);
		$kd_prog= empty($roworg->kd_program) || ($roworg->kd_program) == '' ? '' : ($roworg->kd_program);
		$nm_prog= empty($roworg->nm_program) || ($roworg->nm_program) == '' ? '' : ($roworg->nm_program);
		$kd_giat= empty($roworg->kd_kegiatan) || ($roworg->kd_kegiatan) == '' ? '' : ($roworg->kd_kegiatan);
		$nm_giat= empty($roworg->nm_kegiatan) || ($roworg->nm_kegiatan) == '' ? '' : ($roworg->nm_kegiatan);
		$lokasi= empty($roworg->lokasi) || ($roworg->lokasi) == '' ? '' : ($roworg->lokasi);
		$tu_capai= empty($roworg->tu_capai) || ($roworg->tu_capai) == '' ? '' : ($roworg->tu_capai);
		$tu_mas= empty($roworg->tu_mas) || ($roworg->tu_mas) == '' ? '' : ($roworg->tu_mas);
		$tu_kel= empty($roworg->tu_kel) || ($roworg->tu_kel) == '' ? '' : ($roworg->tu_kel);
		$tu_has= empty($roworg->tu_has) || ($roworg->tu_has) == '' ? '' : ($roworg->tu_has);
		$tk_capai= empty($roworg->tk_capai) || ($roworg->tk_capai) == '' ? '' : ($roworg->tk_capai);
		$tk_mas= empty($roworg->tk_mas) || ($roworg->tk_mas) == '' ? '' : ($roworg->tk_mas);
		$tk_kel= empty($roworg->tk_kel) || ($roworg->tk_kel) == '' ? '' : ($roworg->tk_kel);
		$tk_has= empty($roworg->tk_has) || ($roworg->tk_has) == '' ? '' : ($roworg->tk_has);
		$sas_giat= empty($roworg->sasaran_giat) || ($roworg->sasaran_giat) == '' ? '' : ($roworg->sasaran_giat);
		$ang_lalu= empty($roworg->ang_lalu) || ($roworg->ang_lalu) == '' || ($roworg->ang_lalu) == 'Null' ? 0 : ($roworg->ang_lalu);

        $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",".",",");
                   $totp1 =number_format($rowb->totb*1.1,"2",".",",");
                }
                
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD 221  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"6\" align=\"left\">
						<table border=\"0\">
						<tr><td width=\"20%\" align=\"left\">&nbsp;Urusan Pemerintahan</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">$kd_urusan - $nm_urusan</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Organisasi</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">$kd_skpd   - $nm_skpd</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Program</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">$kd_prog   - $nm_prog</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Kegiatan</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">$kd_giat   - $nm_giat</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;</td>
						<td width=\"5%\" align=\"center\"></td>
						<td width=\"80%\" align=\"left\"></td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Lokasi Kegiatan</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">$lokasi</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Jumlah Tahun n - 1</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">Rp. ".number_format($ang_lalu,"2",".",",")." (".$this->rka_model->terbilang($ang_lalu*1)." rupiah)</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Jumlah Tahun</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">Rp. $totp (".$this->rka_model->terbilang($rowb->totb*1)." rupiah)</td></tr>
						<tr><td width=\"20%\" align=\"left\">&nbsp;Jumlah Tahun n + 1</td>
						<td width=\"5%\" align=\"center\">:</td>
						<td width=\"80%\" align=\"left\">Rp. $totp1 (".$this->rka_model->terbilang($rowb->totb*1.1)." rupiah)</td></tr>
						</table>
						
					</td>";
					
        $cRet .= "</table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">";

        $cRet .= "<tr>
                    <td width=\"100%\" colspan=\"6\"  align=\"center\">Indikator & Tolak Ukur Kinerja Belanja langsung</td>
                 </tr>";
        $cRet .="<tr>
                 <td width=\"20%\" align=\"center\">Indikator </td>
                 <td width=\"60%\" align=\"center\">Tolak Ukur Kerja </td>
                 <td width=\"20%\" align=\"center\">Target Kinerja </td>
                </tr>";		  
        $cRet .=" <tr align=\"center\">
                    <td width=\"20%\">Capaian Program </td>
                    <td width=\"60%\">$tu_capai</td>
                    <td width=\"20%\">$tk_capai</td>
                 </tr>";
        $cRet .=" <tr align=\"center\">
                    <td width=\"20%\">Masukan </td>
                    <td width=\"60%\">$tu_mas</td>
                    <td width=\"20%\">Rp. $totp </td>
                </tr>";
        $cRet .=" <tr align=\"center\">
                    <td width=\"20%\">Keluaran </td>
                    <td width=\"60%\">$tu_kel</td>
                    <td width=\"20%\">$tk_kel</td>
                  </tr>";
        $cRet .=" <tr align=\"center\">
                    <td width=\"20%\">Hasil </td>
                    <td width=\"60%\">$tu_has</td>
                    <td width=\"20%\" >$tk_has</td>
                  </tr>";
        $cRet .= "<tr>
                    <td colspan=\"6\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                </tr>";
        
        $cRet .= "<tr>
                        <td colspan=\"6\" align=\"center\">RINCIAN DOKUMEN PELAKSANAAN ANGGARAN BELANJA LANGSUNG <br>PROGRAM DAN PERKEGIATAN SATUAN KERJA PERANGKAT DAERAH</td>
                  </tr>";
                    
        $cRet .="</table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<thead> 
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     
						</thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp; </td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
						GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
						 UNION ALL 
						 SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
						 UNION ALL  
						 SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
						 UNION ALL 
						 SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
						 UNION ALL 
						 SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY a.kd_rek5,b.nm_rek5
						 UNION ALL 
						 SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
						0 AS harga,SUM(a.total) AS nilai,'6' AS id 
						FROM trdpo a
						LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
						WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(a.no_trdrka,12,21)='$giat'
						GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
						UNION ALL
						SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
						a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,12,21)='$giat' AND (header='0' or header is null)
						) a ORDER BY a.rek1,a.id,a.no_po";
                 
                $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
					
                //    $volum=$row->volume;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');

                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                 
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td></tr>";
                  
                
				 $kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
				
				if (($kd_ttd=='01') ){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>$pangkat 
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"6\">							
								<table border=\"0\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>$pangkat2 
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
 
				$cRet    .= "</table>";                            
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";

				$cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">Tim Anggaran Pemerintah Daerah</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
         $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd where kd_skpd='$id' order by no";
                     $sqltapd = $this->db->query($sqltim);
                  if ($sqltapd->num_rows() > 0){
					
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
				  }}
					else{
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\"> 1. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>
						<tr>
                         <td width=\"5%\" align=\"left\"> 2. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>
						<tr>
                         <td width=\"5%\" align=\"left\"> 3. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>
						<tr>
                         <td width=\"5%\" align=\"left\"> 4. </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>"; 
					}

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
		$judul='RKA-221_'.$id.'';
		switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
		case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 0;  
		 echo ("<title>RKA 221</title>");
			echo($cRet);
        break;
        }
	}
	
	
	
		
	function proses_transfer_sumber(){
      //  $user     = $this->session->userdata('pcNama');
		$skpd     = '';
        $dir = $this->input->post('sumber');
		if ($dir==1){
 		$this->db->query("exec transfer_sumber1 '$skpd'");
		} else if ($dir==2){
 		$this->db->query("exec transfer_sumber2 '$skpd'");
		} else if ($dir==3){
 		$this->db->query("exec transfer_sumber3 '$skpd'");
		} else if ($dir==4){
 		$this->db->query("exec transfer_sumber4 '$skpd'");
		} else if ($dir==5){
 		$this->db->query("exec transfer_sumber5 '$skpd'");
		}
		
 		//$this->db->query("exec [backup]");
		echo '1';	
	}

	
	function transfer()
    {
        $data['page_title']= 'Transfer';
        $this->template->set('title', 'TransfeR--> 1');   
        $this->template->load('template','backup/transfer',$data) ; 
    }
	
	function transfer2()
    {
        $data['page_title']= 'Transfer';
        $this->template->set('title', 'TransfeR--> 2');   
        $this->template->load('template','backup/transfer2',$data) ; 
    }
	
	function transfer3()
    {
        $data['page_title']= 'Transfer';
        $this->template->set('title', 'TransfeR--> 3');   
        $this->template->load('template','backup/transfer3',$data) ; 
    }
	
	function transfer4()
    {
        $data['page_title']= 'Transfer';
        $this->template->set('title', 'TransfeR--> 4');   
        $this->template->load('template','backup/transfer4',$data) ; 
    }
	
	function transfer5()
    {
        $data['page_title']= 'Transfer';
        $this->template->set('title', 'TransfeR--> 5');   
        $this->template->load('template','backup/transfer5',$data) ; 
    }
	
	function rka22()
    {
        $data['page_title']= 'CETAK';
        $this->template->set('title', 'Cetak RKA 22');   
        $this->template->load('template','anggaran/rka/rka22_baru',$data) ; 
    }
	
    
	
	function preview_rka22_baru(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;
                    $pangkat=$rowttd->pangkat;
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip; 
                    $pangkat2=$rowttd2->pangkat;
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr><td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR<br>RKA - SKPD 22  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Pemerintahan </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
					<tr>
                        <td width=\"20%\">Organisasi </td>
                        <td width=\"80%\">$kd_org -".$this->rka_model->get_nama($kd_org,'nm_org','ms_organisasi','kd_org')."</td>
                    </tr>
                    <tr>
                        <td>Unit Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Program</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"12%\" align=\"center\"><b>kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Uraian</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"6%\" align=\"center\"><b>Target Kinerja</b></td>
                            <td colspan=\"4\" bgcolor=\"#CCCCCC\" width=\"36%\" align=\"center\"><b>Tahun n</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Tahun n+1</b></td>
                        </tr>
                        <tr>
 		                    <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Belanja Pegawai</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Barang & Jasa</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Modal</td>
                            <td width=\"9%\" bgcolor=\"#CCCCCC\" align=\"center\">Jumlah</td>
                        </tr>    
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                           
                         </tr>
                     </tfoot>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"12%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"6%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT
							a.kd_program AS prog,
							a.kd_program AS prog1,
							' ' AS giat,
							a.nm_program AS uraian,
							' ' AS lokasi,
							' ' AS target,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '521' THEN x.nilai ELSE 0 END) AS bljpeg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '522' THEN x.nilai ELSE 0 END) AS bljbrg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '523' THEN x.nilai ELSE 0 END) AS bljmdl,
							SUM (x.nilai) AS jumlah
						FROM
							trdrka x
						LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
						AND x.kd_kegiatan = a.kd_kegiatan
						WHERE
							RIGHT (a.kd_program, 2) <> '00'
						AND x.kd_skpd = '$id'
						GROUP BY
							a.kd_program,a.nm_program
						UNION
						SELECT
								a.kd_program AS prog,
								' ' AS prog1,
								a.kd_kegiatan AS giat,
								a.nm_kegiatan AS uraian,
								a.lokasi AS lokasi,
								a.tk_kel AS target,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '521' THEN x.nilai ELSE 0 END) AS bljpeg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '522' THEN x.nilai ELSE 0 END) AS bljbrg,
							SUM (CASE WHEN LEFT (x.kd_rek5, 3) = '523' THEN x.nilai ELSE 0 END) AS bljmdl,
								SUM(x.nilai) AS jumlah
							FROM
								trdrka x
								LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
							WHERE
								RIGHT(a.kd_program,2)<>'00' AND
								x.kd_skpd='$id'
							GROUP BY
								a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel
						ORDER BY prog,giat
						";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $prog=$row->prog1;
                    $giat=$row->giat;
                    $uraian=$row->uraian;
                    $lokasi=$row->lokasi;
                    $target=$row->target;
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$prog</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$giat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$lokasi</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$target</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }

						$sql1="SELECT x.kd_skpd ,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan WHERE LEFT(kd_rek5,3)='521' AND  a.kd_skpd='$id') AS bljpeg,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan WHERE LEFT(kd_rek5,3)='522' AND  a.kd_skpd='$id')  AS bljbrg,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan WHERE LEFT(kd_rek5,3)='523' AND  a.kd_skpd='$id') AS bljmdl,
                        (SELECT SUM(nilai) AS nilai FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd  AND x.kd_kegiatan=a.kd_kegiatan WHERE x.kd_skpd='$id' and LEFT(kd_rek5,2)='52' ) AS jumlah FROM trdrka x inner JOIN trskpd a ON a.kd_skpd=x.kd_skpd
						WHERE x.kd_skpd='$id' GROUP BY x.kd_skpd ";


                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                   
                    $peg=empty($row->bljpeg) || $row->bljpeg == 0 ? '' :number_format($row->bljpeg,2,',','.');
                    $brg=empty($row->bljbrg) || $row->bljbrg == 0 ? '' :number_format($row->bljbrg,2,',','.');
                    $mdl=empty($row->bljmdl) || $row->bljmdl == 0 ? '' :number_format($row->bljmdl,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nilai= number_format($row->jumlah,"2",",",".");
                   
                     $cRet    .= " <tr><td colspan=\"4\" style=\"vertical-align:center;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$peg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$brg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$mdl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>
                                     ";
                }
				$cRet    .= "</table>";
				$kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
		        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";

				if (($kd_ttd=='01') ){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"10\">
								<table border=\"0\"  align=\"right\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>$pangkat 
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"10\">							
								<table border=\"0\"  align=\"right\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>$pangkat2 
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } 
                $cRet    .= "</table>";

		        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";
				
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"10\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"10\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"10\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                            </tr>";
				 $cRet    .= "</table>";      
				 
         $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd where kd_skpd='$id' order by no";
                     $sqltapd = $this->db->query($sqltim);
                  if ($sqltapd->num_rows() > 0){
					
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
				  }}
					else{
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\"> &nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>"; 
					}
        
           
                             
                 
        $cRet    .= "</table>";
        $data['prev']= $cRet; 
		$judul ='RKA-22'.$id.'';
      switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,5,'5');
        break;
		case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 0;     
		echo ("<title>RKA 22</title>");
    	echo($cRet);
        break;
        }
        
                
    }
	
	
	
	function rka0()
    {
        $data['page_title']= 'CETAK';
        $this->template->set('title', 'Cetak RKA 0');   
        $this->template->load('template','anggaran/rka/rka0_baru',$data) ; 
    }


	
	  function preview_rka0_baru(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;  
                    $pangkat=$rowttd->pangkat;  
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip; 
                    $pangkat2=$rowttd2->pangkat;  
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
       $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr> <td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>RKA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Pemerintahan </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
					<tr>
                        <td width=\"20%\">Organisasi </td>
                        <td width=\"80%\">$kd_org -".$this->rka_model->get_nama($kd_org,'nm_org','ms_organisasi','kd_org')."</td>
                    </tr>
                    <tr>
                        <td>Unit Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                 if ($query->num_rows() > 0){                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
					                
				}
				}else{
					$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">4</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">PENDAPATAN</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>";
					
                
				}                                 
                
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>
								  <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,'.',',');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>"; 
                    
					$kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
				if ((($kd_ttd=='01') && ($kd_kepala!='1.20.03'))|| ($id=='1.20.03.00')){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"6\">
								<table border=\"0\"  align=\"right\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>$pangkat 
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"6\">							
								<table border=\"0\"  align=\"right\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>$pangkat2 
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }
                             
					 $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd where kd_skpd='$id' order by no";
                     $sqltapd = $this->db->query($sqltim);
                  if ($sqltapd->num_rows() > 0){
					
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
				  }}
					else{
						$cRet .="<tr>
                         <td width=\"5%\" align=\"left\"> &nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
                         <td width=\"35%\"  align=\"left\"></td>
                         <td width=\"20%\"  align=\"left\"></td>
						</tr>"; 
					} 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $judul         = 'RKA0';
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            //$this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;
		echo ("<title>RKA 0</title>");
    	echo($cRet);
        break;
        }
                
    }
	
		 function preview_rka0_rinci(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
        $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $jabatan2  = $rowttd2->jab;
                }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr> <td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"80%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>RKA - SKPD  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Pemerintahan </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
					<tr>
                        <td width=\"20%\">Organisasi </td>
                        <td width=\"80%\">$kd_org -".$this->rka_model->get_nama($kd_org,'nm_org','ms_organisasi','kd_org')."</td>
                    </tr>
                    <tr>
                        <td>Unit Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                     <thead>                       
                        <tr><td bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td bgcolor=\"#CCCCCC\" width=\"70%\" align=\"center\"><b>URAIAN</b></td>
                            <td bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>JUMLAH(Rp.)</b></td></tr>
                     </thead>
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) where left(b.kd_rek5,2)='41' and b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;
                    $coba2=$row->nm_rek;
                    $coba3= number_format($row->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba3</td></tr>";
                }
                $sqltp="SELECT SUM(nilai) AS totp FROM trdrka WHERE LEFT(kd_rek5,2)='41' and kd_skpd='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                   $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba4</td></tr>
								  <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\"></td></tr>";
                 }     
                $sql2="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(len(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(len(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(len(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       UNION ALL 
                       SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek4 a INNER JOIN trdrka b
                       ON a.kd_rek4=LEFT(b.kd_rek5,(len(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                       UNION ALL 
                       SELECT RTRIM(a.kd_rek5) AS kd_rek,a.kelompok AS rek,a.nm_rek5 AS nm_rek ,SUM(b.nilai) AS nilai FROM ms_rek5 a INNER JOIN trdrka b
                       ON a.kd_rek5=b.kd_rek5 WHERE (LEFT(b.kd_rek5,3)='511' OR LEFT(b.kd_rek5,2)='52') AND b.kd_skpd='$id' GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5 
                       

ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    //$coba5=$row1->rek;
                    $coba5=$this->dotrek($row1->kd_rek);
                    $coba6=$row1->nm_rek;
                    $coba7= number_format($row1->nilai,"2",",",".");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$coba5</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">$coba6</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba7</td></tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb FROM trdrka WHERE (LEFT(kd_rek5,3)='511' or LEFT(kd_rek5,2)='52') and kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$coba8</td></tr>";
                 } 
                  
                  $suplus=$cob1-$cob; 
                  if ($suplus < 0){
                	$x1="(";
                	$suplus=$suplus*-1;
                	$y1=")";}
                  else {
                	$x1="";
	                $y1="";}
                 $surp=number_format($suplus,2,',','.');  
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"70%\">Surplus/Defisit</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$x1$surp$y1</td></tr>"; 
                    
				$kd_ttd=substr($id,8,9);
				 $kd_kepala=substr($id,0,7);
				 $cRet    .= "</table>";
				 
				 $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";
				 if ((($kd_ttd=='01') && ($kd_kepala!='1.20.03'))|| ($id=='1.20.03.00')){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"right\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"35%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br> Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>NIP. $nip 
								<td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td></td>
								</tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100\" align=\"center\" colspan=\"6\">							
								<table border=\"0\">
								<tr>
								
								<td width=\"40%\" align=\"center\">Mengetahui,
								<br>Pengguna Anggaran
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>NIP. $nip2 
								</td>
								<td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp; 
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								<br>Kuasa Pengguna Anggaran
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }					 
				$cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"5\" align=\"center\">Tim Anggaran Pemerintah Daerah </td>
                         
                    </tr>
					<tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tanda Tangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
					
					if($no<=4)
											   {
												 for ($i = $no; $i <= 4; $i++) 
												  {
													$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
												  }                                                   
											   } 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        $judul         = 'RKA0';
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) { 
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;  
		echo ("<title>RKA 0</title>");
    	echo($cRet);
        break;
        }
                
    }
	
//Cetak RKA 1	
	function rka1(){
        $data['page_title']= 'Cetak RKA 1';
        $this->template->set('title', 'Cetak RKA 1');   
        $this->template->load('template','anggaran/rka/rka1',$data) ; 
    }
	
  
   function preview_rka1_baru(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
 
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
  
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
       
	   
		if (strlen($id)==7){
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)';

            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
            
        }else{
            $a = 'left(';;
            $skpd = 'kd_skpd';
            $b = ',10)';
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $sqldns1="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org=left('$id',7)";

            $sqlskpd1=$this->db->query($sqldns1);
            foreach ($sqlskpd1->result() as $rowdns)
                {
                    $kd_skpd1  = $rowdns->kd_sk;
                    $nm_skpd1 = $rowdns->nm_sk;
                }
        }
  
      
            $sqlskpd=$this->db->query($sqldns);
            foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
		
        $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
		
				
        $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
        if ($ttd1 == ''){
            $jnip ='';
            $nip= '';               
            $nama= '';
            $jabatan  = '';
            $pangkat = '';		  
 		}else{
            $sqlttd1="SELECT top 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd WHERE $a$skpd$b= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                     $sqlttd=$this->db->query($sqlttd1);
                     foreach ($sqlttd->result() as $rowttd)
                    {
                        $jnip ='Mengetahui, ';
                        $nip='NIP. ' . ($rowttd->nip);                
                        $nama= ($rowttd->nm);
                        $jabatan  = ($rowttd->jab);
					    $pangkat = ($rowttd->pangkat);
                    }
		}		
        
    if ($ttd2 == ''){
            $jnip2 = '';
            $nip2='';                   
            $nama2= '';
            $jabatan2  = '';
    		$pangkat2 = '';
      }else{
		$sqlttd2="SELECT top 1 nama as nm,nip as nip,jabatan as jab,pangkat FROM ms_ttd WHERE $a$skpd$b= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $jnip2 =$daerah. ',';
                    $nip2='NIP. ' . ($rowttd2->nip) ;                   
                    $nama2= ($rowttd2->nm) ;
                    $jabatan2  = ($rowttd2->jab) ;
					$pangkat2 = ($rowttd2->pangkat) ;
                }
 
     }
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-right: solid 1px black;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"65%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>RKA - SKPD <br> <h1>1</h1>  </strong></td>
                    </tr>

                    <tr>
                         <td width=\"65%\" style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"80%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"80%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";

	  if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"\ align=\"center\"><strong>RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG SATUAN KERJA PERANGKAT DAERAH</strong> </td>
                    </tr>
                </table>";
        }ELSE{
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd1 - $nm_skpd1</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Sub Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"\ width=\"100%\" align=\"center\"><strong>RINCIAN ANGGARAN PENDAPATAN SATUAN KERJA PERANGKAT DAERAH</strong></td>
                    </tr>
                </table>";            
        }      
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" width=\"5%\" align=\"center\"><b>Kode Rekening </b></td>                            
                            <td rowspan=\"2\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" width=\"35%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"20%\" align=\"center\"><b>Jumlah(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"9%\" align=\"center\"><strong>Volume</strong></td>
                            <td width=\"9%\" align=\"center\"><strong>Satuan</strong></td>
                            <td width=\"17%\" align=\"center\"><strong>Tarif /Harga</strong></td>
                        </tr>    
                     </thead>
					
                   
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\"><strong>3</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"9%\" align=\"center\"><strong>4</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"center\"><strong>5</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\" align=\"center\"><strong>6 = (3 X 5)</strong></td></tr>
                        ";
                        
                 $sql1="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,5)='00.04' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.04'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                            0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
                            0 AS harga,SUM(a.total) AS nilai,'6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,5)='00.04' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                            a.harga1 AS harga,a.total AS nilai,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,5)='00.04' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po 
                            ";      
                 
                $totp = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
				                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $head = $row->header;
                    
                    if($rek==' '){ 
                        $uraian='- ' .$row->nama;
                        if($head != 0){
                            $volum='';                            
                        }else{
                            $volum=number_format($row->volume,2,',','.');
                        }
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
                    }
                    
                    
                    
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    $nila= number_format($row->nilai,"2",",",".");
                    
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
                    }
                     
                    if (strlen($row->rek1)>6) {
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"> $uraian </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td></tr>
                                     ";
					}else{
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\" align=\"center\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:11px;\" width=\"20%\" align=\"right\"><strong>$nila</strong></td></tr>
                                     ";
					}
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:11px;\" width=\"20%\" align=\"right\">".number_format(0,"2",",",".")."</td></tr>
                                     ";
					
				}


				   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"5%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"9%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"17%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:11px;\" width=\"20%\" align=\"right\"><strong>$totp</strong></td></tr>";
                 

							 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table border=\"0\">
								<tr>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$jnip
								<br>$jabatan
      							<p>&nbsp;</p>
                				<br><b><ins>$nama</ins></b>
                				<br>$nip 
								</td>
								<td width=\"5%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"50%\" align=\"center\">$jnip2 &emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp; 
								<br>$jabatan2
      							<p>&nbsp;</p>
                				<br><b><u>$nama2</u></b>
                				<br>$nip2 
								</td></tr></table></td>
                             </tr>";
							 
     $cRet    .= "</table>";
   						

        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";
							 
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Keterangan </td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"6\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">Dst.</td>
                            </tr>";
        $cRet    .= "</table>";
 
         $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                       <tr>
                                <td width=\"100%\" align=\"left\" colspan=\"6\">&nbsp;</td>
                            </tr>
                    </table>";

       
      $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"5\" align=\"center\"><strong>Tim Anggaran Pemerintah Daerah</strong> </td>
                         
                    </tr>
					<tr>
                         <td width=\"10%\" align=\"center\"><strong>No</strong> </td>
                         <td width=\"30%\"  align=\"center\"><strong>Nama</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>NIP</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>Jabatan</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>Tanda Tangan</strong></td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
					
					if($no<=4)
											   {
												 for ($i = $no; $i <= 4; $i++) 
												  {
													$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
												  }                                                   
											   } 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        
        switch($cetak) {
            case 0;  
                echo ("<title>RKA 1</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,10,10,'0','','RKA 1');
                    
            break;
        }      
    }
	
//END RKA 1	 
	
 	
//rka 21	
	function rka21()
    {
        $data['page_title']= 'CETAK';
        $this->template->set('title', 'Cetak RKA 21');   
        $this->template->load('template','anggaran/rka/rka21',$data) ; 
    }
	
    function load_ttd_unit($skpd='') {
        $kd_skpd = $skpd; 
		$kd_skpd2= $this->left($kd_skpd,10);
		$lccr='';        
        $lccr = $this->input->post('q');        
		$sql = "SELECT * FROM ms_ttd WHERE left(kd_skpd,10)= '$kd_skpd2' AND kode='PA'  AND (UPPER(kode) LIKE UPPER('%$lccr%') OR UPPER(nama) LIKE UPPER('%$lccr%')) and bidang='1'";   

		 
		
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 0;        
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama']      
                        );
                        $ii++;
        }           
           
        echo json_encode($result);
        $query1->free_result();   	   
	}

    function preview_rka21(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        
        if (strlen($id)==7){
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)';

            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
            
        }else{
            $a = 'left(';;
            $skpd = 'kd_skpd';
            $b = ',10)';
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $sqldns1="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org=left('$id',7)";
        
		    $sqlskpd1=$this->db->query($sqldns1);
            foreach ($sqlskpd1->result() as $rowdns)
                {
                    $kd_skpd1  = $rowdns->kd_sk;
                    $nm_skpd1  = $rowdns->nm_sk;
                }
		}
  
      
            $sqlskpd=$this->db->query($sqldns);
            foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }
		
		
        $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
       
       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengetahui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }
      
      if ($ttd2<>''){  
      $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'. $rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       }else{
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';       
       } 
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> 
						<td width=\"15%\" rowspan=\"5\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" />
					</td>
                        
                    </tr>
					<tr>
                         <td width=\"70%\" align=\"center\" ><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"15%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR RKA - SKPD <br><h1> 2.1 </h1> </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
                  
        if (strlen($id)==7){          
			$cRet .="<table style=\"border-collapse:collapse;font-size:14px;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"25%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>

                    <tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG SATUAN KERJA PERANGKAT DAERAH </td>
                    </tr>
                </table>";
		}else{
			$cRet .="<table style=\"border-collapse:collapse;font-size:14px;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"25%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd1 - $nm_skpd1</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Sub Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
					<tr>
                        <td colspan=\"2\"\ align=\"center\">RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG SATUAN KERJA PERANGKAT DAERAH </td>
                    </tr>
                </table>";
		}
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px; border-top: solid 1px black;\"  width=\"100%\" align=\"center\" border=\"1\"  cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"27%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"17%\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"17%\" align=\"center\"><b>Tahun N+1(Rp.)</b></td></tr>
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volu<br>me</td>
                            <td style=\"font-weight:bold;font-size:9px;\" width=\"5%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;font-size:10px;\" width=\"15%\" bgcolor=\"#CCCCCC\" align=\"center\">Tarif /Harga</td>
                        </tr>                            
                      
						<tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"30%\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"5%\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"15%\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"17%\" align=\"center\">7</td>
                        </tr>
					 </thead>
                    
                     <tfoot>
						<tr>
							<td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" ></td>
                        </tr>
					 </tfoot>
                       
                        ";
			IF ($id == '1.20.12'){					
				$sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' 
							UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51'
							) 
                        a ORDER BY a.rek1,a.id";
			}else{
				if($id == '1.20.12.02'){
					$sql1="SELECT * FROM(
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT 0 header, 0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
							union all
							
							SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
							0 AS harga,SUM(a.total) AS nilai,'6' AS id 
							FROM trdpo a
							LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
							WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,5)='00.51' and substring(a.no_trdrka,34,3) not in ('514','515')
							GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
						
                            UNION ALL 
                            SELECT 0 header, a.no_urut [no_po],RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
                            '' AS satuan,0  AS harga,a.total AS nilai,'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' and 
							substring(no_trdrka,34,3) in ('514','515')
							union all
							SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
							a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
							WHERE LEFT(a.no_trdrka$b='$id' AND 
							SUBSTRING(no_trdrka,28,5)='00.51' and 
							substring(no_trdrka,34,3) not in ('514','515') 
							) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
				}else{
					$sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id";
				}
			}		
						
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totb = 0;                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    
                    
                    if ($reke<>''){
                        $volum='';                        
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
                    }
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai,2,',','.');
                    $nila1 = empty($row->nilai) || $row->nilai == 0 ? '' :number_format($row->nilai*1.1,2,',','.');
                    
					if 	(strlen($reke)==1){
						$totb = $row->nilai;
					}	
					
					$x ='';
					if (strlen($reke)==''){
						$x ='&nbsp;';
					}
					
                    if (strlen($reke)>8 || strlen($reke)==0){
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$reke </td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$x $uraian</td>
                                     <td style=\"vertical-align:top;font-size:10px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$nila1</td>
                                     </tr>
                                     
                                     ";
                   }else{
                     $cRet    .= " <tr><td style=\"vertical-align:top;font-size:11px; border-top: solid 1px black;border-bottom: none;\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$volum</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"center\"><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nila</strong></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nila1</strong></td>
                                     </tr>
                                     
                                     ";
                   }                  
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";
                             
                 //$sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND $a$skpd$b='$id'";
                  //  $sqlb=$this->db->query($sqltp);
                 //foreach ($sqlb->result() as $rowb)
                //{
                   $totp=number_format($totb,"2",",",".");
                   $totp1=number_format($totb*1.1,"2",",",".");
					                  
   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>Jumlah Belanja
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
									 <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;font-size:11px;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totp1</strong></td>
                                     </tr>";
                 //} 
                 $cRet    .= "</table>"; 
				   $cRet    .="<table style=\"border-collapse:collapse;font-size:11px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";
                        $cRet .="<tr>
                                    <td width=\"100\" align=\"center\" colspan=\"7\">							
								        <table border=\"0\">
								            <tr>								
								                <td width=\"40%\" align=\"center\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                				                    <br><b><u>$nama1</u></b>
                				                    <br>$pangkat1 
                				                    <br>$nip1 
								                </td>
								                <td width=\"20%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\">$daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								                    <br>$jabatan2,
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama2</u></b>
                				                    <br>$pangkat2 
                				                    <br>$nip2 
								                </td>
                                            </tr>
                                        </table>
                                    </td>
                             </tr>";
                $cRet    .= "</table>";    

				$cRet    .="<table style=\"border-collapse:collapse;font-size:12px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">";
				
                 $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Keterangan :</td>
                            </tr>";
                                                        
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"7\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Dst</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
 /*       $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tandatangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"left\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";
                     $no=$no+1;                
                    }
        
                    

        $cRet .=       " </table>";*/
		        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                    <tr>
                         <td colspan=\"5\" align=\"center\">Tim Anggaran Pemerintah Daerah </td>
                         
                    </tr>
					<tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tanda Tangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
					
					if($no<=4)
											   {
												 for ($i = $no; $i <= 4; $i++) 
												  {
													$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
												  }                                                   
											   } 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        switch($cetak) {
            case 0;  
                echo ("<title>RKA 21</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,3,10,'0');
            break;
        }
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }

//end rka 21	
    function preview_rka21_baru(){
        $id = $this->uri->segment(3);
		$id = $this->uri->segment(3);
		$tgl_ttd= $_REQUEST['tgl_ttd'];
		$ttd1= $_REQUEST['ttd1'];
		$ttd2= $_REQUEST['ttd2'];
		$tanggal_ttd = $this->tanggal_format_indonesia($tgl_ttd);
       $sqldns="SELECT a.kd_urusan as kd_u,b.header as header, LEFT(a.kd_skpd,7) as kd_org,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
					$header  = $rowdns->header;
					$kd_org = $rowdns->kd_org;
                }

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nip=$rowttd->nip;                    
                    $nama= $rowttd->nm;
                    $pangkat= $rowttd->pangkat;
                    $jabatan  = $rowttd->jab;
                }
				
		$sqlttd2="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE kd_skpd= '$id' AND kode='PA' AND(REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd2=$this->db->query($sqlttd2);
                 foreach ($sqlttd2->result() as $rowttd2)
                {
                    $nip2=$rowttd2->nip;                    
                    $nama2= $rowttd2->nm;
                    $pangkat2= $rowttd->pangkat;
                    $jabatan2  = $rowttd2->jab;
                }
        
        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:14px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr><td width=\"20%\" rowspan=\"4\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td width=\"90%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td width=\"10%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR<br>RKA - SKPD 21  </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>SATUAN KERJA PERANGKAT DAERAH </strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        $cRet .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\">Urusan Pemerintahan </td>
                        <td width=\"80%\">$kd_urusan - $nm_urusan</td>
                    </tr>
					<tr>
                        <td width=\"20%\">Organisasi </td>
                        <td width=\"80%\">$kd_org -".$this->rka_model->get_nama($kd_org,'nm_org','ms_organisasi','kd_org')."</td>
                    </tr>
                    <tr>
                        <td>Unit Organisasi</td>
                        <td>$kd_skpd - $nm_skpd</td>
                    </tr>
                    <tr>
                        <td colspan=\"2\"\ align=\"center\"><strong>Ringkasan Anggaran Pendapatan dan Belanja<br>Satuan Kerja Perangkat Daerah </strong></td>
                    </tr>
                </table>";
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"40%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"3\" bgcolor=\"#CCCCCC\" width=\"30%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Jumlah <br>(Rp.)</b></td></tr>
                            <td rowspan=\"2\" bgcolor=\"#CCCCCC\" width=\"20%\" align=\"center\"><b>Tahun N+1<br>(Rp.)</b></td></tr>
                        <tr>
 		                    <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Volume</td>
                            <td width=\"8%\" bgcolor=\"#CCCCCC\" align=\"center\">Satuan</td>
                            <td width=\"14%\" bgcolor=\"#CCCCCC\" align=\"center\">harga</td>
                        </tr>    
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\" align=\"center\">&nbsp;</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"14%\">&nbsp;</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td>
							<td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"20%\">&nbsp;</td></tr>
                        ";
                 $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'1' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE LEFT(a.kd_rek5,3)='511' AND a.kd_skpd='$id' 
                        GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                        UNION ALL 
                        SELECT 0 header,0 no_po, LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'2' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE LEFT(a.kd_rek5,3)='511'
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2), nm_rek2
                        UNION ALL  
                        SELECT 0 header,0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'3' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                        UNION ALL 
                        SELECT 0 header,0 no_po, LEFT(a.kd_rek5,4) AS rek1,LEFT(a.kd_rek5,4) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'4' AS id , ' ' as po FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,4)=b.kd_rek4 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,4),nm_rek4 
                        UNION ALL 
                        SELECT 0 header,0 no_po, a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
                        0 AS harga,SUM(a.nilai) AS nilai,'5' AS id, ' ' as po FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE LEFT(a.kd_rek5,3)='511' 
                        AND a.kd_skpd='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
						UNION ALL
						SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
						0 AS harga,SUM(a.total) AS nilai,'6' AS id, b.no_po as po
						FROM trdpo a
						LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka
						WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(a.no_trdrka,34,3)='511'
						GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                        UNION ALL 
                        SELECT 0 header, no_po, RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
                        a.harga1 AS harga,a.total AS nilai,'6' AS id, no_po AS po FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,34,3)='511' AND (header='0' or header is null)) a 
						ORDER BY a.rek1,a.id, a.po";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $volum=$row->volume;
                    $sat=$row->satuan;
					if($volum==0){
						$volum = '';
					} else{
						$volum = $volum;
					}
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",".",",");
					$nil = $row->nilai;
					$nilai_n = number_format($nil + ($nil*30/100),"2",".",",");
                   
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">$uraian</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nila</td>
									 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$nilai_n</td></tr>
                                     ";
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td>&nbsp;</td>
								<td align=\"right\">&nbsp;</td>
                             </tr>";
                 $sqltp="SELECT SUM(nilai) AS totb FROM trdrka WHERE LEFT(kd_rek5,3)='511' AND kd_skpd='$id'";
                    $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp=number_format($rowb->totb,"2",".",",");
                   $totp_n=number_format(($rowb->totb)+(($rowb->totb)*30/100),"2",".",",");
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\">Jumlah Belanja</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"8%\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"14%\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp</td>
									 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"20%\" align=\"right\">$totp_n</td></tr>";
                 } 
                 
				 if ($ttd2==''){
					$cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><u><b>$nama</b></u>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 } else {
							 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"7\">
								<table border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">Mengetahui,
								<br>$jabatan2,
      							<p>&nbsp;</p>
                				<br><b>$nama2</b>
                				<br>NIP. $nip2 
								</td>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,$tanggal_ttd
								<br>$jabatan,
      							<p>&nbsp;</p>
                				<br><b><u>$nama</u></b>
                				<br>$pangkat 
                				<br>NIP. $nip 
								</td></tr></table></td>
                             </tr>";
							 
							 }

                             
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Keterangan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"7\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Catatan Hasil Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Dst</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"7\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                            </tr>";
                  
                            
                 
                 
        
              
        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
                         <td width=\"10%\" align=\"center\">No </td>
                         <td width=\"30%\"  align=\"center\">Nama</td>
                         <td width=\"20%\"  align=\"center\">NIP</td>
                         <td width=\"20%\"  align=\"center\">Jabatan</td>
                         <td width=\"20%\"  align=\"center\">Tanda Tangan</td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";
                    $no=$no+1;               
                    }
				if($no<=4)
					{
					 for ($i = $no; $i <= 4; $i++) 
					  {
						$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
						}                                                   
				}
                    

        $cRet .=       " </table>";
        $data['prev']= $cRet;    
        $this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }

//RKA 31
function ctk_rka31 ()
    {
        $data['page_title']= 'CETAK RKA 31';
        $this->template->set('title', 'CETAK RKA 31');   
        $this->template->load('template','anggaran/rka/ctk_rka31',$data) ; 
    }

   function preview_rka31(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        
        $ttd1= $_REQUEST['ttd1'];
        
        if (strlen($id)==7){
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)';

            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
            
        }else{
            $a = 'left(';;
            $skpd = 'kd_skpd';
            $b = ',10)';
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $sqldns1="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org=left('$id',7)";

            $sqlskpd1=$this->db->query($sqldns1);
            foreach ($sqlskpd1->result() as $rowdns)
                {
                    $kd_skpd1  = $rowdns->kd_sk;
                    $nm_skpd1 = $rowdns->nm_sk;
                }
        }
  
      
            $sqlskpd=$this->db->query($sqldns);
            foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }

        $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
       
       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengetahui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-right: solid 1px black;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"65%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>RKA - PPKD <br> <h1>3.1</h1>  </strong></td>
                    </tr>

                    <tr>
                         <td width=\"65%\" style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"80%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"80%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"\ align=\"center\">RINCIAN ANGGARAN BELANJA TIDAK LANGSUNG SATUAN KERJA PERANGKAT DAERAH </td>
                    </tr>
                </table>";
        }ELSE{
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd1 - $nm_skpd1</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Sub Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"\ width=\"100%\" align=\"center\">RINCIAN PENERIMAAN PEMBIAYAAN</td>
                    </tr>
                </table>";            
        }        
                
        $cRet .= "<table style=\"border-collapse:collapse; font-size:12;border-top: solid 1px black;\"  width=\"100%\" align=\"center\" border=\"1\"  cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td  width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td  width=\"50%\" align=\"center\"><b>Uraian</b></td>
                            <td  width=\"40%\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                        </tr>                            
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\"  align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\"  align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"  align=\"center\"><strong>3</strong></td>
                        </tr>
                        ";

                        $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.61' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            ) 
                        a ORDER BY a.rek1,a.id";                        


                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    
                    
                    if ($reke<>''){
                        $volum='';                        
                    }
                    else{
                        $volum=$row->volume;
                    }
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",",",".");
                     
                    $x = strlen($reke);
                    
                    if (strlen($reke)>8 || strlen($reke)==0){
                       $cRet    .= "<tr>
                                        <td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><FONT SIZE=2>$reke </FONT></td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><FONT SIZE=2>$uraian</FONT></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><FONT SIZE=2>$nila</FONT></td>                                     
                                    </tr>";
                   }else{
                        if(strlen($reke)==1){
                             $totp = $totp + $row->nilai;
                             $cRet    .= "  <tr><td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><strong><FONT SIZE=2>$reke</FONT></strong></td>                                     
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong><FONT SIZE=2>$uraian</FONT></strong></td>
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong><FONT SIZE=2></FONT></strong></td>
                                            </tr>";
                        }else{
                             $cRet    .= "  <tr><td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><strong><FONT SIZE=2>$reke</FONT></strong></td>                                     
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong><FONT SIZE=2>$uraian</FONT></strong></td>
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong><FONT SIZE=2>$nila</FONT></strong></td>
                                            </tr>";                            
                        }
                        
                   }                  
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";

                    $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\"><strong><FONT SIZE=2>JUMLAH PENERIMAAN</FONT></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong><FONT SIZE=2>$totp</FONT></strong></td>
                                     </tr>";

                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                              <td align=\"right\">&nbsp;</td>
                             </tr>";

        $cRet    .= "</table>";

        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";

                        $cRet .="<tr>
                                    <td width=\"100\" align=\"right\" colspan=\"3\">							
								        <table border=\"0\">
								            <tr>								
								                <td width=\"60%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;	
								                </td>
								                <td style=\"font-family:Times New Roman; font-size:10;\" width=\"40%\" align=\"center\">
                                                    $daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								                    <br>$jabatan1,
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama1</u></b>
                				                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
                                            </tr>
                                        </table>
                                    </td>
                             </tr>";
                                
                        
 

        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12;border-left: solid 1px black;border-right: solid 1px black;border-bottom: solid 1px black; \" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

                 $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Keterangan </td>
                            </tr>";
                                                        
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"7\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Catatan Hasil Pembahasan : </td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Dst.</td>
                            </tr>";
         
                  
        $cRet    .= "</table>";

        $cRet    .="<table style=\"border-collapse:collapse;font-size:12 \" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";
                    $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">&nbsp; </td>
                            </tr>";
       $cRet    .= "</table>";
                                        
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"5\" align=\"center\"><strong>Tim Anggaran Pemerintah Daerah</strong> </td>
                         
                    </tr>
					<tr>
                         <td width=\"10%\" align=\"center\"><strong>No</strong> </td>
                         <td width=\"30%\"  align=\"center\"><strong>Nama</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>NIP</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>Jabatan</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>Tanda Tangan</strong></td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
					
					if($no<=4)
											   {
												 for ($i = $no; $i <= 4; $i++) 
												  {
													$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
												  }                                                   
											   } 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        switch($cetak) {
            case 0;  
                echo ("<title>RKA 31</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,10,10,'0','','RKA 31','RKA 31');
                    
            break;
        }
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
//END RKA 31

//RKA 32
function ctk_rka32 ()
    {
        $data['page_title']= 'CETAK RKA 32';
        $this->template->set('title', 'CETAK RKA 32');   
        $this->template->load('template','anggaran/rka/ctk_rka32',$data) ; 
    }

   function preview_rka32(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        
        $ttd1= $_REQUEST['ttd1'];
        
        if (strlen($id)==7){
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)';

            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
            
        }else{
            $a = 'left(';;
            $skpd = 'kd_skpd';
            $b = ',10)';
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $sqldns1="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org=left('$id',7)";

            $sqlskpd1=$this->db->query($sqldns1);
            foreach ($sqlskpd1->result() as $rowdns)
                {
                    $kd_skpd1  = $rowdns->kd_sk;
                    $nm_skpd1 = $rowdns->nm_sk;
                }
        }
  
      
            $sqlskpd=$this->db->query($sqldns);
            foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                }

        $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
       
       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd1')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengetahui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }        
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-right: solid 1px black;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"65%\" align=\"center\"><strong>RENCANA KERJA DAN ANGGARAN </strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>RKA - PPKD <br> <h1>3.2</h1>  </strong></td>
                    </tr>

                    <tr>
                         <td  style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>PEJABAT PENGELOLA KEUANGAN DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";
        if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"\ align=\"center\">RINCIAN PENGELUARAN PEMBIAYAAN</td>
                    </tr>
                </table>";
        }ELSE{
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"left\" border=\"1\">
                    <tr>
                        <td width=\"20%\"><strong>Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"20%\"><strong>Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd1 - $nm_skpd1</stong></td>
                    </tr>
                    <tr>
                        <td><strong>Sub Unit Organisasi</stong></td>
                        <td><strong>$kd_skpd - $nm_skpd</stong></td>
                    </tr>
                    <tr>
                        <td colspan=\"3\"\ align=\"center\">RINCIAN PENGELUARAN PEMBIAYAAN</td>
                    </tr>
                </table>";            
        }        
                
        $cRet .= "<table style=\"border-collapse:collapse; font-size:12;border-top: solid 1px black;\"  width=\"100%\" align=\"center\" border=\"1\"  cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td  width=\"10%\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td  width=\"50%\" align=\"center\"><b>Uraian</b></td>
                            <td  width=\"10%\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                        </tr>                            
                     </thead>
                    
                     
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"10%\"  align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"50%\"  align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" width=\"40%\"  align=\"center\"><strong>3</strong></td>
                        </tr>
                        ";

                        $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.62' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            ) 
                        a ORDER BY a.rek1,a.id";                        


                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;  
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $sat=$row->satuan;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                    
                    
                    if ($reke<>''){
                        $volum='';                        
                    }
                    else{
                        $volum=$row->volume;
                    }
                    //$hrg=number_format($row->harga,"2",".",",");
                    $nila= number_format($row->nilai,"2",",",".");
                     
                    $x = strlen($reke);
                    
                    if (strlen($reke)>8 || strlen($reke)==0){
                       $cRet    .= "<tr>
                                        <td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><FONT SIZE=2>$reke </FONT></td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><FONT SIZE=2>$uraian</FONT></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><FONT SIZE=2>$nila</FONT></td>                                     
                                    </tr>";
                   }else{
                        if(strlen($reke)==1){
                             $totp = $totp + $row->nilai;
                             $cRet    .= "  <tr><td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><strong><FONT SIZE=2>$reke</FONT></strong></td>                                     
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong><FONT SIZE=2>$uraian</FONT></strong></td>
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong><FONT SIZE=2></FONT></strong></td>
                                            </tr>";
                        }else{
                             $cRet    .= "  <tr><td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: none;\" width=\"10%\" align=\"left\"><strong><FONT SIZE=2>$reke</FONT></strong></td>                                     
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"50%\"><strong><FONT SIZE=2>$uraian</FONT></strong></td>
                                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" width=\"40%\" align=\"right\"><strong><FONT SIZE=2>$nila</FONT></strong></td>
                                            </tr>";                            
                        }
                        
                   }                  
                }
                    $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
                             </tr>";

                    $totp=number_format($totp,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"40%\"><strong><FONT SIZE=2>JUMLAH PENGELUARAN</FONT></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" align=\"right\"><strong><FONT SIZE=2>$totp</FONT></strong></td>
                                     </tr>";

                  $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                              <td align=\"right\">&nbsp;</td>
                             </tr>";

        $cRet    .= "</table>";

        $cRet    .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";

                        $cRet .="<tr>
                                    <td width=\"100\" align=\"right\" colspan=\"3\">							
								        <table border=\"0\">
								            <tr>								
								                <td width=\"60%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;&nbsp;<br>&nbsp;<br>&nbsp;<br>&nbsp;	
								                </td>
								                <td style=\"font-family:Times New Roman; font-size:10;\" width=\"40%\" align=\"center\">
                                                    $daerah,&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								                    <br>$jabatan1,
                                                    <p>&nbsp;</p>
                                                    <br><b><u>$nama1</u></b>
                				                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
                                            </tr>
                                        </table>
                                    </td>
                             </tr>";
                                
                        
 

        $cRet    .= "</table>";
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12;border-left: solid 1px black;border-right: solid 1px black;border-bottom: solid 1px black; \" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";

                 $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Keterangan </td>
                            </tr>";
                                                        
                  $cRet .= "<tr>
                                 <td width=\"100%\" align=\"left\" colspan=\"7\">Tanggal Pembahasan :</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Catatan Hasil Pembahasan : </td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">1.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">2.</td>
                            </tr>";
                  $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">Dst.</td>
                            </tr>";
         
                  
        $cRet    .= "</table>";

        $cRet    .="<table style=\"border-collapse:collapse;font-size:12 \" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">";
                    $cRet .= "<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">&nbsp; </td>
                            </tr>";
       $cRet    .= "</table>";
                                        
        $cRet    .="<table style=\"border-collapse:collapse;font-size:12px\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr>
                         <td colspan=\"5\" align=\"center\"><strong>Tim Anggaran Pemerintah Daerah</strong> </td>
                         
                    </tr>
					<tr>
                         <td width=\"10%\" align=\"center\"><strong>No</strong> </td>
                         <td width=\"30%\"  align=\"center\"><strong>Nama</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>NIP</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>Jabatan</strong></td>
                         <td width=\"20%\"  align=\"center\"><strong>Tanda Tangan</strong></td>
                    </tr>";
                    $sqltim="SELECT nama as nama,nip as nip,jabatan as jab FROM tapd order by no";
                    $sqltapd=$this->db->query($sqltim);
                    $no=1;
                    foreach ($sqltapd->result() as $rowtim)
                    {
                        $no=$no;                    
                        $nama= $rowtim->nama;
                        $nip= $rowtim->nip;
                        $jabatan  = $rowtim->jab;
         $cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$no </td>
                         <td width=\"20%\"  align=\"left\">$nama</td>
                         <td width=\"20%\"  align=\"left\">$nip</td>
                         <td width=\"35%\"  align=\"left\">$jabatan</td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>"; 
                    $no=$no+1;              
                    }
					
					if($no<=4)
											   {
												 for ($i = $no; $i <= 4; $i++) 
												  {
													$cRet .="<tr>
                         <td width=\"5%\" align=\"center\">$i </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\">&nbsp; </td>
                         <td width=\"35%\"  align=\"left\">&nbsp; </td>
                         <td width=\"20%\"  align=\"left\"></td>
                    </tr>";     
												  }                                                   
											   } 

        
              
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        switch($cetak) {
            case 0;  
                echo ("<title>RKA 31</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,10,10,'0');
            break;
        }
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }
//END RKA 32


	
    function preview_cek_KUA(){
       
         $cetak = $this->uri->segment(3);
		 $tgl_cetak=date('d-m-Y H:i:s');
		 $tanggal = $this->tanggal_format_indonesia($tgl_cetak);
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				
        
		
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='1'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
	
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >ANGGARAN BERDASARKAN KUA PPAS </td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:14px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                     <thead>                       
                        <tr><td  width=\"5%\" align=\"center\"><b>NO</b></td>
						<td  width=\"10%\" align=\"center\"><b>KODE SKPD</b></td>                            
                            <td  width=\"40%\" align=\"center\"><b>NAMA</b></td>
                            <td  width=\"15%\" align=\"center\"><b>Pendapatan</b></td>
                            <td  width=\"15%\" align=\"center\"><b>BTL</b></td>
                            <td  width=\"15%\" align=\"center\"><b>KUA PPAS</b></td>
                            <td  width=\"15%\" align=\"center\"><b>ANGGARAN BL</b></td>
                            <td  width=\"15%\" align=\"center\"><b>SISA(KUA - BL)</b></td>
                            </tr>
                      
                        <tr>
                            <td align=\"center\">1</td>
                            <td align=\"center\">2</td>
                            <td align=\"center\">3</td>
                            <td align=\"center\">4</td>
                            <td align=\"center\">5</td> 
							<td align=\"center\">6</td> 							
							<td align=\"center\">7</td> 							
							<td align=\"center\">8</td> 							
                         </tr>
                     </thead>
					  <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"8\"><i>DATA Dicetak tanggal $tgl_cetak</i></td>

                         </tr>
                     </tfoot>
                        ";
                 $sql1="select  ROW_NUMBER() OVER (ORDER BY a.kd_skpd) AS no,rtrim(a.kd_skpd)kode, 
rtrim(nm_skpd)nama,nilai_pdt,nilai_btl,nilai_kua,(nilai_bl)nilai from 
(select kd_skpd,sum(case when left(kd_rek5,1)='4' then nilai else 0 end)nilai_pdt,
sum(case when left(kd_rek5,2)='51' then nilai else 0 end)nilai_btl,
sum(case when left(kd_rek5,2)='52' then nilai else 0 end)nilai_bl
 from trdrka group by kd_skpd
) a 
						inner join ms_skpd b on a.kd_skpd=b.kd_skpd order by a.kd_skpd

						 ";
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                 //var nomor=1;                                 
                foreach ($query->result() as $row)
                {
                    $nomor=$row->no;
					$kode=$row->kode;
                    $nama=$row->nama;
					$sisa=($row->nilai_kua-$row->nilai);
                    $n_kua=number_format($row->nilai_kua,"2",".",",");
                    $n_anggaran= number_format($row->nilai,"2",".",",");
                    $n_anggaran_btl= number_format($row->nilai_btl,"2",".",",");
                    $n_anggaran_pdt= number_format($row->nilai_pdt,"2",".",",");
                   $sisa=number_format($sisa,"2",".",",");

                     $cRet    .= " <tr>
					 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\">$nomor</td>  
					 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$n_anggaran_pdt</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$n_anggaran_btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$n_kua</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$n_anggaran</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">$sisa</td>
                                     ";
				

                  }  


        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        //$this->_mpdf('',$cRet,10,10,10,0);
       

        $this->_mpdf('',$cRet,10,10,10,0);
		
		   /* 
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
		 */
		
		
    }

	
//Perda Sempurna
//Lamp1 Perda Sempurna
	function ctk_perda1_sempurna(){	
		$this->index('0','ms_skpd','kd_skpd','nm_skpd','Lampiran I - RINGKASAN PERDA PENYEMPURNAAN APBD','ctk_perda1_sempurna','');
	}

	function preview_perda1_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $tgl= $_REQUEST['tgl_ttd'];
        if($tgl==''){
            $tanggal = '';
        }else{
            $tanggal = $this->tanggal_format_indonesia($tgl);
        }
        $ttd2= $_REQUEST['ttd2'];
        $uppkd = '1.20.12.02';
        $sppkd = '1.20.12';
        

        if ($id!='all'){
            if (strlen($id)==7){
                $a = 'left(';
                $skpd = 'kd_skpd';
                $b = ',7)';
    
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
                
            }else{
                $a = 'left(';;
                $skpd = 'kd_skpd';
                $b = ',10)';
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            }
      
          
                $sqlskpd=$this->db->query($sqldns);
                foreach ($sqlskpd->result() as $rowdns)
                    {
                       
                        $kd_urusan=$rowdns->kd_u;                    
                        $nm_urusan= $rowdns->nm_u;
                        $kd_skpd  = $rowdns->kd_sk;
                        $nm_skpd  = $rowdns->nm_sk;
                    }
        
        }
        
        if ($id!='all'){
            $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
        }else{
            $sqldns="SELECT * from ms_urusan1";
        }
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
      
      if ($ttd2<>''){  
      $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    if($rowttd->nip=='1'){
						$nip2='';
					}else{
						$nip2=empty($rowttd->nip) ? '' : 'NIP.'. $rowttd->nip ;
					}
						                    
					$pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       }else{
                     
                    $nip2='' ;
                    
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';       
       } 
       
       
               $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I :  </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" align=\"left\"></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td ></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td ></td>
                    </tr>										
										
                  </table><br>";  

        
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:14px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none; text-transform:uppercase;border-bottom: none;border-left: none;\" >
                            RINGKASAN PENYEMPURNAAN APBD
                         </td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    

        if ($id != 'all'){         
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td width=\"25%\"><strong>Urusan Pemerintahan</stong></td>
                            <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                        </tr>
                        <tr>
                            <td width=\"25%\"><strong>Bidang Pemerintahan</stong></td>
                            <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                        </tr>
                        <tr>
                            <td><strong>Unit Organisasi</stong></td>
                            <td><strong>$kd_skpd - $nm_skpd</stong></td>
                        </tr>
                    </table>";
        }
        
        $font = 11;
        $font1 = $font - 1;        
        $cRet .= "<table style=\"border-collapse:collapse; font-size:$font px;border-top: solid 1px black;\"  width=\"100%\" border=\"1\"  cellspacing=\"0\" cellpadding=\"1\">
                     <thead>                       
                        <tr>
                            <td width=\"5%\" rowspan=\"2\" align=\"center\"><b>No</b></td>                            
                            <td width=\"35%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"34%\" colspan=\"2\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                            <td width=\"24%\" colspan=\"2\" align=\"center\"><b>Bertambah/ </br> (Berkurang)</b></td>                            
                        </tr>
                        <tr>
                            <td width=\"18%\" align=\"center\"><b>Sebelum</b></td>                            
                            <td width=\"18%\" align=\"center\"><b>Setelah</b></td>
                            <td width=\"17%\" align=\"center\"><b>(Rp.)</b></td>
                            <td width=\"7%\" align=\"center\"><b>%</b></td>                            
                        </tr>
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">5 = 4 - 3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">6</td>
                        </tr>
                     </thead>
       	            <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\">
                                <i>Lampiran I : Perda Prov.Kalimantan Barat - Ringkasan Penyempurnaan APBD TA $thn</i>
                            </td>
                         </tr>
                     </tfoot>";

            if ($id != 'all'){
                        $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4'  and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }else{
                       $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                    
                 }
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                
                $totp = 0;
                $totp2 = 0;                                  
                $num_rows = $query->num_rows();
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;   
                    $coba2=$row->nm_rek;
                    $coba3 = $row->nilai;
                    $nilai2 = $row->nilai2;
                    $selisih = $this->rp_minus($nilai2 - $coba3);
                    if($coba3 != 0){
                        $persen = $this->rp_minus((($nilai2 - $coba3)/$coba3)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 

                    
                    if (strlen($coba1)>3) {
                        $bold = '';
                        $fontr = '';
                    }else{
				        if (strlen($coba1)=='1'){
				            $totp = $totp + $coba3;
                            $totp2 = $totp2 + $nilai2;
				        }      
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }

                    $coba3= number_format($coba3,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");

                    $cRet    .= "  <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$coba1</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$coba2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba3</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>

                                    </tr>";                 
                }

 
                 
                    $coba4=number_format($totp,"2",",",".");
                    $cob1=$totp;
                    $totp2c = number_format($totp2,"2",",",".");
                    $tselisihp =  $this->rp_minus($totp2 - $totp);
                    if($totp != 0){
                        $tpersenp = $this->rp_minus((($totp2 - $totp)/$totp)*100);
                    }else{
                        $tpersenp = $this->rp_minus(100);
                    } 
                if($num_rows>0){  
                    $cRet    .= "   <tr>
                                        <td></td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">JUMLAH PENDAPATAN</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba4</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totp2c</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$tselisihp</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$tpersenp</td>
                                    </tr> 
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                    </tr>";
 				}					 



				if ($id != 'all'){					 
                        $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
        					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
        					   UNION ALL 
                               SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                               ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                               UNION ALL 
                               SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                               ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }else{
                     $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
        					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'   GROUP BY a.kd_rek1,a.lra, a.nm_rek1
        					   UNION ALL 
                               SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                               ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5'  GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                               UNION ALL 
                               SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                               ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }
                 

                $totb = 0;
                $totb2 = 0;
                $query1 = $this->db->query($sql2);
                $num_rows = $query1->num_rows();
                foreach ($query1->result() as $row1){
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7 = $row1->nilai;
                    $nilai2 = $row1->nilai2;
                    $selisih = $this->rp_minus($nilai2 - $coba7);
                    if($coba7 != 0){
                        $persen = $this->rp_minus((($nilai2 - $coba7)/$coba7)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     

                    if (strlen($coba5)>3) {
                        $bold = '';
                        $fontr = '';
                    }else{
				        if (strlen($coba5)=='1'){
				            $totb = $totb + $coba7;
                            $totb2 = $totb2 + $nilai2;
				        }      
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }
                    
                    $nilai2 = number_format($nilai2,"2",",",".");
                    $coba7= number_format($coba7,"2",",",".");
                    
                    $cRet    .= "<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \">$coba5</td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \">$coba6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba7</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";

                }
                
                    $totb2c = number_format($totb2,"2",",",".");
                    $coba8=number_format($totb,"2",",",".");
                    $selisih = $this->rp_minus($totb2 - $totb);
                    if($totb != 0){
                        $persen = $this->rp_minus((($totb2 - $totb)/$totb)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     
    
                    
                $cob=$totb;
                if($num_rows>0){
                    $cRet.="<tr>
                                <td></td>                                     
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">JUMLAH BELANJA</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba8</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totb2c</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";
                }

                  
                $suplus=$cob1-$cob; 
                $suplus2 = $totp2 - $totb2;
                $selisih = $this->rp_minus($suplus2 - $suplus);
                if($suplus != 0){
                    $persen = $this->rp_minus((($suplus2 - $suplus)/$suplus)*100);
                }else{
                    $persen = $this->rp_minus(100);
                }                     

                $surp=$this->rp_minus($suplus);
                $surp2 =  $this->rp_minus($suplus2);
                $cRet.="<tr>
                            <td></td>                                     
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">SURPLUS(DEFISIT)</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$surp</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$surp2</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>                            
                        </tr>                                
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>";

                

				
                $cob3 = 0;
                $cob4 = 0;
                $totpm2 = 0;
                $totpk2 =0 ;
                if ($id == $this->ppkd or $id == $this->ppkd1 or $id == 'all' ){
                    if ($id != 'all'){					 
                        $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,0 AS nilai,0 AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
    							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                                UNION ALL 
                                SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                     }else{
                        $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,0 AS nilai,0 as nilai2 FROM ms_rek1 a INNER JOIN trdrka b
    							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                                UNION ALL 
                                SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                        
                     }
                     $query3 = $this->db->query($sql3);
                     //$query = $this->skpd_model->getAllc();
                       
                    $totpm = 0; 
                    $totpm2 = 0;
                    
                    $num_rows = $query3->num_rows();                                 
                    foreach ($query3->result() as $row3){
                        $coba9=$row3->rek;
                        $coba10=$row3->nm_rek;
                        $coba11= $row3->nilai;
                        $nilai2 = $row3->nilai2;
                        $selisih = $this->rp_minus($nilai2 - $coba11);
                        if($coba11 != 0){
                            $persen = $this->rp_minus((($nilai2 - $coba11)/$coba11)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        }                     

                        if (strlen($coba9)>3) {
                            $bold = '';
                            $fontr = '';
                        }else{
    				        if (strlen($coba9)==3){
    				            $totpm = $totpm + $coba11;
                                $totpm2 = $totpm2 + $nilai2;
    				        }      
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:'.$font1.' px;';
                        }
                        
                        $coba11= number_format($coba11,"2",",",".");
                        $nilai2= number_format($nilai2,"2",",",".");
                        if (strlen($coba9)==1){
                            $coba11 = '';
                            $nilai2 = '';
                            $selisih = '';
                            $persen = '';    
                        }

                        
                        $cRet.="<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$coba9</td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$coba10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba11</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";                        
                   }
    

                    $cob3=$totpm; 
                    $selisih = $this->rp_minus($totpm2 - $totpm);
                    if($totpm != 0){
                        $persen = $this->rp_minus((($totpm2 - $totpm)/$totpm)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     
                    
                    $coba12=number_format($totpm,"2",",",".");
                    $totpm2c = number_format($totpm2,"2",",",".");
                    
                       
                    if ($id==$uppkd or $id==$sppkd or $id='all') {
                        $cRet.="<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpm2c</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                </tr>
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                                
                    }
                    
    
                     if ($id != 'all'){   				 
                         $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nila,SUM(b.nilai_sempurna) AS nilai2i FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                     }else{
                         $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                    
                     }
                     $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    
                    $totpk = 0;
                    $totpk2 = 0;                                  
                    foreach ($query4->result() as $row4){
                        $coba13=$row4->rek;
                        $coba14=$row4->nm_rek;
                        $coba15= $row4->nilai;
                        $nilai2 = $row4->nilai2;
                        $selisih = $this->rp_minus($nilai2 - $coba15);
                        if($coba15 != 0){
                            $persen = $this->rp_minus((($nilai2 - $coba15)/$coba15)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        }                     

                        if (strlen($coba13)>3) {
                            $bold = '';
                            $fontr = '';
                        }else{
    				        if (strlen($coba13)==3){
                                $totpk = $totpk + $coba15;
                                $totpk2 = $totpk2 + $nilai2;
                                $c =$coba13;
                            }else{
                                $c='';
                            }
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:'.$font1.' px;';
                        }
                        
                        $coba15= number_format($coba15,"2",",",".");
                        $nilai2= number_format($nilai2,"2",",",".");
                        
                        $cRet.="<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \">$coba13</td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$coba14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba15</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";
                                  
                                
                    }

                    $cob4=$totpk;
                    $selisih = $this->rp_minus($totpk2 - $totpk);
                    if($totpk != 0){
                        $persen = $this->rp_minus((($totpk2 - $totpk)/$totpk)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     

     				$totpk2c = number_format($totpk2,"2",",",".");				 
                    $coba16=number_format($totpk,"2",",",".");                       
                    if($id==$uppkd or $id==$sppkd or $id='all'){
                    $cRet.="<tr>
                                <td></td>                                     
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba16</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpk2c</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                            </tr>";
                                     
                    }
                      
                    $netto=$cob3-$cob4; 
                    $netto2 =$totpm2 - $totpk2; 
					$netto_ag=$netto;
                    $nett=$this->rp_minus($netto_ag);  
                    $nett2 =$this->rp_minus($netto2);
                    $selisih = $this->rp_minus($netto2 - $netto);
                    if($netto != 0){
                        $persen = $this->rp_minus((($netto2 - $netto)/$netto)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     
    
                    if ($id==$uppkd or $id==$sppkd or $id='all'){      
                        $cRet.="<tr>
                                    <td></td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">PEMBIAYAAN NETTO </td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nett</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nett2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                </tr>";
                    }

                    
            }      
                    
            $cRet.="<tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>";
    					
                        
            $silpa=($cob1+$cob3)-($cob+$cob4);
            $silpa2 = ($totp2+$totpm2)-($totb2+$totpk2);
            $selisih = $this->rp_minus($silpa2 - $silpa);
            if($silpa != 0){
                $persen = $this->rp_minus((($silpa2 - $silpa)/$silpa)*100);
            }else{
				if(($silpa==0) & ($silpa2==0)){
					$persen = $this->rp_minus(0);
				}else{
					$persen = $this->rp_minus(100);
				}
            }                     

            $silp=$this->rp_minus($silpa);
            $silp2 = $this->rp_minus($silpa2);
                               
            $cRet.= "<tr>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">3.3</td>                                     
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$silp</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$silp2</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>

                    </tr>";

                
                
                        $cRet .="
                                    <tr>                                    
                                    <td colspan=\"6\" width=\"100\"  >							
								        <table border=\"0\" align=\"right\" >   
                                            <tr>								
                                                <td width=\"40%\"></td>
								                <td width=\"50%\" align=\"center\">&nbsp;$daerah, $tanggal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								                    <br>$jabatan2,
                                                    <p>&nbsp;</p>
                                                    <br>
                                                    <br>
                                                    <br><b>$nama2</b>
                				                    <br>$pangkat2 
                				                    <br>$nip2 
								                </td>
                                                <td width=\"10%\"></td>
                                            </tr>
                                        </table>  
                                    </td>
                             </tr>
                             
 
                             " ;          
  
       
        
            
        $cRet    .= "</table>";
 
 
        $data['prev']= $cRet;    
        switch($cetak) {
            case 0;  
                echo ("<title>Lampiran I - Ringkasan Perda Penyempurnaan APBD</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,10,10,'0','','','',2);
            break;
        }
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }

//End Lamp1 Perda Sempurna

//Lamp II
function perda_II_sempurna()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','Lampiran II - Ringkasan Penyempurnaan APBD Menurut Urusan dan Organisasi','perda_II_sempurna','');
	}

   function preview_perdaII_sempurna(){
        $cjns = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
       
		$tgl=  strtotime($_REQUEST['tgl_ttd']);



        $n_trdrka = 'trdrka';

         $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
        $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran II : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         <td width=\"60%\"></td>
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                         <td ></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                        <td ></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:14px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"75\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:18px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform:uppercase;\" >RINGKASAN PENYEMPURNAAN APBD MENURUT URUSAN PEMERINTAHAN DAERAH DAN ORGANISASI</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		$font = 9;
        $font1 = $font-1;
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr>
                            <td width=\"4%\" rowspan=\"4\" align=\"center\"><b>KODE</b></td>                            
                            <td width=\"15%\" rowspan=\"4\" align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>
                            <td width=\"23%\" colspan=\"4\" align=\"center\"><b>PENDAPATAN</b></td>
                            <td width=\"58%\" colspan=\"8\" align=\"center\"><b>BELANJA</b></td>
                        </tr>
                        <tr>
                            <td width=\"8%\" rowspan=\"2\" align=\"center\"><b>SEBELUM PERUBAHAN</b></td>                            
                            <td width=\"8%\" rowspan=\"2\" align=\"center\"><b>SETELAH PENYEMPURNAAN</b></td>
                            <td width=\"7%\" rowspan=\"2\" colspan=\"2\" align=\"center\"><b>BERTAMBAH/ </br> (BERKURANG)</b></td>
                            
                            <td width=\"24%\" colspan=\"3\" align=\"center\"><b>SEBELUM PERUBAHAN</b></td>
                            <td width=\"24%\" colspan=\"3\" align=\"center\"><b>SETELAH PENYEMPURNAAN</b></td>
                            <td width=\"10%\" colspan=\"2\" rowspan=\"2\" align=\"center\"><b>BERTAMBAH/ </br> (BERKURANG)</b></td>
                        </tr>
                        <tr>
                            <td width=\"8%\" align=\"center\"><b>TIDAK LANGSUNG</b></td>                            
                            <td width=\"8%\" align=\"center\"><b>LANGSUNG</b></td>
                            <td width=\"8%\" align=\"center\"><b>JUMLAH BELANJA</b></td>

                            <td width=\"8%\" align=\"center\"><b>TIDAK LANGSUNG</b></td>                            
                            <td width=\"8%\" align=\"center\"><b>LANGSUNG</b></td>
                            <td width=\"8%\" align=\"center\"><b>JUMLAH BELANJA</b></td>                            
                        </tr>
                        <tr>
                            <td align=\"center\"><b>Rp</b></td>                            
                            <td align=\"center\"><b>Rp</b></td>
                            <td width=\"4%\" align=\"center\"><b>Rp</b></td>                            
                            <td width=\"3%\" align=\"center\"><b>%</b></td>                            
                            <td align=\"center\"><b>Rp</b></td>                            
                            <td align=\"center\"><b>Rp</b></td>
                            <td align=\"center\"><b>Rp</b></td>                            
                            <td align=\"center\"><b>Rp</b></td>
                            <td align=\"center\"><b>Rp</b></td>                            
                            <td align=\"center\"><b>Rp</b></td>
                            <td width=\"7%\" align=\"center\"><b>Rp</b></td>                            
                            <td width=\"3%\" align=\"center\"><b>%</b></td>                                                    
                        </tr>

                        <tr>
                            <td align=\"center\"><b>1</b></td>                            
                            <td align=\"center\"><b>2</b></td>
                            <td align=\"center\"><b>3</b></td>                            
                            <td align=\"center\"><b>4</b></td>                            
                            <td align=\"center\"><b>5 = 4 - 3</b></td>                            
                            <td align=\"center\"><b>6</b></td>
                            <td align=\"center\"><b>7</b></td>                            
                            <td align=\"center\"><b>8</b></td>                            
                            <td align=\"center\"><b>9 = 7 + 8</b></td>
                            <td align=\"center\"><b>10</b></td>                            
                            <td align=\"center\"><b>11</b></td>                            
                            <td align=\"center\"><b>12 = 10 + 11</b></td>
                            <td align=\"center\"><b>13 = 12 - 9</b></td>                            
                            <td align=\"center\"><b>14</b></td>                            
                        </tr>
 
                     </thead>
					  <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"14\"><i>Lampiran II : Perda Prov. Kalimantan Barat - Ringkasan Penyempurnaan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn</i></td>

                         </tr>
                     </tfoot>
                        ";
 
                $sql1 = "SELECT * FROM (
                            SELECT a.kd_urusan1 AS kode, a.nm_urusan1 AS nama,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan ,
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl, 
                            (SELECT isnull(SUM(nilai),0) FROM $n_trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl,
                            (SELECT isnull(SUM(nilai_sempurna),0) FROM $n_trdrka WHERE LEFT(kd_rek5,1)='4'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS pendapatan2 ,
                            (SELECT isnull(SUM(nilai_sempurna),0) FROM $n_trdrka WHERE LEFT(kd_rek5,2)='51'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS btl2, 
                            (SELECT isnull(SUM(nilai_sempurna),0) FROM $n_trdrka WHERE LEFT(kd_rek5,2)='52'AND LEFT(kd_skpd,1)=a.kd_urusan1) AS bl2
                            FROM $n_trdrka b RIGHT JOIN ms_urusan1 a 
                            ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY a.kd_urusan1 ,a.nm_urusan1 
                            UNION all 
                            select distinct b.kd_urusan [kode], c.nm_urusan [nama],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_skpd,4)=b.kd_urusan) [pendapatan],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_skpd,4)=b.kd_urusan) [btl],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_skpd,4)=b.kd_urusan) [bl],
                            (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_skpd,4)=b.kd_urusan) [pendapatan2],
                            (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_skpd,4)=b.kd_urusan) [btl2],
                            (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_skpd,4)=b.kd_urusan) [bl2]
                            from $n_trdrka a 
                            join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                            join ms_urusan c on b.kd_urusan=c.kd_urusan
                            UNION all						 
                            select distinct c.kd_org [kode], c.nm_org [nama],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_skpd,7)=c.kd_org) [pendapatan],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_skpd,7)=c.kd_org) [btl],
                            (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_skpd,7)=c.kd_org) [bl],
                            (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and LEFT(d.kd_skpd,7)=c.kd_org) [pendapatan2],
                            (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and LEFT(d.kd_skpd,7)=c.kd_org) [btl2],
                            (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and LEFT(d.kd_skpd,7)=c.kd_org) [bl2]
                            from $n_trdrka a 
                            join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                            join ms_organisasi c on LEFT(a.kd_skpd,7)=c.kd_org ";
               
                if ($cjns!='SKPD'){
                    $sql2 ="";
                    $cekbold = 4;
                }else{ 
                    $sql2 ="    union all
                                select distinct c.kd_skpd [kode], c.nm_skpd [nama],
                                (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and d.kd_skpd=c.kd_skpd) [pendapatan],
                                (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and d.kd_skpd=c.kd_skpd) [btl],
                                (select isnull(SUM(nilai),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and d.kd_skpd=c.kd_skpd) [bl],
                                (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,1)='4' and d.kd_skpd=c.kd_skpd) [pendapatan2],
                                (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='51' and d.kd_skpd=c.kd_skpd) [btl2],
                                (select isnull(SUM(nilai_sempurna),0)  from $n_trdrka d where LEFT(d.kd_rek5,2)='52' and d.kd_skpd=c.kd_skpd) [bl2]

                                from $n_trdrka a 
                                join trskpd b on a.kd_kegiatan=b.kd_kegiatan
                                join ms_skpd c on a.kd_skpd=c.kd_skpd ";
                    $cekbold = 7;
                    }
                 
                 $sql3 =") a ORDER BY a.kode ";                         
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                
                $tjum = 0;
                $tpend = 0;
                $tbtl = 0;
                $tbl = 0;
                $tjum2 = 0;
                $tpend2 = 0;
                $tbtl2 = 0;
                $tbl2 = 0;
                                                  
                foreach ($query->result() as $row)
                {
                    $kode=$row->kode;
                    $nama=$row->nama;
                    $pend = $row->pendapatan;
                    $btl = $row->btl;
                    $bl = $row->bl;
                    $jumlah = $btl + $bl;
                    $pend2 = $row->pendapatan2;
                    $btl2 = $row->btl2;
                    $bl2 = $row->bl2;
                    $jumlah2 = $btl2 + $bl2;

                    $ceknol = $pend + $jumlah;

                    $selisihp = $this->rp_minus($pend2 - $pend);
                    if($pend != 0){
                        $persenp = $this->rp_minus((($pend2 - $pend)/$pend)*100);
                    }else{
                        if($pend2 == 0){
                            $persenp = $this->rp_minus(0);
                        }else{
                            $persenp = $this->rp_minus(100);
                        }
                    } 

                    $selisihb = $this->rp_minus($jumlah2 - $jumlah);
                    if($jumlah != 0){
                        $persenb = $this->rp_minus((($jumlah2 - $jumlah)/$jumlah)*100);
                    }else{
                        if($pend2 == 0){
                            $persenb = $this->rp_minus(0);
                        }else{
                            $persenb = $this->rp_minus(100);
                        }
                    } 
                    
                    if (strlen($kode)==1){
                        $tpend = $tpend + $pend;
                        $tbtl = $tbtl + $btl;
                        $tbl = $tbl + $bl;
                        $tjum = $tjum + $jumlah;
                        $tpend2 = $tpend2+ $pend2;
                        $tbtl2 = $tbtl2 + $btl2;
                        $tbl2 = $tbl2 + $bl2;
                        $tjum2 = $tjum2 + $jumlah2;

                    }
                                        
                    $pend=number_format($pend,"2",",",".");
                    $btl= number_format($btl,"2",",",".");
                    $bl= number_format($bl,"2",",",".");
                    $jum= number_format($jumlah,"2",",",".");

                    $pend2=number_format($pend2,"2",",",".");
                    $btl2= number_format($btl2,"2",",",".");
                    $bl2= number_format($bl2,"2",",",".");
                    $jum2= number_format($jumlah2,"2",",",".");
                   
                   
				   if (strlen($kode)>$cekbold and $ceknol<>0 ) 
				   {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$pend2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$selisihp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$btl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$jum2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$selisihb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persenb</td>
                                     </tr>

                                     ";
				    } else {
					       if($ceknol<>0){
						      if (strlen($kode)<=4){
                                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>&nbsp;</b></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><b> &nbsp;</b></td>
                                         </tr>                                         
                                         ";
                              }
									 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>$kode</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$pend2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisihp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persenp</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jum</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$btl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$bl2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jum2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisihb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persenb</td>
                                     </tr>
                                     ";
                                }
                        
				    }

                  }

                    $nsurplus = $this->rp_minus(($tpend - ($tbtl+$tbl)));                  
                    $nsurplus2 = $this->rp_minus(($tpend2 - ($tbtl2+$tbl2)));                  

                    $selisihp = $this->rp_minus($tpend2 - $tpend);
                    if($tpend2 != 0){
                        $persenp = $this->rp_minus((($tpend2 - $tpend)/$tpend)*100);
                    }else{
                        if($tpend2 == 0){
                            $persenp = $this->rp_minus(0);
                        }else{
                            $persenp = $this->rp_minus(100);
                        }
                    } 

                    $selisihb = $this->rp_minus($tjum2 - $tjum);
                    if($tjum != 0){
                        $persenb = $this->rp_minus((($tjum2 - $tjum)/$tjum)*100);
                    }else{
                        if($tjum2 == 0){
                            $persenb = $this->rp_minus(0);
                        }else{
                            $persenb = $this->rp_minus(100);
                        }
                    } 

                    $pend=number_format($tpend,"2",",",".");
                    $btl= number_format($tbtl,"2",",",".");
                    $bl= number_format($tbl,"2",",",".");
                    $jum= number_format($tjum,"2",",",".");

                    $pend2=number_format($tpend2,"2",",",".");
                    $btl2= number_format($tbtl2,"2",",",".");
                    $bl2= number_format($tbl2,"2",",",".");
                    $jum2= number_format($tjum2,"2",",",".");
                                       
                    $cRet    .= "  <tr><td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" align=\"right\">JUMLAH</td>                                     
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$pend</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$pend2</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$selisihp</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persenp</td>
                                     
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$btl</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$bl</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$jum</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$btl2</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$bl2</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$jum2</td>
                                     
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$selisihb</td>
                                     <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persenb</td>
                                     
                                     </tr>";

                    $cRet    .= "  <tr>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" colspan=\"2\" align=\"right\">Surplus / (Defisit)</td> 
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;border-right: hidden;\" colspan=\"2\" align=\"left\">SEBELUM PENYEMPURNAAN:</td>
                                                              
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" colspan=\"3\" align=\"left\">$nsurplus</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;border-right: hidden;\" colspan=\"2\" align=\"left\">SETELAH PENYEMPURNAAN:</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;border-top: solid 1px black;border-bottom: none;\" colspan=\"5\" align=\"left\">$nsurplus2</td>   
                                                                  
                                    </tr>";

                                     
  
 
				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"14\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"font-size:11px;width: 30%;\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";							 

        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'Cetak Perda Lampiran II Penyempurnaan');        
        //$this->_mpdf('',$cRet,10,10,10,0);
       
	switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,3,3,10,1);
        break;
        case 0;
        echo ("<title>Perda Lampiran II</title>");
		echo ($cRet);
		break;	
		case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=Perda_II_sempurna.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
		
    }

//End Lamp II

//Perda Lamp III
 function ctk_perdaIII_sempurna()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','Lampiran III - Rincian Penyempurnaan Pendapatan, Belanja, & Pembiayaan','ctk_perdaIII_sempurna','');
	}

  function preview_perdaIII_sempurna(){
		$id = $this->uri->segment(3);
		$cetak = $this->uri->segment(4);         
        $tgl=  strtotime($_REQUEST['tgl_ttd']);
        $ttd2 =  $_REQUEST['ttd2'];
        

        
            

         $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org 
                    FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join 
                    ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
                    WHERE left(kd_skpd,LEN('$id'))='$id' ";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                   // $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah.',';
                    $thn     = $rowsc->thn_ang;
                }
				
				  
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 


      if ($ttd2 != '' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nm;
                    $jab_ttd     = $rowttd->jab.',';

                }
        }
        else{
                    
                    $nama_ttd='';
                    $jab_ttd     = '';
                    $daerah = '';
        }

          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          

       
        $cRet='';
        $cRet1 ='';
        $cRet2 ='';
        $font = 10;
        $font1 = $font-1;			        
        
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11 px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"12%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran III : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         <td width=\"58%\"> </td>
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                         <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                         <td></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:14 px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform: uppercase;\" >RINCIAN PENYEMPURNAAN APBD MENURUT URUSAN PEMERINTAH DAERAH, <br> ORGANISASI, PENDAPATAN, BELANJA DAN PEMBIAYAAN</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";      

				  
		$cRet1 .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
    					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                        <td  width=\"2%\" align=\"left\" valign=\"top\" style=\"border-top:solid 1px black;border-bottom: none;border-left: none;border-right:none; \" >:</td>
                        <td  width=\"78%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >$kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>

					<tr>
					<td align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                        <td  align=\"left\" valign=\"top\" style=\"border-top:none;border-bottom: none;border-left: none;border-right:none; \" >:</td>
                         <td  align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >$kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom:none;\" >&nbsp;Unit Organisasi </td>
                        <td  align=\"left\" valign=\"top\" style=\"border-top:none;border-left: none;border-right:none; border-bottom:none;\" >:</td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom:none; \" >$kd_org - $nm_org</td>
                    </tr>
                  "; 
        $lid = strlen($id);    
        if($lid==7){
            $cRet2 .= "</table>";
        }else{
            $cRet2 .= "<tr>
						<td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Sub Unit Organisasi </td>
                        <td  align=\"left\" valign=\"top\" style=\"border-top:none;border-left: none;border-right:none; \" >:</td>
                        <td  align=\"left\" style=\"border-top: none;border-left: none; \" >$kd_skpd - $nm_skpd</td>
                       </tr></table>";

        }        
        
        		  
	    $cRet .= $cRet1.$cRet2;
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr><td width=\"28%\" rowspan=\"2\" align=\"center\"><b>Kode Rekening </b></td>                            
                            <td width=\"20%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"26%\" colspan=\"2\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                            <td width=\"18%\" colspan=\"2\" align=\"center\"><b>Bertambah/ (Berkurang)</b></td>
                            <td width=\"8%\" rowspan=\"2\" align=\"center\"><b>DASAR HUKUM</b></td>
                        </tr>
                        <tr><td width=\"13%\" align=\"center\"><b>Sebelum Perubahan</b></td>                            
                            <td width=\"13%\" align=\"center\"><b>Setelah Perubahan</b></td>
                            <td width=\"13%\" align=\"center\"><b>(Rp.)</b></td>
                            <td width=\"5%\" align=\"center\"><b>%</b></td>
                        </tr>
                        <tr><td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5 = 4 - 3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>

                        </tr> 
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"7\"><i>Lampiran III : Perda Prov. Kalimantan Barat - Rincian  Penyempurnaan APBD Menurut Urusan Pemerintahan Daerah & Organisasi TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                       ";

                $n_trdrka = 'trdrka';
				$n1 = 'nilai';
                $n2 = 'nilai_sempurna';
                	   
                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] 
                    	from $n_trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and left(a.kd_skpd,LEN('$id'))='$id'
                    	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and left(a.kd_skpd,LEN('$id'))='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                    		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                    			(select kd_kegiatan,nm_hukum from d_hukum a 
                    			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                    			) Z FOR XML path(''), elements)
                    		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)
                        where right(kd_kegiatan1,5)='00.04' and left(a.kd_skpd,LEN('$id'))='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                        
                        ";
                
                if($lid==7){
                  $sql2 =") as a order by urusan,kd_skpd,kd_rek,kd_rek1";                    
                }else{
                    $sql2 = "   union all                        
                                select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek4 [kd_rek1],c.nm_rek4 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                                left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                                left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                                where right(kd_kegiatan1,5)='00.04' and left(a.kd_skpd,LEN('$id'))='$id'
                                group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek4,c.nm_rek4 
                                union all
                                select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 [kd_rek1],a.nm_rek5 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                                left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                                where right(kd_kegiatan1,5)='00.04' and left(a.kd_skpd,LEN('$id'))='$id'
                                group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,a.nm_rek5                       
                                ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        "; 
                };
                      
                 $query = $this->db->query($sql1.$sql2);
                 //$query = $this->skpd_model->getAllc();
                 $num_query = $query->num_rows();   
                $totp = 0;
                $totp2 = 0;                                  
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $nilai2 = $row->nilai2;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    $selisih = $this->rp_minus($nilai2 - $nilai);
                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        if($nilai2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                        $totp2 = $totp2 + $nilai2;
                    }
                    
                    if (strlen($rek1)<3){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }else{
                        $bold = '';
                        $fontr = 'font-size:'.$font.' px;';
                    }

                     $coba3= number_format($nilai,"2",",",".");
                     $nilai2= number_format($nilai2,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold  \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold  \" >$hukum</td></tr>";
                }
                
                  $selisih = $this->rp_minus($totp2 - $totp);
                    if($totp != 0){
                        $persen = $this->rp_minus((($totp2 - $totp)/$totp)*100);
                    }else{
                        if($totp2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 
                   
                   if($num_query>0){                    
                       $coba4=number_format($totp,"2",",",".");
                       $totpc2=number_format($totp2,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         
                                         </tr>";
                       
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;text-transform: uppercase;\" >Jumlah Pendapatan</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$coba4</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$totpc2</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>";
                                         
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                         
                                         </tr>";                
                 } 

                 if($lid==7){
                    $blurus = 'left(a.kd_skpd,4)'; 
                 }else{
                     $blurus = 'b.kd_urusan';
                 }
                 $sqltb="select * from (
                        select $blurus [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] 
                    	from $n_trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and left(a.kd_skpd,LEN('$id'))='$id'
                    	group by $blurus,LEFT(a.kd_skpd,7),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and left(a.kd_skpd,LEN('$id'))='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                    		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                    			(select kd_kegiatan,nm_hukum from d_hukum a 
                    			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                    			) Z FOR XML path(''), elements)
                    		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                        
                        where right(kd_kegiatan1,5)='00.51' and left(a.kd_skpd,LEN('$id'))='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                  
                 $totbl = 0;
                 $totbl2 = 0;       
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $nilai2 = $rowb->nilai2;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                        $totbl2 = $totbl2 + $nilai2;
                    }

                    $selisih = $this->rp_minus($nilai2 - $nilai);
                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        if($nilai2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 

                    
                    if (strlen($rek1)<3){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }else{
                        $bold = '';
                        $fontr = 'font-size:'.$font.' px;';
                    }
 
                    $jmlb=number_format($nilai,"2",",",".");
                    $nilai2=number_format($nilai2,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode </td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                     </tr>";
                 }    
                 
				 
                 $sqlbl = "select b.nm_rek2,isnull(sum($n1),0) [nilai],isnull(sum($n2),0) [nilai2] from $n_trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where left(a.kd_skpd,LEN('$id'))='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 foreach ($querybl->result() as $rowbl){
                    $nm = $rowbl->nm_rek2;
                    $nilai = $rowbl->nilai;
                    $nilai2 = $rowbl->nilai2;

                    $selisih = $this->rp_minus($nilai2 - $nilai);
                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        if($nilai2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 

                    $nilai =number_format($rowbl->nilai,"2",",",".");
                    $nilai2 =number_format($rowbl->nilai2,"2",",",".");

                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\"  align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\"  align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\"  align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\"  align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"left\"></td></tr>";
                 }
                 
                
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],
                            isnull(NM_HUKUM,'') [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)
                            where right(kd_program1,2)<>'00' and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3,NM_HUKUM 
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
             
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;
                    $nilai2= $row1->nilai2;

                    $selisih = $this->rp_minus($nilai2 - $nilai);
                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        if($nilai2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 
                    
                    
                    if ($rek1=='' || strlen($rek1)==2){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $fontr = 'font-size:'.$font.' px;';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    
                    $nilai = number_format($nilai,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                     
                                     </tr>";
                }

                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                            </tr>";

                    
                    $surplus = $totp-$totbl;
                    $surplus2 = $totp2-$totbl2;

                    
                    $selisih_s = $this->rp_minus($surplus2 - $surplus);
                    $persen_s = $this->persen($surplus,$surplus2);
                    
                    $selisih = $this->rp_minus($totbl2 - $totbl);
                    if($totbl != 0){
                        $persen = $this->rp_minus((($totbl2 - $totbl)/$totbl)*100);
                    }else{
                        if($totbl2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 
 
                    $surplus = $this->rp_minus($surplus);
                    $surplus2 = $this->rp_minus($surplus2);
                
                    $jumbl=number_format($totbl,"2",",",".");
                    $totbl2c =number_format($totbl2,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$totbl2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >SURPLUS/(DEFISIT)</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$surplus</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$surplus2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$selisih_s</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$persen_s</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
		
      

                  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                            </tr>";
          
                    
                if ($id==$this->ppkd or $id==$this->ppkd1){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,nilai2=nilai_terima2-nilai_keluar2,'' [hukum] from(
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],
                                 sum(a.$n1) [nilai_terima], 
                            	(select sum($n1) from $n_trdrka where right(kd_kegiatan,5)='00.62' and left(a.kd_skpd,LEN('$id'))='$id') [nilai_keluar],
                                 sum(a.$n2) [nilai_terima2], 
                            	(select sum($n2) from $n_trdrka where right(kd_kegiatan,5)='00.62' and left(a.kd_skpd,LEN('$id'))='$id') [nilai_keluar2]
                            	from $n_trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and left(a.kd_skpd,LEN('$id'))='$id'
                            	group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],isnull(nm_hukum,'') [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                            
                            where right(kd_kegiatan1,5)='00.61' and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;
                    $totpm2 = 0;                               
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $nilai2 = $row3->nilai2;
                        
                        $selisih = $this->rp_minus($nilai2 - $nilai);
                        $persen = $this->persen($nilai,$nilai2);
                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                            $totpm2 = $totpm2 + $nilai2;
                        }


                        
                        if (strlen($rek1)<3){
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:'.$font1.' px;';
                        }else{
                            $bold = '';
                            $fontr = 'font-size:'.$font.' px;';
                        }
                       $coba11= $this->rp_minus($nilai) ;
                       $nilai2= $this->rp_minus($nilai2) ;
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                        </tr>";
                    }


                    $selisih = $this->rp_minus($totpm2 - $totpm);
                    $persen = $this->persen($totpm,$totpm2);

                    $coba12=number_format($totpm,"2",",",".");
                    $totpm2c =number_format($totpm2,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >JUMLAH PENERIMAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpm2c</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";



						
                    $sql4="select * from (
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],'' [hukum] from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],left(a.kd_skpd,LEN('$id')) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.$n1) [nilai],sum(a.$n2) [nilai2],isnull(nm_hukum,'') [hukum]  from $n_trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            left join (SELECT KD_KEGIATAN,LEFT(kd_rek5,3) [kd_rek3],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,LEFT(kd_rek5,3))x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek3=LEFT(kd_rek5,3)                            
                            where right(kd_kegiatan1,5)='00.62' and left(a.kd_skpd,LEN('$id'))='$id'
                            group by b.kd_urusan,left(a.kd_skpd,LEN('$id')),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3,nm_hukum 
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0; 
                    $totpk2 = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $nilai2 = $row4->nilai2;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        
                        $selisih = $this->rp_minus($nilai2 - $nilai);
                        $persen = $this->persen($nilai,$nilai2);


                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                            $totpk2 = $totpk2 + $nilai2;
                        }
                        
                        if (strlen($rek1)<3){
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:'.$font1.' px;';
                        }else{
                            $bold = '';
                            $fontr = 'font-size:'.$font.' px;';
                        }
                        $coba15= $this->rp_minus($nilai) ;
                        $nilai2= $this->rp_minus($nilai2) ;
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td></tr>";
                    }
    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";

                    $netto = $totpm - $totpk;
                    $netto2 = $totpm2 - $totpk2;

                    $coba16 =$this->rp_minus($totpk); 
                    $totpk2c =$this->rp_minus($totpk2);
                    $selisih = $this->rp_minus($totpk2 - $totpk);
                    $persen = $this->persen($totpk,$totpk2);

                    $selisih_n = $this->rp_minus($netto2 - $netto);
                    $persen_n = $this->persen($netto,$netto2);
                    $netto =$this->rp_minus($netto); 
                    $netto2 =$this->rp_minus($netto2);
                    
                                      
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$totpk2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>&nbsp;</tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >PEMBIAYAAN NETTO</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$netto</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$netto2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$selisih_n</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$persen_n</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>&nbsp;</tr>";


            }

               
				
				 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"7\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah $tanggal					
								<br>$jab_ttd
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        

        $cRet    .= "</table>";
        $data['prev']= $cRet;
        $data['kd_org']= $id;
        $this->template->set('title', 'CETAK PERDA');    
        //$this->_mpdf('',$cRet,10,10,10,0);
       
		  switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,2,10,0);
       // echo $cRet;
		break;
        case 0;
			echo ("<title>Perda Lampiran III Penyempurnaan $id</title>");
			echo ($cRet);
			break;	
		case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=Lampiran_III_Perda_Penyempurnaan.xls");
        $this->load->view('anggaran/rka/perdaIII', $data);
        break;
        }
        
                
    }
 

//End Perda Lamp III

//Perda Lamp IV Sempurna
function perda_IV_sempurna()
	{	
	 $this->index('0','ms_organisasi','kd_org','nm_org','Lampiran IV - Ringkasan Penyempurnaan Program & Kegiatan','perda_IV_sempurna','');
	}

  function preview_perdaIV_sempurna(){
        $cjns = $this->uri->segment(3);
		$cetak = $this->uri->segment(4);
        $tgl=  strtotime($_REQUEST['tgl_ttd']);

        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    //$tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
        
         $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='perda'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
		  
        $cRet='';
        
		 $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran IV : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
                         <td width=\"70%\"></td>
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
                         <td ></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
                         <td ></td>
                    </tr>										
										
                  </table><br>";  
				  
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" ><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;text-transform: uppercase;\" >REKAPITULASI PERUBAHAN BELANJA MENURUT URUSAN PEMERINTAHAN DAERAH DAN ORGANISASI</td>
                    </tr>
                   
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">PROGRAM DAN KEGIATAN TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

        
		
		$font = 12;
        $font1 = $font-1;
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">
                     <thead>                       
                        <tr><td width=\"10%\" rowspan=\"3\"  align=\"center\"><b>KODE</b></td>                            
                            <td width=\"23%\" rowspan=\"3\"  align=\"center\"><b>URUSAN PEMERINTAH DAERAH</b></td>                            
                            <td width=\"27%\" colspan=\"4\"  align=\"center\"><b>SEBELUM PERUBAHAN</b></td>
                            <td width=\"27%\" colspan=\"4\"  align=\"center\"><b>SETELAH PERUBAHAN</b></td>
                            <td width=\"13%\" rowspan=\"2\" colspan=\"2\"  align=\"center\"><b>BERTAMBAH/ </br>(BERKURANG)</b></td>
                            </tr>

                        <tr>
                            <td width=\"18%\" colspan=\"3\" align=\"center\"><b>JENIS BELANJA</b></td>
                            <td width=\"9%\" rowspan=\"2\" align=\"center\"><b>JUMLAH</b></td>
                            <td width=\"18%\" colspan=\"3\" align=\"center\"><b>JENIS BELANJA</b></td>
                            <td width=\"9%\" rowspan=\"2\" align=\"center\"><b>JUMLAH</b></td>
                        </tr>
                        <tr>
                            <td width=\"9%\" align=\"center\"><b>PEGAWAI</b></td>
                            <td width=\"9%\" align=\"center\"><b>BARANG DAN JASA</b></td>
                            <td width=\"9%\" align=\"center\"><b>MODAL</b></td>
                            <td width=\"9%\" align=\"center\"><b>PEGAWAI</b></td>
                            <td width=\"9%\" align=\"center\"><b>BARANG DAN JASA</b></td>
                            <td width=\"9%\" align=\"center\"><b>MODAL</b></td>
                            <td width=\"8%\" align=\"center\"><b>(Rp)</b></td>
                            <td width=\"5%\" align=\"center\"><b>%</b></td>

                        </tr>
						<tr>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">1</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">6 = 3 + 4 + 5</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">7</td>                            
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">8</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">9</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">10 = 7 + 8 + 9</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">11 = 10 - 6</td>
                            <td style=\"font-weight:bold;vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">12</td>

                        </tr>						
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"12\"><i>Lampiran IV : Perda Prov. Kalimantan Barat - Rekapitulasi Penyempurnaan Anggaran Belanja Berdasarkan Program dan Kegiatan TA $thn</i></td>

                         </tr>
                     </tfoot>
                    
                      
                        ";


                $n_trdrka = 'trdrka';
				$n1 = 'nilai';
                $n2 = 'nilai_sempurna';
                
                if ($cjns=='UNIT')
				{   
    				$csql1="select * from(
                                SELECT a.kd_urusan1 AS urusan,'' [urusan_asli], '' [skpd],'' [program], a.nm_urusan1 AS nama,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm2
                                 FROM $n_trdrka b 
                                INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1 
                                UNION all
                                SELECT left(b.kd_skpd,4) AS urusan,'' [urusan_asli],'' [skpd],'' [program], a.nm_urusan AS nama,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4)) AS bpeg,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4))AS bbj,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4)) AS bm, 
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4)) AS bpeg2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4))AS bbj2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_skpd,4)=left(b.kd_skpd,4)) AS bm2 
                                FROM $n_trdrka b INNER JOIN ms_urusan a ON left(b.kd_skpd,4)=a.kd_urusan GROUP BY  left(b.kd_skpd,4) ,a.nm_urusan
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan,'' [urusan_asli],left(a.kd_skpd,7) [skpd],'' [program], b.nm_org AS nama,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bpeg,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bbj, 
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bm, 
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bpeg2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bbj2, 
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bm2 
                                FROM $n_trdrka a 
                                INNER JOIN ms_organisasi b ON left(a.kd_skpd,7)=b.kd_org GROUP BY left(a.kd_skpd,4),left(a.kd_skpd,7),b.nm_org
                                ---------unit
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan,left(kd_kegiatan,4) [urusan_asli],a.kd_skpd [skpd],'' [program], b.nm_skpd AS nama,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)  ) AS bpeg,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bbj, 
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bm, 
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)  ) AS bpeg2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bbj2, 
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4)) AS bm2 
                                FROM $n_trdrka a INNER JOIN ms_skpd b ON a.kd_skpd=b.kd_skpd GROUP BY left(a.kd_skpd,4),left(kd_kegiatan,4),a.kd_skpd,a.kd_skpd,b.nm_skpd
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan, b.kd_urusan [urusan_asli],a.kd_skpd as kd_skpd,right(b.kd_program,2) AS program,b.nm_program AS nama,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm2
                                FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_skpd,4),a.kd_skpd,b.kd_urusan,a.kd_skpd,right(b.kd_program,2),b.nm_program
                                union all
                                SELECT left(a.kd_skpd,4) AS urusan, b.kd_urusan [urusan_asli], a.kd_skpd as kd_skpd,right(a.kd_kegiatan,5) AS program,b.nm_kegiatan AS nama,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bpeg,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bbj,
                                (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bm,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bpeg2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bbj2,
                                (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND kd_skpd=a.kd_skpd and left(kd_skpd,4)=left(a.kd_skpd,4) AND substring(kd_kegiatan,17,5)=right(a.kd_kegiatan,5) ) AS bm2

                                FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_skpd,4),b.kd_urusan,a.kd_skpd,right(a.kd_kegiatan,5),b.nm_kegiatan
                            ) as a ORDER BY urusan,skpd,program 

                            ";
                 }else{
                    $csql1 ="select * from(
                            SELECT a.kd_urusan1 AS urusan, '' [skpd],'' [program], a.nm_urusan1 AS nama,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm, 
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bpeg2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' and LEFT(kd_skpd,1)=a.kd_urusan1)AS bbj2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' and LEFT(kd_skpd,1)=a.kd_urusan1) AS bm2 
                            FROM $n_trdrka b 
                            INNER JOIN ms_urusan1 a ON LEFT(b.kd_skpd,1)=a.kd_urusan1 GROUP BY  a.kd_urusan1 ,a.nm_urusan1 
                            UNION all
                            SELECT a.kd_urusan AS urusan,'' [skpd],'' [program], a.nm_urusan AS nama,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bpeg,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_kegiatan,4)=a.kd_urusan)AS bbj,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bm, 
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bpeg2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND LEFT(kd_kegiatan,4)=a.kd_urusan)AS bbj2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT (kd_rek5,3)='523' AND LEFT(kd_kegiatan,4)=a.kd_urusan) AS bm2 
                            FROM $n_trdrka b INNER JOIN ms_urusan a ON LEFT(b.kd_kegiatan,4)=a.kd_urusan GROUP BY  LEFT(b.kd_kegiatan,4),a.kd_urusan ,a.nm_urusan
                            union all
                            SELECT left(a.kd_kegiatan,4) AS urusan,left(a.kd_skpd,7) [skpd],'' [program], b.nm_org AS nama,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)  ) AS bpeg,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bbj, 
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bm, 
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)  ) AS bpeg2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bbj2, 
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4)) AS bm2 
                            FROM $n_trdrka a INNER JOIN ms_organisasi b ON left(a.kd_skpd,7)=b.kd_org GROUP BY left(a.kd_kegiatan,4),left(a.kd_skpd,7),b.nm_org 
                            union all 
                            SELECT left(a.kd_kegiatan,4) AS urusan, left(a.kd_skpd,7) as kd_skpd,right(b.kd_program,2) AS program,b.nm_program AS nama,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bpeg2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bbj2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,2)=right(b.kd_program,2) ) AS bm2
                            FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),left(a.kd_skpd,7),right(b.kd_program,2),b.nm_program
                            union all
                            SELECT left(a.kd_kegiatan,4) AS urusan, left(a.kd_skpd,7) as kd_skpd,right(b.kd_kegiatan,5) AS program,b.nm_kegiatan AS nama,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bpeg,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bbj,
                            (SELECT isnull(SUM($n1),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bm,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='521' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bpeg2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='522' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bbj2,
                            (SELECT isnull(SUM($n2),0) FROM $n_trdrka WHERE LEFT(kd_rek5,3)='523' AND left(kd_skpd,7)=left(a.kd_skpd,7) and left(kd_kegiatan,4)=left(a.kd_kegiatan,4) AND substring(kd_kegiatan,17,5)=right(b.kd_kegiatan,5) ) AS bm2
                            FROM $n_trdrka a JOIN trskpd b ON a.kd_kegiatan=b.kd_kegiatan
                            WHERE RIGHT(b.kd_program,2) <>'00' GROUP BY  left(a.kd_kegiatan,4),left(a.kd_skpd,7),right(b.kd_kegiatan,5),b.nm_kegiatan
                            ) as a ORDER BY urusan,skpd,program ";

                 }  
                $query = $this->db->query($csql1);

                 //$query = $this->skpd_model->getAllc();
                $jum = 0;
                $tbpeg = 0;
                $tbtl = 0;
                $tbl = 0;
                $tjum = 0; 

                $jum2 = 0;
                $tbpeg2 = 0;
                $tbtl2 = 0;
                $tbl2 = 0;
                $tjum2 = 0; 
                                                 
                foreach ($query->result() as $row)
                {
                    
                    $uru = $row->urusan;
                    $sk = $row->skpd;
                    $pro = $row->program;                    
                    $nama=$row->nama;
                    $bpeg = $row->bpeg;
                    $bbj = $row->bbj;
                    $bm = $row->bm;

                    $bpeg2 = $row->bpeg2;
                    $bbj2 = $row->bbj2;
                    $bm2 = $row->bm2;
                    
                    if ($sk == ''){
                        $kode = $uru;
                    }else{
                        if($pro==''){
                            $kode = $sk;
                        }else{
                             if ($cjns=='UNIT'){  
                                $uru1 =  $row->urusan_asli;
                                $kode = $uru1.'.'.$sk.'.'.$pro;
                            }else{
                                $kode = $uru.'.'.$sk.'.'.$pro;
                            }
                        }
                    }
                    
                    $jum = $bpeg + $bbj + $bm;
                    $jum2 = $bpeg2 + $bbj2 + $bm2;
                   
                    if (strlen($uru)<2){    
                        $tbpeg = $tbpeg + $bpeg;
                        $tbtl = $tbtl + $bbj;
                        $tbl = $tbl + $bm;
                        $tjum = $tjum + $jum;

                        $tbpeg2 = $tbpeg2 + $bpeg2;
                        $tbtl2 = $tbtl2 + $bbj2;
                        $tbl2 = $tbl2 + $bm2;
                        $tjum2 = $tjum2 + $jum2;
                    }

                    $selisih = $this->rp_minus($jum2 - $jum);
                    $persen = $this->persen($jum,$jum2);
                    
                    $pend=number_format($bpeg,"2",",",".");
                    $btl= number_format($bbj,"2",",",".");
                    $bl= number_format($bm,"2",",",".");

                    $pend2=number_format($bpeg2,"2",",",".");
                    $btl2= number_format($bbj2,"2",",",".");
                    $bl2= number_format($bm2,"2",",",".");
                   
                    if(strlen($pro) <= 2 || $pro==''){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';  
                    }else{
 
                        $bold = '';
                        $fontr = 'font-size:'.$font.' px;'; 
                    }
                    
                    if (($jum > 0) & ($jum2 > 0)){
                        $jum= number_format($jum,"2",",",".");
                        $jum2= number_format($jum2,"2",",",".");
                    $cRet    .= " 
                                    <tr>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" >$kode</td>                                     
                                        <td style=\"vertical-align:top;$bold border-top: solid 1px black;border-bottom: none;\" >$nama</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$pend</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$btl</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$bl</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$jum</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$pend2</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$btl2</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$bl2</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$jum2</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;$bold $fontr border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen</td>

                                    </tr>
                             ";
                    }
                }



                    $selisih = $this->rp_minus($tjum2 - $tjum);
                    $persen = $this->persen($tjum2,$jum2);
                    
	                   
                    $tbpeg=number_format($tbpeg,"2",",",".");
                    $tbtl= number_format($tbtl,"2",",",".");
                    $tbl= number_format($tbl,"2",",",".");
                    $tjum= number_format($tjum,"2",",",".");

                    $tbpeg2=number_format($tbpeg2,"2",",",".");
                    $tbtl2= number_format($tbtl2,"2",",",".");
                    $tbl2= number_format($tbl2,"2",",",".");
                    $tjum2= number_format($tjum2,"2",",",".");

                     $cRet    .= " <tr><td style=\"font-weight:bold;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\" colspan=\"2\">JUMLAH</td>                                     
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tbpeg</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tbtl</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tbl</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tjum</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tbpeg2</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tbtl2</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tbl2</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tjum2</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$selisih</td>
                                     <td style=\"font-weight:bold;font-size:$font1 px;vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$persen</td>                                     
                                     </tr>
                                     ";
                
       
                
				  
			  
				   $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"12\">
								<table width=\"100%\" border=\"0\">
								<tr>
								<td width=\"70%\" align=\"left\" >&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;<br>	
								</td>
								<td width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        
		
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN IV');        
        //$this->_mpdf('',$cRet,10,10,10,0);
/*
          switch($cetak){   
        case 1;
		ini_set('memory_limit','5000M');
		set_time_limit(5000);
		 
		$this->_mpdf('',$cRet,10,10,10,0);
		break;
        case 0;
		//$this->template->load('template','anggaran/rka/perdaIV',$data);
		echo ("<title>Perda Lampiran IV $cjns</title>");
		echo ($cRet);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
         echo ($cRet);
        //$this->load->view('anggaran/rka/perdaIV', $data);
        break;
		case 3;
		echo ("<title>RKA 22</title>");
		echo ($cRet);
		break;
        }   

*/        
 
 switch($cetak){   
        case 1;
		ini_set('memory_limit','5000M');
		set_time_limit(5000);
		 
		$this->_mpdf('',$cRet,3,2,10,1);
		break;
        case 0;
		//$this->template->load('template','anggaran/rka/perdaIV',$data);

		echo ("<title>Perda_Lampiran_IV_Penyempurnaan_$cjns</title>");
		echo ($cRet);
        break;
        case 2;        
		ini_set('memory_limit','5000M');
		set_time_limit(5000);

         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=Perda_Lampiran_IV_Penyempurnaan.xls");
         echo ($cRet);
        //$this->load->view('anggaran/rka/perdaIV', $data);
        break;
		case 3;
		echo ("<title>RKA 22</title>");
		echo ($cRet);
		break;
        }   
    }

	
//End Perda Lamp IV


//End Perda Sempurna	
	
//Pergub Sempurna

//Lamp 1
	function ctk_perkadaI_sempurna(){	
		$this->index('0','ms_skpd','kd_skpd','nm_skpd','Lampiran I - RINGKASAN PENJABARAN PENYEMPURNAAN APBD','ctk_perkadaI_sempurna','');
	}

    function preview_perkadaI_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $tgl= $_REQUEST['tgl_ttd'];
        if($tgl==''){
            $tanggal = '';
        }else{
            $tanggal = $this->tanggal_format_indonesia($tgl);
        }
        $ttd2= $_REQUEST['ttd2'];
        $uppkd = '1.20.12.02';
        $sppkd = '1.20.12';
        

        if ($id!='all'){
            if (strlen($id)==7){
                $a = 'left(';
                $skpd = 'kd_skpd';
                $b = ',7)';
    
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_org as kd_sk,a.nm_org as nm_sk FROM ms_organisasi a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_org='$id'";
                
            }else{
                $a = 'left(';;
                $skpd = 'kd_skpd';
                $b = ',10)';
                $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            }
      
          
                $sqlskpd=$this->db->query($sqldns);
                foreach ($sqlskpd->result() as $rowdns)
                    {
                       
                        $kd_urusan=$rowdns->kd_u;                    
                        $nm_urusan= $rowdns->nm_u;
                        $kd_skpd  = $rowdns->kd_sk;
                        $nm_skpd  = $rowdns->nm_sk;
                    }
        
        }
        
        if ($id!='all'){
            $sqldns="SELECT * from ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
        }else{
            $sqldns="SELECT * from ms_urusan1";
        }
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }


        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                 //   $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
      
      if ($ttd2<>''){  
      $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    if($rowttd->nip=='1'){
						$nip2='';
					}else{
						$nip2=empty($rowttd->nip) ? '' : 'NIP.'. $rowttd->nip ;
					}
						                    
					$pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
       }else{
                     
                    $nip2='' ;
                    
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';       
       } 
       
       
               $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran I :  </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" align=\"left\"></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td ></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td ></td>
                    </tr>										
										
                  </table><br>";  

        
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:14px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none; text-transform:uppercase;border-bottom: none;border-left: none;\" >
                            RINGKASAN PERUBAHAN PENJABARAN ANGGARAN PENDAPATAN DAERAH, </br> BELANJA DAERAH, DAN PEMBIAYAAN DAERAH 
                         </td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    

        if ($id != 'all'){         
            $cRet .="<table style=\"border-collapse:collapse;\" width=\"100%\" align=\"left\" border=\"1\">
                        <tr>
                            <td width=\"25%\"><strong>Urusan Pemerintahan</stong></td>
                            <td width=\"80%\"><strong>$kd_urusan1 - $nm_urusan1</stong></td>
                        </tr>
                        <tr>
                            <td width=\"25%\"><strong>Bidang Pemerintahan</stong></td>
                            <td width=\"80%\"><strong>$kd_urusan - $nm_urusan</stong></td>
                        </tr>
                        <tr>
                            <td><strong>Unit Organisasi</stong></td>
                            <td><strong>$kd_skpd - $nm_skpd</stong></td>
                        </tr>
                    </table>";
        }
        
        $font = 11;
        $font1 = $font - 1;        
        $cRet .= "<table style=\"border-collapse:collapse; font-size:$font px;border-top: solid 1px black;\"  width=\"100%\" border=\"1\"  cellspacing=\"0\" cellpadding=\"1\">
                     <thead>                       
                        <tr>
                            <td width=\"5%\" rowspan=\"2\" align=\"center\"><b>No</b></td>                            
                            <td width=\"35%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"34%\" colspan=\"2\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                            <td width=\"24%\" colspan=\"2\" align=\"center\"><b>Bertambah/ </br> (Berkurang)</b></td>                            
                        </tr>
                        <tr>
                            <td width=\"18%\" align=\"center\"><b>Sebelum</b></td>                            
                            <td width=\"18%\" align=\"center\"><b>Setelah</b></td>
                            <td width=\"17%\" align=\"center\"><b>(Rp.)</b></td>
                            <td width=\"7%\" align=\"center\"><b>%</b></td>                            
                        </tr>
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">5 = 4 - 3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: none;font-weight:bold\" align=\"center\">6</td>
                        </tr>
                     </thead>
       	            <tfoot>
                        <tr>
                            <td style=\"font-size:10px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"6\">
                                <i>Lampiran I : PerGub Prov.Kalimantan Barat - Ringkasan Perubahan Penjabaran APBD TA $thn</i>
                            </td>
                         </tr>
                     </tfoot>";

            if ($id != 'all'){
                        $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4'  and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }else{
                       $sql1="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                        ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='4' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                        UNION ALL 
                        SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                        ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='4' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                        UNION ALL 
                        SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                        ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='4'  GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                    
                 }
                 
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                
                $totp = 0;
                $totp2 = 0;                                  
                $num_rows = $query->num_rows();
                foreach ($query->result() as $row)
                {
                    $coba1=$row->rek;   
                    $coba2=$row->nm_rek;
                    $coba3 = $row->nilai;
                    $nilai2 = $row->nilai2;
                    $selisih = $this->rp_minus($nilai2 - $coba3);
                    if($coba3 != 0){
                        $persen = $this->rp_minus((($nilai2 - $coba3)/$coba3)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 

                    
                    if (strlen($coba1)>3) {
                        $bold = '';
                        $fontr = '';
                    }else{
				        if (strlen($coba1)=='1'){
				            $totp = $totp + $coba3;
                            $totp2 = $totp2 + $nilai2;
				        }      
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }

                    $coba3= number_format($coba3,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");

                    $cRet    .= "  <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$coba1</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$coba2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba3</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>

                                    </tr>";                 
                }

 
                 
                    $coba4=number_format($totp,"2",",",".");
                    $cob1=$totp;
                    $totp2c = number_format($totp2,"2",",",".");
                    $tselisihp =  $this->rp_minus($totp2 - $totp);
                    if($totp != 0){
                        $tpersenp = $this->rp_minus((($totp2 - $totp)/$totp)*100);
                    }else{
                        $tpersenp = $this->rp_minus(100);
                    } 
                if($num_rows>0){  
                    $cRet    .= "   <tr>
                                        <td></td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">JUMLAH PENDAPATAN</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba4</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totp2c</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$tselisihp</td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$tpersenp</td>
                                    </tr> 
                                    <tr>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                        <td>&nbsp;</td>
                                    </tr>";
 				}					 



				if ($id != 'all'){					 
                        $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
        					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'  and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
        					   UNION ALL 
                               SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                               ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                               UNION ALL 
                               SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                               ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5'  and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }else{
                     $sql2="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
        					   ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='5'   GROUP BY a.kd_rek1,a.lra, a.nm_rek1
        					   UNION ALL 
                               SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                               ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,1)='5'  GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                               UNION ALL 
                               SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                               ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,1)='5' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                 }
                 

                $totb = 0;
                $totb2 = 0;
                $query1 = $this->db->query($sql2);
                $num_rows = $query1->num_rows();
                foreach ($query1->result() as $row1){
                    $coba5=$row1->rek;
                    $coba6=$row1->nm_rek;
                    $coba7 = $row1->nilai;
                    $nilai2 = $row1->nilai2;
                    $selisih = $this->rp_minus($nilai2 - $coba7);
                    if($coba7 != 0){
                        $persen = $this->rp_minus((($nilai2 - $coba7)/$coba7)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     

                    if (strlen($coba5)>3) {
                        $bold = '';
                        $fontr = '';
                    }else{
				        if (strlen($coba5)=='1'){
				            $totb = $totb + $coba7;
                            $totb2 = $totb2 + $nilai2;
				        }      
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }
                    
                    $nilai2 = number_format($nilai2,"2",",",".");
                    $coba7= number_format($coba7,"2",",",".");
                    
                    $cRet    .= "<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \">$coba5</td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \">$coba6</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba7</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";

                }
                
                    $totb2c = number_format($totb2,"2",",",".");
                    $coba8=number_format($totb,"2",",",".");
                    $selisih = $this->rp_minus($totb2 - $totb);
                    if($totb != 0){
                        $persen = $this->rp_minus((($totb2 - $totb)/$totb)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     
    
                    
                $cob=$totb;
                if($num_rows>0){
                    $cRet.="<tr>
                                <td></td>                                     
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">JUMLAH BELANJA</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba8</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totb2c</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";
                }

                  
                $suplus=$cob1-$cob; 
                $suplus2 = $totp2 - $totb2;
                $selisih = $this->rp_minus($suplus2 - $suplus);
                if($suplus != 0){
                    $persen = $this->rp_minus((($suplus2 - $suplus)/$suplus)*100);
                }else{
                    $persen = $this->rp_minus(100);
                }                     

                $surp=$this->rp_minus($suplus);
                $surp2 =  $this->rp_minus($suplus2);
                $cRet.="<tr>
                            <td></td>                                     
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">SURPLUS(DEFISIT)</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$surp</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$surp2</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>                            
                        </tr>                                
                        <tr>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                            <td>&nbsp;</td>
                        </tr>";

                

				
                $cob3 = 0;
                $cob4 = 0;
                $totpm2 = 0;
                $totpk2 =0 ;
                if ($id == $this->ppkd or $id == $this->ppkd1 or $id == 'all' ){
                    if ($id != 'all'){					 
                        $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,0 AS nilai,0 AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
    							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' and $a$skpd$b='$id' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                                UNION ALL 
                                SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                     }else{
                        $sql3="SELECT a.kd_rek1 AS kd_rek,rtrim(a.lra) AS rek, a.nm_rek1 AS nm_rek ,0 AS nilai,0 as nilai2 FROM ms_rek1 a INNER JOIN trdrka b
    							ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(a.kd_rek1,1)='6' GROUP BY a.kd_rek1,a.lra, a.nm_rek1
                                UNION ALL 
                                SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='61' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='61' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                        
                     }
                     $query3 = $this->db->query($sql3);
                     //$query = $this->skpd_model->getAllc();
                       
                    $totpm = 0; 
                    $totpm2 = 0;
                    
                    $num_rows = $query3->num_rows();                                 
                    foreach ($query3->result() as $row3){
                        $coba9=$row3->rek;
                        $coba10=$row3->nm_rek;
                        $coba11= $row3->nilai;
                        $nilai2 = $row3->nilai2;
                        $selisih = $this->rp_minus($nilai2 - $coba11);
                        if($coba11 != 0){
                            $persen = $this->rp_minus((($nilai2 - $coba11)/$coba11)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        }                     

                        if (strlen($coba9)>3) {
                            $bold = '';
                            $fontr = '';
                        }else{
    				        if (strlen($coba9)==3){
    				            $totpm = $totpm + $coba11;
                                $totpm2 = $totpm2 + $nilai2;
    				        }      
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:'.$font1.' px;';
                        }
                        
                        $coba11= number_format($coba11,"2",",",".");
                        $nilai2= number_format($nilai2,"2",",",".");
                        if (strlen($coba9)==1){
                            $coba11 = '';
                            $nilai2 = '';
                            $selisih = '';
                            $persen = '';    
                        }

                        
                        $cRet.="<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$coba9</td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >$coba10</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba11</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";                        
                   }
    

                    $cob3=$totpm; 
                    $selisih = $this->rp_minus($totpm2 - $totpm);
                    if($totpm != 0){
                        $persen = $this->rp_minus((($totpm2 - $totpm)/$totpm)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     
                    
                    $coba12=number_format($totpm,"2",",",".");
                    $totpm2c = number_format($totpm2,"2",",",".");
                    
                       
                    if ($id==$uppkd or $id==$sppkd or $id='all') {
                        $cRet.="<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">JUMLAH PENERIMAAN PEMBIAYAAN</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba12</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpm2c</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                </tr>
                                <tr>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                                
                    }
                    
    
                     if ($id != 'all'){   				 
                         $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' and $a$skpd$b='$id' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nila,SUM(b.nilai_sempurna) AS nilai2i FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' and $a$skpd$b='$id' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";
                     }else{
                         $sql4="SELECT a.kd_rek2 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                                ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(a.kd_rek2,2)='62' GROUP BY a.kd_rek2,a.lra,a.nm_rek2 
                                UNION ALL 
                                SELECT a.kd_rek3 AS kd_rek,rtrim(a.lra) AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                                ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(a.kd_rek3,2)='62' GROUP BY a.kd_rek3,a.lra, a.nm_rek3 ORDER BY kd_rek";                    
                     }
                     $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    
                    $totpk = 0;
                    $totpk2 = 0;                                  
                    foreach ($query4->result() as $row4){
                        $coba13=$row4->rek;
                        $coba14=$row4->nm_rek;
                        $coba15= $row4->nilai;
                        $nilai2 = $row4->nilai2;
                        $selisih = $this->rp_minus($nilai2 - $coba15);
                        if($coba15 != 0){
                            $persen = $this->rp_minus((($nilai2 - $coba15)/$coba15)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        }                     

                        if (strlen($coba13)>3) {
                            $bold = '';
                            $fontr = '';
                        }else{
    				        if (strlen($coba13)==3){
                                $totpk = $totpk + $coba15;
                                $totpk2 = $totpk2 + $nilai2;
                                $c =$coba13;
                            }else{
                                $c='';
                            }
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:'.$font1.' px;';
                        }
                        
                        $coba15= number_format($coba15,"2",",",".");
                        $nilai2= number_format($nilai2,"2",",",".");
                        
                        $cRet.="<tr>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \">$coba13</td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$coba14</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba15</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";
                                  
                                
                    }

                    $cob4=$totpk;
                    $selisih = $this->rp_minus($totpk2 - $totpk);
                    if($totpk != 0){
                        $persen = $this->rp_minus((($totpk2 - $totpk)/$totpk)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     

     				$totpk2c = number_format($totpk2,"2",",",".");				 
                    $coba16=number_format($totpk,"2",",",".");                       
                    if($id==$uppkd or $id==$sppkd or $id='all'){
                    $cRet.="<tr>
                                <td></td>                                     
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">JUMLAH PENGELUARAN PEMBIAYAAN</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba16</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpk2c</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                            </tr>
                            <tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
                            </tr>";
                                     
                    }
                      
                    $netto=$cob3-$cob4; 
                    $netto2 =$totpm2 - $totpk2; 
					$netto_ag=$netto;
                    $nett=$this->rp_minus($netto_ag);  
                    $nett2 =$this->rp_minus($netto2);
                    $selisih = $this->rp_minus($netto2 - $netto);
                    if($netto != 0){
                        $persen = $this->rp_minus((($netto2 - $netto)/$netto)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    }                     
    
                    if ($id==$uppkd or $id==$sppkd or $id='all'){      
                        $cRet.="<tr>
                                    <td></td>                                     
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" align=\"right\">PEMBIAYAAN NETTO </td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nett</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nett2</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                </tr>";
                    }

                    
            }      
                    
            $cRet.="<tr>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                        <td>&nbsp;</td>
                    </tr>";
    					
                        
            $silpa=($cob1+$cob3)-($cob+$cob4);
            $silpa2 = ($totp2+$totpm2)-($totb2+$totpk2);
            $selisih = $this->rp_minus($silpa2 - $silpa);
            if($silpa != 0){
                $persen = $this->rp_minus((($silpa2 - $silpa)/$silpa)*100);
            }else{
				if(($silpa==0) & ($silpa2==0)){
					$persen = $this->rp_minus(0);
				}else{
					$persen = $this->rp_minus(100);
				}
            }                     

            $silp=$this->rp_minus($silpa);
            $silp2 = $this->rp_minus($silpa2);
                               
            $cRet.= "<tr>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">3.3</td>                                     
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >SISA LEBIH PEMBIAYAAN ANGGARAN TAHUN BERKENAAN (SILPA)</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$silp</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$silp2</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>

                    </tr>";

                
                
                        $cRet .="
                                    <tr>                                    
                                    <td colspan=\"6\" width=\"100\"  >							
								        <table border=\"0\" align=\"right\" >   
                                            <tr>								
                                                <td width=\"40%\"></td>
								                <td width=\"50%\" align=\"center\">&nbsp;$daerah, $tanggal&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;.
								                    <br>$jabatan2,
                                                    <p>&nbsp;</p>
                                                    <br>
                                                    <br>
                                                    <br><b>$nama2</b>
                				                    <br>$pangkat2 
                				                    <br>$nip2 
								                </td>
                                                <td width=\"10%\"></td>
                                            </tr>
                                        </table>  
                                    </td>
                             </tr>
                             
 
                             " ;          
  
       
        
            
        $cRet    .= "</table>";
 
 
        $data['prev']= $cRet;    
        switch($cetak) {
            case 0;  
                echo ("<title>Lampiran I - Ringkasan Penjabaran Penyempurnaan APBD</title>");
                echo($cRet);
            break;
            case 1;
                $this->_mpdf('',$cRet,10,10,10,'0','','','',2);
            break;
        }
        //$this->template->load('template','master/fungsi/list_preview',$data);
        
                
    }


//End Lampiran 1


//Lampiran Alokasi Dana PENYEMPURNAAN
function ctk_perkadaIa_sempurna(){	
	 $data['page_title']= 'Cetak ALOKASI DANA PENYEMPURNAAN';
     $this->template->set('title', 'Cetak ALOKASI DANA PENYEMPURNAAN');
	 $this->template->load('template','anggaran/rka/ctk_perkadaIa_sempurna',$data) ;
	 //$this->index('0','ms_skpd','kd_skpd','nm_skpd','PERATURAN KEPALA DAERAH LAMPIRAN I.1 ALOKASI DANA','ctk_perkadaIa','');
	}


  function preview_perkadaIa_sempurna(){
         $cjns = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);
         $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.02'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
		if ($cjns == 'HIBAH' ){
		      $jdl = 'Alokasi Hibah';
              $kd_alokasi = '514';
              $ckd_sql1 = ' LEFT(a.kd_Rek5,3)='.$kd_alokasi ;
		}else{
		      $jdl = 'Alokasi Bantuan Sosial';
              $kd_alokasi1 = "''";//'517';
              $kd_alokasi2 = '515';
              $ckd_sql1 = ' LEFT(a.kd_Rek5,3)='.$kd_alokasi1.'or LEFT(a.kd_Rek5,3)='.$kd_alokasi2;
		}		
        
        $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
        $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        $cRet='';
		
        $cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:11px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran III : </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" align=\"left\"></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td></td>
                    </tr>										
										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:20px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					   <td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					       <img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                        <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none; text-transform:uppercase;border-left: none;\" >DAFTAR NAMA PENERIMA, ALAMAT DAN BESARAN $jdl YANG DITERIMA</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>";    
				  
        
		
        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr><td width=\"3%\" align=\"center\"><b>NO</b></td>                            
                            <td width=\"16%\" align=\"center\"><b>NAMA PENERIMA</b></td>
                            <td width=\"25%\" align=\"center\"><b>ALAMAT PENERIMA</b></td>
                            <td width=\"17%\" align=\"center\"><b>JUMLAH SEBELUM (Rp.)</b></td>
                            <td width=\"17%\" align=\"center\"><b>JUMLAH SETELAH (Rp.)</b></td>
                            <td width=\"15%\" align=\"center\"><b>Bertambah/ </br> Berkurang</b></td>
                            <td width=\"7%\" align=\"center\"><b>%</b></td>
                            </tr>
                        
                        <tr>
                            <td align=\"center\"><strong>1</strong></td>
                            <td align=\"center\"><strong>2</strong></td>
                            <td align=\"center\"><strong>3</strong></td>
                            <td align=\"center\"><strong>4</strong></td>
                            <td align=\"center\"><strong>5</strong></td>
                            <td align=\"center\"><strong>6 = 5 - 4</strong></td>
                            <td align=\"center\"><strong>7</strong></td>                                  
                         </tr>
                     </thead>
                     <tfoot>
                     </tfoot>
                        ";
        
        
      
        $sql1=" select a.* from (
                    select a.kd_rek5 [urut],0 [no_urut],a.kd_rek5 [penerima],a.nm_rek5 [alamat],
                    isnull(sum(nilai),0) [nilai],isnull(sum(nilai_sempurna),0) [nilai2]  from trdrka a where $ckd_sql1 group by a.kd_rek5,a.nm_rek5                     
                    union all
                    select a.kd_rek5 [urut],c.no_urut,
                    penerima,alamat,total [nilai],total_sempurna [nilai2] from trdrka a inner join trdalokasi c on a.no_trdrka = c.no_trdrka where 
                    penerima <> '' and $ckd_sql1 
                ) as a order by urut,no_urut";
     
 
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
    
                $total = 0;  
                $total2 = 0;   
                $tselisih = 0;                             
                foreach ($query->result() as $row)
                {
                    $kode=$row->no_urut;
                    $nama=$row->penerima;
                    $alamat = $row->alamat;
                    $n = $row->nilai;
                    $n2 = $row->nilai2;
                    $selisih = $n2 - $n;
                    
                    
                    if($n != 0){
                        $persen = (($n2-$n)/$n)*100;
                    }else{
                        $persen = 100;
                    } 
                     
                    $nilai = number_format($n,"2",",",".");
                    $nilai2 = number_format($n2,"2",",",".");
                    $selisihc = $this->rp_minus($selisih); 
                    $persenc = $this->rp_minus($persen);                    
                    
				   if ($kode<>0) {
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" >$nama</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">$alamat</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$selisihc</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$persenc</td>
                                     </tr>
                                     ";
				    } else {
				                    $total = $total + $row->nilai;
                                    $total2 = $total2 + $row->nilai2;
									  $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><b>&nbsp;</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" ><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b> &nbsp;</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b> &nbsp;</b></td></tr>
                                     ";

									 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><b></b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" ><b>$nama</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\"><b><ins>$alamat</ins></b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$nilai</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$nilai2</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$selisihc</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$persenc</b></td>
                                     </tr>
                                     ";
                            
                        
				    }

                  }
                    $tselisih = $total2 - $total;                         
                    $total = number_format($total,"2",",",".");
                    $total2 = number_format($total2,"2",",",".");
                    $tselisih = number_format($tselisih,"2",",",".");
                    if($total != 0){
                        $tpersen = (($total2-$total)/$total)*100;
                    }else{
                        $tpersen = 100;
                    } 
                    $tpersen = $this->rp_minus($tpersen);
                    
                   $cRet    .= " <tr>
                                     <td style=\"vertical-align:top; border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"3\" align=\"right\"><b>TOTAL</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$total</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$total2</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$tselisih</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\"><b>$tpersen</b></td>
                                </tr>
                                     ";  
                 $cRet .="</table>";

				$cRet .="</table>";

        $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:10px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">";
				   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"6\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style= width=\"70%\" align=\"left\" >&nbsp;
								</td>
								<td style=width=\"30%\" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";
        $cRet .="</table>";            
 
        $cRet .=       " </table>";
        
        $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN II');        
        //$this->_mpdf('',$cRet,10,10,10,0);
       
	switch($cetak){   
        case 1;
        $this->_mpdf('',$cRet,10,10,10,0);
        break;
        case 0;
        //$this->template->load('template','anggaran/rka/perdaII',$data);
        echo ("<title>Lampiran I.1</title>");
        echo($cRet);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perdaII', $data);
        break;
        }
		
    }


//End Lampiran Alokasi dana sempurna
//Lampiran II 
//ctk_perkadaII_apbd_sempurna

	function ctk_perkadaII_apbd_sempurna(){
        $data['page_title']= 'Cetak Lampiran II Penjabaran Penyempurnaan APBD';
        $this->template->set('title', 'Cetak Lampiran II Penjabaran Penyempurnaan APBD');   
        $this->template->load('template','anggaran/rka/ctk_perkadaII_apbd_sempurna',$data) ; 
    }
	
    

     function preview_perkadaII_apbd_sempurna(){
         $id = $this->uri->segment(3);
         $cetak = $this->uri->segment(4);

        
        
         $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org FROM ms_skpd a 
                INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org)
                WHERE left(kd_skpd,7)='$id'";
                 $sqlskpd=$this->db->query($sqldns);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_u1;                    
                    $nm_urusan1= $rowdns->nm_u1;
                    $kd_urusan=$rowdns->kd_u;                    
                    $nm_urusan= $rowdns->nm_u;
                    $kd_skpd  = $rowdns->kd_sk;
                    $nm_skpd  = $rowdns->nm_sk;
                    $kd_org  = $rowdns->kd_org;
                    $nm_org  = $rowdns->nm_org;      

					}
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
		          $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag)
                {
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        
        $cRet='';
$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran II :  </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" align=\"left\"></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td ></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td ></td>
                    </tr>										
                    <tr>
                         <td align=\"left\">&nbsp;</td>
						 <td >&nbsp;</td>
                    </tr>
										
										
                  </table>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;text-transform:uppercase;border-top: none;border-bottom: none;border-left: none;\" >PERUBAHAN PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

   
 		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12 px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                    <tr>
                        <td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                        <td  width=\"80%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >: $kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>
 			
            
            		<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                         <td  width=\"80%\" align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >: $kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
                    </tr>
                
                  </table>"; 
				  
				     $font = 12;    
                     $font1 = $font-1;   	 
					 $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size: $font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">
                     <thead>                       
                        <tr><td width=\"15%\" rowspan=\"2\" align=\"center\"><b>NOMOR URUT</b></td>                      
                            <td width=\"30%\" rowspan=\"2\" align=\"center\"><b>URAIAN</b></td>
                            <td width=\"20%\" colspan=\"2\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Bertambah / </br>(Berkurang)</b></td>
                            <td width=\"5%\" rowspan=\"2\" align=\"center\"><b>%</b></td>
                            <td width=\"20%\"  rowspan=\"2\" align=\"center\"><b>PENJELASAN</b></td>
                        </tr>
                        <tr>
                            <td width=\"10%\" align=\"center\"><b>Sebelum</b></td>
                            <td width=\"10%\" align=\"center\"><b>Setelah</b></td>
                        </tr>

                        <tr><td align=\"center\"><b>1</b></td>                            
                            <td align=\"center\"><b>2</b></td>
                            <td align=\"center\"><b>3</b></td>
                            <td align=\"center\"><b>4</b></td>
                            <td align=\"center\"><b>5</b></td>
                            <td align=\"center\"><b>6</b></td>
                            <td align=\"center\"><b>7</b></td>
                        </tr>
                     </thead>
                     <tfoot>
                        <tr>
                            <td style=\"font-size:10 px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"7\"><i>
							Lampiran II : PerGub Prov. Kalimantan Barat - Penjabaran Penyempurnaan APBD TA $thn $nm_org<i></td>

                         </tr>
                     </tfoot>
                     
                      
                        ";

                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                    	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],NM_HUKUM [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                        where right(kd_kegiatan1,5)='00.04' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;
                $totp2 = 0;
				$num_sql1 = $query->num_rows();
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $nilai2 = $row->nilai2;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                   
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                        $totp2 = $totp2 + $nilai2;
                    }
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font.' px;';
                    }else{
                        $bold = '';
                        $fontr = '';
                    }

                    $coba3= number_format($nilai,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold  \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" >$hukum</td></tr>";
                }
                

				if($num_sql1>0){
					$coba4=number_format($totp,"2",",",".");
                    $totp2c =  number_format($totp2,"2",",",".");
                    $selisih = $this->rp_minus($totp2-$totp);
                    if($totp != 0){
                        $persen = $this->rp_minus((($totp2 - $totp)/$totp)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size: $font1 px;text-transform: uppercase;\" >Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$totp2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
                 
				 }
 

                 $sqltb="select * from (
                        select left(a.kd_skpd,4) [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and LEFT(a.kd_skpd,7)='$id'
                    	group by left(a.kd_skpd,4),LEFT(a.kd_skpd,7),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],ISNULL(nm_hukum,'') [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5                        
                        where right(kd_kegiatan1,5)='00.51' and LEFT(a.kd_skpd,7)='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                
                 $totbl = 0;
                 $totbl2 = 0;       
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $nilai2 = $rowb->nilai2;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                  
                    
                    
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                        $totbl2 = $totbl2 + $nilai2;
                    }

                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }else{
                        $bold = '';
                        $fontr = '';
                    }

                    $jmlb=number_format($nilai,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");
                    $cRet    .= " <tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                </tr>";
                 }    
                 
   
                 $sqlbl = "select b.nm_rek2,isnull(sum(nilai),0) [nilai],isnull(sum(nilai_sempurna),0) [nilai2] from trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where LEFT(a.kd_skpd,7)='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 foreach ($querybl->result() as $rowbl){
                    $nm = $rowbl->nm_rek2;
  
                    $nilai =number_format($rowbl->nilai,"2",",",".");
                    $nilai2 =number_format($rowbl->nilai2,"2",",",".");
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>
                                     
                                     </tr>";
                 }
                 
                 
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai_sempurna) [nilai],sum(a.nilai_sempurna) [nilai2],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai_sempurna) [nilai],sum(a.nilai_sempurna) [nilai2],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],
                            ISNULL(nm_hukum,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_program1,2)<>'00' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
               
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;
                    $nilai2= $row1->nilai2;
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                    
                    if ($rek1=='' ){
                       $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $font = '';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';                        
                    }else{
                        $bold = '';
                        $font = '';                        
                    }
                    $nilai = number_format($nilai,"2",",",".");
					$nilai2 = number_format($nilai2,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$hukum</td></tr>";
                }


                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                            </tr>";

                    
                    $selisih = $this->rp_minus($totbl2-$totbl);

                    if($totbl != 0){
                        $persen = $this->rp_minus((($totbl2 - $totbl)/$totbl)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                    
                    $jumbl=number_format($totbl,"2",",",".");
                    $totbl2c = number_format($totbl2,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$totbl2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td></tr>";   

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
        
                     
                if ($id==$this->ppkd){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,nilai2=nilai_terima2-nilai_keluar2,'' [hukum] from(
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai_terima], 
                            	(select sum(nilai) from trdrka where right(kd_kegiatan,5)='00.62' and LEFT(a.kd_skpd,7)='1.20.12') [nilai_keluar],sum(a.nilai_sempurna) [nilai_terima2],
                                (select sum(nilai_sempurna) from trdrka where right(kd_kegiatan,5)='00.62' and LEFT(a.kd_skpd,7)='1.20.12') [nilai_keluar2]
                            	from trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],ISNULL(NM_HUKUM,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.61' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
   
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;
                    $totpm2 = 0;                              
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $nilai2 = $row3->nilai2;
                        $selisih = $this->rp_minus($nilai2-$nilai);
    
                        if($nilai != 0){
                            $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        } 
                            
                        

                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                            $totpm2 = $totpm2 + $nilai2;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $fontr = '';
                        }
                       
                        $coba11= $this->rp_minus($nilai) ;
                        $nilai2 = $this->rp_minus($nilai2);
                        
                            
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                        </tr>";
                    }


                    $selisih = $this->rp_minus($totpm2-$totpm);

                    if($totpm != 0){
                        $persen = $this->rp_minus((($totpm2 - $totpm)/$totpm)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 

                    $coba12=number_format($totpm,"2",",",".");
                    $totpm2c=number_format($totpm2,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >JUMLAH PENERIMAAN PEMBIAYAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpm2c</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";



                    $sql4="select * from (
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],ISNULL(NM_HUKUM,'') [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.62' and LEFT(a.kd_skpd,7)='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0;
                    $totpk2 = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $nilai2 = $row4->nilai2;
                        $selisih = $this->rp_minus($nilai2-$nilai);
    
                        if($totpm != 0){
                            $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        } 

                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        $coba15= $this->rp_minus($nilai) ;

                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                            $totpk2 = $totpk2 + $nilai2;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $fontr = '';
                        }
						$nilai2 = $this->rp_minus($nilai2);
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td></tr>";
                    }
     

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
                    $selisih = $this->rp_minus($totpk2-$totpk);

                    if($totpm != 0){
                        $persen = $this->rp_minus((($totpk2 - $totpk)/$totpk)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                                                                
                    $totpk2c = $this->rp_minus($totpk2);
                    $coba16=$this->rp_minus($totpk);                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >JUMLAH PENGELUARAN PEMBIAYAAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$totpk2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>&nbsp;</tr>";
 
            }


					
									 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"7\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"width: 30%; \" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";

					


        $cRet .=       " </table>";

        $data['prev']= $cRet;
        //$this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
		ini_set('memory_limit','5000M');
		set_time_limit(5000);
        $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
				$jdl = 'Laporan Penjabaran Penyempurnaan APBD ['.$kd_org.']';
                echo ("<title>$jdl</title>");
                echo($cRet);
       
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
//end ctk_perkadaII_apbd_sempurna
 
// Enda Lampiran II
//Lampiran II Pergub Unit
function perkada_II_sempurna(){	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','LAMPIRAN II PENJABARAN PENYEMPURNAAN APBD PER-UNIT','perkada_II_sempurna','');
}

 function preview_perkadaII_unit_sempurna(){
    $id = $this->uri->segment(3);
    $cetak = $this->uri->segment(4);
    $cell = $this->uri->segment(5);
    $sqldns="SELECT kd_urusan1 as kd_u1,nm_urusan1 as nm_u1,a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk,nm_org,kd_org 
            FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan inner join ms_urusan1 c ON b.header=c.kd_urusan1 inner join ms_organisasi 
            d on left(rtrim(a.kd_skpd),7)=rtrim(d.kd_org) WHERE kd_skpd='$id'";
    $sqlskpd=$this->db->query($sqldns);
    foreach ($sqlskpd->result() as $rowdns){
        $kd_urusan1=$rowdns->kd_u1;                    
        $nm_urusan1= $rowdns->nm_u1;
        $kd_urusan=$rowdns->kd_u;                    
        $nm_urusan= $rowdns->nm_u;
        $kd_skpd  = $rowdns->kd_sk;
        $nm_skpd  = $rowdns->nm_sk;
        $kd_org  = $rowdns->kd_org;
        $nm_org  = $rowdns->nm_org;      
    }
       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
//                    $tanggal = $this->tanggal_format_indonesia($tgl);
					$tanggal = '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;';

                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }
				
				  $sqlsc="SELECT nama,jabatan FROM ms_ttd where nip='1'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowttd)
                {
                    $nama_ttd=$rowttd->nama;
                    $jab_ttd     = $rowttd->jabatan;
                } 
          
      $sqlsc="SELECT judul,nomor,tanggal FROM trkonfig_anggaran where jenis_anggaran='2'  and lampiran='pergub'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $row_ag){
                    $ag_judul=$row_ag->judul;
                    $ag_nomor = $row_ag->nomor;
					 $ag_tanggal = $row_ag->tanggal;
                } 
          
        
        
        $cRet='';
$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-weight:bold; font-size:12px\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
					<tr>
					<td width=\"10%\" rowspan=\"3\" align=\"left\" Valign=\"top\">Lampiran II :  </td>
                         <td  width=\"30%\" align=\"left\">$ag_judul</td>
						 <td  width=\"60%\" align=\"left\"></td>
                         
                    </tr>
                    <tr>
                         <td align=\"left\">Nomor &nbsp;&nbsp;: $ag_nomor</td>
						 <td ></td>
                    </tr>
                    
                    <tr>
                         <td align=\"left\" style=\"margin-bottom:15px;border-bottom: 2px solid;display: inline-block;width: 170px; \">Tanggal : $ag_tanggal</td>
						 <td ></td>
                    </tr>										
										
                  </table><br>";  
				  
		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:16px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"15%\" rowspan=\"4\" align=\"right\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >
					<img src=\"".base_url()."/image/logoHP.bmp\"  width=\"75\" height=\"100\" /></td>
                         <td  width=\"85%\" align=\"center\" style=\"font-size:23px;font-weight:bold;border-bottom: none;border-left: none; \" >$kab</td>
                         
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\" >PERUBAHAN PENJABARAN APBD</td>
                    </tr>
                    
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-left: none;\">TAHUN ANGGARAN $thn</td>
                    </tr>
                    <tr>
                         <td align=\"center\" style=\"vertical-align:top;border-bottom: none;border-top: none;border-left: none;\" > &nbsp;</td>
                    </tr>
                  </table>"; 
				  

   
 		$cRet .="<table style=\"border-collapse:collapse;font-family: arial; font-size:12px;font-weight:bold;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
					<tr>
					<td width=\"20%\" align=\"left\" style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;border-right: none;\" >&nbsp;Urusan Pemerintahan </td>
                         <td  width=\"80%\" align=\"left\" style=\"border-bottom: none;border-left: none; \" >: $kd_urusan1 - $nm_urusan1</td>
                         
                    </tr>
                    <tr>
					<td align=\"left\" style=\"vertical-align:top;border-top: none;border-bottom: none;border-right: none;\" >&nbsp;Bidang Pemerintahan </td>
                         <td  align=\"left\" style=\"border-top: none;border-bottom: none;border-left: none; \" >: $kd_urusan - $nm_urusan</td>
                         
                    </tr>
              
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;border-bottom: none;\" >&nbsp;Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none;border-bottom: none; \" >: $kd_org - $nm_org</td>
                    </tr>
                    <tr>
					 <td align=\"left\" style=\"vertical-align:top;border-top: none;border-right: none;\" >&nbsp;Sub Unit Organisasi </td>
                         <td  align=\"left\" style=\"border-top: none;border-left: none; \" >: $kd_skpd - $nm_skpd</td>
                    </tr>
                  </table>"; 
				  
	
				     $font = 12;    
                     $font1 = $font-1;  				 
					 $cRet .= "<table style=\"border-collapse:collapse;font-family: arial; font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\" $cell \">
                                 <thead>                       
                                    <tr><td width=\"17%\" rowspan=\"2\" align=\"center\"><b>NOMOR URUT</b></td>                      
                                        <td width=\"30%\" rowspan=\"2\" align=\"center\"><b>URAIAN</b></td>
                                        <td width=\"24%\" colspan=\"2\" align=\"center\"><b>JUMLAH(Rp.)</b></td>
                                        <td width=\"12%\" rowspan=\"2\" align=\"center\"><b>Bertambah / </br>(Berkurang)</b></td>
                                        <td width=\"5%\" rowspan=\"2\" align=\"center\"><b>%</b></td>
                                        <td width=\"12%\"  rowspan=\"2\" align=\"center\"><b>PENJELASAN</b></td>
                                    </tr>
                                    <tr>
                                        <td width=\"12%\" align=\"center\"><b>Sebelum</b></td>
                                        <td width=\"12%\" align=\"center\"><b>Setelah</b></td>
                                    </tr>
            
                                    <tr><td align=\"center\"><b>1</b></td>                            
                                        <td align=\"center\"><b>2</b></td>
                                        <td align=\"center\"><b>3</b></td>
                                        <td align=\"center\"><b>4</b></td>
                                        <td align=\"center\"><b>5</b></td>
                                        <td align=\"center\"><b>6</b></td>
                                        <td align=\"center\"><b>7</b></td>
                                    </tr>
                                 </thead>
                                 <tfoot>
                                    <tr>
                                        <td style=\"font-size:10 px;border-bottom: none;border-right: none;border-left: none;\" colspan=\"7\"><i>
            							Lampiran II : PerGub Prov. Kalimantan Barat - Penjabaran Penyempurnaan APBD TA $thn $nm_org<i></td>
            
                                     </tr>
                                 </tfoot>
                     
                      
                        ";

                 $sql1="select * from (
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                    	group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],NM_HUKUM [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                        where right(kd_kegiatan1,5)='00.04' and a.kd_skpd='$id'
                        group by b.kd_urusan,a.kd_skpd,right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                
                 $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                $totp = 0;
                $totp2 = 0;
				$num_sql1 = $query->num_rows();
                foreach ($query->result() as $row)
                {
                    $uru=$row->urusan;
                    $kdskpd = $row->kd_skpd;
                    $rek = $row->kd_rek;
                    $rek1 = $row->kd_rek1;
                    $nm=$row->nama;
                    $nilai = $row->nilai;
                    $nilai2 = $row->nilai2;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row->hukum);
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                   
                    
                    $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                    if (strlen($rek1)=='2'){
                        $totp = $totp + $nilai;
                        $totp2 = $totp2 + $nilai2;
                    }
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font.' px;';
                    }else{
                        $bold = '';
                        $fontr = '';
                    }

                    $coba3= number_format($nilai,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $font \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold  \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" >$hukum</td></tr>";
                }
                

				if($num_sql1>0){
					$coba4=number_format($totp,"2",",",".");
                    $totp2c =  number_format($totp2,"2",",",".");
                    $selisih = $this->rp_minus($totp2-$totp);
                    if($totp != 0){
                        $persen = $this->rp_minus((($totp2 - $totp)/$totp)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size: $font1 px;text-transform: uppercase;\" >Jumlah Pendapatan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$coba4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$totp2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;font-weight:bold;border-bottom: none;font-size:$font1 px;\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td></tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
                 
				 }
 

                 $sqltb="select * from (
                        select left(a.kd_skpd,4) [urusan],LEFT(a.kd_skpd,7) [kd_skpd],'00.00' [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] 
                    	from trdrka a 
                    	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                    	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                    	where left(a.kd_rek5,1)='5' and a.kd_skpd='$id'
                    	group by left(a.kd_skpd,4),LEFT(a.kd_skpd,7),c.kd_rek1,c.nm_rek1 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                        union all
                        select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],ISNULL(nm_hukum,'') [hukum] from trdrka a 
                        left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                        left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                        left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                        	(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                        		(select kd_kegiatan,nm_hukum from d_hukum a 
                        		inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                        		) Z FOR XML path(''), elements)
                        	) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5                        
                        where right(kd_kegiatan1,5)='00.51' and a.kd_skpd='$id'
                        group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                
                 $totbl = 0;
                 $totbl2 = 0;       
                 $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb){
                    $uru=$rowb->urusan;
                    $kdskpd = $rowb->kd_skpd;
                    $rek = $rowb->kd_rek;
                    $rek1 = $rowb->kd_rek1;
                    $nm=$rowb->nama;
                    $nilai = $rowb->nilai;
                    $nilai2 = $rowb->nilai2;
                    $hukum=str_replace('&lt;br&gt;','<br>',$rowb->hukum);
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                  
                    
                    
                    if (strlen($rek1)==2){
                        $kode = '';
                    }else{
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    if (strlen($rek1)==1){
                        $totbl = $totbl + $nilai;
                        $totbl2 = $totbl2 + $nilai2;
                    }

                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size:'.$font1.' px;';
                    }else{
                        $bold = '';
                        $fontr = '';
                    }

                    $jmlb=number_format($nilai,"2",",",".");
                    $nilai2 = number_format($nilai2,"2",",",".");
                    $cRet    .= " <tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$jmlb</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                </tr>";
                 }    
                 
   
                 $sqlbl = "select b.nm_rek2,isnull(sum(nilai),0) [nilai],isnull(sum(nilai_sempurna),0) [nilai2] from trdrka	a join ms_rek2 b on LEFT(a.kd_rek5,2)=b.kd_rek2 
                            where a.kd_skpd='$id' and LEFT(a.kd_rek5,2)='52' 
                            group by b.nm_rek2";
                 $querybl = $this->db->query($sqlbl);
                 foreach ($querybl->result() as $rowbl){
                    $nm = $rowbl->nm_rek2;
  
                    $nilai =number_format($rowbl->nilai,"2",",",".");
                    $nilai2 =number_format($rowbl->nilai2,"2",",",".");
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; font-size:$font1 px;\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>
                                     
                                     </tr>";
                 }
                 
                 
                 
                 $sql2="select * from (                        
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,2) [kd_rek],'' kd_rek1,b.nm_program [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,2),b.nm_program 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],'' kd_rek1,b.nm_kegiatan [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan where right(kd_program1,2)<>'00'
                            and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai_sempurna) [nilai],sum(a.nilai_sempurna) [nilai2],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,3),c.nm_rek3 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai_sempurna) [nilai],sum(a.nilai_sempurna) [nilai2],
                            '' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(b.kd_kegiatan1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],
                            ISNULL(nm_hukum,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_program1,2)<>'00' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(b.kd_kegiatan1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                        ) as a order by urusan,kd_skpd,kd_rek,kd_rek1
                        ";
                 
               
                 $query1 = $this->db->query($sql2);
                 foreach ($query1->result() as $row1)
                {
                    $uru=$row1->urusan;
                    $kdskpd = $row1->kd_skpd;
                    $rek = $row1->kd_rek;
                    $rek1 = $row1->kd_rek1;
                    $nm=$row1->nama;
                    $hukum=str_replace('&lt;br&gt;','<br>',$row1->hukum);
                    $nilai= $row1->nilai;
                    $nilai2= $row1->nilai2;
                    $selisih = $this->rp_minus($nilai2-$nilai);

                    if($nilai != 0){
                        $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                    
                    if ($rek1=='' ){
                       $kode = $uru.'.'.$kdskpd.'.'.$rek;
                    }else{
                        $bold = '';
                        $font = '';
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);
                    }
                    
                    
                    if (strlen($rek1)<6){
                        $bold = 'font-weight:bold;';
                        $font = 'font-size:11px;';                        
                    }else{
                        $bold = '';
                        $font = '';                        
                    }
                    $nilai = number_format($nilai,"2",",",".");
					$nilai2 = number_format($nilai2,"2",",",".");
                     $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"align=\"left\">$hukum</td></tr>";
                }


                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                            </tr>";

                    
                    $selisih = $this->rp_minus($totbl2-$totbl);

                    if($totbl != 0){
                        $persen = $this->rp_minus((($totbl2 - $totbl)/$totbl)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                    
                    
                    $jumbl=number_format($totbl,"2",",",".");
                    $totbl2c = number_format($totbl2,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >JUMLAH BELANJA</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$jumbl</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$totbl2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px\" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td></tr>";   

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
        
                     
                if ($id==$this->ppkd1){    
                    $sql3="select * from (
                            select urusan,kd_skpd,kd_rek,kd_rek1,nama,nilai=nilai_terima-nilai_keluar,nilai2=nilai_terima2-nilai_keluar2,'' [hukum] from(
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek1 [kd_rek1],c.nm_rek1 [nama],sum(a.nilai) [nilai_terima], 
                            	(select sum(nilai) from trdrka where right(kd_kegiatan,5)='00.62' and a.kd_skpd='1.20.12.02') [nilai_keluar],sum(a.nilai_sempurna) [nilai_terima2],
                                (select sum(nilai_sempurna) from trdrka where right(kd_kegiatan,5)='00.62' and a.kd_skpd='1.20.12.02') [nilai_keluar2]
                            	from trdrka a 
                            	left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            	left join ms_rek1 c on LEFT(a.kd_rek5,1)=c.kd_rek1
                            	where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            	group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek1,c.nm_rek1,a.kd_skpd 
                            ) total 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],ISNULL(NM_HUKUM,'') [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.61' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";
                 
   
                     $query3 = $this->db->query($sql3);
                    //$query = $this->skpd_model->getAllc();
                    
                    $totpm = 0;
                    $totpm2 = 0;                              
                    foreach ($query3->result() as $row3){
                        $uru=$row3->urusan;
                        $kdskpd = $row3->kd_skpd;
                        $rek = $row3->kd_rek;
                        $rek1 = $row3->kd_rek1;
                        $nm=$row3->nama;
                        $hukum=str_replace('&lt;br&gt;','<br>',$row3->hukum);
                        $nilai = $row3->nilai;
                        $nilai2 = $row3->nilai2;
                        $selisih = $this->rp_minus($nilai2-$nilai);
    
                        if($nilai != 0){
                            $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        } 
                            
                        

                            
                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpm = $totpm + $nilai;
                            $totpm2 = $totpm2 + $nilai2;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $fontr = '';
                        }
                       
                        $coba11= $this->rp_minus($nilai) ;
                        $nilai2 = $this->rp_minus($nilai2);
                        
                            
                         $cRet    .= "  <tr>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba11</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td>
                                        </tr>";
                    }


                    $selisih = $this->rp_minus($totpm2-$totpm);

                    if($totpm != 0){
                        $persen = $this->rp_minus((($totpm2 - $totpm)/$totpm)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 

                    $coba12=number_format($totpm,"2",",",".");
                    $totpm2c=number_format($totpm2,"2",",",".");
                       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


                    $cRet    .= "   <tr>                                        
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;\" >JUMLAH PENERIMAAN DAERAH</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$coba12</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$totpm2c</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px;\" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                    </tr>";

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";



                    $sql4="select * from (
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],c.kd_rek2 [kd_rek1],c.nm_rek2 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum] from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek2 c on LEFT(a.kd_rek5,2)=c.kd_rek2
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),c.kd_rek2,c.nm_rek2,b.nm_kegiatan 
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,3) kd_rek1,c.nm_rek3 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek3 c on LEFT(a.kd_rek5,3)=c.kd_rek3
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,3),c.nm_rek3
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],left(a.kd_rek5,5) kd_rek1,c.nm_rek4 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],'' [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek4 c on LEFT(a.kd_rek5,5)=c.kd_rek4
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),left(a.kd_rek5,5),c.nm_rek4
                            union all
                            select b.kd_urusan [urusan],LEFT(a.kd_skpd,7) [kd_skpd],right(kd_program1,5) [kd_rek],a.kd_rek5 kd_rek1,c.nm_rek5 [nama],sum(a.nilai) [nilai],sum(a.nilai_sempurna) [nilai2],ISNULL(NM_HUKUM,'') [hukum]  from trdrka a 
                            left join trskpd b on a.kd_kegiatan=b.kd_kegiatan 
                            left join ms_rek5 c on a.kd_rek5=c.kd_rek5
                            left join (SELECT KD_KEGIATAN,kd_rek5 [kd_rek5],NM_HUKUM=(
                            		(SELECT distinct '-'+ nm_hukum+'<br>' FROM 
                            			(select kd_kegiatan,nm_hukum from d_hukum a 
                            			inner join m_hukum b on a.dhukum=b.kd_hukum  WHERE kd_kegiatan=C.kd_kegiatan 
                            			) Z FOR XML path(''), elements)
                            		) FROM d_hukum C GROUP BY kd_kegiatan,kd_rek5)x ON X.kd_kegiatan=A.KD_KEGIATAN and x.kd_rek5=a.kd_rek5
                            where right(kd_kegiatan1,5)='00.62' and a.kd_skpd='$id'
                            group by b.kd_urusan,LEFT(a.kd_skpd,7),right(kd_program1,5),a.kd_rek5,c.nm_rek5,NM_HUKUM
                            ) as a order by urusan,kd_skpd,kd_rek,kd_rek1";

                    $query4 = $this->db->query($sql4);
                     //$query = $this->skpd_model->getAllc();
                    $totpk = 0;
                    $totpk2 = 0;                                  
                    foreach ($query4->result() as $row4)
                    {
                        $uru=$row4->urusan;
                        $kdskpd = $row4->kd_skpd;
                        $rek = $row4->kd_rek;
                        $rek1 = $row4->kd_rek1;
                        $nm=$row4->nama;
                        $nilai = $row4->nilai;
                        $nilai2 = $row4->nilai2;
                        $selisih = $this->rp_minus($nilai2-$nilai);
    
                        if($totpm != 0){
                            $persen = $this->rp_minus((($nilai2 - $nilai)/$nilai)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        } 

                        $hukum=str_replace('&lt;br&gt;','<br>',$row4->hukum);
                        $coba15= $this->rp_minus($nilai) ;

                        $kode = $uru.'.'.$kdskpd.'.'.$rek.'.'.$this->dotrek($rek1);

                        if (strlen($rek1)=='2'){
                            $totpk = $totpk + $nilai;
                            $totpk2 = $totpk2 + $nilai2;
                        }
                        
                        if (strlen($rek1)<6){
                            $bold = 'font-weight:bold;';
                            $fontr = 'font-size:11px;';
                        }else{
                            $bold = '';
                            $fontr = '';
                        }
						$nilai2 = $this->rp_minus($nilai2);
                         $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"left\">$kode</td>                                     
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold \" >$nm</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$coba15</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                         <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">$hukum</td></tr>";
                    }
     

                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";
                    $selisih = $this->rp_minus($totpk2-$totpk);

                    if($totpm != 0){
                        $persen = $this->rp_minus((($totpk2 - $totpk)/$totpk)*100);
                    }else{
                        $persen = $this->rp_minus(100);
                    } 
                                                                
                    $totpk2c = $this->rp_minus($totpk2);
                    $coba16=$this->rp_minus($totpk);                   
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold; \" >JUMLAH PENGELUARAN DAERAH</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$coba16</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$totpk2c</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$selisih</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-weight:bold;font-size:$font1 px; \" align=\"right\">$persen</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>&nbsp;</tr>";
 
            }


					
									 $cRet .="<tr>
                                <td width=\"100%\" align=\"center\" colspan=\"7\">
								<table style=\"width: 100%;\" border=\"0\" align=\"center\">
								<tr>
								<td style=\"width: 70%;\" align=\"left\" >&nbsp;
								</td>
								<td style=\"width: 30%; \" align=\"center\" >$daerah ,$tanggal					
								<br>$jab_ttd,
      							<p>&nbsp;</p>
								<br>
								<br>
								<br>
								<br>
								<br>
                				<br><b>$nama_ttd</b>
								</td></tr></table></td>
                             </tr>";

					


        $cRet .=       " </table>";
       $data['prev']= $cRet;
        $this->template->set('title', 'CETAK PERDA LAMPIRAN V');        
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','anggaran/rka/perkadaII',$data);
        switch($cetak){   
        case 1;
            $this->_mpdf('',$cRet,10,10,10,1);
        break;
        case 0;
            //$this->template->load('template','anggaran/rka/perkadaII',$data);
   			echo ("<title>Pergub Lampiran II Penyempurnaan Unit $id</title>");
			echo ($cRet);
			break;	        
        break;
        case 2;        
         header("Cache-Control: no-cache, no-store, must-revalidate");
         header("Content-Type: application/vnd.ms-excel");
         header("Content-Disposition: attachment; filename=PERDA.xls");
        $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }
        //$this->load->view('anggaran/rka/perdaV', $data);
                
    }
 

//End Lampiran II Pergub Unit




//End Pergub Sempurna

	
	//DPPA Sempurna

//DPPA 0
	function ctk_dppa0_sempurna(){
        $data['page_title']= 'Cetak DPPA 0 Penyempurnaan';
        $this->template->set('title', 'Cetak DPPA 0 Penyempurnaan');   
        $this->template->load('template','anggaran/rka/ctk_dppa0_sempurna',$data) ; 
    }
    function preview_dppa0_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $rinci = $this->uri->segment(5);
        
        
        $ttd2= $_REQUEST['ttd2'];
        $ttd2 = str_replace('a',' ',$ttd2);

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }


       if ($ttd2<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Menyetujui,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;border-bottom: solid 1px black\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"65%\" align=\"center\"><strong>RINGKASAN DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD<br></strong></td>
                    </tr>

                    <tr>
                         <td  style=\"border-collapse:collapse;border-bottom: solid 1px black\" align=\"center\"  ><strong>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" ><strong>TAHUN ANGARAN $thn</strong></td>
                    </tr>

                  </table>";        
                  
       if (strlen($id)==7){          
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"80%\"><strong>: $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Unit Organisasi</stong></td>
                        <td><strong>: $kd_org - $nm_org</stong></td>
                    </tr>
                </table>";
        }ELSE{
            $cRet .="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; none;font-size:12;\" width=\"100%\" align=\"left\" border=\"0\">
                    <tr>
                        <td width=\"22%\"><strong>&emsp;Urusan Pemerintahan</stong></td>
                        <td width=\"3%\"><strong>: </stong></td>
                        <td width=\"80%\"><strong> $kd_urusan1 - $nm_urusan1</stong></td>
                    </tr>
                    <tr>
                        <td width=\"22%\"><strong>&emsp;Bidang Pemerintahan</stong></td>
                        <td width=\"3%\"><strong>: </stong></td>
                        <td width=\"80%\"><strong> $kd_urusan - $nm_urusan</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Unit Organisasi </stong></td>
                        <td ><strong>: </stong></td>
                        <td><strong> $kd_org - $nm_org</stong></td>
                    </tr>
                    <tr>
                        <td><strong>&emsp;Sub Unit Organisasi </stong></td>
                        <td><strong >: </stong></td>
                        <td><strong> $kd_skpd - $nm_skpd</stong></td>
                    </tr>
                   <tr>
                        <td style=\"border-top: solid 1px black;\" colspan=\"3\" align=\"center\"><strong>&emsp;RINGKASAN DOKUMEN PELAKSANAAN PENYEMPURNAAN ANGGRAN SATUAN KERJA PERANGKAT DAERAH</stong></td>
                    </tr>                    
                </table>";            
        }        
          
        $font = 12;
        $font1 = $font-12; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"2\">
                     <thead>                       
                        <tr><td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Kode Rekening</b></td>                            
                            <td width=\"24%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"40%\" colspan=\"2\" align=\"center\"><b>Jumlah(Rp.)</b></td>
                            <td width=\"26%\" colspan=\"2\" align=\"center\"><b>Bertambah/ (Berkurang)</b></td>
                        </tr>

                        <tr>
                            <td width=\"20%\" align=\"center\"><b>Sebelum</b></td>                            
                            <td width=\"20%\" align=\"center\"><b>Setelah</b></td>
                            <td width=\"17%\" align=\"center\"><b>(Rp.)</b></td>
                            <td width=\"9%\" align=\"center\"><b>%</b></td>
                        </tr>
                            
                         <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>1</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>2</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>3</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>4</strong></td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>5</strong></td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;\" align=\"center\"><strong>6</strong></td>

                         </tr>
                     </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>                         

                         </tr>
                     </tfoot>   
                        ";


                 $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 ";
                 if ($rinci == 1){
                    $sql2 = "union all
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4 
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek 
                            ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) where left(b.kd_rek5,2)='41' and $a b.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,a.kelompok, a.nm_rek5 ";
                 }else{
                    $sql2 = "";
                 }
                 $sql3 = "ORDER BY kd_rek";
                 
                 $query = $this->db->query($sql1.$sql2.$sql3);
                 //$query = $this->skpd_model->getAllc();
                                                  
                foreach ($query->result() as $row)
                {
                    $coba1=rtrim($row->rek);
                    $coba2=$row->nm_rek;
                    $coba3 = $row->nilai;
                    $nilai2 = $row->nilai2;
                    
                    $selisih = $this->rp_minus($nilai2 - $coba3);
                    if($coba3 != 0){
                        $persen = $this->rp_minus((($nilai2 - $coba3)/$coba3)*100);
                    }else{
                        if($nilai2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 
                    
                    $coba3= number_format($coba3,"2",",",".");
                    $nilai2= number_format($nilai2,"2",",",".");
                    
                    if(strlen($coba1)>3){
                        $bold = "";
                        $fontr = "font-size: ".$font." px;";                        
                    }else{
                        $bold = "font-weight:bold;";
                        $fontr = "font-size: ".$font1." px;";
                    }


                    $cRet    .= " <tr>
                                    <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$coba1 </td>                                     
                                    <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" >$coba2</td>
                                    <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$coba3</td>
                                    <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                    <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                    <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                </tr>";
                    
                 }


                $sqltp="SELECT SUM(nilai) AS totp,SUM(nilai_sempurna) AS totp2 FROM trdrka WHERE LEFT(kd_rek5,2)='41' and $a$skpd$b='$id'";
                 $sqlp=$this->db->query($sqltp);
                 foreach ($sqlp->result() as $rowp)
                {
                    $coba4=number_format($rowp->totp,"2",",",".");
                    $cob1=$rowp->totp;
                    $totp2 = $rowp->totp2;
                    
                    $selisih = $this->rp_minus($totp2 - $cob1);
                    if($cob1 != 0){
                        $persen = $this->rp_minus((($totp2 - $cob1)/$cob1)*100);
                    }else{
                        if($totp2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 

                    $totp2c =number_format($totp2,"2",",",".");
    
                    
                    if ($cob1!=0){                   
                        $cRet    .= " <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\"><strong>Jumlah Pendapatan</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$coba4</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$totp2c</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$selisih</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$persen</strong></td>
                                    </tr>";
  
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
                    } 
                 }     

                 
         
         
                $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                       ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (LEFT(b.kd_rek5,1)='5') AND $a b.$skpd$b='$id' 
                       GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                       UNION ALL 
                       SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                       ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                       UNION ALL 
                       SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                       ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                       ";
                 if($rinci==1){
                    $sql2=" UNION ALL 
                            SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek4 a INNER JOIN trdrka b
                            ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                            union all
                            SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                            SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek5 a INNER JOIN trdrka b
                            ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (LEFT(b.kd_rek5,2)='51' OR LEFT(b.kd_rek5,2)='52') AND $a b.$skpd$b='$id' 
                            GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                            ";
                 }else{
                    $sql2="";
                 }
                 $sql3 = " ORDER BY kd_rek";
                 
                 $query1 = $this->db->query($sql1.$sql2.$sql3);
                 foreach ($query1->result() as $row1)
                {
                    $coba5=rtrim($row1->rek);
                    $coba6=$row1->nm_rek;
                    $coba7= $row1->nilai;
                    $nilai2 = $row1->nilai2;

                    $selisih = $this->rp_minus($nilai2 - $coba7);
                    if($coba7 != 0){
                        $persen = $this->rp_minus((($nilai2 - $coba7)/$coba7)*100);
                    }else{
                        if($nilai2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 
                    
                    $coba7= number_format($coba7,"2",",",".");
                    $nilai2= number_format($nilai2,"2",",",".");
                    
                    if(strlen($coba5)>3){
                        $bold = "";
                        $fontr = "font-size: ".$font." px;";                        
                    }else{
                        $bold = "font-weight:bold;";
                        $fontr = "font-size: ".$font1." px;";
                    }
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$coba5</td>                                     
                                 <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold \" >$coba6</td>
                                 <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$coba7</td>
                                 <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                 <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                 <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                 </tr>";
                }
                
                    $sqltb="SELECT SUM(nilai) AS totb,SUM(nilai_sempurna) AS totb2 FROM trdrka WHERE (LEFT(kd_rek5,2)='51' or LEFT(kd_rek5,2)='52') and $a$skpd$b='$id'";
                    $sqlb=$this->db->query($sqltb);
                 foreach ($sqlb->result() as $rowb)
                {
                   $coba8=number_format($rowb->totb,"2",",",".");
                    $cob=$rowb->totb;
                    $totb2 = $rowb->totb2;

                    $selisih = $this->rp_minus($totb2 - $cob);
                    if($cob != 0){
                        $persen = $this->rp_minus((($totb2 - $cob)/$cob)*100);
                    }else{
                        if($totb2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 

                    $totb2c=number_format($totb2,"2",",",".");
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" ><strong>Jumlah Belanja</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$coba8</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$totb2c</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$selisih</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$persen</strong></td>
                                     </tr>";
                 } 
                  


                    $suplus=$cob1-$cob; 
                    $suplus2=$totp2-$totb2;
                    
                    $selisih = $this->rp_minus($suplus2 - $suplus);
                    if($suplus != 0){
                        $persen = $this->rp_minus((($suplus2 - $suplus)/$suplus)*100);
                    }else{
                        if($suplus2 == 0){
                            $persen = $this->rp_minus(0);
                        }else{
                            $persen = $this->rp_minus(100);
                        }
                    } 


                    $surp=$this->rp_minus($suplus);  
                    $surp2=$this->rp_minus($suplus2); 
                 
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;text-transform:uppercase;\" ><strong>Surplus/Defisit</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$surp</strong></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$surp2</strong></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$selisih</strong></td>
                                    <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$persen</strong></td>
                                </tr>";
                                     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" > </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     
                                     </tr>";

                    if ($id == $this->ppkd || $id == $this->ppkd1){
                        //PENERIMAAN PEMBIAYAAN
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     
                                     </tr>";
        
                         $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2  FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2  FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2  FROM ms_rek4 a INNER JOIN trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2  FROM ms_rek5 a INNER JOIN trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,5)='00.61') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=rtrim($row1->rek);
                            $coba6=$row1->nm_rek;
                            $coba7= $row1->nilai;
                            $nilai2= $row1->nilai2;
                            
                            if (strlen($coba5)==1){
                                $totpen = $coba7;
                                $totpen2 = $coba7;
                            }


                            $selisih = $this->rp_minus($nilai2 - $coba7);
                            if($coba7 != 0){
                                $persen = $this->rp_minus((($nilai2 - $coba7)/$coba7)*100);
                            }else{
                                if($nilai2 == 0){
                                    $persen = $this->rp_minus(0);
                                }else{
                                    $persen = $this->rp_minus(100);
                                }
                            } 
        


                            $coba7= number_format($row1->nilai,"2",",",".");
                            $nilai2= number_format($nilai2,"2",",",".");
                            
                            if(strlen($coba5)>3){
                                $bold = "";
                                $fontr = "font-size: ".$font." px;";                        
                            }else{
                                $bold = "font-weight:bold;";
                                $fontr = "font-size: ".$font1." px;";
                            }

                                                    
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$coba5</td>                                     
                                         <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold \" >$coba6</td>
                                         <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$coba7</td>
                                         <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                         <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                         </tr>";
                            
                        }

                        $selisih = $this->rp_minus($totpen2 - $totpen);
                        if($totpen != 0){
                            $persen = $this->rp_minus((($totpen2 - $totpen)/$totpen)*100);
                        }else{
                            if($totpen2 == 0){
                                $persen = $this->rp_minus(0);
                            }else{
                                $persen = $this->rp_minus(100);
                            }
                        } 
                    
                        $totpen1=number_format($totpen,"2",",",".");
                        $totpen2c=number_format($totpen2,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PENERIMAAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$totpen1</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$totpen2c</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$selisih</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 px;\" align=\"right\"><strong>$persen</strong></td>
                                     </tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" > </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";                    

                        //PENGELUARAN PEMBIAYAAN
       
                         $sql1="SELECT a.kd_rek1 AS kd_rek,a.kelompok AS rek, a.nm_rek1 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek1 a INNER JOIN trdrka b
                           ON a.kd_rek1=LEFT(b.kd_rek5,(LEN(a.kd_rek1))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' 
                           GROUP BY a.kd_rek1,a.kelompok, a.nm_rek1
                           UNION ALL 
                           SELECT a.kd_rek2 AS kd_rek,a.kelompok AS rek,a.nm_rek2 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek2 a INNER JOIN trdrka b
                           ON a.kd_rek2=LEFT(b.kd_rek5,(LEN(a.kd_rek2))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek2,a.kelompok,a.nm_rek2 
                           UNION ALL 
                           SELECT a.kd_rek3 AS kd_rek,a.kelompok AS rek,a.nm_rek3 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek3 a INNER JOIN trdrka b
                           ON a.kd_rek3=LEFT(b.kd_rek5,(LEN(a.kd_rek3))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' GROUP BY a.kd_rek3,a.kelompok, a.nm_rek3 
                           ";
                         if($rinci==1){
                            $sql2=" UNION ALL 
                                SELECT a.kd_rek4 AS kd_rek,a.kelompok AS rek,a.nm_rek4 AS nm_rek ,SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek4 a INNER JOIN trdrka b
                                ON a.kd_rek4=LEFT(b.kd_rek5,(LEN(a.kd_rek4))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek4,a.kelompok, a.nm_rek4
                                union all
                                SELECT a.kd_rek5 AS kd_rek,a.kelompok+'.'+SUBSTRING(a.kd_rek5,4,2)+'.'+SUBSTRING(a.kd_rek5,6,2) AS rek,a.nm_rek5 AS nm_rek ,
                                SUM(b.nilai) AS nilai,SUM(b.nilai_sempurna) AS nilai2 FROM ms_rek5 a INNER JOIN trdrka b
                                ON a.kd_rek5=LEFT(b.kd_rek5,(LEN(a.kd_rek5))) WHERE (right(b.kd_kegiatan,5)='00.62') AND $a b.$skpd$b='$id' 
                                GROUP BY a.kd_rek5,a.kelompok, a.nm_rek5
                                ";
                        }else{
                            $sql2="";
                        }
                        $sql3 = " ORDER BY kd_rek";
                     
                        $query1 = $this->db->query($sql1.$sql2.$sql3);
                        foreach ($query1->result() as $row1){
                            $coba5=rtrim($row1->rek);
                            $coba6=$row1->nm_rek;
                            $coba7= $row1->nilai;
                            $nilai2= $row1->nilai2;


                            $selisih = $this->rp_minus($nilai2 - $coba7);
                            if($coba7 != 0){
                                $persen = $this->rp_minus((($nilai2 - $coba7)/$coba7)*100);
                            }else{
                                if($nilai2 == 0){
                                    $persen = $this->rp_minus(0);
                                }else{
                                    $persen = $this->rp_minus(100);
                                }
                            } 
                             
                            if (strlen($coba5)==1){
                                $totpeng = $coba7;
                                $totpeng2 = $nilai2;
                            }
                        
                            $coba7= number_format($row1->nilai,"2",",",".");
                            $nilai2= number_format($nilai2,"2",",",".");
                            
                            if(strlen($coba5)>3){
                                $bold = "";
                                $fontr = "font-size: ".$font." px;";                        
                            }else{
                                $bold = "font-weight:bold;";
                                $fontr = "font-size: ".$font1." px;";
                            }
                                

                                $cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$coba5</td>                                     
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold \" >$coba6</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$coba7</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$nilai2</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                             <td style=\"vertical-align:top;border-top: none ;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>
                                             </tr>";
                        }
                         
                        $jbiaya = $totpen - $totpeng;
                        $jbiaya2 = $totpen2 - $totpeng2;

                        $selisihb = $this->rp_minus($jbiaya2 - $jbiaya);
                        if($jbiaya != 0){
                            $persenb = $this->rp_minus((($jbiaya2 - $jbiaya)/$jbiaya)*100);
                        }else{
                            if($jbiaya2 == 0){
                                $persenb = $this->rp_minus(0);
                            }else{
                                $persenb = $this->rp_minus(100);
                            }
                        } 


                        $selisih = $this->rp_minus($totpeng2 - $totpeng);
                        if($totpeng != 0){
                            $persen = $this->rp_minus((($totpeng2 - $totpeng)/$totpeng)*100);
                        }else{
                            if($totpeng2 == 0){
                                $persen = $this->rp_minus(0);
                            }else{
                                $persen = $this->rp_minus(100);
                            }
                        } 

                        
                        $jbiaya = $this->rp_minus($jbiaya);
                        $jbiaya2 = $this->rp_minus($jbiaya2);
                        
                        $totpeng=number_format($totpeng,"2",",",".");
                        $totpeng2=number_format($totpeng2,"2",",",".");
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PENGELUARAN DAERAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totpeng</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totpeng2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$selisih</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$persen</strong></td>
                                     
                                     </tr>";
                     
                        $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" > </td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     </tr>";
                                                         
                       $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PEMBIAYAAN</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$jbiaya</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$jbiaya2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$selisihb</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$persenb</strong></td>
                                     
                                     </tr>";


                    }
                    
  
   
                    
                    $cRet    .= "</table>"; 

                    
                    $cRet .="<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"4\">
                            
                            <tr >
                                <td colspan=\"7\" width=\"73%\" style=\"text-align: center;\" ><strong>Rencana Pelaksanaan Anggaran <br> Satuan Kerja Perangkat Daerah per Triwulan</strong></td>
                            </tr>
                            <tr>
                                <td width=\"4%\" rowspan=\"2\" ><strong>NO.</strong> </td>
                                <td width=\"21%\" rowspan=\"2\" style=\"text-align: center;\" ><strong>Uraian</strong> </td>
                                <td width=\"75%\" colspan=\"5\"  style=\"text-align: center;\" ><strong>Triwulan</strong></td>
                            </tr>";
                    
                    $cRet .="<tr>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>I </strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>II</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>III</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>IV</strong></td>
                                <td width=\"15%\" style=\"text-align: center;\"><strong>JUMLAH</strong> </td>
                            </tr>";


                    $cRet .="<tr >
                                <td style=\"text-align: center;\"><strong>1</strong> </td>
                                <td style=\"text-align: center;\" ><strong>2</strong> </td>
                                <td style=\"text-align: center;\"><strong>3</strong></td>
                                <td style=\"text-align: center;\"><strong>4</strong></td>
                                <td style=\"text-align: center;\"><strong>5</strong></td>
                                <td style=\"text-align: center;\"><strong>6</strong></td>
                                <td style=\"text-align: center;\"><strong>7=3+4+5+6 </strong></td>
                            </tr>";
                                                        
                    $ctriw1 = "triw1_sempurna";
                    $ctriw2 = "triw2_sempurna";
                    $ctriw3 = "triw3_sempurna";
                    $ctriw4 = "triw4_sempurna";
                    
                    //Pendapatan
                    $qtriw = " SELECT distinct isnull( a.$ctriw1,0) AS triw1,isnull( a.$ctriw2,0) AS triw2,isnull( a.$ctriw3,0) 
                                AS triw3,isnull( a.$ctriw4,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.04' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
     
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Pendapatan</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$total</td></tr>";                   
                    
                    //BTL
                    $qtriw = " SELECT distinct isnull( a.$ctriw1,0) AS triw1,isnull( a.$ctriw2,0) AS triw2,isnull( a.$ctriw3,0) AS triw3,isnull( a.$ctriw4,0) AS triw4 FROM trskpd a
                                join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                                        
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
       
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">2.1</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Belanja Tidak Langsung</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$total</td></tr>";                   

                    //BL
                    $qtriw = " SELECT  isnull(sum(distinct a.$ctriw1),0) AS triw1,isnull(sum(distinct a.$ctriw2),0) AS triw2,isnull(sum(distinct a.$ctriw3),0) 
                                AS triw3,isnull(sum(distinct a.$ctriw4),0) AS triw4 FROM trskpd a
                                join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_program,2)<>'00' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">2.2</td>                                     
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Belanja Langsung</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw1</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw2</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw3</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                                 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$total</td></tr>";                   
 
 
                    //Penerimaan Pembiayaan 
                    $qtriw = "  SELECT distinct isnull( a.$ctriw1,0) AS triw1,isnull( a.$ctriw2,0) AS triw2,isnull( a.$ctriw3,0) 
                                AS triw3,isnull( a.$ctriw4,0) AS triw4 FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id'";
                    
                    
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">3.1</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Penerimaan Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$total</td></tr>";                   

                    //Pengeluaran Pembiayaan
                    $qtriw = "  SELECT distinct isnull( a.$ctriw1,0) AS triw1,isnull( a.$ctriw2,0) AS triw2,isnull( a.$ctriw3,0) 
                                AS triw3,isnull( a.$ctriw4,0) AS triw4 FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id'";
                    $qtriwl = $this->db->query($qtriw);
                    $num_rows = $qtriwl->num_rows();
                    if ($num_rows!=0){
                        foreach ($qtriwl->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                        }
                    }else{
                        $triw1=  0;
                        $triw2= 0;
				        $triw3= 0;
				        $triw4= 0;
				        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
                    }
                    
                    
                    $triw1 = number_format($triw1,2,',','.');
                    $triw2= number_format($triw2,2,',','.');
    				$triw3= number_format($triw3,2,',','.');
    				$triw4= number_format($triw4,2,',','.');
                    $total = number_format($total,2,',','.');
                        
                    $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">3.2</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw1</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw2</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw3</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$total</td></tr>";                   

                   
                    $cRet .="<tr>
                                <td width=\"100%\" align=\"left\" colspan=\"7\">
								<table border=\"0\" width=\"100%\">
								<tr>
								<td width=\"70%\" align=\"left\">&nbsp;<br>&nbsp;
								<br>&nbsp;
								&nbsp;<br>
                				&nbsp;<br>
                				&nbsp;<br>
								&nbsp;	
								</td>
								<td width=\"30%\" align=\"center\">$daerah ,&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;
								<br>$jdlnip1
                                <br>$jabatan1
      							<p>&nbsp;</p>
								&nbsp;<br>
                				&nbsp;<br>
                				<br><strong><ins>$nama1</ins></strong>
                				<br>$pangkat1
                                <br>$nip1 
								</td></tr></table></td>
                             </tr>";
        
             
        $cRet    .= "</table>";
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//END DPPA 0
	
//DPPA 1
	function ctk_dppa1_sempurna(){
        $data['page_title']= 'Cetak DPPA 1';
        $this->template->set('title', 'Cetak DPPA 1');   
        $this->template->load('template','anggaran/rka/ctk_dppa1_sempurna',$data) ; 
    }
    
     function preview_coverdppa1_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $ttd2= $_REQUEST['ttd2'];
 
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }

         
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab FROM ms_ttd WHERE (REPLACE(nip, ' ', '')='$ttd2')  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : $rowttd->nip ;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
                }                
        }
        else{
                    $nip2='' ;
                    $nama2= '';
                    $jabatan2  = '';
        }        
                                
        $cRet='';
        $cRet .="<table style=\"border-collapse:collapse;font-size:12; \" width=\"60%\"  align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tbody>
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"60%\" colspan=\"7\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>                   
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>$kab</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>
                    </tr>
                    <tr>
                        <td width=\"60%\" align=\"center\" colspan=\"7\"><strong>DOKUMEN PELAKSANAAN ANGGARAN</strong></td>
                    </tr>
   
                    <tr>
                        <td style=\"border-collapse:collapse;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>SATUAN KERJA PERANGKAT DAERAH (DPPA SKPD)</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>TAHUN ANGGARAN $thn</strong></td>                    
                    </tr>
 
                      <tr>
                        <td style=\"border-collapse:collapse\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>PENDAPATAN</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;\" width=\"30%\" align=\"right\"><strong>NO DPA SKPD :</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;\" width=\"2%\" align=\"center\"><strong>$kd_urusan</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>01</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>00</strong></td>                    
                        <td style=\"border-collapse:collapse;border-bottom: solid 1px black;border-top: solid 1px black;border-right: solid 1px black;\" width=\"2%\" align=\"center\"><strong>4</strong></td>                    
                        <td style=\"border-collapse:collapse;\" width=\"20%\" align=\"center\"><strong>&nbsp;</strong></td>                    
                    </tr>
                     <tr>
                        <td style=\"border-collapse:collapse;font-size:15;\" width=\"60%\" align=\"center\" colspan=\"7\"><strong>&nbsp;</strong></td>                    
                    </tr>

                    </tbody>
                </table>";
        
        $Xret1 = '';
        $Xret2 = ''; 
        $Xret3 = '';

        $Xret1 .="<table style=\"border-collapse:collapse;font-size:12;margin: 0 auto;\" width=\"80%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <thead>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Urusan Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan1 - $nm_urusan1</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Bidang Pemerintahan</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_urusan - $nm_urusan</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_org - $nm_org</td>
                        </tr>";
       $Xret2 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">Sub Unit Organisasi</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$kd_skpd - $nm_skpd</td>
                        </tr>";                 
       $Xret3 .="       <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">PENGGUNA ANGGARAN / KUASA PENGGUNA ANGGARAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">&nbsp;</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">&nbsp;</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NAMA</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nama2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">NIP</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$nip2</td>
                        </tr>
                        <tr>
                            <td width=\"20%\" style=\"font-weight: bold;\">JABATAN</td> 
                            <td width=\"2%\" style=\"font-weight: bold;\">:</td>
                            <td width=\"58%\" style=\"font-weight: bold;\">$jabatan2</td>
                        </tr>                        
                   </thead>
                </table>";
        
        if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }   
        
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report Cover DPA-0</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'0','no','','','');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        }   
     }   
    
     function preview_dppa1_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
        $ttdsetda = $this->uri->segment(7);
        
        $ttd1= $_REQUEST['ttd1'];
		
        $ttd2= $_REQUEST['ttd2'];
		$ttd1 = str_replace('a',' ',$ttd1);
        $ttd2 = str_replace('a',' ',$ttd2);

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> 
                        <td style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"50\" height=\"50\" /></td>
                        <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                        <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"20%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD 1<br></strong></td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" style=\"border-top: solid 1px black;border-bottom: hidden;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"2\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>TAHUN ANGGARAN $thn</strong> </td>
                    </tr>    
                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" ><strong>Latar belakang perubahan/dianggarkan </br> pendapatan dalam APBD</strong></td>
                        <td style=\"border-top:solid 1px black;font-size:12;vertical-align:top;\"  colspan=\"2\" ><strong>:</strong></td>
                    </tr>

                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:12;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran Pendapatan <br>Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12;
        $font1 = $font-1; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td width=\"7%\" rowspan=\"3\"  align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"31%\" rowspan=\"3\"  align=\"center\"><b>Uraian</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Sebelum</b></td>
                            <td width=\"26%\" colspan=\"4\"  align=\"center\"><b>Setelah</b></td>
                            <td width=\"20%\" colspan=\"2\"  align=\"center\"><b>Bertambah/(Berkurang)</b></td>        
                        </tr>
 
                        <tr>
 		                    <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\"  align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"16%\" colspan=\"3\" style=\"font-weight:bold;\"   align=\"center\">Rincian Perhitungan</td>
                            <td width=\"10%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">Jumlah </br> (Rp.)</td>
                            <td width=\"15%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">(Rp.)</td>
                            <td width=\"5%\" rowspan=\"2\" style=\"font-weight:bold;\" align=\"center\">%</td>
                        </tr>                            
    
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>
 		                    <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"3%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"10%\" align=\"center\">Tarif / Harga</td>

                        </tr>                            
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9) </td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10 - 6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td colspan=\"12\" style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";
				$angg_n1 = 'nilai';
                $angg_n2 = 'nilai_sempurna';
                $rangg_n1 = 'total';        
                $rangg_n2 = 'total_sempurna';
                $v1 = 'volume1';
                $v2 = 'volume_sempurna1';
                $s1 = 'satuan1';
                $s2 = 'satuan_sempurna1';
                $h1 = 'harga1';
                $h2 = 'harga_sempurna1';
                
				$sql1 ="SELECT * FROM(
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE right(a.kd_kegiatan,5)='00.04' AND  $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama, 
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '2' AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.04'
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
                            UNION ALL  
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga,SUM(a.$angg_n2) AS nilai2,
                            '3' AS id FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
                            UNION ALL 
                            SELECT 0 header,0 no_po,LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
                            UNION ALL 
                            SELECT 0 header,0 no_po,a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,
                            0 AS volume,' 'AS satuan,0 AS harga,SUM(a.$angg_n1) AS nilai,
                            0 AS volume2,' 'AS satuan2,0 AS harga2,SUM(a.$angg_n2) AS nilai2,
                            '5' AS id FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.04' 
                            AND  $a a.$skpd$b='$id'  GROUP BY a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,
                            0 AS volume,' ' AS satuan,0 AS harga,SUM(a.$rangg_n1) AS nilai,
                            0 AS volume2,' ' AS satuan2,0 AS harga2,SUM(a.$rangg_n2) AS nilai2,
                            '6' AS id FROM trdpo a
                            LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
                            WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(a.no_trdrka,28,5)='00.04' 
                            GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
                            UNION ALL
                            SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,
                            a.$v1 AS volume,a.$s1 AS satuan,a.$h1 AS harga,a.$rangg_n1 AS nilai,
                            a.$v2 AS volume2,a.$s2 AS satuan2,a.$h2 AS harga2,a.$rangg_n2 AS nilai2,
                            '6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka$b='$id' AND SUBSTRING(no_trdrka,28,5)='00.04' AND (header='0' or header is null)
                        )a ORDER BY a.rek1,a.id,a.no_po";
                
                $totp = 0;
                $totp2 = 0;
                $query = $this->db->query($sql1);
                if ($query->num_rows() > 0){                                                 				                                 
                    foreach ($query->result() as $row){
                        $rek=$row->rek;
                        $reke=$this->dotrek($rek);
                        
                        if($rek==' '){ 
                            $uraian='- ' .$row->nama;
                            $volum=$row->volume;
                            $volum2=$row->volume2;                            
                        }else{
                            $uraian=$row->nama;
                            $volum=' ';
                            $volum2=' ';
                        }
                        
                        $sat=$row->satuan;
                        $sat2=$row->satuan2;

                        $nila = $row->nilai;
                        $nila2 = $row->nilai2;
                        
                        if (strlen($row->rek1)==1){
                           $totp = $totp +  $nila;
                           $totp2 = $totp2 +  $nila2;
                        }
                        
                        $selisih = $this->rp_minus($nila2 - $nila);
                        if($nila != 0){
                            $persen = $this->rp_minus((($nila2 - $nila)/$nila)*100);
                        }else{
                            if($nila2 == 0){
                                $persen = $this->rp_minus(0);
                            }else{
                                $persen = $this->rp_minus(100);
                            }
                        } 

                        
                        $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
                        $hrg2= empty($row->harga2) || $row->harga2 == 0 ? '' :number_format($row->harga2,2,',','.');

                        $nila= number_format($nila,"2",",",".");
                        $nila2= number_format($nila2,"2",",",".");
                        
                        if (strlen($row->rek1)>6) {
                            $bold = "";
                            $fontr = "font-size: ".$font." px;";                        
                        }else{
                            $bold = "font-weight:bold;";
                            $fontr = "font-size: ".$font1." px;";
                        }

						$cRet    .= " <tr>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"left\">$reke</td>                                     
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" > $uraian </td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$volum2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" align=\"center\">$sat2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$hrg2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$nila2</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$selisih</td>
                                         <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"right\">$persen</td>

                                     </tr>
                                     ";
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>4.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>PENDAPATAN</b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" lign=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     </tr>

                                     ";
					
				}



			
                    $totp=number_format($totp,"2",",",".");
                    $totp2=number_format($totp2,"2",",",".");

                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"><strong>Jumlah Pendapatan</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"3\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totp2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                </tr>";


        $cRet    .= "</table>";
     
     if($ttdsetda == '0'){
         $jdlnip3 = '';
         $jabatan3 = '';
         $nama3 = '';
         $pangkat3 = '';
         $nip3='';        
     }else{   
         $jdlnip3 = 'Menyetujui,';
         $jabatan3 = 'Sekretaris Daerah Provinsi Kalimantan Barat';
         $nama3 = 'Dr. M. Zeet Hamdy Assovie, MTM';
         $pangkat3 = 'Pembina Utama';
         $nip3='19620815 1991031011';
     }
     $cRet .="<table style=\"border-collapse:collapse;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;font-size:10 px;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"1\" cellpadding=\"4\">";

							 $cRet .=" 
                                            <tr>
                                                <td width=\"70%\" colspan=\"2\">&emsp;
                                                <td width=\"30%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>

								            <tr>

								                <td width=\"35%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"30%\" align=\"center\">$jdlnip3 
								                    <br>$jabatan3
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                				                    <br><b><u>$nama3</u></b>
                                                    <br>$pangkat3
                				                    <br>$nip3
								                </td>
								                <td width=\"30%\" align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                                                    <p>&nbsp;</p>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>  
                                </table>";                                       
        $cRet    .= "</table>"; 


        $qtriw = " SELECT distinct isnull( a.triw1_sempurna,0) AS triw1,isnull( a.triw2_sempurna,0) AS triw2,isnull( a.triw3_sempurna,0) 
                                AS triw3,isnull( a.triw4_sempurna,0) AS triw4  FROM trskpd a join trdrka b on a.kd_kegiatan=b.kd_kegiatan
                                WHERE RIGHT (a.kd_kegiatan,5)='00.04' AND $a a.$skpd$b='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triwa1 = number_format($triw1,2,',','.');
        $triwa2= number_format($triw2,2,',','.');
		$triwa3= number_format($triw3,2,',','.');
		$triwa4= number_format($triw4,2,',','.');
        $totala = number_format($total,2,',','.');

        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font1 px;border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" width=\"40%\" colspan=\"3\" align=\"center\">Rencana Pendapatan per Triwulan</td>
                        <td style=\"border-left: solid 1px black;border-bottom: solid 1px black;\" width=\"60%\" colspan=\"6\" align=\"center\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                    </tr>
                    <tr>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" colspan=\"3\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">N0</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"center\">Nama</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">NIP</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">JABATAN</td>
                        <td style=\"border-bottom: solid 1px black;\" width=\"20%\" align=\"center\" colspan=\"2\">TANDA TANGAN</td>
                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" width=\"8%\" >Triwulan I</td>
                        <td style=\"vertical-align:top;\" width=\"2%\" >Rp</td>
                        <td style=\"vertical-align:top; border-right: solid 1px black;\" width=\"30%\" align=\"right\">$triwa1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >ANSELMUS, S.Sos</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KEPALA BIDANG ANGGARAN</td>
                        <td style=\"vertical-align:top;\" width=\"10%\">1.</td>
                        <td width=\"10%\"></td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\"  >Triwulan II</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >GURUH PARYONO, S.IP.,M.Si</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KABID MONEVDAL BAPPEDA</td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">2.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Triwulan III</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa3</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">3</td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td >3.</td>
                        <td ></td>

                    </tr>
                    <tr>
                        <td  style=\"vertical-align:top;\" >Triwulan IV</td>
                        <td  style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triwa4</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">4</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">4.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Jumlah </td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\" >$totala</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\"></td>
                        <td  style=\"border-right: solid 1px black;\"></td>
                        <td ></td>
                        <td ></td>

                    </tr>

                  ";
        $cRet .= "</table>";

       $cRet    .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-0 Penyempurnaan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','','','',3);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//END DPPA 1

	
//DPPA 21 Sempurna
	function ctk_dppa21_sempurna(){
        $data['page_title']= 'Cetak DPPA 2.1';
        $this->template->set('title', 'Cetak DPPA 2.1');   
        $this->template->load('template','anggaran/rka/ctk_dppa21_sempurna',$data) ; 
    }


    function preview_dppa21_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);

       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
		$ttd1 = str_replace('a',' ',$ttd1);	
		$ttd2 = str_replace('a',' ',$ttd2);        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
					$jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan1 = str_replace('PENGGUNA','',$jabatan1);
					$jabatan1 = str_replace('ANGGARAN','',$jabatan1);
					$jabatan1 = str_replace('Pengguna','',$jabatan1);
					$jabatan1 = str_replace('Anggaran','',$jabatan1);
 
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);

					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
 
				}
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        
        $k2 = substr($kd_org,5,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SKPD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - <br>SKPD - 2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" ><strong>Latar belakang penyempurnaan/dianggarkan<br>dalam penyempurnaan APBD</strong></td>
                    </tr>          
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>Rincian Dokumen Pelaksanaan Anggaran <br>Belanja Tidak Langsung Satuan Kerja Perangkat Daerah</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:12;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >

					 <tr>
						<td rowspan=\"3\"  width=\"5%\" align=\"center\"><b>KODE REKENING</b></td>                            
                        <td rowspan=\"3\"  width=\"25%\" align=\"center\"><b>Uraian</b></td>
						<td colspan=\"4\"  width=\"28%\" align=\"center\"><b>Sebelum Perubahan</b></td>
						<td colspan=\"4\"  width=\"28%\" align=\"center\"><b>Setelah Perubahan</b></td>
						<td colspan=\"2\"  width=\"15%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
					 </tr>
						<tr>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Rincian Perhitungan</b></td>
                            <td rowspan=\"2\" width=\"10%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
							<td colspan=\"3\" width=\"18%\" align=\"center\"><b>Rincian Perhitungan</b></td>
							<td rowspan=\"2\" width=\"10%\" align=\"center\"><b>Jumlah (Rp.)</b></td>
							<td rowspan=\"2\" style=\"font-weight:bold;\" width=\"10%\" align=\"center\">(Rp.)</td>
                            <td rowspan=\"2\" style=\"font-weight:bold;\" width=\"5%\" align=\"center\">%</td>
						</tr>
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">Tarif / Harga</td>
							<td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"9%\" align=\"center\">Tarif / Harga</td>
							
                        </tr>                            
                        <tr>
							<td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
							<td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
							<td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9)</td>
							<td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10-6</td>
							<td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;border-bottom: solid 1px black;\"  colspan=\"12\"></td>
                         </tr>
                     </tfoot>   
                        ";
/*
                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
                            a.satuan1 AS satuan,a.harga1  AS harga,a.total AS nilai,'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id a";
*/

			IF ($id == $this->ppkd){					
				$sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
							0 as volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,							
                            0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan, 
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
                            0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
							a.volume_sempurna1 AS volume_sempurna1,
                            a.satuan1 AS satuan,
							a.satuan_sempurna1 AS satuan_sempurna1,
							a.harga1  AS harga,
							a.harga_sempurna1 AS harga_sempurna1,
							a.total AS nilai,
							a.total_sempurna AS nilai_sempurna,
							'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' 
							UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.penerima+' ,alamat:'+a.alamat AS nama,0 AS volume,
							0 AS volume_sempurna,
                            '' AS satuan,
							'' AS satuan_sempurna,
							0  AS harga,
							0 AS harga_sempurna,
							a.total AS nilai,
							a.total_sempurna AS nilai_sempurna,
							'6' AS id FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51'
							) 
                        a ORDER BY a.rek1,a.id";
			}else{
				if($id == $this->ppkd1){
					$sql1="SELECT * FROM(
                            SELECT
								0 header,
								0 no_po,
								LEFT (a.kd_rek5, 1) AS rek1,
								LEFT (a.kd_rek5, 1) AS rek,
								b.nm_rek1 AS nama,
								0 AS volume,
								0 as volume_sempurna,
								' ' AS satuan,
								' ' AS satuan_sempurna,
								0 AS harga,
								0 AS harga_sempurna,
								SUM (a.nilai) AS nilai,
								SUM (a.nilai_sempurna) AS nilai_sempurna,
								'1' AS id
							FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT
				0 header,
				0 no_po,
				LEFT (a.kd_rek5, 2) AS rek1,
				LEFT (a.kd_rek5, 2) AS rek,
				b.nm_rek2 AS nama,
				0 AS volume,
				0 AS volume_sempurna,
				' ' AS satuan,
				' ' AS satuan_sempurna,
				0 AS harga,
				0 AS harga_sempurna,
				SUM (a.nilai) AS nilai,
				SUM (a.nilai_sempurna) AS nilai_sempurna,
				'2' AS id
							FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT
					0 header,
					0 no_po,
					LEFT (a.kd_rek5, 3) AS rek1,
					LEFT (a.kd_rek5, 3) AS rek,
					b.nm_rek3 AS nama,
					0 AS volume,
					0 AS volume_sempurna,
					' ' AS satuan,
					' ' AS satuan_sempurna,
					0 AS harga,
					0 AS harga_sempurna,
					SUM (a.nilai) AS nilai,
					SUM (a.nilai_sempurna) AS nilai_sempurna,
					'3' AS id			
							FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT
						0 header,
						0 no_po,
						LEFT (a.kd_rek5, 5) AS rek1,
						LEFT (a.kd_rek5, 5) AS rek,
						b.nm_rek4 AS nama,
						0 AS volume,
						0 AS volume_sempurna,
						' ' AS satuan,
						' ' AS satuan_sempurna,
						0 AS harga,
						0 AS harga_sempurna,
						SUM (a.nilai) AS nilai,
						SUM (a.nilai_sempurna) AS nilai_sempurna,
						'4' AS id
					
							FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
						SELECT
							0 header,
							0 no_po,
							a.kd_rek5 AS rek1,
							a.kd_rek5 AS rek,
							b.nm_rek5 AS nama,
							0 AS volume,
							0 AS volume_sempurna,
							' ' AS satuan,
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM (a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'5' AS id
						                            


							FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5
							union all
							
							SELECT * FROM (SELECT
										b.header,
										b.no_po,
										RIGHT (a.no_trdrka, 7) AS rek1,
										' ' AS rek,
										b.uraian AS nama,
										0 AS volume,
										0 AS volume_sempurna,
										' ' AS satuan,
										' ' AS satuan_sempurna,
										0 AS harga,
										0 AS harga_sempurna,
										SUM (a.total) AS nilai,
										SUM (a.total_sempurna) AS nilai_sempurna,
										'6' AS id
									
							FROM trdpo a
							LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
							WHERE LEFT(a.no_trdrka,10)='$id' AND  SUBSTRING(a.no_trdrka,28,5)='00.51' and substring(a.no_trdrka,34,3) not in ('514','515')
							GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
						
                            UNION ALL 
                            SELECT
									0 header,
									a.no_urut [no_po],
									RIGHT (a.no_trdrka, 7) AS rek1,
									'' AS rek,
									a.penerima + ' ,alamat:' + a.alamat AS nama,
									0 AS volume,
									0 AS volume_sempurna,
									'' AS satuan,
									'' AS satuan_sempurna,
									0 AS harga,
									0 AS harga_sempurna,
									a.total AS nilai,
									a.total_sempurna AS nilai_sempurna,
									'6' AS id
								
							FROM trdalokasi a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' and 
							substring(no_trdrka,34,3) in ('514','515')
							union all
							SELECT
										a.header,
										a.no_po,
										RIGHT (a.no_trdrka, 7) AS rek1,
										'' AS rek,
										a.uraian AS nama,
										a.volume1 AS volume,
										a.volume_sempurna1 AS volume_sempurna1,
										a.satuan1 AS satuan,
										a.satuan_sempurna1 AS satuan_sempurna1,
										a.harga1 AS harga,
										a.harga_sempurna1 AS harga_sempurna1,
										a.total AS nilai,
										a.total_sempurna AS nilai_sempurna,
										'6' AS id
									
							
							FROM trdpo a 
							WHERE LEFT(a.no_trdrka$b='$id' AND 
							SUBSTRING(no_trdrka,28,5)='00.51' and 
							substring(no_trdrka,34,3) not in ('514','515') 
							) 
                        a ORDER BY a.rek1,a.id,a.no_po ";
				}else{
					$sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,
							0 as volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
                            0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.51' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan,
							' ' AS satuan_sempurna,
                            0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,
							0 AS volume_sempurna,
							' 'AS satuan, 
							' ' AS satuan_sempurna,
							0 AS harga,
							0 AS harga_sempurna,
							SUM(a.nilai) AS nilai,
							SUM (a.nilai_sempurna) AS nilai_sempurna,
							'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            UNION ALL 
                            SELECT RIGHT(a.no_trdrka,7) AS rek1,'' AS rek,a.uraian AS nama,a.volume1 AS volume,
							a.volume_sempurna1 AS volume_sempurna1,
                            a.satuan1 AS satuan,
							a.satuan_sempurna1 AS satuan_sempurna1,
							a.harga1  AS harga,
							a.harga_sempurna1 AS harga_sempurna1,
							a.total AS nilai,
							a.total_sempurna AS nilai_sempurna,
							'6' AS id FROM trdpo a 
                            WHERE LEFT(a.no_trdrka$b='$id' AND 
                            SUBSTRING(no_trdrka,28,5)='00.51' ) 
                        a ORDER BY a.rek1,a.id";
				}
			}		

                $totp = 0;
				$totps = 0;
                $query = $this->db->query($sql1);
                  if ($query->num_rows() > 0){                                  
               
			   
				                                 
                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $reke=$this->dotrek($rek);
                    
                    if($rek==''){ 
                        $uraian='- ' .$row->nama;
                        $volum=$row->volume;
						$volume_sempurna=$row->volume_sempurna;
                    }else{
                        $uraian=$row->nama;
                        $volum=' ';
						$volume_sempurna=' ';
                    }
                    
					if ($reke<>''){
                        $volum='';
						$volume_sempurna='';
                    }
                    else{
                        $volum=empty($row->volume) || $row->volume == 0 ? '' :number_format($row->volume,2,',','.');
						$volume_sempurna=empty($row->volume_sempurna) || $row->volume_sempurna == 0 ? '' :number_format($row->volume_sempurna,2,',','.');
                    }
					
                    $sat=$row->satuan;
					$satuan_sempurna=$row->satuan_sempurna;
                    $hrg= empty($row->harga) || $row->harga == 0 ? '' :number_format($row->harga,2,',','.');
					$hrg_sempurna= empty($row->harga_sempurna) || $row->harga_sempurna == 0 ? '' :number_format($row->harga_sempurna,2,',','.');
					$nil_ = $row->nilai;
					$nil_se_ = $row->nilai_sempurna;
                    $nila= number_format($row->nilai,"2",",",".");
					$nilai_sempurna= number_format($row->nilai_sempurna,"2",",",".");
                    
					$ab = $nil_se_ - $nil_;
					$jml1 = $this->rp_minus($ab);
					
					if($nil_ != 0 AND $nil_se_ !=0){
                        $persen = (($nil_se_-$nil_)/$nil_)*100;
						$persen1 = $this->rp_minus($persen);
                    }else if($nil_ == 0 AND $nil_se_ ==0){
                        $persen = 0;
						$persen1 = $this->rp_minus($persen);
                    } else {
						$persen = 100;
						$persen1 = $this->rp_minus($persen);
					}
					
					
					
                    if (strlen($row->rek1)==1){
                       $totp = $totp +  $row->nilai;
					   $totps = $totps +  $row->nilai_sempurna;
                    }
					
					

					
                    if (strlen($row->rek1)>6) {
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"left\">$reke</td>                                     
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" > $uraian </td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$volume_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"center\">$satuan_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$hrg_sempurna</td>
                                     <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$nilai_sempurna</td>
									 <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$jml1</td>
									 <td style=\"vertical-align:top;border-top: none;border-bottom: none;\" align=\"right\">$persen1</td></tr>
									 ";
					}else{
						$cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><strong>$reke</strong></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$uraian</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$sat</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nila</strong></td>
									 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong></strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>$satuan_sempurna</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$hrg_sempurna</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$nilai_sempurna</strong></td>
									 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$jml1</strong></td>
									  <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$persen1</strong></td>
                                     ";
					}
				}
					  }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>BELANJA DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">".number_format(0,"2",",",".")."</td>
									 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
									<td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"></td>
									 
									 </tr>
                                     ";
					
				}


				   $cRet .= "<tr>
                                <td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
                                <td align=\"right\">&nbsp;</td>
								<td>&nbsp;</td>
                                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
				                <td>&nbsp;</td>
								<td>&nbsp;</td>
                             </tr>";
      
                   $totp=number_format($totp,"2",",",".");
				   $totps=number_format($totps,"2",",",".");
                   
                    $cRet    .=" <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH BELANJA</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\"><strong>$totp</strong></td>
									 <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\"  align=\"right\">&nbsp;</td>
									<td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>$totps</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" >&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">&nbsp;</td>
								</tr>";

					$cRet .=" 	<tr>
									<td  width=\"100%\" align=\"left\" colspan=\"12\">
										<table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"40%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    &nbsp;<br>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    &nbsp;<br>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>
										</table>
									</td>		
								</tr></table>";

        $qtriw = "SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_sempurna,0) AS triwa1,isnull( a.triw2_sempurna,0) AS triwa2,isnull( a.triw3_sempurna,0) AS triwa3,isnull( a.triw4_sempurna,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE RIGHT(kd_kegiatan,5)='00.51' AND $a$skpd$b='$id'
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE RIGHT(a.kd_kegiatan,5)='00.51' AND $a a.$skpd$b='$id'";
/*                                
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');

        $cRet  .=" <tr>
					<td style=\"border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"left\" colspan=\"12\">
					<table  border=\"0\" width=\"100%\">
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan I</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw1</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td align=\"left\">&emsp;Triwulan II</td>
                        <td align=\"left\">&emsp;Rp</td>                        
                        <td align=\"right\">&emsp;$triw2</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan III</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$triw3</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"left\">&emsp;Triwulan IV</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
                    <tr>
                        <td width=\"20%\" align=\"right\">&emsp;Jumlah</td>
                        <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                        <td width=\"20%\" align=\"right\">&emsp;$total</td>
                        <td width=\"40%\" align=\"left\">&emsp;</td>

                    </tr>
					</table>
					</td>		
				</tr>                    
                </table>";    
*/
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
				            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
				            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
				            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
	        $triwa3= 0;
	        $triwa4= 0;
	        $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
		$triwa3= number_format($triwa3,2,',','.');
		$triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\">
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" width=\"40%\" colspan=\"5\" align=\"center\">Rencana Penarikan Dana per Triwulan</td>
                        <td style=\"border-left: solid 1px black;border-bottom: solid 1px black;\" width=\"60%\" colspan=\"6\" align=\"center\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                    </tr>
                    <tr>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" colspan=\"3\" align=\"center\">Sebelum</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" colspan=\"2\" align=\"center\">Setelah</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">N0</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"center\">Nama</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">NIP</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">JABATAN</td>
                        <td style=\"border-bottom: solid 1px black;\" width=\"20%\" align=\"center\" colspan=\"2\">TANDA TANGAN</td>
                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" width=\"8%\" >Triwulan I</td>
                        <td style=\"vertical-align:top;\" width=\"2%\" >Rp</td>
                        <td style=\"vertical-align:top; border-right: solid 1px black;\" width=\"10%\" align=\"right\">$triw1</td>
                        <td style=\"vertical-align:top;\"  width=\"5%\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" width=\"15%\" align=\"right\">$triwa1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >ANSELMUS, S.Sos</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KEPALA BIDANG ANGGARAN</td>
                        <td style=\"vertical-align:top;\" width=\"10%\">1.</td>
                        <td width=\"10%\"></td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\"  >Triwulan II</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triw2</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >GURUH PARYONO, S.IP.,M.Si</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KABID MONEVDAL BAPPEDA</td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">2.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Triwulan III</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triw3</td>
                        <td style=\"vertical-align:top;\">Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa3</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">3</td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td >3.</td>
                        <td ></td>

                    </tr>
                    <tr>
                        <td  style=\"vertical-align:top;\" >Triwulan IV</td>
                        <td  style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                        <td  style=\"vertical-align:top;\">Rp</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triwa4</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">4</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">4.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Jumlah </td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\" >$total</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td   style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$totala</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\"></td>
                        <td  style=\"border-right: solid 1px black;\"></td>
                        <td ></td>
                        <td ></td>

                    </tr>

                  ";
        $cRet .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-21</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//End DPPA 21 Sempurna
	
	
//DPPA 22 Sempurna 
	function ctk_dppa22_sempurna(){
        $data['page_title']= 'Cetak DPPA 2.2 Penyempurnaan';
        $this->template->set('title', 'Cetak DPPA 2.2 Penyempurnaan');   
        $this->template->load('template','anggaran/rka/ctk_dppa22_sempurna',$data) ; 
    }
    
      function preview_dppa22_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
        $chkpa = $this->uri->segment(5);
        $cell = $this->uri->segment(6);
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];

		$ttd1 = str_replace('a',' ',$ttd1);	
		$ttd2 = str_replace('a',' ',$ttd2);		
        

        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1' ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip)  ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;

                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'  ";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('KUASA','',$jabatan2);


					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
					$jabatan2 = str_replace('Kuasa','',$jabatan2);

                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        


     
		
        $cRet='';

     $cRet .="<table style=\"border-collapse:collapse;font-size:18;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">

                    <tr> <td  style=\"border-collapse:collapse;\"  width=\"15%\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td width=\"66%\" align=\"center\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-collapse:collapse;font-size:16;border-left: solid 1px black\" width=\"19%\" rowspan=\"3\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD <br><h3>2.2</h3></strong></td>
                    </tr>
                    <tr> 
                         <td style=\"border-top: solid 1px black;\" >&nbsp;</td>   
                         <td align=\"center\"  style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                         <td></td>
                    </tr>
                    <tr>
                        <td >&nbsp;</td>
                         <td align=\"center\"><strong>TAHUN ANGGARAN $thn</strong></td>
                         <td></td>
                    </tr>

                  </table>";        

      


       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"15%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"82%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td ><strong>&emsp;Unit Organisasi</strong></td>
                        <td ><strong >: </strong></td>
                        <td > <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td ><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td ><strong >: </strong></td>
                        <td ><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14px;\" colspan=\"3\" align=\"center\"><strong>REKAPITULASI ANGGARAN BELANJA LANGSUNG BERDASARKAN PROGRAM DAN KEGIATAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
        
        $font = 11;
        $font1 = $font - 1;
        
        $cRet .= "<table style=\"border-collapse:collapse;vertical-align:top;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">

                     <thead >                       
                        <tr><td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Kode<br>Program</b></td>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>Kode<br>Kegiatan</b></td>  
                            <td width=\"20%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"11%\"  rowspan=\"2\" align=\"center\"><b>Lokasi Kegiatan</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:9px;\"  align=\"center\"><b>Target Kinerja (Kuantitatif)</b></td>
                            <td width=\"6%\"  rowspan=\"2\" style=\"font-size:10px;\"  align=\"center\"><b>Sumber Dana</b></td>
                            <td width=\"22%\" colspan=\"2\" align=\"center\"><b>Jumlah (Rp)</b></td>
                            <td width=\"15%\" colspan=\"2\" align=\"center\"><b>Bertambah/(Berkurang)</b></td>
                        </tr>
                        <tr>
 		                    <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Sebelum</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">Setelah</td>
                            <td style=\"font-weight:bold;\" width=\"11%\" align=\"center\">(Rp)</td>
                            <td style=\"font-weight:bold;\" width=\"4%\" align=\"center\">%</td>
                        </tr>    
                        <tr>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">1</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">2</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">3</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">4</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">5</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">6</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">7</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">8</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">9 = 8 - 7</td>
                            <td style=\"font-weight:bold;border-bottom: solid 2px black;\" align=\"center\">10</td>
                         </tr>
                     </thead>
                     <tfoot >
                        <tr>
                            <td width=\"100%\" style=\"border-top: solid 1px black;border-right: none;border-bottom: none;border-left: none;\" colspan=\"10\"></td>                         
                         </tr>
                     </tfoot> 
                   
                        ";

                $sql1="SELECT 
                        	a.kd_program AS prog,
                        	a.kd_program AS prog1,
                        	' ' AS giat,
                        	a.nm_program AS uraian,
                        	' ' AS lokasi,
                        	' ' AS target,
                        	'' [sumber_dana],
                        	isnull(sum(nilai),0) [susun],isnull(sum(nilai_sempurna),0) [nilai2]
                        FROM
                        	trdrka x
                        LEFT JOIN trskpd a ON a.kd_skpd = x.kd_skpd
                        AND x.kd_kegiatan = a.kd_kegiatan
                        WHERE
                        	RIGHT (a.kd_program, 2) <> '00'
                        AND $a x.kd_skpd$b = '$id'
                        GROUP BY
                        	a.kd_program,a.nm_program
                        
                        UNION
                        SELECT
                        		a.kd_program AS prog,
                        		' ' AS prog1,
                        		a.kd_kegiatan AS giat,
                        		a.nm_kegiatan AS uraian,
                        		a.lokasi AS lokasi,
                        		a.tk_kel_sempurna AS target,
                        		isnull(x.sumber,'') [sumber_dana],
                        		isnull(sum(nilai),0) [susun],isnull(sum(nilai_sempurna),0) [nilai2]	
                        	FROM
                        		trdrka x
                        		LEFT JOIN trskpd a ON a.kd_skpd=x.kd_skpd AND x.kd_kegiatan=a.kd_kegiatan
                        	WHERE
                        		RIGHT(a.kd_program,2)<>'00' AND
                        		$a x.kd_skpd$b='$id'
                        	GROUP BY
                        		a.kd_program,a.kd_kegiatan,a.nm_kegiatan,lokasi,tk_kel_sempurna,a.triw1,a.triw2,a.triw3,a.triw4,x.sumber 
                        					ORDER BY prog,giat  
						";
  

                $totnilai = 0; 
                $tnilai2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);
                 //$query = $this->skpd_model->getAllc();
                                 
                foreach ($query->result() as $row)
                {
                    $prog=rtrim($row->prog1);
                    $giat=rtrim($row->giat);
                    $uraian=rtrim($row->uraian);
                    $lokasi=rtrim($row->lokasi);
                    $target=rtrim($row->target);
                    $sumber=rtrim($row->sumber_dana);
                    $nilai = $row->susun;
                    $nilai2 = $row->nilai2;
                    $selisih = $nilai2-$nilai;
                    if($nilai != 0){
                        $persen = (($nilai2-$nilai)/$nilai)*100;
                    }else{
                        $persen = 100;
                    } 
                    //iif(apbdsusun <> 0 ,((abs(apbdubah-apbdsusun))/apbdsusun)*100,100) 
                    
                    if($prog != ''){
                        $bold = 'font-weight:bold;';
                        $fontr = $font1;
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $totnilai = $totnilai +  $nilai;
                        $tnilai2 = $tnilai2 + $nilai2;
                        $tselisih = $tselisih + $selisih;
                    }else{
                        $bold ='';
                        $fontr = $font;
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                    }

                    $nilai1 = number_format($nilai,2,',','.');
                    $nilai2a = number_format($nilai2,2,',','.');
                    $selisih = $this->rp_minus($selisih);
                    $persen = $this->rp_minus($persen);

                      $cRet    .= " <tr>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \"  align=\"left\">$prog</td>                                     
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$giat</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$uraian</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" >$lokasi</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$target</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"left\">$sumber</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai1</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$nilai2a</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;$latas $lbawah $bold \" align=\"right\">$persen</td>
                                    </tr> 
                                    
                                   
                                    ";
 
                }

                if($totnilai != 0){
                    $tpersen = (($tnilai2-$totnilai)/$totnilai)*100;
                }else{
                    $tpersen = 100;
                } 
 
                $totnilai = number_format($totnilai,2,',','.');
                $tnilai2 = number_format($tnilai2,2,',','.');
                $tselisih = $this->rp_minus($tselisih);
                $tpersen = $this->rp_minus($tpersen);
                
                 $cRet    .= " <tr>
                                    <td colspan=\"6\" style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\"> JUMLAH</td>                                     
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$totnilai</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tnilai2</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tselisih</td>
                                    <td style=\"vertical-align:top;font-weight:bold;border-top: solid 1px black;border-bottom: none;\" align=\"right\">$tpersen</td>
                                </tr>
                                 ";
            

 



							 $cRet .="<tr>
                                        <td colspan=\"10\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,</td>
                                                </tr>
                                                <tr>
    								                <td align=\"center\" valign=\"top\">$jdlnip1
    								                    <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><ins>$nama1</ins></b>
                                                        <br>$pangkat1
                    				                    <br>$nip1 
    								                </td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\" valign=\"top\">&nbsp;&nbsp;
    								                    <br>&nbsp;&nbsp;&nbsp;
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b>&nbsp;&nbsp;&nbsp;&nbsp;</b>
                                                        <br>&nbsp;&nbsp;&nbsp;&nbsp;
                    				                    <br>&nbsp;&nbsp;&nbsp;
    								                </td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\">$jdlnip2  
    								                    <br>$jabatan2
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><u>$nama2</u></b>
                                                        <br>$pangkat2
                    				                    <br>$nip2 
    								                </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";

/*							 $cRet .="<tr>
                                        <td colspan=\"10\">
                                            <table border=\"1\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,</td>
                                                </tr>
                                                <tr>
    								                <td align=\"center\" valign=\"top\">$jdlnip1</td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\" valign=\"top\">Menyetujui,</td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\">$jdlnip2</td>
                                                </tr>
                                                <tr>
    								                <td align=\"center\" valign=\"top\">$jabatan1</td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\" valign=\"top\">SEKRETARIS DAERAH PROVINSI KALIMANTAN BARAT</td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\" valign=\"top\">$jabatan2</td>
                                                </tr>
                                                <tr>
    								                <td height=\"50px\">&emsp;</td>
                                                    <td height=\"50px\">&emsp;</td>
    								                <td height=\"50px\">&emsp;</td>
                                                    <td height=\"50px\">&emsp;</td>
    								                <td height=\"50px\">&emsp;</td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>";
*/

        $cRet .="</table>";
 
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-22 Penyempurnaan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

//END DPPA 22 Sempurna

//DPPA 221 Sempurna	
    function load_ttd_ta(){
	
        $query1 = $this->db->query(" select nip,nama,jabatan,pangkat from ms_ttd where kode='TA' ");  
        $result = array();
        $ii = 0;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'nip' => $resulte['nip'],  
                        'nama' => $resulte['nama'],						
                        'jabatan' => $resulte['jabatan'],
                        'pangkat' => $resulte['pangkat']
                        );
                        $ii++;
        }
           
           //return $result;
		   echo json_encode($result);	
	}

    function dppa221_sempurna(){	
	 $this->index('0','ms_skpd','kd_skpd','nm_skpd','DPPA 221 PENYEMPURNAAN','dppa221_sempurna','');
	}

    function daftar_kegiatan1_sempurna($offset=0){
		$id = $this->uri->segment(3);
        $data['page_title'] = "DAFTAR KEGIATAN PENYEMPURNAAN";
		
		$total_rows = $this->rka_model->get_count($id);
  
		// pagination        
 
		$config['base_url']		= site_url("rka/daftar_kegiatan1_sempurna/$id");
		$config['total_rows'] 	= $total_rows;
		$config['per_page'] 	= '10';
		$config['uri_segment'] 	= 3;
		$config['num_links'] 	= 5;
		$config['full_tag_open'] = '<ul class="page-navi">';
		$config['full_tag_close'] = '</ul>';
		$config['num_tag_open'] = '<li>';
		$config['num_tag_close'] = '</li>';
		$config['cur_tag_open'] = '<li class="current">';
		$config['cur_tag_close'] = '</li>';
		$config['prev_link'] = '&lt;';
		$config['prev_tag_open'] = '<li>';
		$config['prev_tag_close'] = '</li>';
		$config['next_link'] = '&gt;';
		$config['next_tag_open'] = '<li>';
		$config['next_tag_close'] = '</li>';
		$config['last_link'] = 'Last';
		$config['last_tag_open'] = '<li>';
		$config['last_tag_close'] = '</li>';
		$config['first_link'] = 'First';
		$config['first_tag_open'] = '<li>';
		$config['first_tag_close'] = '</li>';
		$limit            		= $config['per_page'];  
		$offset         		= $this->uri->segment(4);  
		$offset         		= ( ! is_numeric($offset) || $offset < 1) ? 0 : $offset;  
		  
		if(empty($offset))  
		{  
			$offset=0;  
		}
	
		$data['list'] 		= $this->rka_model->getAll($limit, $offset,$id);
		$data['num']		= $offset;
		$data['total_rows'] = $total_rows;
		$data['kode_skpd'] = $id;
		
				$this->pagination->initialize($config);
		
		$this->template->set('title', 'Master Data kegiatan');
		$this->template->load('template', 'anggaran/rka/list_dppa_sempurna', $data);
	}
 
    function preview_dppa221_sempurna(){
       $id = $this->uri->segment(3);
       $giat = $this->uri->segment(4);
       $cetak = $this->uri->segment(5);
       $chkpa = $this->uri->segment(6);
       $cell = $this->uri->segment(7); 
       
        
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];
        $ttd3= $_REQUEST['ttd3'];
		$ttd1 = str_replace('a',' ',$ttd1);	
		$ttd2 = str_replace('a',' ',$ttd2);
		$ttd3 = str_replace('a',' ',$ttd3);
		
		
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = $this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
					$jabatan2 = str_replace('Kuasa','',$jabatan2);
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					$jabatan2 = str_replace('KUASA','',$jabatan2);


					
                }
                
                if ($chkpa==1){
                    $jdlnip2 = 'Pengguna Anggaran,';  
                }else{
                    $jdlnip2 = 'Kuasa Pengguna Anggaran,';  
                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }        


       if ($ttd3<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd3'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                                      
                    $nip3=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat3=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama3= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan3  = empty($rowttd->jab) ? '': $rowttd->jab;
					//$jabatan3 = str_replace('Pengguna','',$jabatan2);
					//$jabatan3 = str_replace('Anggaran','',$jabatan2);

                }
                
        }
        else{
                    $jdlnip3 = '';
                    $nip3='' ;
                    $pangkat3='';
                    $nama3= '';
                    $jabatan3 = '';
        }        



		
         $sqlorg="SELECT f.kd_urusan,f.nm_urusan,a.kd_skpd,e.nm_skpd,a.kd_program,a.nm_program,a.kd_kegiatan,c.nm_kegiatan,SUM(d.nilai) AS nilai,a.tu_capai,a.tu_mas,a.tu_kel,a.tu_has,
                a.tk_capai,a.tk_mas,a.tk_kel,a.tk_has,a.lokasi,rtrim(d.sumber) [sumber] ,a.sasaran_giat,a.ang_lalu,a.waktu_giat,a.tu_capai_sempurna,
                a.tu_mas_sempurna,a.tu_kel_sempurna,a.tu_has_sempurna,a.tk_capai_sempurna,a.tk_mas_sempurna,a.tk_kel_sempurna,a.tk_has_sempurna 
                FROM trskpd a 
                INNER JOIN m_giat c ON a.kd_kegiatan1=c.KD_KEGIATAN
                INNER JOIN trdrka d ON a.kd_kegiatan=d.kd_kegiatan
                INNER JOIN ms_skpd e ON a.kd_skpd=e.kd_skpd
                INNER JOIN ms_urusan f ON a.kd_urusan=f.kd_urusan where a.kd_kegiatan='$giat'
                GROUP BY f.kd_urusan,
				f.nm_urusan,
				a.kd_skpd,
				e.nm_skpd,
				a.kd_program,
				a.nm_program,
				a.kd_kegiatan,
				c.nm_kegiatan,
				a.tu_capai,
                a.tu_capai_sempurna,
				a.tu_mas,
                a.tu_mas_sempurna,
				a.tu_kel,
                a.tu_kel_sempurna,
				a.tu_has,
                a.tu_has_sempurna,
				a.tk_capai,
                a.tk_capai_sempurna,
				a.tk_mas,
                a.tk_mas_sempurna,
				a.tk_kel,
                a.tk_kel_sempurna,
				a.tk_has,
                a.tk_has_sempurna,
				a.lokasi,
				d.sumber,
				a.sasaran_giat,
				a.ang_lalu,a.waktu_giat";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $roworg)
                {
                    $kd_urusan=$roworg->kd_urusan;                    
                    $nm_urusan= $roworg->nm_urusan;
                    $kd_skpd  = $roworg->kd_skpd;
                    $nm_skpd  = $roworg->nm_skpd;
                    $kd_prog  = $roworg->kd_program;
                    $nm_prog  = $roworg->nm_program;
                    $kd_giat  = $roworg->kd_kegiatan;
                    $nm_giat  = $roworg->nm_kegiatan;
                    $lokasi  = $roworg->lokasi;
                    $tu_capai  = $roworg->tu_capai;
                    $tu_capai2  = $roworg->tu_capai_sempurna;
                    $tu_mas  = $roworg->tu_mas;
                    $tu_mas2  = $roworg->tu_mas_sempurna;
                    $tu_kel  = $roworg->tu_kel;
                    $tu_kel2  = $roworg->tu_kel_sempurna;
                    $tu_has  = $roworg->tu_has;
                    $tu_has2  = $roworg->tu_has_sempurna;
                    $tk_capai  = $roworg->tk_capai;
                    $tk_capai2  = $roworg->tk_capai_sempurna;
                    $tk_mas  = $roworg->tk_mas;
                    $tk_mas2  = $roworg->tk_mas_sempurna;
                    $tk_kel  = $roworg->tk_kel;
                    $tk_kel2 = $roworg->tk_kel_sempurna;
                    $tk_has  = $roworg->tk_has;
                    $tk_has2  = $roworg->tk_has_sempurna;
                    $sas_giat = $roworg->sasaran_giat;
                    $ang_lalu = $roworg->ang_lalu;
                    $wak_giat = $roworg->waktu_giat;
                    $sumber = $roworg->sumber;

                    
                }
		$kd_urusan= empty($roworg->kd_urusan) || ($roworg->kd_urusan) == '' ? '' : ($roworg->kd_urusan);
		$nm_urusan= empty($roworg->nm_urusan) || ($roworg->nm_urusan) == '' ? '' : ($roworg->nm_urusan);
		$kd_skpd= empty($roworg->kd_skpd) || ($roworg->kd_skpd) == '' ? '' : ($roworg->kd_skpd);
		$nm_skpd= empty($roworg->nm_skpd) || ($roworg->nm_skpd) == '' ? '' : ($roworg->nm_skpd);
		$kd_prog= empty($roworg->kd_program) || ($roworg->kd_program) == '' ? '' : ($roworg->kd_program);
		$nm_prog= empty($roworg->nm_program) || ($roworg->nm_program) == '' ? '' : ($roworg->nm_program);
		$kd_giat= empty($roworg->kd_kegiatan) || ($roworg->kd_kegiatan) == '' ? '' : ($roworg->kd_kegiatan);
		$nm_giat= empty($roworg->nm_kegiatan) || ($roworg->nm_kegiatan) == '' ? '' : ($roworg->nm_kegiatan);
		$lokasi= empty($roworg->lokasi) || ($roworg->lokasi) == '' ? '' : ($roworg->lokasi);
		$tu_capai= empty($roworg->tu_capai) || ($roworg->tu_capai) == '' ? '' : ($roworg->tu_capai);
		$tu_mas= empty($roworg->tu_mas) || ($roworg->tu_mas) == '' ? '' : ($roworg->tu_mas);
		$tu_kel= empty($roworg->tu_kel) || ($roworg->tu_kel) == '' ? '' : ($roworg->tu_kel);
		$tu_has= empty($roworg->tu_has) || ($roworg->tu_has) == '' ? '' : ($roworg->tu_has);
		$tk_capai= empty($roworg->tk_capai) || ($roworg->tk_capai) == '' ? '' : ($roworg->tk_capai);
		$tk_mas= empty($roworg->tk_mas) || ($roworg->tk_mas) == '' ? '' : ($roworg->tk_mas);
		$tk_kel= empty($roworg->tk_kel) || ($roworg->tk_kel) == '' ? '' : ($roworg->tk_kel);
		$tk_has= empty($roworg->tk_has) || ($roworg->tk_has) == '' ? '' : ($roworg->tk_has);
		$tu_capai2= empty($roworg->tu_capai_sempurna) || ($roworg->tu_capai_sempurna) == '' ? '' : ($roworg->tu_capai_sempurna);
		$tu_mas2= empty($roworg->tu_mas_sempurna) || ($roworg->tu_mas_sempurna) == '' ? '' : ($roworg->tu_mas_sempurna);
		$tu_kel2= empty($roworg->tu_kel_sempurna) || ($roworg->tu_kel_sempurna) == '' ? '' : ($roworg->tu_kel_sempurna);
		$tu_has2= empty($roworg->tu_has_sempurna) || ($roworg->tu_has_sempurna) == '' ? '' : ($roworg->tu_has_sempurna);
		$tk_capai2= empty($roworg->tk_capai_sempurna) || ($roworg->tk_capai_sempurna) == '' ? '' : ($roworg->tk_capai_sempurna);
		$tk_mas2= empty($roworg->tk_mas_sempurna) || ($roworg->tk_mas_sempurna) == '' ? '' : ($roworg->tk_mas_sempurna);
		$tk_kel2= empty($roworg->tk_kel_sempurna) || ($roworg->tk_kel_sempurna) == '' ? '' : ($roworg->tk_kel_sempurna);
		$tk_has2= empty($roworg->tk_has_sempurna) || ($roworg->tk_has_sempurna) == '' ? '' : ($roworg->tk_has_sempurna);
		$sas_giat= empty($roworg->sasaran_giat) || ($roworg->sasaran_giat) == '' ? '' : ($roworg->sasaran_giat);
		$ang_lalu= empty($roworg->ang_lalu) || ($roworg->ang_lalu) == '' || ($roworg->ang_lalu) == 'Null' ? 0 : ($roworg->ang_lalu);
		$wak_giat= empty($roworg->waktu_giat) || ($roworg->waktu_giat) == '' || ($roworg->waktu_giat) == 'Null' ? '' : ($roworg->waktu_giat);
   		$sumber= empty($roworg->sumber) || ($roworg->sumber) == '' || ($roworg->sumber) == 'Null' ? '' : ($roworg->sumber);
        
        switch($sumber){
            case 'DAU';
                $sumber = 'Dana Alokasi Umum (DAU)';
            break;
            case 'PAD';
                $sumber = 'Pendapatan Asli Daerah (PAD)';
            break;            
            case 'DAK';
                $sumber = 'Dana Alokasi Khusus (DAK)';
            break;            
        }
        
  
       $sqltp="SELECT SUM(nilai) AS totb,sum(nilai_sempurna) [totb2] FROM trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id' ";
                 $sqlb=$this->db->query($sqltp);
                 foreach ($sqlb->result() as $rowb)
                {
                   $totp  =number_format($rowb->totb,"2",",",".");
                   $totp2 =number_format($rowb->totb2,"2",",",".");
                }        
        $cRet='';

 
        $k2 = substr($id,5,5);
        $k3 = substr($kd_prog,-2,2);
        $k4 = substr($kd_giat,-2,2);
        $cRet='';
     $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"100\" height=\"100\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SKPD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - SKPD <br>2.2.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k3</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k4</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>5</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>2</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"20%\"><strong>&nbsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\" align=\"center\">:</td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                     <tr>
                        <td><strong>&nbsp;Bidang Pemerintahan</strong></td>
                        <td align=\"center\">:</td>
                        <td><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td><strong>&nbsp;Organisasi</strong></td>
                        <td align=\"center\">:</td>
                        <td> <strong>$kd_org - $nm_org</strong></td>
                    </tr>
                    <tr>
                        <td style=\"border-bottom:solid 1px black;\"><strong>&nbsp;Sub Unit Organisasi </strong></td>
                        <td style=\"border-bottom:solid 1px black;\" align=\"center\">:</td>
                        <td style=\"border-bottom:solid 1px black;\"><strong> $kd_skpd - $nm_skpd</strong></td>
                    </tr>
						<tr>
                            <td>&nbsp;Program</td>
    						<td align=\"center\">:</td>
    						<td>$kd_prog   - $nm_prog</td>
                        </tr>
						<tr>
                            <td>&nbsp;Kegiatan</td>
    						<td align=\"center\">:</td>
    						<td>$kd_giat   - $nm_giat</td>
                        </tr>
						<tr>
                            <td style=\"border-bottom:solid 1px black;\">&nbsp;Lokasi Kegiatan</td>
    						<td style=\"border-bottom:solid 1px black;\" align=\"center\">:</td>
    						<td style=\"border-bottom:solid 1px black;\">$lokasi</td>
                        </tr>						

                        <tr>
                            <td style=\"border-bottom:solid 1px black;\" valign=\"top\">Latar Belakang Perubahan/dianggarkan dalam<br>perubahan APBD </td>
    						<td style=\"border-bottom:solid 1px black;\" valign=\"top\" align=\"center\">:</td>
    						<td style=\"border-bottom:solid 1px black;\"></td>
                        </tr>
                </table>";         
 
        $cRet .= "<table style=\"border-collapse:collapse;font-weight:bold;font-size:5px;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"1\">
                    <tr>
                        <td width=\"100%\" colspan=\"5\"  align=\"center\">Perubahan Indikator & Tolak Ukur Kinerja Belanja Langsung</td>
                    </tr>
                    <tr>
                        <td width=\"20%\" rowspan=\"2\" align=\"center\">Indikator </td>
                        <td width=\"40%\" colspan=\"2\" align=\"center\">Tolak Ukur Kerja </td>
                        <td width=\"40%\" colspan=\"2\" align=\"center\">Target Kinerja </td>
                    </tr>		  
                    <tr>
                        <td width=\"20%\" align=\"center\">Sebelum</td>
                        <td width=\"20%\" align=\"center\">Setelah</td>
                        <td width=\"20%\" align=\"center\">Sebelum</td>
                        <td width=\"20%\" align=\"center\">Setelah</td>
                   </tr>		  
                    <tr>
                        <td align=\"center\">CAPAIAN PROGRAM</td>
                        <td>$tu_capai</td>
                        <td><pre>$tu_capai2</pre></td>
                        <td>$tk_capai</td>
                        <td><pre>$tk_capai2</pre></td>
                   </tr>		  
                   <tr>
                        <td align=\"center\">Masukan </td>
                        <td>$tu_mas</td>
                        <td>$tu_mas2</td>
                        <td>Rp. $totp</td>
                        <td>Rp. $totp2 </td>
                   </tr> 
                   <tr>
                        <td align=\"center\">Keluaran </td>
                        <td>$tu_kel</td>
                        <td>$tu_kel2</td>
                        <td>$tk_kel</td>
                        <td>$tk_kel2</td>
                  </tr>
                  <tr>
                        <td align=\"center\">Hasil </td>
                        <td>$tu_has</td>
                        <td>$tu_has2</td>
                        <td>$tk_has</td>
                        <td>$tk_has2</td>
                  </tr>                   
                  <tr>
                        <td colspan=\"5\"  width=\"100%\" align=\"left\">Kelompok Sasaran Kegiatan : $sas_giat</td>
                  </tr>
                  <tr>
                        <td colspan=\"5\" align=\"center\">Rincian Perubahan Anggaran Belanja Langsung Program dan Per Kegiatan Satuan Kerja Perangkat Daerah</td>
                  </tr>
                </table>";
        
        $font = 12;
        $font1 = $font-1;
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead >                       
                        <tr><td style=\"font-size:$font1;\" rowspan=\"3\" width=\"6%\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td rowspan=\"3\" width=\"24%\" align=\"center\"><b>Uraian</b></td>
                            <td colspan=\"4\" width=\"28%\" align=\"center\"><b>Sebelum</b></td>
                            <td colspan=\"4\" width=\"28%\" align=\"center\"><b>Setelah</b></td>
                            <td colspan=\"2\" width=\"14%\" align=\"center\"><b>Bertambah/(Berkurang)</b></td></tr>
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"18%\" colspan=\"3\" align=\"center\">Rincian Perhitungan</td>
 		                    <td style=\"font-weight:bold;\" width=\"10%\" rowspan=\"2\" align=\"center\"></td>
                            <td style=\"font-weight:bold;\" width=\"18%\" colspan=\"3\" align=\"center\">Rincian Perhitungan</td>
 		                    <td style=\"font-weight:bold;\" width=\"10%\" rowspan=\"2\" align=\"center\"></td>
                            <td style=\"font-weight:bold;\" width=\"9%\" rowspan=\"2\" align=\"center\"></td>
                            <td style=\"font-weight:bold;\" width=\"5%\" rowspan=\"2\" align=\"center\"></td>
                        </tr>                            
                        <tr>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
 		                    <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Harga</td>
                            <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Volume</td>
 		                    <td style=\"font-weight:bold;\" width=\"5%\" align=\"center\">Satuan</td>
                            <td style=\"font-weight:bold;\" width=\"8%\" align=\"center\">Harga</td>
                        </tr>                     
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6 = (3 X 5)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">7</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">8</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">9</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">10 = (7 X 9)</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">11 = 10 - 6</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">12</td>

                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: solid 1px black; border-bottom: none;border-right: none;border-left: none;\" colspan=\"12\"></hr></td>
                         </tr>
                     </tfoot>   
                        ";

                $sql1="SELECT * FROM(SELECT 0 header,0 no_po, LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'1' AS id 
                        FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id' 
						GROUP BY LEFT(a.kd_rek5,1),nm_rek1 
						 UNION ALL 
						 SELECT 0 header, 0 no_po,LEFT(a.kd_rek5,2) AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'2' AS id 
                        FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,2),nm_rek2 
						 UNION ALL  
						 SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'3' AS id 
                        FROM trdrka a INNER JOIN ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,3),nm_rek3 
						 UNION ALL 
						 SELECT 0 header, 0 no_po, LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'4' AS id 
                        FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY LEFT(a.kd_rek5,5),nm_rek4 
						 UNION ALL 
						 SELECT 0 header, 0 no_po, a.kd_rek5 AS rek1,RTRIM(a.kd_rek5) AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan,
						0 AS harga,SUM(a.nilai) AS nilai,0 AS volume2,' 'AS satuan2, 0 AS harga2,isnull(SUM(a.nilai_sempurna),0) AS nilai2,'5' AS id 
                        FROM trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE a.kd_kegiatan='$giat'
						AND a.kd_skpd='$id'  GROUP BY a.kd_rek5,b.nm_rek5
						 UNION ALL 
						 SELECT * FROM (SELECT  b.header,b.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,b.uraian AS nama,0 AS volume,' ' AS satuan,
						0 AS harga,SUM(a.total) AS nilai,0 AS volume2,' ' AS satuan2, 0 AS harga2,isnull(SUM(a.total_sempurna),0) AS nilai2,'6' AS id 
						FROM trdpo a
						LEFT JOIN trdpo b ON b.kode=a.kode AND b.header ='1' AND a.no_trdrka=b.no_trdrka 
						WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(a.no_trdrka,12,21)='$giat'
						GROUP BY  RIGHT(a.no_trdrka,7),b.header,b.no_po,b.uraian)z WHERE header='1'
						UNION ALL
						SELECT a. header,a.no_po,RIGHT(a.no_trdrka,7) AS rek1,' 'AS rek,a.uraian AS nama,a.volume1 AS volume,a.satuan1 AS satuan,
						a.harga1 AS harga,a.total AS nilai,a.volume_sempurna1 AS volume2,a.satuan_sempurna1 AS satuan2, a.harga_sempurna1 AS harga2,
                        a.total_sempurna AS nilai2,'6' AS id FROM trdpo a  WHERE LEFT(a.no_trdrka,10)='$id' AND SUBSTRING(no_trdrka,12,21)='$giat' AND (header='0' or header is null)
						) a ORDER BY a.rek1,a.id,a.no_po ";
                $totbl = 0;
                $totbl2 = 0;
                $tselisih = 0;
                $query = $this->db->query($sql1);

                foreach ($query->result() as $row)
                {
                    $rek=$row->rek;
                    $cpo = rtrim($rek);
                    $reke=$this->dotrek($rek);
                    $uraian=$row->nama;
                    $nopo = $row->no_po;
					$header = $row->header;
                    $sat=empty($row->satuan) ? '':$row->satuan;
                    $hrg= empty($row->harga) ? '0.00' :number_format($row->harga,2,',','.');
                    $volum= empty($row->volume) ? 0 : number_format($row->volume,2,',','.'); 
                    $nila= empty($row->nilai) ? 0.00 :number_format($row->nilai,2,',','.');
                    $nilaibl = empty($row->nilai)  ? 0.00 : $row->nilai;
                    
                    $sat2=empty($row->satuan2) ? '' : rtrim($row->satuan2);
                    $hrg2= empty($row->harga2)  ? 0 :number_format($row->harga2,2,',','.');
                    $volum2= empty($row->volume2)  ? 0 :number_format($row->volume2,2,',','.');
                    $nila2= empty($row->nilai2)  ? 0 :number_format($row->nilai2,2,',','.');
                    $nilaibl2 = empty($row->nilai2)  ? 0 : $row->nilai2;
                    
                    $selisih = $nilaibl2 - $nilaibl;
                    if($nilaibl != 0){
                        $persen = (($nilaibl2-$nilaibl)/$nilaibl)*100;
                    }else{
                        $persen = 100;
                    } 
                    $xx = strlen($row->rek1);
                    if(strlen($row->rek1) <= '5' ){
                        $bold = 'font-weight:bold;';
                        $lbawah = 'border-bottom: solid 1px black;';
                        $latas = 'border-top: solid 1px black;';
                        $fontr = $font1;
                    }else{
                        $bold ='';
                        $lbawah = 'border-bottom: none;';
                        $latas = 'border-top: none;';
                        $fontr = $font;
                    }

                    if(strlen($row->rek1) == '1' ){
                        $totbl = $totbl + $nilaibl;
                        $totbl2 = $totbl2 + $nilaibl2;
                        $tselisih = $tselisih + $selisih;
                    }
                    
                     $persenc = $this->rp_minus($persen);
                     $selisihc = $this->rp_minus($selisih);
                    
                    if($cpo == ''){
                        if($header=='0'){
                            
                            if($sat==''){
                                $volum = '';
                                $hrg = '';
                                $nila = '';                             
                            }

                            if($sat2 ==''){
                                $volum2 = '';
                                $hrg2 = '';
                                $nila2 = '';
                                $selisihc = '';
                                $persenc = '';
                                                             
                            }                            
                        }else{
                                $volum = '';
                                $hrg = '';                            
                        }

                    }else{
                        
                        $volum = '';
                        $hrg = ''; 
                            if($sat2 ==''){
                                $volum2 = '';
                                $hrg2 = '';                                                             
                            }                            


                    } 
					
                     $cRet    .= " <tr>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \">$reke</td>                                     
                                     <td style=\"vertical-align:top;$bold $lbawah $latas \">$uraian </td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$volum</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"center\">$sat</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$hrg</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$nila</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$volum2</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"center\">$sat2</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$hrg2</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$nila2</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$selisihc</td>
                                     <td style=\"vertical-align:top;$bold $lbawah $latas font-size:$fontr ; \" align=\"right\">$persenc</td>
                                    </tr>
                                     ";
                             
                }

                    if($totbl != 0){
                        $tpersen = (($totbl2-$totbl)/$totbl)*100;
                    }else{
                        $tpersen = 100;
                    } 

                    $totbl=number_format($totbl,"2",",",".");
                    $totbl2=number_format($totbl2,"2",",",".");
                    $tselisih=$this->rp_minus($tselisih);
                    $tpersen = $this->rp_minus($tpersen);                    
                   
                    $cRet    .=" <tr>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\" colspan=\"5\" ><strong>JUMLAH</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 ;\" align=\"right\"><strong>$totbl</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" colspan=\"3\">&nbsp;</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 ;\" align=\"right\"><strong>$totbl2</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 ;\" align=\"right\"><strong>$tselisih</strong></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size:$font1 ;\" align=\"right\"><strong>$tpersen</strong></td>
                                </tr>";

							 $cRet .="<tr>
                                        <td colspan=\"12\">
                                            <table border=\"0\" width=\"100%\" >
                                                <tr>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" >&emsp;</td>
                                                    <td width=\"5%\" >&emsp;</td>
                                                    <td width=\"30%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,</td>
                                                </tr>
                                                <tr>
    								                <td align=\"center\" valign=\"top\">$jdlnip1
    								                    <br>$jabatan1
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><ins>$nama1</ins></b>
                                                        <br>$pangkat1
                    				                    <br>$nip1 
    								                </td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\" valign=\"top\">&emsp;
    								                    <br>&emsp;
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b>&emsp;</b>
                                                        <br>&emsp;
                    				                    <br>&emsp;
    								                </td>
                                                    <td>&emsp;</td>
    								                <td align=\"center\">$jdlnip2  
    								                    <br>$jabatan2
                                                        <p>&nbsp;</p>
                                                        <br>&nbsp;
    								                    &nbsp;<br>
                    				                    &nbsp;<br>
                    				                    <br><b><u>$nama2</u></b>
                                                        <br>$pangkat2
                    				                    <br>$nip2 
    								                </td>
                                                </tr>
                                            </table>
                                        </td>
                                    </tr>
                            </table>";

 
        $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_sempurna,0) AS triwa1,isnull( a.triw2_sempurna,0) AS triwa2,isnull( a.triw3_sempurna,0) AS triwa3,isnull( a.triw4_sempurna,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE kd_kegiatan='$giat' AND kd_skpd='$id'
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE a.kd_kegiatan='$giat' AND a.kd_skpd='$id'";
        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
				            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
				            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
				            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
	        $triwa3= 0;
	        $triwa4= 0;
	        $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
		$triwa3= number_format($triwa3,2,',','.');
		$triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font;border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\">
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" width=\"40%\" colspan=\"5\"></td>
                        <td style=\"border-left: solid 1px black;border-bottom: solid 1px black;\" width=\"60%\" colspan=\"6\" align=\"center\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                    </tr>
                    <tr>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" colspan=\"3\" align=\"center\">Sebelum</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"20%\" colspan=\"2\" align=\"center\">Setelah</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">N0</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"center\">Nama</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">NIP</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">JABATAN</td>
                        <td style=\"border-bottom: solid 1px black;\" width=\"20%\" align=\"center\" colspan=\"2\">TANDA TANGAN</td>
                    </tr>
                    <tr>
                        <td width=\"8%\" >Triwulan I</td>
                        <td width=\"2%\" >Rp</td>
                        <td style=\"border-right: solid 1px black;\" width=\"10%\" align=\"right\">$triw1</td>
                        <td width=\"5%\" >Rp</td>
                        <td style=\"border-right: solid 1px black;\" width=\"15%\" align=\"right\">$triwa1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >ANSELMUS, S.Sos</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KEPALA BIDANG ANGGARAN</td>
                        <td style=\"vertical-align:top;\" width=\"10%\">1.</td>
                        <td width=\"10%\"></td>

                    </tr>
                    <tr>
                        <td >Triwulan II</td>
                        <td >Rp</td>
                        <td style=\"border-right: solid 1px black;\" align=\"right\">$triw2</td>
                        <td >Rp</td>
                        <td style=\"border-right: solid 1px black;\" align=\"right\">$triwa2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >GURUH PARYONO, S.IP.,M.Si</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KABID MONEVDAL BAPPEDA</td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">2.</td>

                    </tr>
                    <tr>
                        <td >Triwulan III</td>
                        <td >Rp</td>
                        <td style=\"border-right: solid 1px black;\" align=\"right\">$triw3</td>
                        <td >Rp</td>
                        <td style=\"border-right: solid 1px black;\" align=\"right\">$triwa3</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">3</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >$nama3</td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >$jabatan3</td>
                        <td style=\"vertical-align:top;\">3.</td>
                        <td ></td>

                    </tr>
                    <tr>
                        <td  >Triwulan IV</td>
                        <td  >Rp</td>
                        <td  style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triw4</td>
                        <td  >Rp</td>
                        <td  style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triwa4</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"center\">4.</td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td ></td>
                        <td >4.</td>

                    </tr>
                    <tr>
                        <td  >Jumlah </td>
                        <td  >Rp</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"right\" >$total</td>
                        <td  >Rp</td>
                        <td   style=\"border-right: solid 1px black;\" align=\"right\">$totala</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\"></td>
                        <td  style=\"border-right: solid 1px black;\"></td>
                        <td ></td>
                        <td ></td>

                    </tr>

                  ";
        $cRet .= "</table>";
/*        $cRet  .=" 
                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;Rencana Penarikan Dana per Triwulan</td>
                     </tr>

                     <tr>
                        <td style=\"border-right: solid 1px black;border-left: solid 1px black;border-top: solid 1px black;border-bottom: solid 1px black;\" colspan=\"6\" width=\"100%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;
                            <table border=\"0\" width=\"100%\">
                                <tr>
                                    <td width=\"15%\" align=\"left\">&emsp;Triwulan I</td>
                                    <td width=\"10%\" align=\"left\">&emsp;Rp</td>                        
                                    <td width=\"10%\" align=\"right\">&emsp;$triw1</td>
                                    <td width=\"65%\" align=\"left\">&emsp;</td>

                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan II</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw2</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan III</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$triw3</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"left\">&emsp;Triwulan IV</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td style=\"border-bottom: solid 2px black;\" width=\"20%\" align=\"right\">&emsp;$triw4</td>
                                    <td align=\"left\">&emsp;</td>
            
                                </tr>
                                <tr>
                                    <td align=\"right\">&emsp;Jumlah</td>
                                    <td align=\"left\">&emsp;Rp</td>                        
                                    <td align=\"right\">&emsp;$total</td>
                                    <td align=\"left\">&emsp;</td>

                                </tr>                           
                            </table>
                        </td>
                     </tr>
                     
                </table>";    
*/
        $cRet.=  "</table>";                                                             
        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-2.2.1 PENYEMPURNAAN</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }

 
//end DPPA 221 Sempurna  
//DPPA 31 Sempurna
	function ctk_dppa31_sempurna(){
        $data['page_title']= 'Cetak DPPA 3.1 Penyempurnaan';
        $this->template->set('title', 'Cetak DPPA 3.1 Penyempurnaan');   
        $this->template->load('template','anggaran/rka/ctk_dppa31_sempurna',$data) ; 
    }
 


    function preview_dppa31_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
               
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];


		$ttd1 = str_replace('a',' ',$ttd1);	
		$ttd2 = str_replace('a',' ',$ttd2);
		
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
					
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip2 = 'Pengguna Anggaran,';                    
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					


                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }
 
        $k2 = substr($kd_org,5,2);
        $cRet='';
         $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"50\" height=\"50\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;font-size:12;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SPKD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - SPKD <br> 3.1<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>6</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>1</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" colspan=\"2\" align=\"left\">
                            <strong>
                                Latar belakang perubahan </br> penerimaan pembiayaan/ dianggarkan dalam penyempurnaan APBD  
                            </strong>
                        </td>
                        <td style=\"vertical-align:top;border-top:solid 1px black;\"><strong>:</strong></td>
                    </tr>

                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN </br> PENERIMAAN PEMBIAYAAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12;
        $font1 = $font-1; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"1\">
                     <thead >                       
                        <tr>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"40%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"30%\" colspan=\"2\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td width=\"20%\" colspan=\"2\" align=\"center\"><b>Bertambah/ (Berkurang)</b></td>
                        </tr>
                        <tr>
                            <td width=\"15%\" align=\"center\"><b>Sebelum</b></td>                            
                            <td width=\"15%\" align=\"center\"><b>Setelah</b></td>
                            <td width=\"15%\" align=\"center\"><b>Rp</b></td>
                            <td width=\"5%\" align=\"center\"><b>%</b></td>
                        </tr>
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6</td>
                        </tr>                     
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";

                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.61' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            ) 
                        a ORDER BY a.rek1,a.id";

                $totp = 0;
                $totp2 = 0;
                $query = $this->db->query($sql1);
                if ($query->num_rows() > 0){                                      
                    foreach ($query->result() as $row){
                        $rek=$row->rek;
                        $reke=$this->dotrek($rek);
                        $uraian=$row->nama; 
                        $nila = $row->nilai;
                        $nilai2 = $row->nilai2;                   
                        $selisih = $this->rp_minus($nilai2 - $nila);
                        if($nila != 0){
                            $persen = $this->rp_minus((($nilai2-$nila)/$nila)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        } 
                        
                        
                        if (strlen($row->rek1)==1){
                           $totp = $totp +  $nila;
                           $totp2 = $totp2 +  $nilai2;
                        }
                        
                        if(strlen($row->rek1)>6) {
                            $bold = '';
                            $fontr = '';
                        }else{
                            $bold = 'font-weight: bold;';
                            $fontr = 'font-size: '.$font1.' px;';                            
                        }
                        
                        $nila= number_format($nila,"2",",",".");
                        $nilai2 =   number_format($nilai2,"2",",",".");
						$cRet .= "  <tr>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"left\">$reke</td>                                     
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \" > $uraian </td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$nila</td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$nilai2</td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$persen</td>
                               </tr>";
    				
    				}
                }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>PEMBIAYAAN DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     </tr>
                                     ";
				}
      
                $selisih = $this->rp_minus($totp2 - $totp);
                if($totp != 0){
                    $persen = $this->rp_minus((($totp2-$totp)/$totp)*100);
                }else{
                    $persen = $this->rp_minus(100);
                } 

                $totp=number_format($totp,"2",",",".");
                $totp2 = number_format($totp2,"2",",",".");

                    $cRet    .=" <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PENERIMAAN</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\" align=\"right\"><strong>$totp</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\" align=\"right\"><strong>$totp2</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\" align=\"right\"><strong>$selisih</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\"align=\"right\"><strong>$persen</strong></td>
                                </tr>
                                <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong>
                                        </td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong></td>
                                </tr>
                                ";
                                
					$cRet .=" 	<tr>
									<td  width=\"100%\" align=\"left\" colspan=\"6\">
 										<table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"60%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>
										</table>
									</td>		
								</tr>";
                                
        $cRet    .= "</table>";

        $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_sempurna,0) AS triwa1,isnull( a.triw2_sempurna,0) AS triwa2,isnull( a.triw3_sempurna,0) AS triwa3,isnull( a.triw4_sempurna,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE RIGHT(kd_kegiatan,5)='00.61' AND $a$skpd$b='$id'
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE RIGHT(a.kd_kegiatan,5)='00.61' AND $a a.$skpd$b='$id'";
  

        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
				            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
				            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
				            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
	        $triwa3= 0;
	        $triwa4= 0;
	        $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
		$triwa3= number_format($triwa3,2,',','.');
		$triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\">
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" width=\"40%\" colspan=\"3\" align=\"center\"></td>
                        <td style=\"border-left: solid 1px black;border-bottom: solid 1px black;\" width=\"60%\" colspan=\"6\" align=\"center\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                    </tr>
                    <tr>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" colspan=\"3\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">N0</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"center\">Nama</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">NIP</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">JABATAN</td>
                        <td style=\"border-bottom: solid 1px black;\" width=\"20%\" align=\"center\" colspan=\"2\">TANDA TANGAN</td>
                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" width=\"8%\" >Triwulan I</td>
                        <td style=\"vertical-align:top;\" width=\"2%\" >Rp</td>
                        <td style=\"vertical-align:top; border-right: solid 1px black;\" width=\"30%\" align=\"right\">$triwa1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >ANSELMUS, S.Sos</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KEPALA BIDANG ANGGARAN</td>
                        <td style=\"vertical-align:top;\" width=\"10%\">1.</td>
                        <td width=\"10%\"></td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\"  >Triwulan II</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >GURUH PARYONO, S.IP.,M.Si</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KABID MONEVDAL BAPPEDA</td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">2.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Triwulan III</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa3</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">3</td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td >3.</td>
                        <td ></td>

                    </tr>
                    <tr>
                        <td  style=\"vertical-align:top;\" >Triwulan IV</td>
                        <td  style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triwa4</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">4</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">4.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Jumlah </td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\" >$totala</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\"></td>
                        <td  style=\"border-right: solid 1px black;\"></td>
                        <td ></td>
                        <td ></td>

                    </tr>

                  ";
        $cRet .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-31 Penyempurnaan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','','','',5);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
	
//END DPPA 31 Sempurna

//DPPA 32 Sempurna
	function ctk_dppa32_sempurna(){
        $data['page_title']= 'Cetak DPPA 3.2 Penyempurnaan';
        $this->template->set('title', 'Cetak DPPA 3.2 Penyempurnaan');   
        $this->template->load('template','anggaran/rka/ctk_dppa32_sempurna',$data) ; 
    }
 



    function preview_dppa32_sempurna(){
        $id = $this->uri->segment(3);
        $cetak = $this->uri->segment(4);
               
        $ttd1= $_REQUEST['ttd1'];
        $ttd2= $_REQUEST['ttd2'];


		$ttd1 = str_replace('a',' ',$ttd1);	
		$ttd2 = str_replace('a',' ',$ttd2);
		
        if (strlen($id)>7){
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE kd_skpd='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',10)';             
        }else{
            $sqldns="SELECT a.kd_urusan as kd_u,b.nm_urusan as nm_u,a.kd_skpd as kd_sk,a.nm_skpd as nm_sk FROM ms_skpd a INNER JOIN ms_urusan b ON a.kd_urusan=b.kd_urusan WHERE left(kd_skpd,7)='$id'";
            $a = 'left(';
            $skpd = 'kd_skpd';
            $b = ',7)'; 
        }

         $sqlskpd=$this->db->query($sqldns);
         foreach ($sqlskpd->result() as $rowdns)
        {
           
            $kd_urusan=$rowdns->kd_u;                    
            $nm_urusan= $rowdns->nm_u;
            $kd_skpd  = $rowdns->kd_sk;
            $nm_skpd  = $rowdns->nm_sk;
        }
            
            $sqlorg="SELECT * FROM ms_organisasi WHERE kd_org=left('$id',7)";
                 $sqlorg1=$this->db->query($sqlorg);
                 foreach ($sqlorg1->result() as $rowdns)
                {
                   
                    $kd_org=$rowdns->kd_org;                    
                    $nm_org= $rowdns->nm_org;
                }


        $sqlurusan1="SELECT * FROM ms_urusan1 WHERE kd_urusan1=left('$kd_urusan',1)";
                 $sqlskpd=$this->db->query($sqlurusan1);
                 foreach ($sqlskpd->result() as $rowdns)
                {
                   
                    $kd_urusan1=$rowdns->kd_urusan1;                    
                    $nm_urusan1= $rowdns->nm_urusan1;
                }
                       
        $sqlsc="SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                }

       if ($ttd1<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip1 = 'Mengesahkan,';                    
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $jdlnip1 = '';
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }

       if ($ttd2<>'' ){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd2'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {
                    $jdlnip2 = 'Pengguna Anggaran,';                    
                    $nip2=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat2=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama2= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan2  = empty($rowttd->jab) ? '': $rowttd->jab;
					$jabatan2 = str_replace('Pengguna','',$jabatan2);
					$jabatan2 = str_replace('Anggaran','',$jabatan2);
					$jabatan2 = str_replace('PENGGUNA','',$jabatan2);
					$jabatan2 = str_replace('ANGGARAN','',$jabatan2);
					


                }
        }
        else{
                    $jdlnip2 = '';
                    $nip2='' ;
                    $pangkat2='';
                    $nama2= '';
                    $jabatan2  = '';
        }
 
        $k2 = substr($kd_org,5,2);
        $cRet='';
         $cRet .="<table style=\"border-collapse:collapse;font-size:13;border-top: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" align=\"center\" border=\"0\" cellspacing=\"0\" cellpadding=\"4\">
                    <tr> <td style=\"border-collapse:collapse;\"  width=\"15%\" rowspan=\"2\" align=\"center\"><img src=\"".base_url()."/image/logoHP.bmp\"  width=\"50\" height=\"50\" /></td>
                         <td style=\"border-RIGHT: solid 1px black;font-size:12;\" width=\"40%\" align=\"center\" rowspan=\"2\" ><strong>DOKUMEN PELAKSANAAN ANGGARAN <br>SATUAN KERJA PERANGKAT DAERAH</strong></td>
                         <td style=\"border-bottom: solid 1px black;\" width=\"26%\" align=\"center\" colspan=\"6\"><strong>NOMOR DPA SPKD</strong></td>
                         <td style=\"border-collapse:collapse;font-size:18;border-left: solid 1px black\" width=\"19%\" rowspan=\"4\" align=\"center\"><strong>FORMULIR <br>DPA - SPKD <br> 3.2<br></strong></td>

                    </tr>

                    <tr>

                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\" ><strong>$kd_urusan</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>$k2</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-right: solid 1px black;\" width=\"5%\" align=\"center\"><strong>00</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>6</strong></td>
                         <td style=\"border-left: solid 1px black;\" width=\"3%\" align=\"center\"><strong>2</strong></td> 
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" style=\"border-top: solid 1px black;\"><strong>$kab</strong> </td>
                    </tr>
                    <tr>
                         <td align=\"center\" colspan=\"8\" width=\"100%\" ><strong>TAHUN ANGGARAN $thn</strong></td>
                    </tr>

                  </table>";        
       
       $Xret1 = '';
       $Xret2 = ''; 
       $Xret3 = '';
       $Xret1.="<table style=\"border-collapse:collapse;font-size:12;border-left:solid 1px black;border-top:solid 1px black;border-right:solid 1px black; font-size:12;\" width=\"100%\" border=\"0\">
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Urusan Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan1 - $nm_urusan1</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Bidang Pemerintahan</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong>$kd_urusan - $nm_urusan</strong></td>
                    </tr>
                    <tr>
                        <td width=\"25%\"><strong>&emsp;Unit Organisasi</strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"> <strong>$kd_org - $nm_org</strong></td>
                    </tr>";
       $Xret2.= " <tr>
                        <td width=\"25%\"><strong>&emsp;Sub Unit Organisasi </strong></td>
                        <td width=\"3%\"><strong >: </strong></td>
                        <td width=\"77%\"><strong> $kd_skpd - $nm_skpd</strong></td>
                 </tr>";
       $Xret3.=     "
                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" colspan=\"2\" align=\"left\">
                            <strong>
                                Latar belakang perubahan </br> pengeluaran pembiayaan/ dianggarkan dalam perubahan APBD  
                            </strong>
                        </td>
                        <td style=\"vertical-align:top;border-top:solid 1px black;\"><strong>:</strong></td>
                    </tr>

                    <tr>
                        <td style=\"border-top:solid 1px black;font-size:14;\" width=\"100%\" colspan=\"3\" align=\"center\"><strong>RINCIAN DOKUMEN PELAKSANAAN ANGGARAN </br> PENGELUARAN PEMBIAYAAN</strong></td>
                    </tr>
                    </table>";         
       if (strlen($id)==7){          
            $cRet .= $Xret1.$Xret3; 
        }ELSE{
            $cRet .= $Xret1.$Xret2.$Xret3; 
        }        
          
        $font = 12;
        $font1 = $font-1; 
        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;\" width=\"100%\" align=\"center\" border=\"1\" cellspacing=\"0\" cellpadding=\"0\">
                     <thead >                       
                        <tr>
                            <td width=\"10%\" rowspan=\"2\" align=\"center\"><b>KODE REKENING</b></td>                            
                            <td width=\"40%\" rowspan=\"2\" align=\"center\"><b>Uraian</b></td>
                            <td width=\"30%\" colspan=\"2\" align=\"center\"><b>Jumlah (Rp.)</b></td>
                            <td width=\"20%\" colspan=\"2\" align=\"center\"><b>Bertambah/ (Berkurang)</b></td>
                        </tr>
                        <tr>
                            <td width=\"15%\" align=\"center\"><b>Sebelum</b></td>                            
                            <td width=\"15%\" align=\"center\"><b>Setelah</b></td>
                            <td width=\"15%\" align=\"center\"><b>Rp</b></td>
                            <td width=\"5%\" align=\"center\"><b>%</b></td>
                        </tr>
                        <tr>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">1</td>                            
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">2</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">3</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">4</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">5</td>
                            <td style=\"vertical-align:top;border-top: none;border-bottom: solid 2px black;font-weight:bold;\" align=\"center\">6</td>
                        </tr>                      
                    </thead>
                     
                    <tfoot>
                        <tr>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                            <td style=\"border-top: none;\"></td>
                         </tr>
                     </tfoot>   
                        ";

                 $sql1="SELECT * FROM(
                            SELECT LEFT(a.kd_rek5,1)AS rek1,LEFT(a.kd_rek5,1)AS rek,b.nm_rek1 AS nama ,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'1' AS id FROM trdrka a INNER JOIN ms_rek1 b ON LEFT(a.kd_rek5,1)=b.kd_rek1 WHERE 
                            right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,1),b.nm_rek1 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,2) 
                            AS rek1,LEFT(a.kd_rek5,2) AS rek,b.nm_rek2 AS nama,0 AS volume,' 'AS satuan,0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'2' 
                            AS id FROM trdrka a INNER JOIN ms_rek2 b ON LEFT(a.kd_rek5,2)=b.kd_rek2 WHERE right(a.kd_kegiatan,5)='00.62' AND 
                            $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,2),b.nm_rek2 
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,3) AS rek1,LEFT(a.kd_rek5,3) AS
                            rek,b.nm_rek3 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'3' AS id FROM trdrka a INNER JOIN
                            ms_rek3 b ON LEFT(a.kd_rek5,3)=b.kd_rek3 WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' 
                            GROUP BY LEFT(a.kd_rek5,3),b.nm_rek3
                            UNION ALL 
                            SELECT LEFT(a.kd_rek5,5) AS rek1,LEFT(a.kd_rek5,5) AS rek,b.nm_rek4 AS nama,0 AS volume,' 'AS satuan, 
                            0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'4' AS id FROM trdrka a INNER JOIN ms_rek4 b ON LEFT(a.kd_rek5,5)=b.kd_rek4 
                            WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY LEFT(a.kd_rek5,5),b.nm_rek4 
                            UNION ALL 
                            SELECT a.kd_rek5 AS rek1,a.kd_rek5 AS rek,b.nm_rek5 AS nama,0 AS volume,' 'AS satuan, 0 AS harga,SUM(a.nilai) AS nilai,SUM(a.nilai_sempurna) AS nilai2,'5' AS id FROM 
                            trdrka a INNER JOIN ms_rek5 b ON a.kd_rek5=b.kd_rek5 WHERE right(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id' GROUP BY 
                            a.kd_rek5,b.nm_rek5 
                            ) 
                        a ORDER BY a.rek1,a.id";

                $totp = 0;
                $totp2 = 0;
                $query = $this->db->query($sql1);
                if ($query->num_rows() > 0){                                      
                    foreach ($query->result() as $row){
                        $rek=$row->rek;
                        $reke=$this->dotrek($rek);
                        $uraian=$row->nama; 
                        $nila = $row->nilai;
                        $nilai2 = $row->nilai2;                   
                        $selisih = $this->rp_minus($nilai2 - $nila);
                        if($nila != 0){
                            $persen = $this->rp_minus((($nilai2-$nila)/$nila)*100);
                        }else{
                            $persen = $this->rp_minus(100);
                        } 
                        
                        
                        if (strlen($row->rek1)==1){
                           $totp = $totp +  $nila;
                           $totp2 = $totp2 +  $nilai2;
                        }
                        
                        if(strlen($row->rek1)>6) {
                            $bold = '';
                            $fontr = '';
                        }else{
                            $bold = 'font-weight: bold;';
                            $fontr = 'font-size: '.$font1.' px;';                            
                        }
                        
                        $nila= number_format($nila,"2",",",".");
                        $nilai2 =   number_format($nilai2,"2",",",".");
						$cRet .= "<tr>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr \" align=\"left\">$reke</td>                                     
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold \"> $uraian </td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$nila</td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$nilai2</td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$selisih</td>
                                        <td style=\"vertical-align:top;border-top: none;border-bottom: none;$bold $fontr  \" align=\"right\">$persen</td>
                                  </tr>";
    				
    				}
                }else{
					 $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\"><b>5.</b></td>                                     
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><b>PEMBIAYAAN DAERAH </b></td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\">".number_format(0,"2",",",".")."</td>
                                     </tr>
                                     ";
				}
      
                $selisih = $this->rp_minus($totp2 - $totp);
                if($totp != 0){
                    $persen = $this->rp_minus((($totp2-$totp)/$totp)*100);
                }else{
                    $persen = $this->rp_minus(100);
                } 

                $totp=number_format($totp,"2",",",".");
                $totp2 = number_format($totp2,"2",",",".");

                    $cRet    .=" <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>JUMLAH PENGELUARAN</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\" align=\"right\"><strong>$totp</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\" align=\"right\"><strong>$totp2</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\" align=\"right\"><strong>$selisih</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;font-size: $font1 px;\"align=\"right\"><strong>$persen</strong></td>
                                </tr>
                                <tr>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"left\">&nbsp;</td>                                     
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" ><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong>
                                        </td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong></td>
                                        <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: none;\" align=\"right\"><strong>&nbsp;</strong></td>
                                </tr>
                                ";
                                
					$cRet .=" 	<tr>
									<td  width=\"100%\" align=\"left\" colspan=\"6\">
 										<table border=\"0\" width=\"100%\">
                                            <tr>
                                                <td width=\"60%\" colspan=\"3\">&emsp;
                                                <td width=\"40%\" align=\"left\">&emsp;&emsp;&emsp;&emsp;&emsp;&emsp;$daerah,
                                            </tr>
								            <tr>
								                <td width=\"10%\" align=\"left\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td width=\"40%\" align=\"center\" valign=\"top\">$jdlnip1
								                    <br>$jabatan1
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    <br><b><ins>$nama1</ins></b>
                                                    <br>$pangkat1
                				                    <br>$nip1 
								                </td>
								                <td width=\"10%\" align=\"left\" valign=\"top\">&nbsp;<br>&nbsp;
								                    <br>&nbsp;
								                    &nbsp;<br>
                				                    &nbsp;<br>
                				                    &nbsp;<br>
								                    &nbsp;	
								                </td>
								                <td align=\"center\">$jdlnip2  
								                    <br>$jabatan2
                                                    <p>&nbsp;</p>
													&nbsp;<br>
                				                    <br><b><u>$nama2</u></b>
                                                    <br>$pangkat2
                				                    <br>$nip2 
								                </td>
                                            </tr>
										</table>
									</td>		
								</tr>";
                                
        $cRet    .= "</table>";

        $qtriw = " SELECT isnull( a.triw1,0) AS triw1,isnull( a.triw2,0) AS triw2,isnull( a.triw3,0) AS triw3,isnull( a.triw4,0) AS triw4,  
                   isnull( a.triw1_sempurna,0) AS triwa1,isnull( a.triw2_sempurna,0) AS triwa2,isnull( a.triw3_sempurna,0) AS triwa3,isnull( a.triw4_sempurna,0) AS triwa4  
                   FROM trskpd a join (
                                    select kd_kegiatan from trdrka WHERE RIGHT(kd_kegiatan,5)='00.62' AND $a$skpd$b='$id'
                                    group by kd_kegiatan
                                    )b on a.kd_kegiatan=b.kd_kegiatan 
                                WHERE RIGHT(a.kd_kegiatan,5)='00.62' AND $a a.$skpd$b='$id'";
  

        $query = $this->db->query($qtriw);
        if ($query->num_rows() > 0){
            foreach ($query->result() as $triw){
                            $triw1=  empty($triw->triw1) ? 0 : $triw->triw1;
                            $triw2= empty($triw->triw2) ? 0 :$triw->triw2;
				            $triw3= empty($triw->triw3)  ? 0 :$triw->triw3;
				            $triw4= empty($triw->triw4) ? 0 :$triw->triw4;
				            $total = $triw1 + $triw2 + $triw3 + $triw4;
                            $triwa1=  empty($triw->triwa1) ? 0 : $triw->triwa1;
                            $triwa2= empty($triw->triwa2) ? 0 :$triw->triwa2;
				            $triwa3= empty($triw->triwa3)  ? 0 :$triw->triwa3;
				            $triwa4= empty($triw->triwa4) ? 0 :$triw->triwa4;
				            $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;
            }
        }else{
            $triw1=  0;
            $triw2= 0;
	        $triw3= 0;
	        $triw4= 0;
	        $total = $triw1 + $triw2 + $triw3 + $triw4;                            
            $triwa1=  0;
            $triwa2= 0;
	        $triwa3= 0;
	        $triwa4= 0;
	        $totala = $triwa1 + $triwa2 + $triwa3 + $triwa4;                            
        }

        $triw1 = number_format($triw1,2,',','.');
        $triw2= number_format($triw2,2,',','.');
		$triw3= number_format($triw3,2,',','.');
		$triw4= number_format($triw4,2,',','.');
        $total = number_format($total,2,',','.');
        $triwa1 = number_format($triwa1,2,',','.');
        $triwa2= number_format($triwa2,2,',','.');
		$triwa3= number_format($triwa3,2,',','.');
		$triwa4= number_format($triwa4,2,',','.');
        $totala = number_format($totala,2,',','.');


        $cRet .= "<table style=\"border-collapse:collapse;font-size:$font px;border-top: solid 1px black;border-bottom: solid 1px black;border-right: solid 1px black;border-left: solid 1px black;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"2\">
                    <tr>
                        <td style=\"border-bottom: solid 1px black;\" width=\"40%\" colspan=\"3\" align=\"center\"></td>
                        <td style=\"border-left: solid 1px black;border-bottom: solid 1px black;\" width=\"60%\" colspan=\"6\" align=\"center\">TIM ANGGARAN PEMERINTAH DAERAH</td>
                    </tr>
                    <tr>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" colspan=\"3\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"5%\" align=\"center\">N0</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"15%\" align=\"center\">Nama</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">NIP</td>
                        <td style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" width=\"10%\" align=\"center\">JABATAN</td>
                        <td style=\"border-bottom: solid 1px black;\" width=\"20%\" align=\"center\" colspan=\"2\">TANDA TANGAN</td>
                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" width=\"8%\" >Triwulan I</td>
                        <td style=\"vertical-align:top;\" width=\"2%\" >Rp</td>
                        <td style=\"vertical-align:top; border-right: solid 1px black;\" width=\"30%\" align=\"right\">$triwa1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">1</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >ANSELMUS, S.Sos</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KEPALA BIDANG ANGGARAN</td>
                        <td style=\"vertical-align:top;\" width=\"10%\">1.</td>
                        <td width=\"10%\"></td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\"  >Triwulan II</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">2</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >GURUH PARYONO, S.IP.,M.Si</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" >KABID MONEVDAL BAPPEDA</td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">2.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Triwulan III</td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\">$triwa3</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">3</td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td >3.</td>
                        <td ></td>

                    </tr>
                    <tr>
                        <td  style=\"vertical-align:top;\" >Triwulan IV</td>
                        <td  style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"border-right: solid 1px black;border-bottom: solid 1px black;\" align=\"right\">$triwa4</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"center\">4</td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td style=\"vertical-align:top;border-right: solid 1px black;\" ></td>
                        <td ></td>
                        <td style=\"vertical-align:top;\">4.</td>

                    </tr>
                    <tr>
                        <td style=\"vertical-align:top;\" >Jumlah </td>
                        <td style=\"vertical-align:top;\" >Rp</td>
                        <td  style=\"vertical-align:top;border-right: solid 1px black;\" align=\"right\" >$totala</td>
                        <td  style=\"border-right: solid 1px black;\" align=\"center\"></td>
                        <td style=\"border-right: solid 1px black;\" ></td>
                        <td style=\"border-right: solid 1px black;\"></td>
                        <td  style=\"border-right: solid 1px black;\"></td>
                        <td ></td>
                        <td ></td>

                    </tr>

                  ";
        $cRet .= "</table>";

        $data['prev']= $cRet;    
        //$this->_mpdf('',$cRet,10,10,10,0);
        //$this->template->load('template','master/fungsi/list_preview',$data);
        switch($cetak) {
        case 0;
               echo ("<title>Report DPPA-32 Penyempurnaan</title>");
                echo($cRet);
  
 //           $this->template->load('template','anggaran/rka/perkadaII',$data);
        break;
        case 1;
             $this->_mpdf('',$cRet,10,10,10,'1','','','',5);
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= DPA0.xls");
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        
        }    
    }
		
//END DPPA 31 Sempurna


 
//End DPPA Sempurna

//End DPPA Sempurna	

// Anggaran Kas Penyempurnaan
   function anggaran_kas_sempurna()
	{
        $data['page_title']= 'INPUT RENCANA KEGIATAN ANGGARAN PENYEMPURNAAN';
        $this->template->set('title', 'INPUT ANGGARAN KAS PENYEMPURNAAN');   
        $this->template->load('template','anggaran/rka/anggaran_kas_sempurna',$data) ; 
   }

    function simpan_trskpd_sempurna(){
    
        $cskpd=$this->input->post('cskpd');
        $cgiat=$this->input->post('cgiat');
        $bln1=$this->input->post('jan');      
        $bln2=$this->input->post('feb');       $bln3=$this->input->post('mar');
        $bln4=$this->input->post('apr');       $bln5=$this->input->post('mei');        $bln6=$this->input->post('jun');
        $bln7=$this->input->post('jul');       $bln8=$this->input->post('ags');        $bln9=$this->input->post('sep');
        $bln10=$this->input->post('okt');      $bln11=$this->input->post('nov');       $bln12=$this->input->post('des');
        $tr1=$this->input->post('tr1');        $tr2=$this->input->post('tr2');
        $tr3=$this->input->post('tr3');        $tr4=$this->input->post('tr4');               
        $status = $this->input->post('csts');
        $sql = "delete from trdskpd_sempurna where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
        $asg = $this->db->query($sql);
        if ($asg){                           
                $kdGab = $cskpd.'.'.$cgiat;
                $sql1 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','1','$bln1','$bln1',0,0,'$status') ";
                $asg = $this->db->query($sql1);                              
                $sql2 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','2','$bln2','$bln2',0,0,'$status') ";
                $asg = $this->db->query($sql2);                
                $sql3 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','3','$bln3','$bln3',0,0,'$status') ";
                $asg = $this->db->query($sql3);                
                $sql4 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','4','$bln4','$bln4',0,0,'$status') ";
                $asg = $this->db->query($sql4);        
                $sql5 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','5','$bln5','$bln5',0,0,'$status') ";
                $asg = $this->db->query($sql5);       
                $sql6 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','6','$bln6','$bln6',0,0,'$status') ";
                $asg = $this->db->query($sql6);                
                $sql7 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','7','$bln7','$bln7',0,0,'$status') ";
                $asg = $this->db->query($sql7);                
                $sql8 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','8','$bln8','$bln8',0,0,'$status') ";
                $asg = $this->db->query($sql8);                
                $sql9 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','9','$bln9','$bln9',0,0,'$status') ";
                $asg = $this->db->query($sql9);                
                $sql10 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','10','$bln10','$bln10',0,0,'$status') ";
                $asg = $this->db->query($sql10);                
                $sql11 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','11','$bln11','$bln11',0,0,'$status') ";
                $asg = $this->db->query($sql11);                
                $sql12 = "insert into trdskpd_sempurna values('$kdGab','$cgiat','$cskpd','','12','$bln12','$bln12',0,0,'$status') ";
                $asg = $this->db->query($sql12);         
                $ntotal = $tr1+$tr2+$tr3+$tr4;
				$sql13 = "update trskpd set triw1_sempurna='$tr1',triw2_sempurna='$tr2',triw3_sempurna='$tr3',triw4_sempurna='$tr4',total_sempurna='$ntotal' where kd_skpd='$cskpd' and kd_kegiatan='$cgiat'";
                $asg = $this->db->query($sql13);       

        } else {
            echo '0';
            exit();
        }
        
        echo '1';
    }


   function load_trdskpd_sempurna(){
    
        $kegiatan = $this->input->post('p');
        $sql = "select * from trdskpd_sempurna where kd_kegiatan='$kegiatan' order by bulan";
        $query1 = $this->db->query($sql);  
        $result = array();
        $ii = 1;
        foreach($query1->result_array() as $resulte)
        { 
           
            $result[] = array(
                        'id' => $ii,        
                        'bulan' => $resulte['bulan'],
                        'nilai' => number_format($resulte['nilai'],2,'.',',')                                                              
                        );
                        $ii++;
        }
           
        echo json_encode($result);
   }
//End Anggaran Kas Penyempurnaan

//Cetak Anggaran Kas Penyempurnaan
    function cetak_anggaran_kas_sempurna($skpd='',$cetak=''){
        $data['page_title']= 'ANGGARAN KAS PENYEMPURNAAN';
        $this->template->set('title', 'ANGGARAN KAS PENYEMPURNAAN');   
        $this->template->load('template','anggaran/rka/cetak_anggaran_kas_sempurna',$data) ; 
    }

   function preview_anggaran_kas_sempurna($skpd='',$cetak=0){
        
       $cell = $this->uri->segment(5);
       $ang_t=0;
       $jan_t=0;
       $feb_t=0;
       $mar_t=0;
       $apr_t=0;
       $mei_t=0;
       $jun_t=0;
       $jul_t=0;
       $ags_t=0;
       $sep_t=0;
       $okt_t=0;
       $nov_t=0;
       $des_t=0;
       
       $jtriw1=0;
       $jtriw2=0;
       $jtriw3=0;
       $jtriw4=0;
       
	   
       $id     = $skpd;
            $qrskpd = $this->db->query("select upper(nm_skpd) as cnmskpd from ms_skpd where kd_skpd='$id'");

       $ttd1= $_REQUEST['ttd1'];

		$ttd1 = str_replace('a',' ',$ttd1);
       $tgl= $_REQUEST['tgl_ttd'];
       $tanggal = '';//$this->tanggal_format_indonesia($tgl);
       
       foreach( $qrskpd->result() as $qrskpd ){
            $nmskpd = $qrskpd->cnmskpd; 
       }
        
        
       $qrorg = $this->db->query("select kd_org,nm_org from ms_organisasi where left(kd_org,7)=left('$id',7)");
       
       foreach( $qrorg->result() as $qrorg ){
            $kd_org = $qrorg->kd_org;
            $nm_org = $qrorg->nm_org;
             
       }

       
       $sqlsc = "SELECT tgl_rka,provinsi,kab_kota,daerah,thn_ang,daerah FROM sclient where kd_skpd='1.20.12.01'";
                 $sqlsclient=$this->db->query($sqlsc);
                 foreach ($sqlsclient->result() as $rowsc)
                {
                   
                    $tgl=$rowsc->tgl_rka;
                    $tanggal = '';//$this->tukd_model->tanggal_format_indonesia($tgl);
                    $kab     = $rowsc->kab_kota;
                    $daerah  = $rowsc->daerah;
                    $thn     = $rowsc->thn_ang;
                    $kota =  $rowsc->daerah;
                }
        

       if ($ttd1<>''){         
       $sqlttd1="SELECT nama as nm,nip as nip,jabatan as jab, pangkat as pangkat FROM ms_ttd WHERE nip='$ttd1'";
                 $sqlttd=$this->db->query($sqlttd1);
                 foreach ($sqlttd->result() as $rowttd)
                {                   
                    $nip1=empty($rowttd->nip) ? '' : 'NIP.'.$rowttd->nip ;
                    $pangkat1=empty($rowttd->pangkat) ? '' : $rowttd->pangkat;
                    $nama1= empty($rowttd->nm) ? '' : $rowttd->nm;
                    $jabatan1  = empty($rowttd->jab) ? '': $rowttd->jab;
                }
        }
        else{
                    $nip1='' ;
                    $pangkat1='';
                    $nama1= '';
                    $jabatan1  = '';
        }
        
        $cRet='<META http-equiv="X-UA-Compatible" content="IE=8"/>';
        $cRet1='';
        $cRet2='';
      
            $cRet .="<table style=\"border-collapse:collapse;font-size:20px;font-weight:bold;\" width=\"100%\"  border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td align=\"center\">$kab</td>
                             
                        </tr>
                         <tr>
                             <td align=\"center\">ANGGARAN KAS PENGELUARAN</td>
                        </tr>
                        
                        <tr>
                             <td align=\"center\">TAHUN ANGGARAN $thn</td>
                        </tr>
    
                        <tr>
                             <td>&nbsp;</td>
                        </tr>
                   </table>";  

        if($id!=0){
            
            $cRet .="<table style=\"border-collapse:collapse;font-weight:bold;font-size:12px;\" width=\"100%\" border=\"0\" cellspacing=\"0\" cellpadding=\"1\">
                        <tr>
                             <td width=\"10%\" >Organisasi</td>
                             <td width=\"2%\">:</td>
                             <td width=\"88%\">$kd_org - $nm_org</td>
                        </tr>
    
                        <tr>
                             <td>Sub Unit Organisasi</td>
                             <td>:</td>
                             <td>$skpd - $nmskpd</td>
                        </tr>
                        <tr>
                            <td colspan=\"3\">&nbsp;</td>
                        </tr>
                    </table>";  
        }

        $font = 8;
        $font1 = $font-1;
		$nttriw = 'trdskpd_sempurna';
        $cRet .= "<table style=\"border-collapse:collapse; font-size=$font px;\" width=\"100%\" border=\"1\" cellspacing=\"0\" cellpadding=\"$cell\">
                     <thead>                       
                        <tr>
                            <td rowspan=\"2\" width=\"9%\" align=\"center\"><b>Kode</b></td>                            
                            <td rowspan=\"2\" width=\"11%\" align=\"center\"><b>Uraian</b></td>                            
                            <td rowspan=\"2\" width=\"8%\" align=\"center\"><b>Jumlah <br>(Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan I (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan II (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan III (Rp.)</b></td>
                            <td colspan=\"3\" width=\"18%\" align=\"center\"><b>Triwulan IV (Rp.)</b></td>
                            </tr>
                        <tr>
 		                     <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jan</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Feb</td>                             
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mar</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Apr</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Mei</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jun</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Jul</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Ags</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Sep</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Okt</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Nov</td>
                             <td style=\"font-weight:bold;\" width=\"6%\"  align=\"center\">Des</td>
                        </tr>
                        <tr>
 		                     <td  style=\"font-weight:bold;\" align=\"center\">1</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">2</td>                             
                             <td  style=\"font-weight:bold;\" align=\"center\">3</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">4</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">5</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">6</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">7</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">8</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">9</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">10</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">11</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">12</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">13</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">14</td>
                             <td  style=\"font-weight:bold;\" align=\"center\">15</td>
                        </tr>    
                            
                     </thead>                    
                        <tr><td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>                            
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                            <td style=\"border-top: none;border-bottom: none;\">&nbsp;</td>
                        </tr>
                        <tfoot sytle=\"display:table-footer-group;\" border=\"1\">
                            <tr>
                                <td colspan=\"15\"></td> 
                            </tr>                 
                       </tfoot>
  
                        <tbody>
                        ";
                        
                                      
      
                // Pendapatan & Penerimaan Pendapatan
                // 0 = keseluruhan 
                if($id != 0){                             
                     $sql="SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where b.kd_skpd='$id' and (right(b.kd_kegiatan,5)='00.04' or right(b.kd_kegiatan,5)='00.61')
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan ";
                }else{

                     $sql="select kd_skpd = case nm_kegiatan 
                            when 'Pendapatan' then '' 
                            when 'Penerimaan Pembiayaan' then 'PPKD' end,
                            kd_kegiatan = case nm_kegiatan 
                            when 'Pendapatan' then '0.00.0.00.00.00.00.04' 
                            when 'Penerimaan Pembiayaan' then '0.00.0.00.00.00.00.61' end
                            ,nm_kegiatan,isnull(sum(total),0) [total]
                            ,isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],isnull(sum(apr),0) [apr]
                            ,isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags]
                            ,isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] 
                            from(
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=1) AS jan,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=2) AS feb,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=3) AS mar,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=4) AS apr,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=5) AS mei,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=6) AS jun,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=7) AS jul,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=8) AS ags,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=9) AS sep,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=10) AS okt,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=11) AS nov,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.04' or right(kd_kegiatan,5)='00.61') AND bulan=12) AS des  
                            FROM trdrka b where (right(b.kd_kegiatan,5)='00.04' or right(b.kd_kegiatan,5)='00.61' )
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),b.nm_kegiatan,b.kd_kegiatan
                            ) as c group by c.nm_kegiatan
                            union all
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],c.nm_org [nm_kegiatan],isnull(sum(b.nilai),0) [total],
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=1) AS jan,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=2) AS feb,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=3) AS mar,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=4) AS apr,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=5) AS mei,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=6) AS jun,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=7) AS jul,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=8) AS ags,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=9) AS sep,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=10) AS okt,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=11) AS nov,
                                (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.04' AND bulan=12) AS des  
                            FROM trdrka b 
                            join ms_organisasi c on c.kd_org= LEFT(b.kd_skpd,7)
                            where (right(b.kd_kegiatan,5)='00.04' )
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),c.nm_org 
                            order by kd_skpd";                    
                    
                }
                  $qtpend = $this->db->query($sql);
                  $num_rowpend = $qtpend->num_rows();
                    
                    
                    $ang_t=0;
                    $ang_tpend=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1pend = 0;
                    $jtriw2pend = 0;
                    $jtriw3pend = 0;
                    $jtriw4pend = 0;
                    
                    if ($num_rowpend>0){
                        foreach ($qtpend->result() as $row){
                            $cskpdcek = ($row->kd_skpd);
                            $kode = ($row->kd_kegiatan);
                            $nama=$row->nm_kegiatan;
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
							
                          if($cskpdcek=='' || $cskpdcek=='PPKD'){                            
                                $ang_tpend=$ang_tpend+$ang;
                                $jan_t=$jan_t+$jan;
                                $feb_t=$feb_t+$feb;
                                $mar_t=$mar_t+$mar;
                                $apr_t=$apr_t+$apr;
                                $mei_t=$mei_t+$mei;
                                $jun_t=$jun_t+$jun;
                                $jul_t=$jul_t+$jul;
                                $ags_t=$ags_t+$ags;
                                $sep_t=$sep_t+$sep;
                                $okt_t=$okt_t+$okt;
                                $nov_t=$nov_t+$nov;
                                $des_t=$des_t+$des;

                                $jtriw1pend = $jtriw1pend + ($jan+$feb+$mar);
                                $jtriw2pend = $jtriw2pend + ($apr+$mei+$jun);
                                $jtriw3pend = $jtriw3pend + ($jul+$ags+$sep);
                                $jtriw4pend = $jtriw4pend + ($okt+$nov+$des);
                                
                                $cskpd = '';
                            }else{
                                $cskpd = $cskpdcek;
                            }
                            
                            $ckode = substr($kode,-5);

                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 
                            
                            $cRet    .= "<tr><td style=\"vertical-align:top;font-weight:bold;\" >$cskpd</td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">$nama</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";

                        }      
                    }else{
                        
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pendapatan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                            
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Penerimaan Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                    
                    if($num_rowpend==1){
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Penerimaan Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                
                    $ang_t=number_format($ang_tpend,"2",",",".");
                    $jan_t=number_format($jan_t,"2",",",".");
                    $feb_t=number_format($feb_t,"2",",",".");
                    $mar_t=number_format($mar_t,"2",",",".");
                    $apr_t=number_format($apr_t,"2",",",".");
                    $mei_t=number_format($mei_t,"2",",",".");
                    $jun_t=number_format($jun_t,"2",",",".");
                    $jul_t=number_format($jul_t,"2",",",".");
                    $ags_t=number_format($ags_t,"2",",",".");
                    $sep_t=number_format($sep_t,"2",",",".");
                    $okt_t=number_format($okt_t,"2",",",".");
                    $nov_t=number_format($nov_t,"2",",",".");
                    $des_t=number_format($des_t,"2",",","."); 
                    
                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Jumlah Pendapatan & Pembiayaan Penerimaan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t</td>
                                </tr>";                                                     
                    
                    $jtriw1_t = number_format($jtriw1pend,2,',','.');
                    $jtriw2_t = number_format($jtriw2pend,2,',','.');
                    $jtriw3_t = number_format($jtriw3pend,2,',','.');
                    $jtriw4_t = number_format($jtriw4pend,2,',','.');

                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Jumlah Alokasi Kas yang tersedia untuk pengeluran</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" >$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                                </tr>";                                                     

                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                                                     
                  
                  
                 //Belanja Tidak Langsung
                if($id==0){
                    $sql="select kd_skpd = case nm_kegiatan 
                            when 'Belanja Tidak Langsung' then '' 
                            when 'Pengeluaran Pembiayaan' then 'PPKD' end,
                            kd_kegiatan = case nm_kegiatan 
                            when 'Belanja Tidak Langsung' then '0.00.0.00.00.00.00.51' 
                            when 'Pengeluaran Pembiayaan' then '0.00.0.00.00.00.00.61' end
                            ,nm_kegiatan,isnull(sum(total),0) [total]
                            ,isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],isnull(sum(apr),0) [apr]
                            ,isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags]
                            ,isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] 
                            from(
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan and (right(kd_kegiatan,5)='00.51' or  right(kd_kegiatan,5)='00.62') AND bulan=12) AS des  
                            FROM trdrka b where (right(b.kd_kegiatan,5)='00.51' or  right(b.kd_kegiatan,5)='00.62') 
                            GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),b.nm_kegiatan,b.kd_kegiatan
                            )as c group by c.nm_kegiatan                         
                            union all
                            SELECT left(b.kd_skpd,7) [kd_skpd],left(b.kd_kegiatan,12) [kd_kegiatan],c.nm_org [nm_kegiatan],isnull(sum(b.nilai),0) [total],
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=1) AS jan,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=2) AS feb,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=3) AS mar,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=4) AS apr,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=5) AS mei,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=6) AS jun,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=7) AS jul,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=8) AS ags,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=9) AS sep,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=10) AS okt,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=11) AS nov,
                                                        (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE left(kd_kegiatan,12)=left(b.kd_kegiatan,12) and right(kd_kegiatan,5)='00.51' AND bulan=12) AS des  
                                                    FROM trdrka b 
                                                    join ms_organisasi c on c.kd_org= LEFT(b.kd_skpd,7)
                                                    where (right(b.kd_kegiatan,5)='00.51') 
                                                    GROUP BY left(b.kd_skpd,7),left(b.kd_kegiatan,12),c.nm_org 
                            order by kd_skpd";                    
                }else{                    
                    $sql="SELECT '' kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            (SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                        FROM trdrka b where b.kd_skpd='$id' and (right(b.kd_kegiatan,5)='00.51' or  right(b.kd_kegiatan,5)='00.62') 
                        GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan";
                }         
                  $qtbtl = $this->db->query($sql);
                  $num_rowbtl = $qtbtl->num_rows();
                    
                    
                    $ang_tbtl=0;
                    $ang_t=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1btl = 0;
                    $jtriw2btl = 0;
                    $jtriw3btl = 0;
                    $jtriw4btl = 0;
                    
                    
                    if ($num_rowbtl>0){
                        foreach ($qtbtl->result() as $row){
                            $cskpdcek = ltrim($row->kd_skpd);
                            $nama=$row->nm_kegiatan;
                            $kode = ($row->kd_kegiatan);
                            //$ang=$row->total;
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            
                            if($cskpdcek=='' || $cskpdcek=='PPKD'){ 
                                $ang_tbtl=$ang_tbtl+$ang;
                                $jan_t=$jan_t+$jan;
                                $feb_t=$feb_t+$feb;
                                $mar_t=$mar_t+$mar;
                                $apr_t=$apr_t+$apr;
                                $mei_t=$mei_t+$mei;
                                $jun_t=$jun_t+$jun;
                                $jul_t=$jul_t+$jul;
                                $ags_t=$ags_t+$ags;
                                $sep_t=$sep_t+$sep;
                                $okt_t=$okt_t+$okt;
                                $nov_t=$nov_t+$nov;
                                $des_t=$des_t+$des;

                                $jtriw1btl = $jtriw1btl + ($jan+$feb+$mar);
                                $jtriw2btl = $jtriw2btl + ($apr+$mei+$jun);
                                $jtriw3btl = $jtriw3btl + ($jul+$ags+$sep);
                                $jtriw4btl = $jtriw4btl + ($okt+$nov+$des);
                                
                                $cskpd = '';
                            }else{
                                $cskpd = $cskpdcek;
                            }

                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 
                            
                            $cRet    .= "<tr><td style=\"vertical-align:top;font-weight:bold;\">$cskpd</td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">$nama</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";

                        }      
                    }else{
                        
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Belanja Tidak Langsung</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                            
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                    
                    if($num_rowbtl==1){
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Pengeluaran Pembiayaan</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                                                     
                    }
                
                    $ang_t=number_format($ang_tbtl,"2",",",".");
                    $jan_t=number_format($jan_t,"2",",",".");
                    $feb_t=number_format($feb_t,"2",",",".");
                    $mar_t=number_format($mar_t,"2",",",".");
                    $apr_t=number_format($apr_t,"2",",",".");
                    $mei_t=number_format($mei_t,"2",",",".");
                    $jun_t=number_format($jun_t,"2",",",".");
                    $jul_t=number_format($jul_t,"2",",",".");
                    $ags_t=number_format($ags_t,"2",",",".");
                    $sep_t=number_format($sep_t,"2",",",".");
                    $okt_t=number_format($okt_t,"2",",",".");
                    $nov_t=number_format($nov_t,"2",",",".");
                    $des_t=number_format($des_t,"2",",","."); 
          
                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Bulan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t</td>
                                </tr>";                                                     
                    
                    $jtriw1_t = number_format($jtriw1btl,2,',','.');
                    $jtriw2_t = number_format($jtriw2btl,2,',','.');
                    $jtriw3_t = number_format($jtriw3btl,2,',','.');
                    $jtriw4_t = number_format($jtriw4btl,2,',','.');

                    $cRet    .= " <tr><td></td> 
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Triwulan</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                    <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                                </tr>";                                                     

                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
                 
                //Sisa Kas BTL
                $ang_t = $this->rp_minus($ang_tpend - $ang_tbtl);
                $jtriw1_t = $this->rp_minus($jtriw1pend - $jtriw1btl);
                $jtriw2_t = $this->rp_minus($jtriw2pend - $jtriw2btl);
                $jtriw3_t = $this->rp_minus($jtriw3pend - $jtriw3btl);
                $jtriw4_t = $this->rp_minus($jtriw4pend - $jtriw4btl);

                $cRet    .= " <tr><td></td> 
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"left\">Sisa Kas setelah dikurangi Belanja Tidak Langsung & Pembiayaan Pengeluran Per Triwulan</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw1_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw2_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw3_t</td>
                                <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\" colspan=\"3\">$jtriw4_t</td>
                            </tr>";                                                     
              
                    $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
            
                //BL
                if($id==0){
                    $where1 = '';
                }else{
                    $where1 = "b.kd_skpd='$id' and ";
                }    
                $sql="  select kd_skpd,isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                        isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                        isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                            SELECT '' [kd_skpd],b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where $where1 SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan
                        ) c group by kd_skpd";
                    $qtbl = $this->db->query($sql);
                    $num_rowbl = $qtbl->num_rows();

                    $ang_tbl=0;
                    $jan_t=0;
                    $feb_t=0;
                    $mar_t=0;
                    $apr_t=0;
                    $mei_t=0;
                    $jun_t=0;
                    $jul_t=0;
                    $ags_t=0;
                    $sep_t=0;
                    $okt_t=0;
                    $nov_t=0;
                    $des_t=0;
                    $jtriw1bl = 0;
                    $jtriw2bl = 0;
                    $jtriw3bl = 0;
                    $jtriw4bl = 0;

                     
                    if($num_rowbl>0){
                        foreach ($qtbl->result() as $row){
                            $jan=$row->jan;
                            $feb=$row->feb;
                            $mar=$row->mar;
                            $apr=$row->apr;
                            $mei=$row->mei;
                            $jun=$row->jun;
                            $jul=$row->jul;
                            $ags=$row->ags;
                            $sep=$row->sep;
                            $okt=$row->okt;
                            $nov=$row->nov;
                            $des=$row->des; 
                            $ang = $jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des;
                            $ang_tbl=$ang_tbl+$ang;
        
                            $jan_t=$jan_t+$jan;
                            $feb_t=$feb_t+$feb;
                            $mar_t=$mar_t+$mar;
        
                            $apr_t=$apr_t+$apr;
                            $mei_t=$mei_t+$mei;
                            $jun_t=$jun_t+$jun;
        
                            $jul_t=$jul_t+$jul;
                            $ags_t=$ags_t+$ags;
                            $sep_t=$sep_t+$sep;
        
                            $okt_t=$okt_t+$okt;
                            $nov_t=$nov_t+$nov;
                            $des_t=$des_t+$des;

                            $jtriw1bl = $jtriw1bl + ($jan+$feb+$mar);
                            $jtriw2bl = $jtriw2bl + ($apr+$mei+$jun);
                            $jtriw3bl = $jtriw3bl + ($jul+$ags+$sep);
                            $jtriw4bl = $jtriw4bl + ($okt+$nov+$des);
                            
                            $ang=number_format($ang,"2",",",".");
                            $jan=number_format($jan,"2",",",".");
                            $feb=number_format($feb,"2",",",".");
                            $mar=number_format($mar,"2",",",".");
                            $apr=number_format($apr,"2",",",".");
                            $mei=number_format($mei,"2",",",".");
                            $jun=number_format($jun,"2",",",".");
                            $jul=number_format($jul,"2",",",".");
                            $ags=number_format($ags,"2",",",".");
                            $sep=number_format($sep,"2",",",".");
                            $okt=number_format($okt,"2",",",".");
                            $nov=number_format($nov,"2",",",".");
                            $des=number_format($des,"2",",","."); 



                            $cRet    .= "<tr><td></td> 
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Belanja Langsung</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des</td>
                                        </tr>";
                         }                        
                    }else{
                            $cRet    .= " <tr><td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;\" align=\"center\"></td> 
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"left\">Belanja Langsung</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                            <td style=\"vertical-align:top;border-top: solid 1px black;border-bottom: solid 1px black;font-weight:bold;font-size:$font1 px;\" align=\"right\">0,00</td>
                                        </tr>";                        
                        
                    }
               
                 //rincian    
                 if($id==0){
                     $sql1="select * from(
                                select kd_skpd,kd_skpd [kd_kegiatan],nm_skpd [nm_kegiatan],isnull(sum(total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c group by kd_skpd,nm_skpd
                            union all
                            select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                            isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                            isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                            ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                            union all
                            SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                            	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                            FROM trdrka b where SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                            GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";                 
                 }else{
                     $sql1="select * from(
                                select c.kd_skpd,d.kd_program [kd_kegiatan],d.nm_program [nm_kegiatan],isnull(sum(c.total),0) [total],isnull(sum(jan),0) [jan],isnull(sum(feb),0) [feb],isnull(sum(mar),0) [mar],
                                isnull(sum(apr),0) [apr],isnull(sum(mei),0) [mei],isnull(sum(jun),0) [jun],isnull(sum(jul),0) [jul],isnull(sum(ags),0) [ags],
                                isnull(sum(sep),0) [sep],isnull(sum(okt),0) [okt],isnull(sum(nov),0) [nov],isnull(sum(des),0) [des] from(
                                    SELECT b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where b.kd_skpd='$id' and SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.nm_skpd,b.kd_kegiatan,b.nm_kegiatan
                                ) as c join trskpd d on c.kd_kegiatan=d.kd_kegiatan group by c.kd_skpd,d.kd_program,d.nm_program
                                union all
                                SELECT b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan,isnull(sum(b.nilai),0) [total],
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=1) AS jan,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=2) AS feb,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=3) AS mar,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=4) AS apr,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=5) AS mei,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=6) AS jun,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=7) AS jul,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=8) AS ags,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=9) AS sep,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=10) AS okt,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=11) AS nov,
                                    	(SELECT isnull(SUM(nilai),0) FROM $nttriw WHERE kd_kegiatan=b.kd_kegiatan AND bulan=12) AS des  
                                    FROM trdrka b where b.kd_skpd='$id' and SUBSTRING(b.kd_kegiatan,17,2)<>'00'
                                    GROUP BY b.kd_skpd,b.kd_kegiatan,b.nm_kegiatan 
                    ) as gab order by kd_skpd,kd_kegiatan";
                }                 
                $query = $this->db->query($sql1);

                    $ang_t=0;
                    $ang_t2=0;
                    $jan_t2=0;
                    $feb_t2=0;
                    $mar_t2=0;
                    $apr_t2=0;
                    $mei_t2=0;
                    $jun_t2=0;
                    $jul_t2=0;
                    $ags_t2=0;
                    $sep_t2=0;
                    $okt_t2=0;
                    $nov_t2=0;
                    $des_t2=0;
                    $jtriw1_t = 0;
                    $jtriw2_t = 0;
                    $jtriw3_t = 0;
                    $jtriw4_t = 0;

                                                                    
                foreach ($query->result() as $row)
                {
                    $kode=$row->kd_kegiatan;
                    $nama=$row->nm_kegiatan;
                    
                    $jan=$row->jan;
                    $feb=$row->feb;
                    $mar=$row->mar;
                    $apr=$row->apr;
                    $mei=$row->mei;
                    $jun=$row->jun;
                    $jul=$row->jul;
                    $ags=$row->ags;
                    $sep=$row->sep;
                    $okt=$row->okt;
                    $nov=$row->nov;
                    $des=$row->des;
                    $ang = number_format($jan+$feb+$mar+$apr+$mei+$jun+$jul+$ags+$sep+$okt+$nov+$des,"2",",",".");
                   
                    if(strlen($kode)<=18){
                        $bold = 'font-weight:bold;';
                        $fontr = 'font-size: '.$font1.' px;';
                    }else{
                        $bold='';
                        $fontr = 'font-size: '.$font.' px;';
                    }

                    $jan=number_format($jan,"2",",",".");
                    $feb=number_format($feb,"2",",",".");
                    $mar=number_format($mar,"2",",",".");
                    $apr=number_format($apr,"2",",",".");
                    $mei=number_format($mei,"2",",",".");
                    $jun=number_format($jun,"2",",",".");
                    $jul=number_format($jul,"2",",",".");
                    $ags=number_format($ags,"2",",",".");
                    $sep=number_format($sep,"2",",",".");
                    $okt=number_format($okt,"2",",",".");
                    $nov=number_format($nov,"2",",",".");
                    $des=number_format($des,"2",",",".");
                    
                    $cRet    .= " <tr><td style=\"vertical-align:top;$bold $fontr \" >$kode </td>                            
                                        <td style=\"vertical-align:top;$bold $fontr \" >$nama</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ang</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jan</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$feb</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mar</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$apr</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$mei</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jun</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$jul</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$ags</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$sep</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$okt</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$nov</td>
                                        <td style=\"vertical-align:top;$bold $fontr \" align=\"right\">$des</td>
                                    </tr>
                                     ";
                  }  
                  
                    $ang_t2=number_format($ang_tbl,"2",",",".");
                    $jan_t2=number_format($jan_t,"2",",",".");
                    $feb_t2=number_format($feb_t,"2",",",".");
                    $mar_t2=number_format($mar_t,"2",",",".");
                    $apr_t2=number_format($apr_t,"2",",",".");
                    $mei_t2=number_format($mei_t,"2",",",".");
                    $jun_t2=number_format($jun_t,"2",",",".");
                    $jul_t2=number_format($jul_t,"2",",",".");
                    $ags_t2=number_format($ags_t,"2",",",".");
                    $sep_t2=number_format($sep_t,"2",",",".");
                    $okt_t2=number_format($okt_t,"2",",",".");
                    $nov_t2=number_format($nov_t,"2",",",".");
                    $des_t2=number_format($des_t,"2",",",".");
                                      
                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Langsung Per Bulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jan_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$feb_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mar_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$apr_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$mei_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jun_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jul_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ags_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$sep_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$okt_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$nov_t2</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$des_t2</td>
                                    </tr>";
                                             
                    $jtriw1_t = number_format($jtriw1bl,2,',','.');
                    $jtriw2_t = number_format($jtriw2bl,2,',','.');
                    $jtriw3_t = number_format($jtriw3bl,2,',','.');
                    $jtriw4_t = number_format($jtriw4bl,2,',','.');

                    $cRet    .= " <tr><td></td>                            
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Langsung Per Triwulan</td>
                                        <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t2</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                        <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                    </tr>";  

                  $cRet    .= " <tr><td></td> 
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                    <td>&nbsp;</td>
                                </tr>";                  
        
                    //sisa kas bl
                    $ang_t = $this->rp_minus($ang_tpend - $ang_tbl);
                    $jtriw1_t = $this->rp_minus($jtriw1pend - $jtriw1bl);
                    $jtriw2_t = $this->rp_minus($jtriw2pend - $jtriw2bl);
                    $jtriw3_t = $this->rp_minus($jtriw3pend - $jtriw3bl);
                    $jtriw4_t = $this->rp_minus($jtriw4pend - $jtriw4bl);
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Sisa Kas setelah dikurangi Belanja Langsung Per Triwulan</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  


                    //bl+btl+pengeluaran pembiayaan
                    $ang_t = $this->rp_minus($ang_tbtl + $ang_tbl);
                    $jtriw1_t = $this->rp_minus($jtriw1btl + $jtriw1bl);
                    $jtriw2_t = $this->rp_minus($jtriw2btl + $jtriw2bl);
                    $jtriw3_t = $this->rp_minus($jtriw3btl + $jtriw3bl);
                    $jtriw4_t = $this->rp_minus($jtriw4btl + $jtriw4bl);
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Jumlah Alokasi Belanja Tidak Langsung dan Belanja Langsung serta pembiayaan pengeluaran</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  


                    //bl+btl+pengeluaran pembiayaan
                    $ang_t = $this->rp_minus($ang_tpend - ($ang_tbtl + $ang_tbl));
                    $jtriw1_t = $this->rp_minus($jtriw1pend - ($jtriw1btl + $jtriw1bl));
                    $jtriw2_t = $this->rp_minus($jtriw2pend - ($jtriw2btl + $jtriw2bl));
                    $jtriw3_t = $this->rp_minus($jtriw3pend - ($jtriw3btl + $jtriw3bl));
                    $jtriw4_t = $this->rp_minus($jtriw4pend - ($jtriw4btl + $jtriw4bl));
                    
                      $cRet    .= " <tr><td></td>                            
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\">Sisa Kas setelah dikurangi Belanja Tidak Langsung dan Belanja Langsung serta pembiayaan pengeluaran</td>
                                            <td style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$ang_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw1_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw2_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw3_t</td>
                                            <td colspan=\"3\" style=\"vertical-align:top;font-weight:bold;font-size:$font1 px;\" align=\"right\">$jtriw4_t</td>
                                        </tr>";  

 
 
            $cRet .="<tr>
                        <td colspan=\"15\" width=\"100%\">							
					        <table border=\"0\" width=\"100%\">
					            <tr>								
					                <td width=\"70%\">&nbsp;</td>
					                <td width=\"30%\" align=\"center\">$kota,$tanggal
					                    <br>$jabatan1
                                        <p>&nbsp;</p>
                                        <br>
                                        <br>
    				                    <br><b><u>$nama1</u></b>
    				                    <br>$pangkat1 
    				                    <br>$nip1 
					                </td>
                                </tr>
                            </table>
                        </td>
                 </tr>
                 </tbody>
                 
               ";
        
            
        $cRet .=       " </table>";
        $data['prev']= $cRet;
        if ($id==0){
            $id = 'Keseluruhan'; 
        }
            $judul  = 'Anggaran_Kas_'.$id;//'Anggaran_KAS_'.$id;
        $this->template->set('title', 'CETAK PERDA REALISASI LAMPIRAN V');        
        switch($cetak) {
        case 0;  
                echo ("<title>A</title>");
                echo($cRet);
            break;
        case 1;
      		ini_set('memory_limit','10000M');
            set_time_limit(10000);

             $this->_mpdf('',$cRet,5,3,10,'1');
        break;
        case 2;        
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-excel");
            header("Content-Disposition: attachment; filename= $judul.xls");
            
            $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 3;     
            header("Cache-Control: no-cache, no-store, must-revalidate");
            header("Content-Type: application/vnd.ms-word");
            header("Content-Disposition: attachment; filename= $judul.doc");
           $this->load->view('anggaran/rka/perkadaII', $data);
        break;
        case 4;
            ini_set('memory_limit','10000M');
            set_time_limit(10000);
            
            $this->_mpdf('',$cRet,5,3,10,'1','','',$judul);        

/*
        header ("Cache-Control: must-revalidate, post-check=0, pre-check=0");
        header('Content-Type: application/octetstream');
        header("Content-Transfer-Encoding: Binary");
        header("Content-length: ".filesize($data));
        header("Content-disposition: attachment; filename= $judul.pdf");
        readfile("$data");  
        break;
*/
        } 
    }


//End Cetak Anggaran Kas Penyempurnaan



}


